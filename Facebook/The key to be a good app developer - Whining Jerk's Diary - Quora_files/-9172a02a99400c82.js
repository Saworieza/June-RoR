/*
Name: main.js
URL: http://qsf.cf.quoracdn.net/-9172a02a99400c82.js
Generated: 1401236079651540
Files: /w2.keycombo.js, /ytplayer.js, /qtexteditor.js, /app/view/topic.js, /async_post.js, /typeahead.js, /fastclick.js, /viz.js, /app/view/question/question_add.js, /app/view/question/fast_answers.js, /view/smart_scroll.js, /app/view/home.js, /app/view/search/google_search_iframe.js, /app/view/feed.js, /app/view/question.js, /app/view/board/blog.js, /jquery.mjs.nestedSortable.js, /jquery.tinysort.js, /app/view/signup.js, /app/view/signup/mobile_app.js, /app/view/contact_importer.js, /app/view/notifications.js, /app/view/user.js, /app/view/query.js, /app/view/suggestions.js, /pinterest.js, /app/view/user_stats.js, /app/view/user_content.js, /app/view/livenode_log.js, /app/view/layout/site_header.js, /app/view/intro_to_quora.js, /main.js
*/
rec('package', 'Start', 'main.js');require.install("w2.keycombo",function(require,a,b){var c=require("cookies"),d=require("scribe"),e="keyboard_used",f={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",13:"ENTER",27:"ESCAPE",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"},g=a.hasCmdKey=/Mac/.test(navigator.platform),h=function(){$("body").addClass("show_focus"),c.cookie(e)||(c.cookie(e,!0),d.log({category:"keyboard_shortcuts",time:(new Date).getTime()}))},i=function(a){return a.toUpperCase().split(" ").map(function(a){return{alt:/ALT-/.test(a),ctrl:/CTRL-/.test(a)||!g&&/CMD-/.test(a),meta:/META-/.test(a)||g&&/CMD-/.test(a),shift:/SHIFT-/.test(a),character:a.split("-").pop()}})},j=function(a){return a.map(function(a){var b="";return a.alt&&(b+="ALT-"),a.ctrl&&(b+="CTRL-"),a.meta&&(b+="META-"),a.shift&&(b+="SHIFT-"),b+=a.character,b}).join(" ")};a.bindKeyComboHandler=function(a,b,c,d){var e=i(b);b=j(e);var g=$(a).data("kchandlers")||{};if(b in g)return!1;var k=0,l,m=function(){k=0,clearTimeout(l)},n=function(a){clearTimeout(l);var b=a.target.nodeName.toLowerCase();if(!d&&(a.target.isContentEditable||b=="input"||b=="textarea"))return;var g=e[k],i=f[a.which]||String.fromCharCode(a.which).toUpperCase();if(i===g.character&&a.altKey==g.alt&&a.ctrlKey==g.ctrl&&a.metaKey==g.meta&&a.shiftKey==g.shift)return k+=1,k==e.length?(k=0,h(),c(a)):(l=setTimeout(m,1e3),!1);m()};return g[b]=n,$(a).data("kchandlers",g),$(a).on("keydown",n),!0},a.unbindKeyComboHandler=function(a,b){a=a.toUpperCase();var c=$(b).data("kchandlers")||{};return a in c?($(b).unbind("keydown",c[a]),delete c[a],!0):!1}}),require.install("ytplayer",function(require,a,b){a.getYTPlayerStatuses=function(a,b){var c=[];return a.find(".qtext_embed iframe").each(function(a,d){var e=$(d).attr("id"),f=$(d).parent().attr("data-yt-id");$.each(window.YT.players,function(a,b){if(b.playerId==e){var d=b.player.getCurrentTime();c.push({ytId:f,time:d,state:b.state})}}),b&&b(d)}),c},a.restoreYTPlayerStatuses=function(a,b){$.each(b,function(b,c){var d=a.find('.qtext_embed[data-yt-id="'+c.ytId+'"]');if(!d.size())return;d=d.get(0),$(d).click(),$.each(window.YT.players,function(a,b){b.playerId==$(d).find("iframe").attr("id")&&(b.onReady=function(a){a.player.seekTo(c.time),(c.state==window.YT.PlayerState.PAUSED||c.state==window.YT.PlayerState.ENDED)&&a.player.pauseVideo()})})})}}),require.install("qtexteditor",function(require,a,b){function m(){return(new Date).getTime()*1e3}function n(a){var b=parseInt(a,10);return isNaN(b)?a!="normal"&&a!="lighter":b>400}var c=require("w2.quora").Component,d=require("qed/edit").edit,e=require("qed/util"),f=e.hasCtrlOrCmd,g=e.hasShift,h=e.deleteContents,i=require("view/fixable"),j=require("qed/npd"),k=require("settings"),l=require("qed/modifiers"),o=a.QTextEditorBase=c.extend({onUnload:function(){this.typingTimeout&&(clearTimeout(this.typingTimeout),this.typingTimeout=null),this.meaningfulChangeTimeout&&(clearTimeout(this.meaningfulChangeTimeout),this.meaningfulChangeTimeout=null),this.uninstallScrollHandlers(),this._qed&&(this._qed.stop(),delete this._qed)},onLoad:function(a){function e(a){return function(){return b.modify(function(b,c){$(b).before("["+a+"]"),$(c).after("[/"+a+"]")},!0),!1}}function g(a,c){f.$("#@cmd_"+a).click(function(){return b.modify(c,!0),f.inputEntered(),!1})}this.linkSelectorLoaded=!1,this.editor=this.$("#@editor");if(this.editor.length===0)return;var b=this._qed=d(this.editor[0]);if(!b)return;var c=require("webnode2");c.interactionMode&&c.interactionMode.bindInteractionMode(this.editor),this.enterCallback||(this.enterCallback=null),this.focusCallback||(this.focusCallback=null),this.blurCallback||(this.blurCallback=null),this.typingStateCallback||(this.typingStateCallback=function(a){}),this.typingTimeout=null,this.lastInputTime=0,this.lastTypingReportTime=0,this.lastReportedTypingState="empty",this.typingStopped=!1,this.meaningfulChangeCallback||(this.meaningfulChangeCallback=function(){}),this.meaningfulChangeTimeout=null,this.resetMeaningfulChange(),this.$("#@add_qlink").tooltip({contents:"Link to questions, topics, blogs and people."}),this.$("#@cmd_blockquote").tooltip({contents:"Blockquote Text"}),this.$("#@cmd_code").tooltip({contents:"Code Block [code][/code]"}),this.$("#@cmd_latex").tooltip({contents:"LaTeX [math][/math]"}),this.$("#@cmd_spoiler").tooltip({contents:"Spoiler [spoiler][/spoiler]"}),this.$("#@cmd_qimg").tooltip({contents:"Insert an Image"}),this.$("#@cmd_inserthr").tooltip({contents:"Insert Horizontal Separator"}),this.$("#@cmd_heading").tooltip({contents:"Heading"}),this.$("#@add_qlink").click(this.fnbind(function(){return this.addLink(),!1})),this.$("#@cmd_code").click(e("code")),this.$("#@cmd_latex").click(e("math")),this.$("#@cmd_spoiler").click(e("spoiler")),this.$("#@cmd_qimg").click(this.fnbind(function(){return this.openImageDialog(),!1}));var f=this;g("bold",l.bold),g("italic",l.italic),g("underline",l.underline),g("blockquote",l.blockquote),g("insertorderedlist",l.orderedList),g("insertunorderedlist",l.unorderedList),g("inserthr",function(a,b){var c=l.insertHR(a,b,f.hr_img);f.markImageAsDetected(c)}),g("heading",l.heading),this.$("#@save").click(this.fnbind(function(){this.save()})),this.editor.on("input",this.fnbind(function(a){this.editorInputChange(a)})),this.isIE=navigator.userAgent.match(/(Trident)|(.NET)/i),this.isIE||(this.isIE=window&&window.navigator.appName=="Microsoft Internet Explorer"),this.editor.keydown(this.fnbind(function(a){return this.isIE&&(this.editorInputChange(a),this.handlePlaceholder(!0)),this.editorKeyDown(a)})),this.editor.keyup(this.fnbind(function(a){return this.editorKeyUp(a)})),this.editor.keypress(this.fnbind(function(a){return this.editorKeyPress(a)})),this.editor.focus(this.fnbind(function(a){this.editor.attr("focused",!0),this.handlePlaceholder(!1),this.loadLinkSelector(),this.focusCallback&&this.focusCallback(),this.focusEditLinkCallback&&this.focusEditLinkCallback()})),this.editor.blur(this.fnbind(function(a){this.editor.removeAttr("focused"),this.handlePlaceholder(!1),this.blurCallback&&this.blurCallback(),this.detectLinks()})),this.editor.click(this.fnbind(function(a){this.setFormattingButtons(a.target)}));var h=this.fnbind(function(){this.qlinkSync()});this.$("#@qlink_text").keydown(h),this.$("#@qlink_text").keyup(h),this.$("#@qlink_text").keypress(h),this.$("#@qlink_text").change(h),this.$(".@qlink_close").click(this.fnbind(function(){return this.replaceLinkWithText(this.$("#@qlink_key").val(),"@"+this.getLinkSelector().getValue()),this.editor.focus(),!1})),this.$("#@qlink_update").click(this.fnbind(function(){return this.qlinkUpdate(),!1})),this.$("#@editor img").each(function(a,b){f.markImageAsDetected(b)}),this._enableImageDetection=!0,this.fixEditorButtons(),this.registerLinkHandlers(),this.$("#@fake_editor").click(this.fnbind(function(){this.hideFakeEditor()})),this.hideFakeEditorByDefault&&(this.hideFakeEditor(),this.blurOnLoad&&this.editor.blur())},fixEditorButtons:function(){if(this.buttonsVisible&&this.shouldFixButtons){var a=this.$("#@qtext_editor_buttons");i.makeFixable({element:a,width_dep:!0,height_dep:!0,scroll_dep:!0,scroll_marker:this.$("#@editor_outer")})}},handlePlaceholder:function(a){!this.isEmpty()||a?this.editor.removeClass("needs_placeholder"):this.editor.addClass("needs_placeholder")},hideFakeEditor:function(){this.$("#@fake_editor").hide(),this.editor.show(),this.editor.focus()},registerLinkHandlers:function(){function c(c,d){b&&b.indexOf(c)>=0&&a.addLinkHandlerForType(c,a.fnbind(d))}this._linkHandlers={};var a=this,b=a.supported_link_handlers;c("youtube",a.handleYoutubeLink),c("image",a.handleImageLink),c("email",a.handleEmailLink),c("invalid",a.handleInvalidLink)},addLinkHandlerForType:function(a,b){this._linkHandlers&&(this._linkHandlers[a]=b)},getLinkHandler:function(a){return this._linkHandlers&&this._linkHandlers[a]},loadLinkSelector:function(a){this.linkSelectorLoaded||this.serverCall("get_link_selector").contentFor(this.$("#@link_selector"),{parentCID:this.cid}).success(this.fnbind(function(b){if(!this.plaintext){var c=this.getLinkSelector();c&&c.setCallback(this.fnbind(function(){this.onLinkSelection()}))}this.linkSelectorLoaded=!0,a&&$.isFunction(a)&&a()})).send()},makeKey:function(){var a="",b="abcdefghijklmnopqrstuvwxyz0123456789";for(var c=0;c<10;c++)a+=b[Math.floor(Math.random()*b.length)];return a},syncTypingState:function(){var a=1e7,b;this.isEmpty()||this.typingStopped?b="empty":this.lastInputTime<m()-a?b="paused":b="typing";var c=!1;b!=this.lastReportedTypingState&&(c=!0),b!="empty"&&this.lastTypingReportTime<m()-55e6&&(c=!0),c&&(this.typingStateCallback(b),this.lastReportedTypingState=b,this.lastTypingReportTime=m()),this.typingTimeout&&(clearTimeout(this.typingTimeout),this.typingTimeout=null);if(b=="typing"||b=="paused")this.typingTimeout=setTimeout(this.fnbind(function(){this.syncTypingState()}),a/1e3)},checkMeaningfulChange:function(){var a=this.checkMeaningfulTimeoutPeriod*1e3;if(this.meaningfulChangeTimeout)return;this.meaningfulChangeTimeout=setTimeout(this.fnbind(function(){var a=this.serialize(!0);a!=this.meaningfulChangeBase&&this.meaningfulChangeCallback(),this.meaningfulChangeBase=a,this.meaningfulChangeTimeout=null}),a)},reportMeaningfulChange:function(){this.meaningfulChangeBase=null,this.checkMeaningfulChange()},resetMeaningfulChange:function(){this.meaningfulChangeBase=this.serialize(!0),this.meaningfulChangeTimeout&&(clearTimeout(this.meaningfulChangeTimeout),this.meaningfulChangeTimeout=null)},editorKeyUp:function(a){this.detectNewImages(),this.inputEntered(),this._detectMaybeBypassSpacingRulesOnNextKeyUp&&(this._detectMaybeBypassSpacingRulesOnNextKeyUp=!1,this.maybeBypassSpacingRules()),this._detectPasteOnNextKeyUp&&(this._detectPasteOnNextKeyUp=!1,this.fixBadSpacing()),this._detectLinksOnNextKeyUp&&(this._detectLinksOnNextKeyUp=!1,this.detectLinks())},inputEntered:function(){this.typingStopped=!1,this.lastInputTime=m(),this.syncTypingState(),this.checkMeaningfulChange(),this.dirtyText()},text:function(a){var b=this._cachedText;if(a||!b)b=this._qed.text();return(this._cachedText=b)||""},dirtyText:function(){this._cachedText=null},_cachedUrlInfo:{},getUrlInfo:function(a,b){var c=this,d=c._cachedUrlInfo[a];d!==!1&&(d?b(d):($(c).trigger("link-fetch-start",[a]),c.serverCall("get_url_info").kwargs({url:a}).success(function(d){b(c._cachedUrlInfo[a]=d),$(c).trigger("link-fetch-end",[a])}).error(function(){c._cachedUrlInfo[a]=!1,$(c).trigger("link-fetch-end",[a])}).send()))},detectLinks:function(){var a=this,b=require("linkify").iterLinks;b(a.text(),function(b,c){a.detectLink(b,c)})},detectLink:function(a,b){var c=this;if(a&&a.indexOf("mailto:")===0){var d={type:"email",title:b,url:a};c.handleDetectedLink(d,a,b)}else c.getUrlInfo(a,function(d){c.handleDetectedLink(d,a,b)})},handleDetectedLink:function(a,b,c){var d=a&&a.type,e=d&&this.getLinkHandler(d);return e?e(a,b,c):$(this).trigger("link-added-to-editor",[a,b,c])},handleImageLink:function(a,b,c){var d=this;d.findTextAndModify(c,function(b){var c=d.replaceLinkWithImage(b,a.url);d.detectNewImage(c)})},handleYoutubeLink:function(a,b,c){var d=this;d.findTextAndModify(c,function(b){var c="http://img.youtube.com/vi/"+a.video_id+"/hqdefault.jpg",e=d.replaceLinkWithImage(b,c);d.markImageAsDetected(e);for(var f in a)e.setAttribute(f,a[f])})},handleInvalidLink:function(a,b,c){},handleEmailLink:function(a,b,c){},replaceLinkWithImage:function(a,b){var c=a;$(c.foundStart).replaceWith(c.start),$(c.foundEnd).replaceWith(c.end),e.deleteContents(c.start,c.end),this.handleImageWithinLink(c);var d=b&&this.addImage(b,!0);return d},handleImageWithinLink:function(a){var b=a.start.parentElement;if(!e.hasTag(b,"a")||b!==a.end.parentElement)return;var c=b.firstChild;while(c){var d=c.nextSibling;c.nodeType===3?(!c.nodeValue||c.nodeValue.length===0)&&$(c).remove():e.hasTag(c,"span")&&c!==a.start&&c!==a.end&&(!c.childNodes||c.childNodes.length===0)&&$(b).after(c),c=d}b.firstChild==a.start&&b.lastChild==a.end&&($(b).before(a.start).after(a.end),e.deleteContents(a.start,a.end))},findTextAndModify:function(a,b,c){var d=this,e=require("find"),f=!1;d._qed.modify(function(c,f){e.findText(d.editor.get(0),a,function(a,d){var e={start:c,end:f,foundStart:a,foundEnd:d};return b(e)})},c)},onLinkAdded:function(a){var b=this;$(b).bind("link-added-to-editor",function(c,d,e,f){return a.call(b,d,e,f)})},onLinkFetchStart:function(a){var b=this;$(b).bind("link-fetch-start",function(c,d){return a.call(b,d)})},onLinkFetchEnd:function(a){var b=this;$(b).bind("link-fetch-end",function(c,d){return a.call(b,d)})},detectNewImages:function(){if(!this._enableImageDetection)return;var a=this;this.$("#@editor img").each(function(b,c){a.detectNewImage(c)})},detectNewImage:function(a){function c(a,b,c){if(!/^webkit-fake-url:/.test(a)){var d=new Image;d.onload=b,c&&(d.onerror=c),d.src=a}else c&&c()}var b=this;if(!b.markImageAsDetected(a))return;$(a).addClass("qtext_image"),c(a.src,function(){b.serverCall("upload_image_by_url").kwargs({url:a.src}).success(function(b){b&&c(b.url,function(){a.src=b.url})}).send()},function(){$(a).remove()})},markImageAsDetected:function(a){if(!a.hasAttribute("detected"))return a.setAttribute("detected",a.src.slice(0,100)),!0},editorInputChange:function(a){this.handlePlaceholder(!1)},editorKeyPress:function(a){if(String.fromCharCode(a.which)=="@")return this.addLink(),!1},editorKeyDown:function(a){if(this.enterCallback&&!a.shiftKey&&a.keyCode==13)return this.enterCallback(),!1;switch(a.which){case 86:if(!f(a))break;this._detectPasteOnNextKeyUp=!0;case 32:case 13:this._detectLinksOnNextKeyUp=!0;case 221:this._detectMaybeBypassSpacingRulesOnNextKeyUp=!0}return this._detectPasteOnNextKeyUp&&(this._detectMaybeBypassSpacingRulesOnNextKeyUp=!0),!0},addDummySpan:function(){var a;return this._qed.modify(function(b,c){h(b,c),a=document.createElement("span"),c.parentNode.insertBefore(a,c)}),a},openImageDialog:function(){var a=this;a._dialog=a._dialog||a.dialog().title("Insert an Image").cancel(null,"Close").close(function(){a._dialog=null}).load("image_dialog_contents")},addImage:function(a,b,c){var d=this;return d._qed.modify(function(e,f){var g=e.parentNode;if(g){var h=document,i=h.createElement("img"),j,k;return i.src=a,i.setAttribute("unselectable","on"),c?k=i:(j=h.createElement("div"),j.appendChild(i),k=j),g.insertBefore(k,e),b||d.detectNewImages(),i}},!0)},addLink:function(){if(!this.linkSelectorLoaded)return this.loadLinkSelector(this.fnbind(this.addLink));var a=this.makeKey(),b=document.createElement("a");b.id="qlink_"+a,b.innerHTML="…",b.className="qlink",b.href="#",this._qed.modify(function(a,c){function d(a){$(a).closest("a.qlink").map(function(){$(this).after(a)})}d(a),d(c),h(a,c),$(a).before(b)},!0),this.qlink_data[a]={target:{},text:""},setTimeout(this.fnbind(function(){this.editLink(a,"")}),0)},setSelectionlessCallback:function(a){if(!this.selectionlessCallback){var b=this.getLinkSelector(),c=this;b.setSelectionlessCallback(function(){c.callSelectionlessCallback()})}this.selectionlessCallback=a},callSelectionlessCallback:function(){var a=this.selectionlessCallback;a&&a()},editLink:function(a,b){this.closeEditLink(),this.editingLink=!0;var c=this,d=this.qlink_data[a].text?this.qlink_data[a].text:b,e=this.qlink_data[a].target,f=this.qlink_data[a].options;e.type&&this.$("#@qlink_selector").hide(),this.$("#@qlink_key").val(a),d&&this.$("#@qlink_text").val(d);var g=this.$("#@editor_wrapper").offset(),h=this.$("#@editor #qlink_"+a).offset(),i=h.left-g.left,j=h.top-g.top;this.$("#@qlink_editor").css("left",i-10),this.$("#@qlink_editor").css("top",j+20),this.$("#@qlink_editor").removeClass("hidden");var k=this.getLinkSelector();k.clear(),k.setText(d),k.focus(!0),k.setEscKeyDown(this.fnbind(function(b){var c=k.getValue(),d=b.keyCode==27,e=!c&&b.keyCode==13,f=!c&&b.keyCode==8,g="@";d&&c&&(g="@"+c);if(e||d||f)return this.replaceLinkWithText(a,g),setTimeout(this.fnbind(function(){this.editor.focus()}),0),!1}));var l=function(){c.replaceLinkWithText(a,"@"+k.getValue())};this.setSelectionlessCallback(this.fnbind(function(){l(),setTimeout(this.fnbind(function(){this.editor.focus()}),0)})),k.setKeyUp(function(){c.editLinkText(a,k.getValue())}),e.type?this.$("#@qlink_text").focus():(this.focusEditLinkCallback=this.fnbind(function(){this.editingLink?l():this.closeEditLink()}),this.$("#@editor #qlink_"+a).addClass("qlink_active"))},getLinkSelector:function(){return this.child("link_selector")},replaceLinkWithText:function(a,b){this.closeEditLink();if(!a)return;var c=this.$("#@editor #qlink_"+a),d=$("<div>");b=d.text(b).html(),c.length&&this._qed.modify(function(a,d){c.after(d).after(a).replaceWith(b||"")}),delete this.qlink_data[a]},editLinkText:function(a,b){if(!this.editingLink)return;this.qlink_data[a].text=b,this.$("#@editor #qlink_"+a).text("@"+b)},closeEditLink:function(){this.editingLink=!1;var a=this.$("#@qlink_key").val();if(!a)return;this.$("#@qlink_editor").addClass("hidden"),this.$("#@editor #qlink_"+a).removeClass("qlink_active"),this.$("#@qlink_selector").show()},qlinkSync:function(){var a=this.$("#@qlink_key").val(),b=this.$("#@qlink_text").val(),c=this.$("#@editor #qlink_"+a);c.text(b||"…");var d=this.getLinkSelector().result;b&&c.attr("title",this.qlink_data[a].text=b),d&&(this.qlink_data[a].target=d)},qlinkUpdate:function(){this.qlinkSync(),this.closeEditLink()},onLinkSelection:function(){var a=this.getLinkSelector().qValue;this.$("#@qlink_text").val(a),this.qlinkUpdate(),setTimeout(this.fnbind(function(){this.editor.focus()}),0),this.inputEntered()},fixBadSpacing:function(){var a=this,b=this._qed.text();require("settings").qtext_improvement_spacing&&a._qed.modify(function(b,c){var d=a.editor.get(0);for(var f=e.firstLeaf(d);f;f=e.nextLeaf(f,d))if(f.nodeType===3){var g=f.textContent;g=l.cleanUpSpace(g);var h=g.replace(/ +/g," ");f.nodeValue=h,e.checkBeginningOfLine(f)&&l.removeTextNodeLeadingSpace(f)}})},maybeBypassSpacingRules:function(){if(require("settings").qtext_improvement_spacing){var a=this._qed.text(),b=["[code]","[/code]"];for(var c=0;c<b.length;c++)if(a.indexOf(b[c])>=0){require("settings").qtext_improvement_spacing=!1;break}}},setFormattingButtons:function(a){var b=$(a),c={bold:n(b.css("font-weight")),italic:b.css("font-style")=="italic",underline:b.css("text-decoration")=="underline"};e.isHeading(a)&&delete c.bold;for(var d in c)c[d]?this.$("#@cmd_"+d).addClass("qtext_editor_button_active"):this.$("#@cmd_"+d).removeClass("qtext_editor_button_active")},setEnterCallback:function(a){this.enterCallback=a},setTypingStateCallback:function(a){this.plaintext?this.typingStateCallback=null:this.typingStateCallback=a},setMeaningfulChangeCallback:function(a){this.plaintext?this.meaningfulChangeCallback=null:this.meaningfulChangeCallback=a},setFocusCallback:function(a){this.focusCallback=a},setBlurCallback:function(a){this.blurCallback=a},serialize:function(a){var b={html:this.html(a)};return this.plaintext?b.data={}:b.data=this.qlink_data,b},html:function(a){if(this.plaintext){var b=this.editor.val();return b||(b=""),b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")}return this._qed?this._qed.html(!a):this.editor.html()},setHtml:function(a,b){return b&&(this.qlink_data=b),this.editor.html(a)},isEmpty:function(){if(this.plaintext)return this.editor.val()==="";if(this.editor.length===0)return!0;var a=this.editor[0];if(!a)return!0;if(a.childNodes.length==1&&a.childNodes[0].tagName=="BR")return!0;var b=this.html(!0);return b===""},valLength:function(){if(this.plaintext){var a=this.editor.val();return a?a.replace(/\n/g,"<br>").length:0}return this.text().length},clear:function(a){this.plaintext?this.editor.val(""):(this._qed&&this._qed.clear(a),this.qlink_data={},this.lastInputTime=m(),this.syncTypingState(),this.dirtyText())},stopTyping:function(){this.plaintext||(this.typingStopped=!0,this.syncTypingState())},selectAll:function(){var a=this.editor;this._qed.modify(function(b,c){$(b).prependTo(a),$(c).appendTo(a)},!0)},focus:require("atexit").hook(function(){var a=this;a.whenOnLoaded(function(){var b=a.editor;b.anchor().focus();var c=a.plaintext?b.val().length>0:b.text().length>0;if(c){var d=b.get(0);a.plaintext?d.setSelectionRange?d.setSelectionRange(0,b.val().length):b.select():a._qed.modify(function(a,b){e.insertBefore(d,a,d.lastChild),e.insertBefore(d,b,d.lastChild)},!0)}b.attr("focused",!0)})}),blur:function(){this.editor.blur().removeAttr("focused")}}),p=a.LinkQTextEditor=o.extend({onLoad:function(a){this._super.apply(this,arguments),$.browser.msie&&parseInt($.browser.version,10)>=9&&document.execCommand("AutoUrlDetect",!1,!1);var b=this;this.link_class_to_option={},this.options=["href","text","preview","delete"],$.each(this.options,function(a,c){var d=b.getClassName(c);b.link_class_to_option[d]=c}),b.linkEditorDiv=b.$("#@editor_wrapper"),b.initLinkOptions(),b.onLinkAdded(function(a,c,d){b.handleLinkAdded(a,c,d)}),b.editor.mouseover(function(a){return b.linkEditorMouseOver(a)}),b.editor.keydown(function(a){return b.linkEditorKeyDown(a)}),b._retrievingUrlInfo={},b._retrievingUrlInfoCount=0,b.onLinkFetchStart(function(a){b.$("#@spinner").show(),b._retrievingUrlInfo[a]=!0,b._retrievingUrlInfoCount++}),b.onLinkFetchEnd(function(a){b._retrievingUrlInfoCount--,delete b._retrievingUrlInfo[a],b._retrievingUrlInfoCount===0&&b.$("#@spinner").hide()})},onUnload:function(){this._super.apply(this,arguments),this.editor=$(),delete this.linkEditorDiv,delete this.linkOptions},getUrlInfo:function(a,b){if(this._retrievingUrlInfo&&this._retrievingUrlInfo[a])return;this._retrievingUrlInfo[a]=!0;var c=this;this._super.apply(this,[a,function(d){delete c._retrievingUrlInfo[a],b(d)}])},getClassName:function(a){return"qtext_editor_link_"+a},getAttrName:function(a){return a==="href"?a:"data-link-"+a},getButton:function(a){return this.$("#@link_option_"+a)},initLinkOptions:function(){var a=this;a.linkOptions=a.$("#@qtext_editor_link_options");var b=[["href","Show linked URL"],["text","Show linked title"],["delete","Show unlinked"]];$.each(b,function(b,c){a.getButton(c[0]).click(function(b){return a.handleLinkOption(c[0])}).tooltip({contents:c[1]})})},positionLinkOptions:function(a){var b=$("<span>﻿</span>").prependTo(a),c=b.offset(),d=b.height();b.remove();var e=this.linkEditorDiv.offset(),f=c.left-e.left-2,g=c.top-e.top;this.linkOptionsHeight=this.linkOptionsHeight||this.linkOptions.outerHeight(),g-=this.linkOptionsHeight,this.linkOptions.css("top",g),this.linkOptions.css("left",f),this._isPosnIntersectsHeader(c.top+g)&&(g=g+this.linkOptionsHeight+d,this.linkOptions.css("top",g))},_isPosnIntersectsHeader:function(a){var b;k.new_grid?b=$(".SiteHeader"):b=$(".header");if(b.length===0)throw"var siteHeader does not exist in qTextEditor positionLinkOption";var c=b.offset().top+b.outerHeight();return c>a},linkEditorMouseOver:function(a){var b=a.target,c=(b&&b.nodeName||"").toLowerCase(),d=this.linkOptions;b=$(b);var f;if(c==="a")f=b[0];else{var g=b.parents("a");g.length>0&&(f=g[0])}this.unhighlightLinkTarget(),f&&(this.linkTarget=f,this.positionLinkOptions(f));if(f||e.contains(d[0],b)){var h=this.detectNewLinkElement(f);h&&(this.highlightActiveButton(f),this.highlightLinkTarget(),d.show())}else d.hide()},highlightActiveButton:function(a){var b=this,c=b.getOption(a);$.each(b.options,function(a,d){var e=b.getButton(d);d===c?e.addClass("active"):e.removeClass("active")})},highlightLinkTarget:function(){this.linkTarget&&$(this.linkTarget).addClass("qtext_editor_link_hover")},unhighlightLinkTarget:function(){this.linkTarget&&$(this.linkTarget).removeClass("qtext_editor_link_hover")},linkAlreadyDetected:function(a,b){var c=this,d=this.getLinkParent(b),e=d?c.getQlinkKey(d):null;if(e)return!0;if(d){var f=d;if($(f).text()!==a)return c.moveSelectionOut(f,b.start,b.end),c.moveSelectionOut(f,b.foundStart,b.foundEnd),c.detectNewLinkElement(d),!0}return!1},getLinkParent:function(a){var b=$(a.foundStart).parents("a"),c=b.length>0?b[0]:null;return c},detectLinks:function(){var a=this,b=require("linkify").iterLinks;b(a.text(),function(b,c){a.findTextAndModify(c,function(d){a.linkAlreadyDetected(c,d)||a.detectLink(b,c)})}),this.detectNewLinkElements()},detectLink:function(a,b){if(this.has_excluded_tld(a))return;this._super.apply(this,arguments)},has_excluded_tld:function(a){var b=this.tlds_to_exclude;if(!b)return!1;for(var c=0;c<b.length;c++){var d=b[c];if(a&&a.toLowerCase().indexOf(d,a.length-d.length)!==-1)return!0}return!1},linkEditorKeyDown:function(a){this.linkOptions.hide(),this.unhighlightLinkTarget()},getQlinkKey:function(a){if(e.hasTag(a,"a")){var b=$(a).attr("id");if(b&&b.indexOf("qlink_")===0)return b.substring(6)}return null},handleInvalidLink:function(a,b,c){this.handleLinkAdded(a,b,c,"href")},handleEmailLink:function(a,b,c){var d="Send an email to "+a.title;this.handleLinkAdded(a,b,c,"href",d)},handleLinkAdded:function(a,b,c,d,f){var g=this,h=document.activeElement==g.editor.get(0),i=a.title||c;i===b&&(d=d||"text",d==="text"&&(f=f||this.getDefaultText(b),i=f)),f=f||i,g.findTextAndModify(c,function(a){if(g.linkAlreadyDetected(c,a))return!1;var j=g.getLinkParent(a);return e.deleteContents(a.foundStart,a.foundEnd),g._qed.modify(function(e,h){var k=g.makeKey(),l="qlink_"+k;j?(g.moveSelectionOut(j,a.start,a.end),g.moveSelectionOut(j,a.foundStart,a.foundEnd),g.moveSelectionOut(j,e,h)):j="<a>",j=$(j),j.attr("id",l),j.text(i),j.addClass("qlink"),j.attr(g.getAttrName("text"),f),j.attr(g.getAttrName("href"),b),j.attr(g.getAttrName("delete"),c),g.setOption(j,d||"text"),$(a.foundStart).after(j)},h),!0})},getDefaultText:function(a){var b=this.getHostName(a.toLowerCase());if(!b)return a;var c=b.split("."),d=c.slice(-1)[0].match(/com|net|org|edu|gov/i)?2:3;c=c.slice(-d);var e=c.join(".");return"Page on "+e},getHostName:function(a){var b=a.match(/^https?:\/\/([^/]+)/i);return b?b[1]:null},removeLinkClasses:function(a){var b=this;$.each(this.options,function(c,d){var e=b.getClassName(d);$(a).removeClass(e)})},getOption:function(a){var b,c=this;return $.each(this.options,function(d,e){$(a).hasClass(c.getClassName(e))&&(b=e)}),b},setOption:function(a,b){this.removeLinkClasses(a),$(a).addClass(this.getClassName(b))},getValue:function(a,b){return $(a).attr(this.getAttrName(b))},setValue:function(a,b,c){return $(a).attr(this.getAttrName(b),c)},getLinkHtml:function(a){return j.cleanInnerHTML(a)},initNonDetectedLink:function(a){var b=this.makeKey(),c="qlink_"+b,a=$(a),d=a.attr("href");if(!d||$.trim(d).length==0||d==="#"){var e=a.attr(this.getAttrName("href"));d=e||"http://..."}var f=this.getLinkHtml(a[0]);if(!f||$.trim(f).length===0)f=d;if(this._retrievingUrlInfo[d]||this._retrievingUrlInfo[f])return!1;a.attr("id",c),a.attr(this.getAttrName("text"),f),a.attr(this.getAttrName("href"),d),a.html(f),a.addClass("qlink");var g=this.getOption(a);return g||this.setOption(a,"text"),!0},initLinkSelectorLink:function(a){var a=$(a);if(a.attr(this.getAttrName("text"))||this.getOption(a))return!0;var b=this.getQlinkKey(a[0]);if(!this.qlink_data[b])return!0;if(this.editingLink&&b===this.$("#@qlink_key").val())return!1;var c=this.getValue(a,"href");if(!c||c==="#"||c.length===0){var d=window.location;c=this.qlink_data[b].target.url}var e=this.getLinkHtml(a[0]);return this.setValue(a,"href",c),this.setValue(a,"text",e),this.setValue(a,"delete",e),this.setOption(a,"text"),!0},qlinkSync:function(){this._super.apply(this,arguments);var a=this.$("#@qlink_key").val(),b=this.$("#@qlink_text").val(),c=this.$("#@editor #qlink_"+a);if(!b||!a||!c)return;var d=this.getLinkSelector().result;if(!d)return;this.initLinkSelectorLink(c)},detectNewLinkElement:function(a){var a=$(a),b=this.getQlinkKey(a[0]);return b&&a.attr(this.getAttrName("text"))?!0:this.qlink_data[b]?this.initLinkSelectorLink(a):this.initNonDetectedLink(a)},detectNewLinkElements:function(){var a=this;this.$("#@editor a").each(function(b,c){a.detectNewLinkElement(c)})},handleLinkOption:function(a){var b=this,c=b.linkTarget,d=b.getQlinkKey(c);if(!d)return b.editor.focus(),!1;if(b.getOption(c)===a)return b.editor.focus(),!1;var e=b.getValue(c,a);return b.unhighlightLinkTarget(c),b._qed.modify(function(f,g){b.updateLinkText(c,d,e,a),b.setOption(c,a),a==="delete"?$(c).removeClass("qlink"):$(c).addClass("qlink")},!0),b.highlightLinkTarget(c),b.highlightActiveButton(c),!1},updateLinkText:function(a,b,c,d){var e=this.getOption(a),f=this,g;e!=="href"?g=this.getLinkHtml(a):g=$(a).text(),this._qed.modify(function(b,e){f.moveSelectionOut(a,b,e),d!=="href"?$(a).html(c):$(a).text(c)},!0),this.setValue(a,e,g)},containsSelection:function(a,b,c){return $.contains(a,b)||$.contains(a,c)},moveSelectionOut:function(a,b,c){this.containsSelection(a,b,c)&&$(a).after(b).after(c)}}),q=a.QTextEditor=p.extend({onLoad:function(a){var b=this;this._super.apply(this,arguments);if(!this.math_detection_on)return;this.editor.click(this.fnbind(function(a){this.handleMathBlockDialog(a.target)})),b._retrievingMathInfo={},b._retrievingMathInfoCount=0,b.onMathFetchStart(function(a){b.$("#@spinner").show(),b._retrievingMathInfo[a]=!0,b._retrievingMathInfoCount++}),b.onMathFetchEnd(function(a){b._retrievingMathInfoCount--,delete b._retrievingMathInfo[a],b._retrievingMathInfoCount===0&&b.$("#@spinner").hide()})},onMathFetchStart:function(a){var b=this;$(b).bind("math-fetch-start",function(c,d){return a.call(b,d)})},onMathFetchEnd:function(a){var b=this;$(b).bind("math-fetch-end",function(c,d){return a.call(b,d)})},handleMathBlockDialog:function(a){var b=this,c=$(a).attr("type"),d=$(a).attr("alt");if(!c||c!="math"||!d)return;if(b._dialog)return;return b.disableEdit(),b._dialog=b.dialog().title("Edit Math Block").cancel().close(function(){b._dialog=null,b.enableEdit()}).ok(b.fnbind(function(){var c=arguments[0].dialogComponent,d=c.$("#@editor");return b.getUpdatedMathInfo(d.val(),a,b.fnbind(b.maybeUpdateMathImage)),!1}),"Update").load("edit_math_block_dialog_contents",{kwargs:{text:d}}),!1},detectNewImage:function(a){var b=this;if(!this.math_detection_on||!$(a).hasClass("math")){this._super.apply(this,arguments);return}$(a).removeClass("math"),$(a).addClass("math_editor"),$(a).attr("title","Click to edit")},_cachedMathInfo:{},postProcessMathInfo:function(a,b){a.type="math",a.alt=b,a.title="Click to edit"},getMathInfoAndMaybeReplaceOldImage:function(a,b,c){var d=this;if(this._retrievingMathInfo&&this._retrievingMathInfo[a])return;var e=d._cachedMathInfo[a];e!==!1&&(e?c?b(e,c):b(e):($(d).trigger("math-fetch-start",[a]),d.serverCall("get_math_info").kwargs({math:a}).success(function(e){d.postProcessMathInfo(e,a),c?b(d._cachedMathInfo[a]=e,c):b(d._cachedMathInfo[a]=e),$(d).trigger("math-fetch-end",[a])}).error(function(){d._cachedMathInfo[a]=!1,$(d).trigger("math-fetch-end",[a])}).send()))},getMathInfo:function(a,b){this.getMathInfoAndMaybeReplaceOldImage(a,b)},editorKeyDown:function(a){var b=this._super.apply(this,arguments);if(!this.math_detection_on)return b;switch(a.which){case 86:if(!f(a))break;case 32:case 13:case 221:if(g(a))break;this._detectMathsOnNextKeyUp=!0}return!0},editorKeyUp:function(a){this._super.apply(this,arguments);if(!this.math_detection_on)return;this._detectMathsOnNextKeyUp&&(this._detectMathsOnNextKeyUp=!1,this.detectMaths())},detectMaths:function(){var a=this,b=require("mathify").iterMaths;b(a.text(),function(b,c){a.detectMath(b,c)})},detectMath:function(a,b){var c=this;c.getMathInfo(a,function(d){c.handleDetectedMath(d,a,b)})},handleDetectedMath:function(a,b,c){var d=this.fnbind(this.handleMath);if(!this.handleMathInfoError(a)){var e=new Image;e.src=a.url,e.onload=function(){if(d)return d(a,b,c)}}},handleMath:function(a,b,c){var d=this;d.findTextAndModify(c,function(b){var c=d.replaceMathWithImage(b,a)})},applyInfoToMathImage:function(a,b){for(var c in b)b[c]&&a.setAttribute(c,b[c]);$(a).addClass("math_editor")},replaceMathWithImage:function(a,b){var c,d,f,g;this._qed.modify(function(a,b){c=a.previousSibling,d=b.nextSibling,f=a.parentElement,g=b.parentElement},!0);var h=b.url,i=a;$(i.foundStart).replaceWith(i.start),$(i.foundEnd).replaceWith(i.end),e.deleteContents(i.start,i.end),this.handleImageWithinLink(i);var j=h&&this.addImage(h,!0,!0);return this.applyInfoToMathImage(j,b),this.markImageAsDetected(j),this._qed.modify(function(a,b){c==i.foundEnd?c=j:c||$(f.firstChild).before(a),d==i.foundStart?d=j:d||$(g.lastChild).after(b),$(c).after(a),$(d).before(b)},!0),j},getUpdatedMathInfo:function(a,b,c){this.getMathInfoAndMaybeReplaceOldImage(a,c,b)},handleMathInfoError:function(a){return!a.url||a.error?(a.error?alert("An error occured: "+a.error):alert("An error occured: Cannot retrieve LaTeX image url!"),!0):!1},maybeUpdateMathImage:function(a,b){if(!this.handleMathInfoError(a)){var c=this,d=new Image;d.src=a.url,d.onload=function(){c.closeDialog(),c.updateMathImage
(a,b)}}},updateMathImage:function(a,b){var c=this,d=new Image;d.src=a.url,this.applyInfoToMathImage(d,a),c._qed.modify(function(a,e){c.markImageAsDetected(d),$(b).replaceWith(d)})},closeDialog:function(){this._dialog.close_()},setTitle:function(a){this._dialog.setTitle(a)},disableEdit:function(){this.$("#@editor").attr("contenteditable","false"),this.$("#@editor").addClass("qtext_editor_content_disabled")},enableEdit:function(){this.$("#@editor").attr("contenteditable","true"),this.$("#@editor").removeClass("qtext_editor_content_disabled"),this.$("#@editor").focus()}});a.MathBlockDialogContents=c.extend({onLoad:function(){this.$("#@editor").focus()}});var r=a.VizQTextEditor=q.extend({onLoad:function(a){this._super.apply(this,arguments);if(!this.viz_on)return;this.viz_upload_on&&(this.$("#@cmd_qimg").unbind("click"),this.$("#@cmd_qimg").click(this.fnbind(function(){return this.openImageDialogWithViz(),!1})))},hideFakeEditor:function(){this._super.apply(this,arguments);if(!this.viz_on)return;this.show_viz_section&&(this.$("#@editor").css("border-bottom","1px dashed #e0e0e0"),this.$("#@viz_editor").show())},openImageDialogWithViz:function(){var a=this;a._dialog=a._dialog||a.dialog().title("Insert an Image").cancel(null,"Close").close(function(){a._dialog=null}).load("image_dialog_contents_with_query",{kwargs:{query:a.query}})}}),s=a.ThreadMessageQTextEditor=q.extend({onLoad:function(a){this.is_disabled=!1,this._super.apply(this,arguments),this.setTypingStateCallback(this.fnbind(function(a){this.serverCall("typing").kwargs({area:"thread-"+this.thread_id,state:a}).send()})),this.focusOnload&&this.focus()},request:function(){if(this.is_disabled||this.isEmpty()&&!this.plaintext)return!1;var a={};a.thread_id=this.thread_id,a.object_id=this.object_id,this.isEmpty()&&this.plaintext?a.msg={html:this.editor.val()}:a.msg=this.serialize(),require("w2.rpc"),require("webnode2").rpc("/thread/"+this.ajax_POST).kwargs(a).liveMutate().success(this.fnbind(function(){this.cleanUp()})).send(),this.disable()},disable:function(){this.is_disabled=!0,this.editor.addClass("qtext_editor_content_disabled")},cleanUp:function(){this.is_disabled=!1,this.editor.removeClass("qtext_editor_content_disabled"),this.clear(),this.blur(),this.focus()}});a.CompactThreadMessageQTextEditor=s.extend({onLoad:function(a){this._super.apply(this,arguments),this.setEnterCallback(this.fnbind(function(){this.request()}))}}),a.TestSaveButton=c.extend({onLoad:function(){this.$("#@save").click(this.fnbind(function(){var a=this.lookup("editor").serialize();$.securepost("/internal/qtexttest/save_POST",{content:a})}))}}),a.TCommentQTextEditor=q.extend({onLoad:function(a){function d(a){a||!c?b.$("#@qtext_editor_buttons_wrapper").toggle(a):c&&(c=!1,b.focus())}var b=this,c;b._super.apply(b,arguments),b.editor.focus(function(){d(!0)}).blur(function(){d(!1)}),b.$("#@qtext_editor_buttons_wrapper").mousedown(function(){c=!0}),b.setMeaningfulChangeCallback(b.fnbind(function(){b.save_draft()}))},save_draft:function(){this.serverCall("save_draft_auto").kwargs({content:this.serialize(),window_id:require("webnode2").windowId,draft_space:this.draft_space}).send()}}),a.EmbedQtextEditor=q.extend({onUnload:function(){delete this.embedEditorDiv},onLoad:function(a){this._super.apply(this,arguments);var b=this;b.url_attr_name="data-url",b.embed_data_attr_name="data-embed",b.embedEditorDiv=b.$("#@embed_editor"),b.last_embed_update=+(new Date),b.embedComponents={},b.placeholderImages={},b.overlays={},b.retrieveExistingEmbeds(),b.onLinkAdded(function(a){b.handleLinkAdded(a)}),b.onLinkFetchStart(function(){b.$("#@spinner").show()}),b.onLinkFetchEnd(function(){b.$("#@spinner").hide()}),b.editor.keydown(function(a){return b.embedEditorKeyDown(a)}),b.editor.bind("paste",function(a){b.updateEmbedDetectedAttr(),b.detectEmbeds()}),b.editor.bind("cut",function(a){b.detectEmbeds()})},clear:function(a){var b=this,c;for(c in b.embedComponents)b.deleteComponent(c,!0);this._super.apply(this,arguments)},retrieveExistingEmbeds:function(){var a=this;$.each(this.idsToUrls,function(b,c){var d=a.editor.find("#"+a.imageId(b));a.placeholderImages[b]=d,a.markEmbedAsDetected(d);var e=a.embedEditorDiv.find("#"+a.overlayId(b));a.overlays[b]=e})},embedEditorKeyDown:function(a){var b=this;return b.detectEmbeds(),!0},detectEmbeds:function(){var a=this;if(a.detectEmbedCallback)return;a.detectEmbedCallback=setTimeout(function(){a.detectAndRemoveDeletedComponents(),a.detectNewPlaceholderImages(),delete a.detectEmbedCallback},0)},imageId:function(a){return"embed_image_"+a},getImageInEditor:function(a){return this.editor.find("#"+this.imageId(a))},getImage:function(a){var b=this.getImageInEditor();if(b.length){var c=this.placeholderImages[a];this.placeholderImages[a]=b}return this.placeholderImages[a]},overlayId:function(a){return"embed_overlay_"+a},getOverlay:function(a){return this.overlays[a]},detectAndRemoveDeletedComponents:function(){var a=this;a.getEmbedComponents(function(b,c){var d=a.editor.find("#"+a.imageId(b));a.isInEditor(d)||a.deleteComponent(b,!0)}),a.updateEmbedComponentPositions()},isInEditor:function(a){return a=$(a),a=a&&a.length?a[0]:null,a?this.editor.length===0?!1:e.contains(this.editor[0],a):!1},deleteComponent:function(a,b){var c=this,d=this.embedComponents[a],e=this.idsToUrls[a],f=this.getOverlay(a),g=this.getImage(a);delete this.embedComponents[a],delete this.idsToUrls[a],delete this.overlays[a],delete this.placeholderImages[a],require("webnode2").unloadComponent(d.cid),f.forgetContents(),f.remove(),g&&(g.attr("height",0),g.attr("width",0),g.attr("embed_detected",0),c._qed.modify(function(a,b){g.remove()}),c.updateEmbedComponentPositions()),b&&d.handleDeleted(),this.editor.focus()},getEmbedComponents:function(a){$.each(this.embedComponents,a)},getGuid:function(){var a=e.guid();return a.replace(/\./g,"")},handleLinkAdded:function(a){var b=this,c=a.url;if(c in b.seenUrls)return;var d=b.getGuid();b.seenUrls[c]=d,b.idsToUrls[d]=c;var e="embed_component_from_preview",f={preview:a};b.createAndPopulateOverlay(d,e,f)},createAndPopulateOverlay:function(a,b,c,d){var e=this,f=e.createOverlay(a);e.$("#@spinner").show(),e.serverCall(b).success(function(a){e.$("#@spinner").hide()}).error(function(){e.$("#@spinner").hide(),d&&d.remove()}).contentFor(f,{parentCID:e.cid,useLoadingSpinner:!1}).kwargs(c).send()},markEmbedAsDetected:function(a){a.attr("embed_detected",this.last_embed_update)},updateEmbedDetectedAttr:function(){var a=this,b=this.last_embed_update;this.last_embed_update=+(new Date),this.$("#@editor img").each(function(c,d){d=$(d);if(d.attr("type")!=="embed")return;d.attr("embed_detected")==b&&a.markEmbedAsDetected(d)})},detectNewPlaceholderImages:function(){var a=this;this.$("#@editor img").each(function(b,c){c=$(c);if(c.attr("type")!=="embed")return;if(c.attr("embed_detected")==a.last_embed_update)return;var d=c.attr(a.url_attr_name),e,f=a.seenUrls[d];if(f){e=a.idsToUrls[f];if(e){c.remove(),setTimeout(function(){a.updateEmbedComponentPositions()},0);return}}else f=a.getGuid();c.attr("id",a.imageId(f)),a.markEmbedAsDetected(c),a.placeholderImages[f]=c;var g=JSON.parse(c.attr(a.embed_data_attr_name));d?e=d:e=g.url,a.seenUrls[e]=f,a.idsToUrls[f]=e;var h="embed_component_from_client_embed_data",i={url:e,embed_data:g};a.createAndPopulateOverlay(f,h,i,c)})},updateEmbedComponentPositions:function(){var a=this;a.getEmbedComponents(function(b,c){a.updateEmbedComponentPosition(b,c)})},updateEmbedComponentPosition:function(a,b){if(b.positionUpdated){var c=this.getImage(a),d=$(c).offset(),e=this.embedEditorDiv.offset(),f=d.left-e.left,g=d.top-e.top,h=this.getOverlay(a),i=this.editor.width();b.positionUpdated(h,f,g,i)}},registerEmbedComponent:function(a,b,c){var d=this,e=d.seenUrls[b];d.embedComponents[e]=a;var f=this.placeholderImages[e];if(f&&!d.isInEditor(f)){this.getOverlay(e).hide(),setTimeout(function(){d.deleteComponent(e,!0)},0);return}f||d.createPlaceholderImage(e,b),d.setImageEmbedDataAttr(e,c),d.updatePlaceholderImageSize(e),f||d.insertPlaceholderImage(e),d.updateEmbedComponentPosition(e,a),a.initializeEmbedComponent(e,d.getImage(e),d.getOverlay(e)),d.updateEmbedComponentPositions()},createOverlay:function(a){var b=$("<div>",{id:this.overlayId(a)});return b.addClass("embed_overlay"),this.embedEditorDiv.append(b),this.overlays[a]=b,b},createPlaceholderImage:function(a,b,c){var d=this,e={src:d.spacerUrl,id:d.imageId(a),type:"embed"};e[d.url_attr_name]=b;var f=$("<img>",e);f.css("margin","0").css("padding","0").css("border","none"),d.markEmbedAsDetected(f),d.markImageAsDetected(f[0]),c&&c(f),this.placeholderImages[a]=f},insertPlaceholderImage:function(a){var b=this.getImage(a),c=$("<div>");c.append(b),this._qed.modify(function(a,b){var d=a.parentNode;d&&d.insertBefore(c[0],a)})},addImage:function(a,b){var c=this,d=new Image;d.onload=function(){c.updateEmbedComponentPositions(),$(d).remove()},d.src=a;var e=this._super.apply(this,arguments);return e},updatePlaceholderImageSize:function(a,b,c){var d=this.getOverlay(a),e=this.getImage(a);b=b?b:d.height(),c=c?c:d.width(),e.attr("height",b),e.attr("width",c)},setImageEmbedDataAttr:function(a,b){var c=this.getImage(a);c.attr(this.embed_data_attr_name,b)},notifySubmit:function(){}}),a.EmbedComponentBase=c.extend({registerWithParent:function(a,b){this.parent().registerEmbedComponent(this,a,b)},initializeEmbedComponent:function(a,b,c){this.id=a,this.img=b,this.overlay=c},dataChanged:function(a){this.setImageEmbedDataAttr(a),this.updatePlaceholderImageSize(),this.parent().updateEmbedComponentPositions()},setImageEmbedDataAttr:function(a){this.parent().setImageEmbedDataAttr(this.id,a)},componentDeleted:function(){this.parent().deleteComponent(this.id,!1)},updatePlaceholderImageSize:function(){var a=this.overlay.height(),b=this.overlay.width();if(this.previous_height!==a||this.previous_width!==b)this.parent().updatePlaceholderImageSize(this.id,a,b),this.previous_height=a,this.previous_width=b},positionUpdated:function(a,b,c,d){a.css("position","absolute").css("left",b).css("top",c).css("width",d)},handleDeleted:function(){}}),a.QuestionWizardQTextEditor=q.extend({onLoad:function(){this._super.apply(this,arguments)},editorInputChange:function(a){this._super.apply(this,arguments),this.parent().onEditorInputChange&&this.parent().onEditorInputChange()}})}),require.installLazy("app/view/topic",'var Component=require("w2.quora").Component,cookies=require("cookies"),floatingVote=require("view/floating_voting_buttons");require("dialog"),exports.TopicEmailNewQuestionsControl=Component.extend({onLoad:function(){this.$("#@enable").click(this.fnbind(function(){return this.serverCall("enable").liveMutate().send(),!1})),this.$("#@undo").click(this.fnbind(function(){return this.serverCall("undo_enable").liveMutate().send(),!1}))}}),exports.TopicLocationPreview=Component.extend({onLoad:function(){var a=this;this.$("#@enlarge_map").click(this.fnbind(function(){return this.$("#@enlarge_map").hide(),this.$("#@wrapper").css("height","auto"),this.$("#@wrapper").css("width","auto"),this.$("#@wrapper").removeClass("mask"),this.$("#@content").removeClass("mask_content"),this.$("#@content").css("top","0px"),this.lookup("picker").toggleControls(!0),!1}))}}),exports.TopicAliases=Component.extend({onLoad:function(){var a=this.fnbind(this.addAliasSubmit);this.$("#@topic_alias_add").click(a),this.$("#@topic_alias_add_form").submit(a),this.$("#@show_alias_link").click(this.fnbind(function(a){a.preventDefault(),this.$("#@add_topic_alias").show(),this.$("#@show_alias").hide(),this.$("#@topic_alias_input").focus()}))},get_value:function(){return this.$("#@topic_alias_input").val()},addAliasSubmit:function(){return this._request(this.get_value()),!1},_request:function(a){if(!this.tid||!a)return!1;this.serverCall("add_topic_alias").kwargs({tid:this.tid,alias:a}).success(this.fnbind(function(){this.$("#@topic_alias_input").val(""),this.$("#@topic_alias_input").focus()})).liveMutate().send()}}),exports.TopicAlias=Component.extend({onLoad:function(){var a={title:"Topic Alias Deletion",contents:"Are you sure you wish to delete this alias?",buttons:{Ok:this.fnbind(this._request),Cancel:null}};this.$("#@topic_alias_remove").click(function(){return $(".content").dialog(a),!1})},_request:function(){if(!this.tid||!this.alias)return!1;this.serverCall("remove_topic_alias").kwargs({tid:this.tid,alias:this.alias}).liveMutate().send()}}),exports.TopicTypeManageTypes=Component.extend({onLoad:function(){this.$("#@show_selector").click(this.fnbind(function(){return this.$("#@category_selector").show(),this.$("#@show_selector").hide(),!1}))}}),exports.TopicAdultContent=Component.extend({onLoad:function(){this.$("#@remove_topic_as_adult").click(this.fnbind(function(){return $(".content").dialog({title:"Modify Adult Content Setting",contents:"Are you sure you want to modify the Adult setting for this topic?",buttons:{"Remove Adult Mark":this.fnbind(function(){this.serverCall("remove_topic_as_adult").liveMutate().send()}),Cancel:null}}),!1})),this.$("#@set_topic_as_adult").click(this.fnbind(function(){return $(".content").dialog({title:"Mark Topic as Adult Content",contents:"Are you sure you want to modify the Adult setting for this topic?",buttons:{"Mark as Adult":this.fnbind(function(){this.serverCall("set_topic_as_adult").liveMutate().send()}),Cancel:null}}),!1}))}}),exports.TopicReviewable=Component.extend({onLoad:function(){this.$("#@unmark_topic_as_reviewable").click(this.fnbind(function(){return this.serverCall("unmark_topic_as_reviewable").liveMutate().send(),!1})),this.$("#@mark_topic_as_reviewable").click(this.fnbind(function(){return this.serverCall("mark_topic_as_reviewable").liveMutate().send(),!1}))}}),exports.TopicDelete=Component.extend({onLoad:function(){var a=this;this.$("#@delete_topic_link").click(function(){return $(".content").dialog({title:"Delete Topic",url:"/ajax/topic_delete_dialog",buttons:{Ok:function(){a._request("delete_topic")},Cancel:null}}),!1}),this.$("#@undelete_topic_link").click(function(){return $(".content").dialog({title:"Undelete Topic",url:"/ajax/topic_undelete_dialog",buttons:{Ok:function(){a._request("undelete_topic")},Cancel:null}}),!1})},_request:function(a){if(!topicDialog)return;var b=topicDialog.lookup("editor");if(b.isEmpty())return;this.serverCall(a).kwargs({tid:this.tid,comment:b.serialize()}).liveMutate().send()}});var topicDialog;exports.TopicDialog=Component.extend({onLoad:function(){this.lookup("editor").focus(),topicDialog=this}}),exports.getTopicDialog=function(){return topicDialog},exports.TopicMergeUnmerge=Component.extend({onLoad:function(){this.$("#@show_merge").click(this.fnbind(function(){return this.$("#@merge").removeClass("hidden"),this.$("#@show_merge").addClass("hidden"),this.cQuery(":standalone.selector").focus(),!1}))}}),exports.TopicRelated=Component.extend({onLoad:function(){this.$("#@view_all").click(this.fnbind(function(){return this.$("#@all").removeClass("hidden"),this.$("#@preview").addClass("hidden"),!1}))}}),exports.TopicFollowButton=Component.extend({onLoad:function(){this.$("#@follow").click(this.fnbind(function(a){cookies.setQfeedLog(this,"TopicFollow"),cookies.setQueryLog(this,"TopicFollow"),cookies.setTlog({type:"TopicFollow",tid:this.tid}),require("action_log").logSecondaryAction("TopicFollow",{type:"topic",tid:this.tid}),this.serverCall("follow").kwargs({tid:this.tid}).liveMutate().send(),a.preventDefault()})),this.$("#@unfollow").click(this.fnbind(function(a){this.serverCall("unfollow").kwargs({tid:this.tid}).liveMutate().send(),a.preventDefault()}))}}),exports.AdultTopicFollowButton=DialogLink.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@link").click(this.fnbind(function(){return this.serverCall("follow").liveMutate().send(),!1}))}}),exports.TopicUnmergeLink=Component.extend({onLoad:function(){var a=this;this.$("#@unmerge").click(function(){return a.serverCall("unmerge_topic").kwargs({tid:a.tid}).liveMutate().send(),!1})}}),exports.TopicNameLinkBase=Component.extend({onLoad:function(){this.$("#@link").mousedown(this.fnbind(function(){cookies.setQfeedLog(this,"TopicClickthrough"),cookies.setQueryLog(this,"TopicClickthrough")}))}}),exports.TopicParentsLink=Component.extend({onLoad:function(){this.$("#@view_parent").tooltip({contents:"View Topic Parent"}).click(this.fnbind(function(){return this.$("#@view_parent").removeClass("topic_parent_link"),this.$("#@parents").removeClass("hidden"),!1}))}}),exports.PendingTopicHoverMenuContents=Component.extend({onLoad:function(){this.$("#@confirm_pending_topic").click(this.fnbind(function(){return this.serverCall("confirm_pending_topic").liveMutate().send(),!1}))}}),exports.AddBannedUser=Component.extend({onLoad:function(){this.$("#@add").click(this.fnbind(function(){return this.$("#@label").hide(),this.$("#@selector").show(),this.lookup("selector").focus(),!1}))},setTo:function(a){a&&a!=""&&this.serverCall("ban_user").kwargs({tid:this.tid,ban_uid:a}).success(this.fnbind(function(){this.clear(),this.lookup("selector").focus()})).liveMutate().send()},clear:function(){this.lookup("selector").inputBlur()}}),exports.BannedUser=Component.extend({onLoad:function(){this.$("#@remove").click(this.fnbind(function(){return this.serverCall("remove").kwargs({tid:this.tid,ban_uid:this.ban_uid}).liveMutate().send(),!1}))}}),exports.FollowTopicOnTwitterSection=Component.extend({onLoad:function(){this.$("#@icon").click(this.fnbind(function(a){return this.lookup("follow_link").follow(),!1}))}}),exports.TopicFeed=Component.extend({onLoad:function(){var a=this;this.installScrollHandlers(this.setPosition),this.floatingZone=200,this.topOffset=$(".header").outerHeight()+7,this.bottomOffset=55},onUnload:function(){this.uninstallScrollHandlers()},setPosition:function(){var a=this,b=$(window).height(),c=$(window).scrollTop();clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout(this.fnbind(function(){$(this.$("#@topic_feed").find(".expanded_feed_content").get().reverse()).each(function(){var b=$(this).find(".rating_buttons_wrapper").eq(0),d=$(window).width()-($(".feed_item").offset().left+$(".feed_item").outerWidth());b.css("right",d);if(b.find(".rating_options").is(":visible")){var e=$(this).find(".answer_content").eq(0),f=$(this).find(".feed_item_board_content").eq(0),g=e.length>0?e:f,h=e.length>0?g.height()+2:g.height(),i="feed",j=-1;if(b.offset().top>c-a.floatingZone&&b.offset().top<c+a.floatingZone&&h>a.floatingZone)floatingVote.enableFloatingVotingButtons(c,b,g.offset().top,h,a.topOffset,a.bottomOffset,j,g,i);else if(c<b.offset().top){b.hasClass("voting_buttons_fixed")&&b.removeClass("voting_buttons_fixed"),b.hasClass("voting_buttons_absolute")&&b.removeClass("voting_buttons_absolute"),g.hasClass("voting_buttons_content_feed")&&g.removeClass("voting_buttons_content_feed");var k=b.attr("style");typeof k!="undefined"&&k!==!1&&b.removeAttr("style")}}})}),0)}}),exports.TopicMuteLink=Component.extend({onLoad:function(){this.$("#@topic_mute_link").click(this.fnbind(function(){return this.serverCall("mute").kwargs({tid:this.tid}).liveMutate().send(),!1}))}}),exports.TopicUnmuteLink=Component.extend({onLoad:function(){this.$("#@topic_unmute_link").click(this.fnbind(function(){return this.serverCall("unmute").kwargs({tid:this.tid}).liveMutate().send(),!1}))}});'),require.install("async_post",function(require,a,b){function d(a){function i(){e&&clearTimeout(e),e=setTimeout(j,f)}function j(){if(d.length===0)return;if(g){i();return}g=!0,h=d,d=[],c.rpc(a).kwargs({messages:h}).success(k).error(l).send()}function k(){h.length=0,g=!1}function l(){d=d.concat(h),h.length=0,g=!1}var b=this,d=[],e=null,f=500,g=!1,h=[];return b.send=function(a){d.push(a),i()},b}var c=require("webnode2");a.AsyncPost=function(a){return d(a)}}),require.install("typeahead",function(require,a,b){function o(){return new Date}var c=require("simscroll"),d=require("window_manager"),e=require("cookies"),f=require("w2.quora").Component,g=require("html"),h=require("siteuri").URI,i=require("settings").keyboardShortcuts,j=require("email"),k=require("async_post").AsyncPost,l=require("e2e"),m=require("settings"),n=k("/ajax/typeahead_log_POST");a.TypeaheadResults=f.extend({onLoad:function(){m.new_grid||(this.$("#@results_frame").addClass("no_fade"),this.hideDropdown()),this.focusedIndex=null,this.instructions=null,this.runSetup()},runSetup:function(){for(var a=0;a<this.results.length;a++)this.setupListItem(a)},setupListItem:function(a){var b=this.$("#@list_item_"+a);b.addClass("needsclick"),this.$("#@list_item_"+a+" *").addClass("needsclick"),b.mouseover(this.fnbind(function(b){return this.setFocusIndex(a),!1})),b.mousedown(this.fnbind(function(b){return this.goResult(a,b)}))},hideDropdown:function(a,b){var c=this.$("#@results_frame");m.new_grid?a?(this.parent().shouldAnimateShowDropdown=!0,c.removeClass("fade_in").addClass("fade_out"),setTimeout(function(){c.removeClass("is_shown").removeClass("fade_out"),b&&b()},150)):(c.removeClass("is_shown"),b&&b()):c.hide()},showDropdown:function(a,b){if(this.results.length){var c=this.$("#@results_frame");m.new_grid?(this.parent().shouldAnimateShowDropdown&&(a=!0,this.parent().shouldAnimateShowDropdown=!1),a?(c.hasClass("fade_in")||c.addClass("is_shown").addClass("fade_in"),setTimeout(function(){b&&b()},150)):c.addClass("is_shown")):c.css("display","inline-block"),c.removeClass("inverted");var d=$(window).scrollTop(),e=d+$(window).height(),f=c.offset().top,g=e-f,h=f-d;h>500&&g<200&&c.addClass("inverted");var i=c.offset().top+c.height();i&&$(document.body).height()<i&&$(document.body).height(i)}},isVisible:function(){var a=this.$("#@results_frame");return a.is(":visible")&&a.css("visibility")!="hidden"},hide:function(){this.hideDropdown(!0),this.setFocusIndex(null)},getResult:function(a){return this.results[a]},goResult:function(a,b){if(this.query&&this.log_data_json){var c={data:this.log_data_json,click_index:a};n.send(c)}if(this.actionType=="url")d.handleClick(this.actionOfIndex[a],b);else{if(this.actionType=="value")return this.hide(),this.qValue=this.actionOfIndex[a],this.parent().setValue(this.qValue,this.results[a]),!1;assert(0)}},down:function(){this.focusedIndex===null?this.setFocusIndex(0):this.focusedIndex<this.nResults-1?this.setFocusIndex(this.focusedIndex+1):this.focusedIndex==this.nResults-1&&this.setFocusIndex(null)},up:function(){this.focusedIndex===null?this.setFocusIndex(this.nResults-1):0===this.focusedIndex?this.setFocusIndex(null):0<this.focusedIndex&&this.setFocusIndex(this.focusedIndex-1)},go:function(a){return this.focusedIndex!==null?(this.goResult(this.focusedIndex,a),!0):!1},setFocusIndex:function(a,b){if(this.empty)return;var c=this.$("#@list_item_"+a);this.focusedIndex!==null&&this.$("#@list_item_"+this.focusedIndex).removeClass("selected");if(c.hasClass("instruction")){b&&b.cancelIfSelectingInstruction||this.focusedIndex===a+1?this.focusedIndex=null:this.setFocusIndex(a+1);return}if(c.length===0){this.focusedIndex=null;return}if(a!==null){c.addClass("selected");var d=$(window),e=d.scrollTop(),f=c.offset().top+c.height()+20-(e+d.height());f>0&&d.scrollTop(e+f)}this.focusedIndex=a}}),a.NavigatorResults=a.TypeaheadResults.extend({onLoad:function(){this._super.apply(this,arguments),this.cookieSet=!1},setCookieHelper:function(a,b){this.cookieSet||(this.cookieSet=!0,e.setMessage("qrl",[require("webnode2").windowId,this.query,this.matchTargetsJson,this.contextTid,a]),e.setSingleUse("q",JSON.stringify(this.query)))},goResult:function(a,b){var c=a;this.query&&this.numMatches>0&&(c>=this.numMatches&&(c=-1),this.cookieSet||(this.cookieSet=!0,e.setMessage("qrl",[require("webnode2").windowId,this.query,this.matchTargetsJson,this.contextTid,c]),e.setSingleUse("q",JSON.stringify(this.query)))),this._super.apply(this,arguments)}}),a.FullNavigatorResults=a.NavigatorResults.extend({onLoad:function(a){this._super.apply(this,arguments),(a||!this.query)&&this.hideDropdown(),this.focusedIndex=null,this.instructions=null,this.forceOpenResults=!1,this.openResultsLinkInNewTab=this.parent().openResultsLinkInNewTab(),this.openResultsLinkInNewTab||this.runSetup()},hideDropdown:function(a,b){this.forceOpenResults||(this._super.apply(this,arguments),this.parent().parent().$("#@results_tray").hide())},hide:function(){this.hideDropdown(!0),this.forceOpenResults||this.setFocusIndex(null)},showDropdown:function(a,b){if(this.results.length){this.$("#@results_frame").show();var c=null,d=this.parent().parent().$("#@results_tray");if(this.results.length<=1)c=35;else{var e=Math.max(375,this.results.length*35);c=e}d.show(),parseInt(d.height(),10)!==parseInt(c,10)&&d.css("height",c+"px")}},goResult:function(a,b){this.forceOpenResults=!0,this.actionType=="url"?(this.setCookieHelper(a,b),this.$("#@list_item_"+a).hasClass("addquestionitem")?this.parent().addQuestionClick():d.handleClick(this.actionOfIndex[a],b)):assert(0)},go:function(a){return this.forceOpenResults=!0,this.focusedIndex!==null?(this.$("#@list_item_"+this.focusedIndex).hasClass("addquestionitem")?this.parent().addQuestionClick():this.goResult(this.focusedIndex,a),!0):!1},down:function(){this.focusedIndex===null?this.setFocusIndex(0):this.focusedIndex<this.nResults-1?this.setFocusIndex(this.focusedIndex+1):this.focusedIndex===this.nResults-1&&(this.highlightAddQuestion?this.setFocusIndex(0):this.setFocusIndex(null))}}),a.InlineQuestionsNavigatorResults=a.FullNavigatorResults.extend({onLoad:function(a){this._super.apply(this,arguments);for(var b=0;b<this.results.length;b++)this.bindListItem(b)},bindListItem:function(a){this.$("#@list_item_"+a).click(this.fnbind(function(){this.serverCall("log_question_click").send()}))}}),a.Typeahead=f.extend({onLoad:function(){this.qValue=this.initialValue,this.result=null,this.requestOutstanding=!1,this.closed=!1,this.selectionChosen=!1,this.selectionlessCallback=null,this.placeholderActive=!1,this.extraKeydown=null,this.userClicked=!1,this.shouldAnimateShowDropdown=!0,this.simulateScroll=!0;var a=this.$("#@input").attr("placeholder");this.$("#@input").attr("placeholder",g.decode(a)),this.$("#@view_selector").click(this.fnbind(function(){return this.$("#@selector_wrapper").removeClass("hidden"),this.$("#@view_selector_wrapper").addClass("hidden"),this.focus(!0),!1}));var b=this;b.data||(b.data={}),b.$("#@input").focus(function(){$(this).attr("focused","true"),b.inputFocus(),b.extraFocus&&b.extraFocus()}).blur(function(){$(this).removeAttr("focused"),b.inputBlur(),b.userClicked=!1}).keydown(function(a){return b.inputKeydown(a)}).keyup(function(a){return b.inputKeyup(a)}).keypress(function(a){if(a.which==13||a.which==27)return a.stopPropagation(),a.preventDefault(),!1}).click(function(){b.userClicked=!0})},getRequestUpdatePostData:function(){return{q:this.qValue,data:JSON.stringify(this.data)}},requestUpdate:function(){this.requestOutstanding=!0,this.requestStartTime=o();var a=this.getRequestUpdatePostData();a.___W2_parentId=this.cid,a.___W2_windowId=require("webnode2").windowId;var b=l.startAction({url:d.getURL(),vcon:this.fakeVcon,method:this.fakeMethod,mustReport:!0,server_time:1,standard:{server_side:50,e2e:50,owner:6}});if(m.new_grid){var c=this.fnbind(function(){$.ajax({type:"GET",url:this.resultsQueryPath,dataType:"json",data:a,success:this.fnbind(function(a){l.finishAction(b.id),this.ajaxCallback(a)}),error:this.fnbind(function(a,b,c){this.requestOutstanding=!1})})});!a||a.q.length===0?this.child("results").hideDropdown(!0,c):c()}else $.ajax({type:"GET",url:this.resultsQueryPath,dataType:"json",data:a,success:this.fnbind(function(a){l.finishAction(b.id),this.ajaxCallback(a)}),error:this.fnbind(function(a,b,c){this.requestOutstanding=!1})})},close:function(){this.closed=!0,this.child("results").hide()},clear:function(){this.clearInput(),this.close()},clearInput:function(){this.$("#@input").val(""),this.$("#@input").get(0).style.backgroundColor="#fff"},reset:function(){this.qValue=this.initialValue,this.clearInput(),this.result=null},resetFocus:function(){this.reset(),this.requestUpdate(),this.focus(),this.inputFocus()},setCallback:function(a){var b=this.callback;if(!b)b=a;else{var c=b;b=function(){c(),a()}}this.callback=b},setSelectionlessCallback:function(a){var b=this.selectionlessCallback;if(!b)b=a;else{var c=b;b=function(){c(),a()}}this.selectionlessCallback=b},setExtraFocus:function(a){this.extraFocus=a},setExtraKeydown:function(a){this.extraKeydown=a},setValue:function(a,b){this.qValue=a,this.$("#@input").val(this.qValue),this.result=b;var c=this.$("#@input");this.selectionChosen=!0,this.callback&&this.callback()},getValue:function(){return this.placeholderActive?"":this.$("#@input").val()},ajaxCallback:function(a){var b=o();if(!this.requestOutstanding)return;this.requestOutstanding=!1;if(this.closed)return;if(!this.child("results"))return;require("webnode2").unloadComponent(this.child("results").cid),this.$("#@results_shell").setContent(a),!this.child("results").empty&&(this.child("results").query||this.always_show_dropdown_on_results)&&this.child("results").showDropdown(),this.child("results").query!=this.qValue&&this.requestUpdate(),this.shouldHighlightFirstResult()&&this.child("results").setFocusIndex(0,{cancelIfSelectingInstruction:!0}),this.child("results").highlightAddQuestion&&this.child("results").setFocusIndex(this.child("results").results.length-1,{cancelIfSelectingInstruction:!0}),this.newSearch&&this.parent().typeaheadUpdateReturned&&this.parent().typeaheadUpdateReturned(),this.openResultsLinkInNewTab&&this.$("#@results_shell").find('a[href!="#"]').attr("target","_blank")},openResultsLinkInNewTab:function(){return!1},shouldHighlightFirstResult:function(){return this.minAutoFocusIndexLength&&this.qValue.length<this.minAutoFocusIndexLength||this.child("results").highlightFirst},inputKeydown:function(a){var b=this.$("#@input"),d=b.val();if(this.simulateScroll&&!this.child("results").isVisible()&&!this.requestOutstanding&&c.maybeSimulateScroll(a))return b.blur(),!1;c.cancelSimulatedScroll();if(a.keyCode==40)return this.requestOutstanding=!1,this.child("results").down(),!1;if(a.keyCode==38)return this.child("results").up(),!1;if(a.keyCode==27)return this.child("results").hide(),this.userClicked=!1,!1;if(a.keyCode==13){if(this.child("results").go(a))return!1;if(this.selectionlessCallback&&this.selectionlessCallback())return!1}return this.extraKeydown?this.extraKeydown(a.keyCode):!0},inputKeyup:function(){return this.onInputChange(),!1},onInputChange:function(){var a=this.$("#@input").val();if(a==this.qValue)return;this.qValue=a,this.requestOutstanding||this.requestUpdate(),this.qValue===""&&(this.closed=!1)},inputBlur:function(){this.setPlaceholder(),this.blurFakeInput(),this.child("results")&&!this.no_hide_on_blur&&this.child("results").hide()},disable:function(){this.close(),this.$("#@input").attr("disabled","disabled"),this.$("#@input").css("background","#e0e0e0")},enable:function(){this.$("#@input").attr("disabled",!1),this.$("#@input").css("background","#fff")},setText:function(a){this.$("#@input").val(a),this.onInputChange()},setPlaceholder:function(){var a=this.$("#@input").attr("placeholder");a&&!this.getValue()&&(this.placeholderActive=!0,this.$("#@input").addClass("light"),this.$("#@input").val(a))},removePlaceholder:function(){this.placeholderActive&&(this.placeholderActive=!1,this.$("#@input").removeClass("light"),this.clearInput())},focus:function(a){if(!a)if(window.getSelection){if(window.getSelection().rangeCount>0)return}else if(document.selection&&document.selection.createRange())return;if(!this.$("#@input").is(":visible"))return;this.$("#@input").attr("focused",!0),this.closed=!1,this.$("#@input").focus(),this.removePlaceholder()},inputFocus:function(){this.$("#@input").attr("focused",!0),this.removePlaceholder(),this.$("#@input").get(0).style.backgroundColor="",this.focusFakeInput(),this.selectionChosen?(this.selectionChosen=!1,this.result=null,this.requestUpdate()):(!this.focusOnLoad||this.userClicked&&this.focusOnLoad)&&this.showResultsDropdown()},focusFakeInput:function(){this.$("#@input").closest(".search_input").addClass("focus")},blurFakeInput:function(){this.$("#@input").closest(".search_input").removeClass("focus")},showResultsDropdown:function(){this.child("results").showDropdown()},hideResultsDropdown:function(){this.child("results").hideDropdown(!0)},cursorPosition:function(a){var b=a.get(0),c=null;if(b.selectionStart!==undefined)b.selectionStart==b.selectionEnd&&(c=b.selectionStart);else if(document.selection){var d=document.selection.createRange().duplicate();d.text===""&&(d.moveEnd("character",b.value.length),d.text===""?c=b.value.length:c=b.value.lastIndexOf(d.text))}return c}}),a.ContextTypeahead=a.Typeahead.extend({onLoad:function(a){this._super.apply(this,arguments),this.width=this.$("#@input").outerWidth(),this.paddingRight=parseInt(this.$("#@input").css("paddingRight").replace("px","")
,10),this.orgPlaceholder=this.$("#@input").attr("placeholder"),this.child("context")&&this.child("context").setDefault&&(this.child("context").setDefault(),this.context.id&&this.clearInstruction()),this.resizeInput(),this.child("context")&&this.child("context").hasContext()&&this.showClearButton(),this.$("#@clear").click(this.fnbind(function(){return this.reset(),this.resetContext(),this.clearInstruction(),this.$("#@input").focus(),!1})),this.setExtraKeydown(this.fnbind(function(a){if(a==9){var b=this.child("results").focusedIndex?this.child("results").focusedIndex:0,c=this.child("results").getResult(b);if(c&&c.text)return this.clearInstruction(),this.context={type:c.type,id:c.id},this.child("context").setContext(c.text,c.url),this.$("#@input").val(""),this.showClearButton(),this.resizeInput(),!1}else if(a==8){var d=this.$("#@input");(d.val()===""||this.cursorPosition(d)===0)&&this.resetContext()}return!0})),this.setExtraFocus(this.fnbind(function(){this.$("#@input_wrapper").css("background-color","#fff")})),this.focusOnLoad?this.focus():this.setPlaceholder()},showClearButton:function(){this.$("#@clear").show()},hideClearButton:function(){this.$("#@clear").hide()},clearInstruction:function(){this.$("#@input").attr("placeholder",""),this.removePlaceholder()},resizeInput:function(){if(!m.new_grid){var a=this.child("context")?this.child("context").getWidth():0,b=this.width-a-10,c=this.paddingRight;a&&(c+=17,b-=17),this.$("#@input").css("width",b+"px"),this.$("#@input").css("paddingRight",c+"px")}},resetContext:function(){this.context={},this.child("context").removeContext(),this.$("#@input").attr("placeholder",this.orgPlaceholder),this.hideClearButton(),this.resizeInput(),this.requestUpdate()},getRequestUpdatePostData:function(){return{q:this.qValue,context_type:this.context.type,context_id:this.context.id,data:JSON.stringify(this.data)}}}),a.MultiSelectTypeahead=a.Typeahead.extend({onLoad:function(a){this._super.apply(this,arguments);var b=this;b.data.partial_results=null,b.qValues=[],b.results=[],b.count=0,b.input=b.$("#@input"),b.$("#@multi_select_typeahead").click(function(){b.input.focus()}),b.input.keypress(function(a){a.which===13&&(b.input.attr("focused",!1),b.child("results").hide(),a.preventDefault())}),b.input.keydown(function(a){if(a.which===8&&b.input.val()===""&&b.qValues.length>0){var c=b.qValues.length-1;while(c>=0&&!(c in b.qValues))c--;c in b.qValues&&(b.remove(c),b.child("token_list").$("#@item"+c).hide())}b.fixWidth()}),b.input.bind("paste",b.fnbind(b.fixWidth))},fixWidth:function(){var a=350,b=50,c=12;this.count===0?this.input.width(a):this.input.width(Math.min(a,Math.max(b,c*this.input.val().length)))},setValue:function(a,b){this.qValue=a,this.input.val(this.qValue),this.result=b;if($.inArray(this.qValue,this.qValues)!=-1){this.reset();return}this.qValues.push(this.qValue),this.results.push(this.result),this.data.partial_results=this.results,this.updateContainer(),this.count++,this.child("token_list").addItem(this.result.text,this.qValues.length-1),this.input.attr("placeholder",""),this.fixWidth(),this.input.hasClass("maintain_background_white")||this.input.css("background-color","#eee"),this.selectionChosen=!0,this.callback&&this.callback(),this.reset()},remove:function(a){delete this.qValues[a],delete this.results[a],this.updateContainer(),this.count--,this.count===0&&this.input.attr("placeholder",this.placeholder)},updateContainer:function(){var a=this;this.lookup("typeaheadContainer").updateValues($.grep(this.qValues,function(b,c){return c in a.qValues}))},clear:function(){var a=this;$.each(a.qValues,function(b,c){delete a.qValues[b],delete a.results[b],a.child("token_list").$("#@item"+b).hide()}),a.count=0,a.input.attr("placeholder",a.placeholder),a.resetFocus(),a.fixWidth(),a.updateContainer()},focusFakeInput:function(){this.$("#@input").closest(".multi_select_typeahead").addClass("focus")},blurFakeInput:function(){this.$("#@input").closest(".multi_select_typeahead").removeClass("focus")}}),a.MultiSelectTokenList=f.extend({attachRemoveClickHandler:function(a){this.$("#@remove"+a).click(this.fnbind(function(a){return this.parent().remove(a),this.parent().fixWidth(),this.parent().input.focus(),this.$("#@item"+a).hide(),!1},a))},cloneItem:function(a){var b=this.$("#@item"+a).clone(),c=b.attr("id");b.attr("id",this.constructNextId(c,a));var d=$(".token_remove",b),e=d.attr("id");d.attr("id",this.constructNextId(e,a));var f=$(".token_name_text",b),g=f.attr("id");return f.attr("id",this.constructNextId(g,a)),this.attachRemoveClickHandler(a),b},constructNextId:function(a,b){var c=a.lastIndexOf(b),d=a.slice(0,c)+(b+1);return d},addItem:function(a,b){this.cloneItem(b).appendTo(this.$("#@token_list")),this.$("#@text"+b).text(a),this.$("#@item"+b).css("display","inline-block")}}),a.TopicSelector=a.Typeahead.extend({onLoad:function(a){this._super.apply(this,arguments),this.setCallback(this.fnbind(function(){this.lookup("topic_add").select(),this.type!="to_tid"&&this.type!="replace_topic"&&this.reset()})),this.simulateScroll=!1},shouldHighlightFirstResult:function(){return this._super.apply(this,arguments)&&this.child("results").nResults>1},addTempTopic:function(a){this.$("#@temp_topics_list").append(a),this.parent().$("#@update").show(),this.parent().onAddTempTopic&&this.parent().onAddTempTopic()},resetTempTopics:function(a){this.$("#@temp_topics_list").text("")},hideSelector:function(){this.$("#@selector_wrapper").addClass("hidden"),this.$("#@view_selector_wrapper").removeClass("hidden"),this.$("#@view_selector").focus()},setTarget:function(a){a&&this.$("#@view_selector").text("Suggest Topics for "+a)}}),a.Navigator=a.Typeahead.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@add_new_question").click(this.fnbind(function(){return this.lookup("add_question").openDialog(this.qValue),!1})),this.setSelectionlessCallback(this.fnbind(function(){this.lookup("add_question").openDialog(this.qValue)}))}}),a.TopicNavigator=a.Typeahead.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@add_new_question").click(this.fnbind(function(){return this.setTopic(),this.lookup("add_question").openDialog(this.qValue),this.lookup("add_question").setOkCallback(this.fnbind(function(){this.clear()})),this.close(),!1})),this.setSelectionlessCallback(this.fnbind(function(){this.setTopic(),this.lookup("add_question").openDialog(this.qValue),this.lookup("add_question").setOkCallback(this.fnbind(function(){this.clear()})),this.close()}))},setTopic:function(){this.tid&&this.lookup("add_question").setTid(this.tid)},getRequestUpdatePostData:function(){return{q:this.qValue,tid:this.tid,data:JSON.stringify(this.data)}}}),a.ContextNavigator=a.ContextTypeahead.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@placeholder").hover(this.fnbind(function(){this.hideInstructionPlaceholder()})),this.$("#@input").click(this.fnbind(function(){return this.hideAddQuestionNote(),this.focus(!0),!1})),this.$("#@input").keydown(this.fnbind(function(a){this.keydownHandler(a)})),this.$("#@input").blur(this.fnbind(function(){this.hideAddQuestionNote()})),this.$("#@input").focus(this.fnbind(function(){this.hideAddQuestionNote()})),this.$("#@add_new_question").click(this.fnbind(function(){return this.addQuestionClick(),!1})),this.setSelectionlessCallback(this.fnbind(function(){this.addQuestionClick()})),this.open_add_question_dialog_on_load&&this.lookup("add_question").openDialog(this.qValue),this.focusOnLoad&&this.showInstructionPlaceholder("Search Questions, Topics and People")},keydownHandler:function(a){a.keyCode!=13&&this.hideAddQuestionNote()},addQuestionClick:function(){if(!this.qValue||this.qValue===""){this.showAddQuestionNote();return}this.hideAddQuestionNote(),this.child("results").hide(),this.lookup("add_question").setTid(this.getTopic()),this.lookup("add_question").openDialog(this.qValue)},showAddQuestionNote:function(){this.focus(!0),this.showInstructionPlaceholder("Type your question here"),this.child("results").hideDropdown(!0),this.lookup("add_question_note").$("#@note").fadeIn(500)},showInstructionPlaceholder:function(a){!this.$("#@input").val()&&!this.context.id&&(this.$("#@placeholder").text(a),this.$("#@placeholder").show())},hideInstructionPlaceholder:function(){this.$("#@placeholder").hide()},hideAddQuestionNote:function(){this.hideInstructionPlaceholder(),this.lookup("add_question_note").$("#@note").hide()},getTopic:function(){return this.context&&this.context.type=="topic"?this.context.id:null}}),a.FullNavigator=a.ContextNavigator.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@placeholder").hover(this.fnbind(function(){this.hideInstructionPlaceholder()})),this.$("#@input").click(this.fnbind(function(){return this.focus(!0),!1})),this.setSelectionlessCallback(this.fnbind(function(){})),this.open_add_question_dialog_on_load&&this.lookup("add_question").openDialog(this.qValue),this.focusOnLoad&&this.showInstructionPlaceholder("Search Questions, Topics and People")},addQuestionClick:function(){this.child("results").hide(),this.lookup("add_question").setTid(this.getTopic()),this.lookup("add_question").openDialog(this.qValue)},showInstructionPlaceholder:function(a){!this.$("#@input").val()&&!this.context.id&&(this.$("#@placeholder").text(a),this.$("#@placeholder").show())},hideInstructionPlaceholder:function(){this.$("#@placeholder").hide()},getTopic:function(){return this.context&&this.context.type=="topic"?this.context.id:null}}),a.InlineQuestionsNavigator=a.FullNavigator.extend({onLoad:function(){this._super.apply(this,arguments)},inputBlur:function(){this.setPlaceholder(),this.blurFakeInput()},addQuestionClick:function(){this.parent().addQuestion()}}),a.SearchPageInlineQuestionsNavigator=a.InlineQuestionsNavigator.extend({onLoad:function(){this.loaded=!1,this._super.apply(this,arguments),this.$("#@input").focus(this.fnbind(function(){this.loaded||(this.requestUpdate(),this.loaded=!0)})),this.simulateScroll=!1},keydownHandler:function(a){this._super.apply(this,arguments),a.keyCode>=48&&a.keyCode<=90&&this.$("#@results_shell").slideDown(100)},close:function(){this._super.apply(this,arguments),this.$("#@results_shell").slideUp(100)},openResultsLinkInNewTab:function(){return!0},addQuestionClick:function(){}}),a.InlineTopicsNavigator=a.InlineQuestionsNavigator.extend({onLoad:function(){this._super.apply(this,arguments),this.extraKeydown=null,this.simulateScroll=!1}}),a.BoardsNavigator=a.ContextNavigator.extend({onLoad:function(){this.loaded=!1,this._super.apply(this,arguments),this.setSelectionlessCallback(this.fnbind(function(){})),this.open_add_question_dialog_on_load&&this.lookup("add_question").openDialog(this.qValue),this.$("#@input").click(this.fnbind(function(){this.loaded||(this.requestUpdate(),this.loaded=!0)}))},keydownHandler:function(a){a.keyCode!=13&&this.hideAddQuestionNote()},showResultsDropdown:function(){this.userClicked&&this.child("results").showDropdown()},inputIsNotEmpty:function(){return this.$("#@input").val()&&this.$("#@input").val()!=this.orgPlaceholder},showAddQuestionNote:function(){},hideAddQuestionNote:function(){}}),a.MobileNavigator=a.Typeahead.extend({onLoad:function(){this._super.apply(this,arguments),this.setSelectionlessCallback(this.fnbind(function(){if(this.child("results").actionType=="url"&&this.qValue!==""){var a=h("/search?q="+encodeURIComponent(this.qValue).replace(/%20/g,"+"));window.location.href=a.unicode()}this.child("results").hide()}))}}),a.RedirectQuestionSelector=a.Typeahead.extend({onLoad:function(a){this._super.apply(this,arguments),this.setCallback(this.fnbind(function(){this.$("#@input").val($.trim($("<div>"+this.result.html+"</div>").text())),this.parent().$("#@to_qid").val(this.qValue),this.serverCall("question_redirect_preview").kwargs({to_qid:this.qValue}).contentFor(this.parent().$("#@question_redirect_preview"),{parentCID:this.cid}).send(),this.$("#@input").blur()}))}}),a.WantedAnswerQuestionSelector=a.Typeahead.extend({onLoad:function(a){this._super.apply(this,arguments),this.qid=null,this.setCallback(this.fnbind(function(){this.setQid(this.qValue),this.$("#@selector").addClass("hidden"),this.$("#@question").removeClass("hidden"),this.serverCall("question_name").kwargs({qid:this.qValue}).contentFor(this.$("#@question"),{parentCID:this.cid}).send(),this.reset()}))},setQid:function(a){this.qid=a},getQid:function(){return this.qid}}),a.PeopleSelector=a.Typeahead.extend({onLoad:function(a){this._super.apply(this,arguments),this.setCallback(this.fnbind(function(){this.to_uid=this.qValue,this.reset(),this.parent().setTo(this.to_uid)})),this.parent().allow_selectionless_input&&this.setSelectionlessCallback(this.fnbind(function(){this.to_uid=this.qValue,this.reset(),this.parent().setTo(this.to_uid)}))}}),a.ContactsSelector=a.Typeahead.extend({onLoad:function(a){this._super.apply(this,arguments),this.setCallback(this.fnbind(function(){this.setEmail(this.qValue)})),this.allow_selectionless_input&&this.setSelectionlessCallback(this.fnbind(function(){this.setEmail(this.qValue)})),this.trigger_selection_on_blur&&this.$("#@input").blur(this.fnbind(function(){var a=this.$("#@input").val();a&&a!=this.placeholder&&this.setEmail(a)})),this.$("#@input").keypress(this.fnbind(function(a){a.which==13&&(this.$("#@input").attr("focused",!1),this.child("results").hide(),a.preventDefault())}))},setEmail:function(a){this.parent().setTo(a),this.forceReset&&this.reset()}}),a.LinkSelector=a.Typeahead.extend({onLoad:function(){this._super.apply(this,arguments);var a=this;this.simulateScroll=!1,a.$("#@input").keydown(function(){if(a._escKeyDown)return a._escKeyDown.apply(this,arguments)}),a.$("#@input").keyup(function(b){if(a._keyUp)return a._keyUp.apply(this,arguments)})},setEscKeyDown:function(a){this._escKeyDown=a},setKeyUp:function(a){this._keyUp=a}}),a.FeaturedContentLinkSelector=a.Typeahead.extend({onLoad:function(){this._super.apply(this,arguments);var a=this;this.setCallback(this.fnbind(function(){this.child("results").hideDropdown()})),a.setSelectionlessCallback(function(){a.child("results").hideDropdown()}),a.$("#@input").keydown(function(){if(a._escKeyDown)return a._escKeyDown.apply(this,arguments)})}}),a.TopicPeopleSelector=a.Typeahead.extend({_callback:function(){var a=this.qValue.id,b=this.qValue.type;this.reset(),this.parent().setTo(a,b)},onLoad:function(a){this._super.apply(this,arguments),this.setCallback(this.fnbind(this._callback)),this.parent().allow_selectionless_input&&this.setSelectionlessCallback(this.fnbind(this._callback))},inputBlur:function(){this._super.apply(this,arguments),this.parent().blurSelector()}}),a.BoardSelector=a.Typeahead.extend({onLoad:function(a){this._super.apply(this,arguments),this.qValue=this.bid?this.bid:null,this.simulateScroll=!1,this.$("#@fake_input").click(this.fnbind(function(){return this.clearInput(),!1})),this.setSelectionlessCallback(function(){this.child("results").hideDropdown(),this.focusNext()}),this.setCallback(this.fnbind(function(){var a=this.getBid();if(!a){this.$("#@input").css("background","#fff"),this.focusNext();return}this.swapInput(a)})),this.$("#@input").click(this.fnbind(function(a){a.stopPropagation()})),this.child("results").$("#@results_frame").click(this.fnbind(function(a){a.stopPropagation()})),$(document).click(this.fnbind(function(){this.child("results")&&this.child("results").hide()}))},inputBlur:function(){this.setPlaceholder()},setInput:function(a){this.setValue(a),this.swapInput(a)},swapInput:function(a){this.$("#@input_wrapper").hide(),this.$("#@fake_input").show(),this.selectionChosen=!1,this.serverCall("update_preview").kwargs({bid:a}).contentFor(this.$("#@fake_input"),{parentCID:this.cid}).send(),this.focusNext()},focusNext:function(){try{this.cQuery(":editor.editor")&&this.cQuery(":editor").showEditor()}catch(a){}},resetFakeInput:function(){this.qValue=this.initialValue,this.$("#@fake_input").hide(),this.$("#@input_wrapper").show(),this.$("#@input").val(""),this.$("#@input").css("background","#fff")},clearInput:function(a){this.resetFakeInput(),this.focus(!0),this.child("results").showDropdown()},getText:function(){var a=this.$("#@input").val();return a==this.$("#@input").attr("placeholder")?null:a},getBid:function(){return isNaN(this.qValue)?null:this.qValue}}),a.PeopleAndSocialContactsSelector=a.Typeahead.extend({onLoad:function(a){this._super.apply(this,arguments),this.setCallback(this.fnbind(function(){this.result&&this.result.text?this.setUserOrEmail(this.qValue,this.result.text):this.setUserOrEmail(this.qValue,this.qValue)})),this.allow_selectionless_input&&this.setSelectionlessCallback(this.callback),this.trigger_selection_on_blur&&this.$("#@input").blur(this.fnbind(function(){var a=this.$("#@input").val();a&&a!=this.placeholder&&this.setUserOrEmail(a,a)})),this.$("#@input").keypress(this.fnbind(function(a){a.which==13&&(this.$("#@input").attr("focused",!1),this.child("results").hide(),a.preventDefault())}))},setUserOrEmail:function(a,b){typeof a=="string"&&a.indexOf("@")>=0?this.parent().setEmailTo(a,b):typeof a=="number"&&this.parent().setUserTo(a,b),this.reset()}}),a.PeopleAndSocialContactsMultiSelector=a.MultiSelectTypeahead.extend({onLoad:function(a){this._super.apply(this,arguments);var b=this;b.allow_selectionless_input&&b.setSelectionlessCallback(b.fnbind(b.setWithoutSelection)),b.trigger_selection_on_blur&&b.input.blur(b.fnbind(b.setWithoutSelection))},setWithoutSelection:function(){this.qValue&&j.isValidEmail(this.qValue)&&this.setValue(this.qValue,{type:"contact",value:this.qValue,text:this.qValue})},updateContainer:function(){var a=this;this.lookup("socialTypeaheadContainer").updateResults($.grep(this.results,function(b,c){return c in a.results&&b.type!=="instruction"}))}}),a.SearchSuggestions=a.TypeaheadResults.extend({onLoad:function(){this._super.apply(this,arguments);var a=this.$(".full_search.instant_results").width();this.$("#@results_frame").css("width",a)},hide:function(){this.hideDropdown(!0),this.forceOpenResults||this.setFocusIndex(null)},goResult:function(a,b){if(this.actionType=="url"){this.serverCall("log_navigator_click").kwargs({query_hash:this.query_hash,index:a}).send(),this.setCookies();var c=this.results[a].type||null;if(c=="addquestionitem"){var f=this.results[a].question,g=this.parent().lookup("wizard");g.close();var h=this.results[a].query||null,i=f;g.open(f,!1,!1,h,i,"skip_1");return}var j=this.query_type;j=="all"?e.setSingleUse("q",JSON.stringify(this.results[a].plaintext)):j=="author"?e.setSingleUse("q",JSON.stringify("author: "+this.parent().selectedAuthor+": "+this.results[a].plaintext)):e.setSingleUse("q",JSON.stringify(j+": "+this.results[a].plaintext));if(this.parent().isAuthorSelected===!0){var k=this.actionOfIndex[a].slice(0,20),l=this.actionOfIndex[a].slice(20,this.actionOfIndex[a].length),m=this.parent().selectedAuthor.replace(/ /g,"+"),n=k+m+"%3A+"+l;d.handleClick(n,b)}else d.handleClick(this.actionOfIndex[a],b)}else assert(0)},setCookies:function(){e.setMessage("qhash",[this.query_hash,this.parent().selectedOid])}}),a.QuerySuggestionsNavigator=a.Typeahead.extend({onLoad:function(){this.qValue=this.initialValue,this.result=null,this.requestOutstanding=!1,this.closed=!1,this.selectionChosen=!1,this.selectionlessCallback=null,this.placeholderActive=!1,this.extraKeydown=null,this.userClicked=!1,this.simulateScroll=!0,this.originalPageTitle=$("title").text(),this.query_hash=Math.random().toString(36),this.data={query_hash:this.query_hash},this.search_typ="",this.selectedOid=null,this.selectedAuthor="",this.isAuthorSelected=!1;var a=this.$("#@input").attr("placeholder");this.$("#@input").attr("placeholder",g.decode(a)),this.$("#@view_selector").click(this.fnbind(function(){return this.$("#@selector_wrapper").removeClass("hidden"),this.$("#@view_selector_wrapper").addClass("hidden"),this.focus(),!1}));var b=this;b.data||(b.data={}),b.$("#@input").focus(function(){$(this).attr("focused","true"),b.inputFocus(),b.extraFocus&&b.extraFocus()}).blur(function(){$(this).removeAttr("focused"),b.inputBlur(),b.userClicked=!1}).keydown(function(a){return b.inputKeydown(a)}).keyup(function(a){return b.inputKeyup(a)}).click(function(){b.userClicked=!0}),this.onKeyCombination(document.body,"/",function(){return b.$("#@input").focus(),b.showResultsDropdown(),!1},document.body),this.setSelectionlessCallback(this.fnbind(function(){if(this.child("results").actionType=="url"&&this.qValue!==""){var a=h("/search?q="+encodeURIComponent(this.qValue).replace(/%20/g,"+"));this.setCookies(),window.location.href=a.unicode()}this.child("results").hide()})),this.$("#@search").click(this.fnbind(function(){return this.selectionlessCallback(),!1}))},inputKeydown:function(a){var b=this.$("#@input"),d=b.val();this.qValue=d;var e=!this.child("results").isVisible()&&!this.requestOutstanding,f=a.keyCode==39,g=i&&a.keyCode==27;if(!this.userClicked&&this.simulateScroll&&e&&(c.maybeSimulateScroll(a)||f||g)){b.blur();if(f)return;return!1}this.closed=!1,c.cancelSimulatedScroll();if(a.keyCode==40)return this.requestOutstanding=!1,this.child("results").down(),this.previewSearchInInput(),!1;if(a.keyCode==38)return this.child("results").up(),this.previewSearchInInput(),!1;if(a.keyCode==27)return!i||this.child("results").isVisible()?this.child("results").hide():b.blur(),this.userClicked=!1,this.resetInputIcon(),!1;if(a.keyCode==13){if(this.child("results").go(a))return this.child("results").hide(),!1;if(this.selectionlessCallback&&this.selectionlessCallback())return!1}else{if(a.keyCode==9){var h=this.child("results").focusedIndex;return h===null?(this.child("results").down(),this.previewSearchInInput(),!1):(this.requestUpdate(),!1)}a.keyCode==39&&(this.userClicked=!0)}return this.resetInputIcon(),this.extraKeydown?this.extraKeydown(a.keyCode):!0},onInputChange:function(){var a=this.$("#@input").val();if(a==this.qValue)return;if(!this.should_update)return;this.qValue=a,this.requestOutstanding||this.requestUpdate(),this.qValue===""&&(this.closed=!1);var b=this.child("results").query_type;if(b=="author"){var c=this.getValue();c.split(":").length==3?(this.isAuthorSelected=!0,this.selectedAuthor=$.trim(c.split(":")[1])):this.isAuthorSelected=!1}},focusedUpdate:function(){var a=this.qValue,b;if(a.indexOf(":")>=0){var c=a.split(":"),d=c[0];this.search_type=$.trim(d);if(this.search_type=="author"){var e=c[1];b=c[2]}else b=c[1]}},setValue:function(a,b){this._super.apply(this,arguments),b.img_src?this.$("#@input_icon").attr("src",b.img_src):this.resetInputIcon()},resetInputIcon:function(){this.$("#@input_icon").attr("src",this.default_search_icon)},previewSearchInInput:function(){var a=this.child("results").focusedIndex,b=this.child("results").getResult(a);if(b===undefined)this.setValue(this.child("results").query,{});else{this.setValue(b.plaintext,b);var c=this.child("results").query_type;c!="all"&&c!="author"&&(c=="board"?this.setValue("blog: "+this.qValue,{}):this.setValue(c+": "+this.qValue,{})),c=="author"&&(this.isAuthorSelected===!0?this.setValue("author: "+this.selectedAuthor+": "+this.qValue,{}):(this.setValue("author: "+this.qValue,{}),this.selectedOid=b.id))}},getRequestUpdatePostData:function(){return{q:this.qValue,data:JSON.stringify(this.data)}},setCookies:function(){e.setMessage("qhash",[this.query_hash,this.selectedOid])}}),$.extend(window,a)}),require.install("fastclick",function(require,a,b){function c(a){"use strict";var b,d=this;this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=10,this.layer=a;if(!a||!a.nodeType)throw new TypeError("Layer must be a document node");this.onClick=function(){return c.prototype.onClick.apply(d,arguments)},this.onMouse=function(){return c.prototype.onMouse.apply(d,arguments)},this.onTouchStart=function(){return c.prototype.onTouchStart.apply(d,arguments)},this.onTouchMove=function(){return c.prototype.onTouchMove.apply(d,arguments)},this.onTouchEnd=function(){return c.prototype.onTouchEnd.apply(d,arguments)},this.onTouchCancel=function(){return c.prototype.onTouchCancel.apply(d,arguments)};if(c.notNeeded(a))return;this.deviceIsAndroid&&(a.addEventListener("mouseover",this.onMouse,!0),a.addEventListener("mousedown",this.onMouse,!0),a.addEventListener("mouseup",this.onMouse,!0)),a.addEventListener("click",this.onClick,!0),a.addEventListener("touchstart",this.onTouchStart,!1),a.addEventListener("touchmove",this.onTouchMove,!1),a.addEventListener("touchend",this.onTouchEnd,!1),a.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(a.removeEventListener=function(b,c,d){var e=Node.prototype.removeEventListener;b==="click"?e.call(a,b,c.hijacked||c,d):e.call(a,b,c,d)},a.addEventListener=function(b,c,d){var e=Node.prototype.addEventListener;b==="click"?e.call(a,b,c.hijacked||(c.hijacked=function(a){a.propagationStopped||c(a)}),d):e.call(a,b,c,d)}),typeof a.onclick=="function"&&(b=a.onclick,a.addEventListener("click",function(a){b(a)},!1),a.onclick=null)}c.prototype.deviceIsAndroid=navigator.userAgent.indexOf("Android")>0,c.prototype.deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent),c.prototype.deviceIsIOS4=c.prototype.deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent),c.prototype.deviceIsIOSWithBadTarget=c.prototype.deviceIsIOS&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent),c.prototype.needsClick=function(a){"use strict";switch(a.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(a.disabled)return!0;break;case"input":if(this.deviceIsIOS&&a.type==="file"||a.disabled)return!0;break;case"label":case"video":return!0}return/\bneedsclick\b/.test(a.className)},c.prototype.needsFocus=function(a){"use strict";switch(a.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!this.deviceIsAndroid;case"input":switch(a.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!a.disabled&&!a.readOnly;default:return/\bneedsfocus\b/.test(a.className)}},c.prototype.sendClick=function(a,b){"use strict";var c,d;document.activeElement&&document.activeElement!==a&&document.activeElement.blur(),d=b.changedTouches[0],c=document.createEvent("MouseEvents"),c.initMouseEvent(this.determineEventType(a),!0,!0,window,1,d.screenX,d.screenY,d.clientX,d.clientY,!1,!1,!1,!1,0,null),c.forwardedTouchEvent=!0,a.dispatchEvent(c)},c.prototype.determineEventType=function(a){return"use strict",this.deviceIsAndroid&&a.tagName.toLowerCase()==="select"?"mousedown":"click"},c.prototype.focus=function(a){"use strict";var b;this.deviceIsIOS&&a.setSelectionRange&&a.type.indexOf("date")!==0&&a.type!=="time"?(b=a.value.length,a.setSelectionRange(b,b)):a.focus()},c.prototype.updateScrollParent=function(a){"use strict";var b,c;b=a.fastClickScrollParent;if(!b||!b.contains(a)){c=a;do{if(c.scrollHeight>c.offsetHeight){b=c,a.fastClickScrollParent=c;break}c=c.parentElement}while(c)}b&&(b.fastClickLastScrollTop=b.scrollTop)},c.prototype.getTargetElementFromEventTarget=function(a){return"use strict",a.nodeType===Node.TEXT_NODE?a.parentNode:a},c.prototype.onTouchStart=function(a){"use strict";var b,c,d;if(a.targetTouches.length>1)return!0;b=this.getTargetElementFromEventTarget(a.target),c=a.targetTouches[0];if(this.deviceIsIOS){d=window.getSelection();if(d.rangeCount&&!d.isCollapsed)return!0;if(!this.deviceIsIOS4){if(c.identifier===this.lastTouchIdentifier)return a.preventDefault(),!1;this.lastTouchIdentifier=c.identifier,this.updateScrollParent(b)}}return this.trackingClick=!0,this.trackingClickStart=a.timeStamp,this.targetElement=b,this.touchStartX=c.pageX,this.touchStartY=c.pageY,a.timeStamp-this.lastClickTime<200&&a.preventDefault(),!0},c.prototype.touchHasMoved=function(a){"use strict";var b=a.changedTouches[0],c=this.touchBoundary;return Math.abs(b.pageX-this.touchStartX)>c||Math.abs(b.pageY-this.touchStartY)>c?!0:!1},c.prototype.onTouchMove=function(a){"use strict";if(!this.trackingClick)return!0;if(this.targetElement!==this.getTargetElementFromEventTarget(a.target)||this.touchHasMoved(a))this.trackingClick=!1,this.targetElement=null;return!0},c.prototype.findControl=function(a){return"use strict",a.control!==undefined?a.control:a.htmlFor?document.getElementById(a.htmlFor):a.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},c.prototype.onTouchEnd=function(a){"use strict";var b,c,d,e,f,g=this.targetElement;if(!this.trackingClick)return!0;if(a.timeStamp-this.lastClickTime<200)return this.cancelNextClick=!0,!0;var h=a.timeStamp-this.trackingClickStart;if(h>100)return!1;this.cancelNextClick=!1,this.lastClickTime=a.timeStamp,c=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,this.deviceIsIOSWithBadTarget&&(f=a.changedTouches[0],g=document.elementFromPoint(f.pageX-window.pageXOffset,f.pageY-window.pageYOffset)||g,g.fastClickScrollParent=this.targetElement.fastClickScrollParent),d=g.tagName.toLowerCase();if(d==="label"){b=this.findControl(g);if(b){this.focus(g);if(this.deviceIsAndroid)return!1;g=b}}else if(this.needsFocus(g)){if(a.timeStamp-c>100||this.deviceIsIOS&&window.top!==window&&d==="input")return this.targetElement=null,!1;this.focus(g);if(!this.deviceIsIOS4||d!=="select")this.targetElement=null,a.preventDefault();return!1}if(this.deviceIsIOS&&!this.deviceIsIOS4){e=g.fastClickScrollParent;if(e&&e.fastClickLastScrollTop!==e.scrollTop)return!0}return this.needsClick(g)||(a.preventDefault(),this.sendClick(g,a)),!1},c.prototype.onTouchCancel=function(){"use strict",this.trackingClick=!1,this.targetElement=null},c.prototype.onMouse=function(a){return"use strict",this.targetElement?a.forwardedTouchEvent?!0:a.cancelable?!this.needsClick(this.targetElement)||this.cancelNextClick?(a.stopImmediatePropagation?a.stopImmediatePropagation():a.propagationStopped=!0,a.stopPropagation(),a.preventDefault(),!1):!0:!0:!0},c.prototype.onClick=function(a){"use strict";var b;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):a.target.type==="submit"&&a.detail===0?!0:(b=this.onMouse(a),b||(this.targetElement=null),b)},c.prototype.destroy=function(){"use strict";var a=this.layer;this.deviceIsAndroid&&(a.removeEventListener("mouseover",this.onMouse,!0),a.removeEventListener("mousedown",this.onMouse,!0),a.removeEventListener("mouseup",this.onMouse,!0)),a.removeEventListener("click",this.onClick,!0),a.removeEventListener("touchstart",this.onTouchStart,!1),a.removeEventListener("touchmove",this.onTouchMove,!1),a.removeEventListener("touchend",this.onTouchEnd,!1),a.removeEventListener("touchcancel",this.onTouchCancel,!1)},c.notNeeded=function(a){"use strict";var b,d;if(typeof window.ontouchstart=="undefined")return!0;d=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(d){if(!c.prototype.deviceIsAndroid)return!0;b=document.querySelector("meta[name=viewport]");if(b){if(b.content.indexOf("user-scalable=no")!==-1)return!0;if(d>31&&window.innerWidth<=window.screen.width)return!0}}return a.style.msTouchAction==="none"?!0:!1},c.attach=function(a){return"use strict",new c(a)},typeof define!="undefined"&&define.amd?define(function(){return"use strict",c}):typeof b!="undefined"&&b.exports?(b.exports=c.attach,b.exports.FastClick=c):window.FastClick=c}),require.install("viz",function(require,a,b){var c=require("w2.quora").Component,d=a.VizImageTemplate=c.extend({onLoad:function(){}})}),require.install("app/view/question/question_add",function(require,a,b){var c=require("w2.quora").Component,d=require("webnode2"),e=require("w2.livenode"),f=require("window_manager"),g=require("settings");a.AddQuestionContextEditor=c.extend({onLoad:function(){this.cQuery(":context_editor").$("#@input").bind("focus",this.fnbind(function(a){this.removeMissingContextError()})),this.cQuery(":context_editor").$("#@input").bind("blur",this.fnbind(function(a){this.parent().checkSubmitStatus()}))},focusInput:function(){this.cQuery(":context_editor").focus(!0)},getContext:function(){var a=this.cQuery(":context_editor.topic_add").getTempTopicNamesAsArray();return a.length>0?a[0]:null},addMissingContextError:function(){this.cQuery(":context_editor").$("#@input").addClass("input_validation_error"),this.$("#@no_context_error").show()},removeMissingContextError:function(){this.cQuery(":context_editor").$("#@input").removeClass("input_validation_error"),this.$("#@no_context_error").hide()},onAddTempTopic:function(){this.parent().focusQuestionBox()}});var h=a.AddQuestionInline=c.extend({onLoad:function(){this.editor=this.lookup("navigator"),this.lookup("navigator").$("#@input").focus(this.fnbind(function(){this.$("#@wrapper").addClass("expanded")})),this.lookup("navigator").$("#@input").keydown(this.fnbind(function(){this.$("#@add").removeClass("disabled"),this.$("#@topic_section").fadeIn(250)})),this.setupAddClick(),this.disabled=!1
},focusQuestionBox:function(){this.editor.focus(!0)},setupAddClick:function(){this.$("#@add").click(this.fnbind(function(){return this.addQuestion(),!1}))},checkSubmitStatus:function(){this.add_request_pending||this.minLength&&this.lookup("editor").valLength()<this.minLength?($(".dialog .submit_button").addClass("submit_button_disabled"),this.disabled=!0):($(".dialog .submit_button").removeClass("submit_button_disabled"),this.disabled=!1)},isDefaultText:function(){return this.lookup("editor").html().slice(0,this.default_text.length)==this.default_text},setFocusCallback:function(a){this.lookup("editor").setFocusCallback(a)},fixQuestion:function(a){this.$("#@fixit").show(),this.$("#@text").html(a),this.attempts++,this.attempts>1&&this.$("#@skip").show()},questionAddedCallback:function(a){var b=a[0];f.sameDomainURL(b)&&f.navigateTo(b),d.Dialog.openerFor(this).closeDialog()},addQuestionClickedCallback:function(a){},getDistribution:function(){return this.lookup("distribution_menu").getValue()},isPrivate:function(){return this.getDistribution()==0?1:0},expand:function(){if(this.expanded)return;this.$("#@editor_row").addClass("form_row"),this.$("#@form_buttons").removeClass("hidden"),this.$("#@form_option_row").removeClass("hidden"),this.focus(),this.expanded=!0},clear:function(){this.lookup("editor").clear(),this.$("#@question_privacy").attr("checked",!1)},select:function(){this.lookup("editor").selectAll()},focus:function(){this.lookup("editor").focus()},getKwargs:function(){var a={question:this.getQuestionText(),is_private:this.isPrivate(),topic_names:this.lookup("topic_section").getTopicNames(),unselected_topic_names:this.lookup("topic_section").getUnselectedTopicNames(),needs_fast_answers:!1};return a},getQuestionText:function(){return this.lookup("navigator").$("#@input").val()},getDistribution:function(){return this.lookup("anon_checkbox").getValue()},showPoorQuestionFeedback:function(a){this.add_request_pending=!1,this.enableAddQuestionButton(),this.editor.focus(),this.fixQuestion(a.note),this.$("#@fixit").show()},addQuestion:function(){if(this.disabled)return!1;require("action_log").logSecondaryAction("QuestionAdd",null),this.disableAddQuestionButton();var a=this.getKwargs(),b=this.serverCall(this.getAddQuestionServerCall()).kwargs(a).success(this.fnbind(function(a){this.add_request_pending=!1,this.enableAddQuestionButton(),this.questionAddedCallback(a)})).except("poor_question",this.fnbind(function(a){this.showPoorQuestionFeedback(a)})).except("problematic_question",this.fnbind(function(a){this.showPoorQuestionFeedback(a)})).except("non_english_question",this.fnbind(function(a){this.showPoorQuestionFeedback(a)})).except("survey_question",this.fnbind(function(a){this.showPoorQuestionFeedback(a)})).error(this.fnbind(function(a){this.add_request_pending=!1,this.enableAddQuestionButton()})).disableNextPostReload();this.shouldLiveMutateAddQuestionCall()&&(b.liveMutate(),b.persistMutation()),b.send(),this.addQuestionClickedCallback(a)},shouldLiveMutateAddQuestionCall:function(){return!0},getAddQuestionServerCall:function(){return this.shouldLiveMutateAddQuestionCall()?"add_question":"add_question_no_live_mutation"},focus:function(){this.lookup("navigator").focus(!0)},disableAddQuestionButton:function(){this.disabled=!0},enableAddQuestionButton:function(){this.disabled=!1}});a.AddQuestionIntoTopicInline=h.extend({questionAddedCallback:function(a){var b=a[0],c=a[1];this.parent().newQuestionAdded(b,c)},addQuestionClickedCallback:function(a){var b=a.question;this.parent().newQuestionPending(b),this.lookup("navigator").clear(),this.focusQuestionBox()},disableAddQuestionButton:function(){},enableAddQuestionButton:function(){},shouldLiveMutateAddQuestionCall:function(){return!1}}),a.AddQuestionDialogFromInlineForm=c.extend({onLoad:function(){this.hasStartedTyping=!1,this.$("#@question_text").keydown(this.fnbind(function(a){if(a.keyCode==13)return this.lookup("button").openDialog(),a.stopPropagation(),!1;this.hasStartedTyping||(this.serverCall("log_start_adding_question").send(),this.hasStartedTyping=!0)})),this.$("#@question_text").bind("focus keydown",this.fnbind(function(a){this.$("#@anon_checkbox").show(),this.$("#@fast_answer_checkbox").show()}))},addButtonClickCallback:function(){this.hasStartedTyping||(this.serverCall("log_start_adding_question").send(),this.hasStartedTyping=!0)},getQuestionText:function(){var a=this.$("#@question_text").val(),b=$("<div/>").text(a).html();return b},getIsPrivate:function(){var a=this.child("anon_checkbox",!0);return a?a.getValue()==0?1:0:0},getNeedsFastAnswers:function(){var a=this.child("fast_answers_checkbox",!0);return a?a.isChecked():!1}}),a.FastAnswersCheckbox=c.extend({onLoad:function(){this.cb=this.$("#@fast_answer_checkbox")},isChecked:function(){return this.cb.is(":checked")},setChecked:function(a){a?this.cb.attr("checked","checked"):this.cb.removeAttr("checked")}}),a.AddQuestionDialogLink=c.extend({onLoad:function(){this.$("#@dialog_link").click(this.fnbind(function(){return this.openDialog(),!1}))},openDialog:function(){var a=!1,b=!1,c=null,d=null,e=null,f=this.parent(),g=this.getQuestionText();return f&&(f.addButtonClickCallback&&f.addButtonClickCallback(),f.getIsPrivate&&(a=f.getIsPrivate()),f.getNeedsFastAnswers&&(b=f.getNeedsFastAnswers()),f.query&&(c=f.query),f.question_text&&(d=f.question_text),f.skip_step&&(e=f.skip_step)),this.lookup("wizard").open(g,a,b,c,d,e),this.lookup("hover_menu")&&this.lookup("hover_menu").doHide&&this.lookup("hover_menu").doHide(),!1},getQuestionText:function(){return this.parent().getQuestionText?this.parent().getQuestionText():""}}),a.AddQuestionWizard=c.extend({onLoad:function(){this.$("#@question_text_done").click(this.fnbind(function(a){return this.questionTextDoneCallback(),!1})),this.$("#@cancel, #@close_x").click(this.fnbind(function(){return this.close(),!1}));var a=this,b=a.lookup("question");b.setEnterCallback(function(){a.questionTextDoneCallback()}),this.duration=75,this.question_text_html=null,this.last_topic_lookup_question_text_html=null,this.add_button_disabled=!1,this.$("#@add_question_title_link").click(this.fnbind(function(){return this._hide_request_reviews(),this._show_add_question(),!1})),this.$("#@request_reviews_title_link").click(this.fnbind(function(){return this._hide_add_question(),this._show_request_reviews(),!1})),this.enableQuestionTextDoneButton(),this.lookup("question").setFocusCallback(this.fnbind(function(){this.removeQuestionFeedbackHighlight()})),this.skip_soft_rules=!1,this.duplicate_no_results=!1},_show_request_reviews:function(){this.$("#@request_reviews_title_link").addClass("as_title"),this.$("#@request_reviews_inner").show(),this.lookup("request_reviews").lookup("context").focus()},_hide_request_reviews:function(){this.$("#@request_reviews_title_link").removeClass("as_title"),this.$("#@request_reviews_inner").hide()},_show_add_question:function(){this.$("#@add_question_title_link").addClass("as_title"),this.$("#@question_row_inner").show()},_hide_add_question:function(){this.$("#@add_question_title_link").removeClass("as_title"),this.$("#@question_row_inner").hide()},open:function(a,b,c,d,e,f){this.origQuestionHtml=e||a,this.origQuery=d,this.skipStep=f,this.showCheckboxesOnDuplicateStep=f=="skip_1",this.skipDuplicateCheckOnOrigQuestion=f=="skip_2";var g=this.lookup("anon_checkbox"),h=b?g.anon_value:g.public_value;g.setValue(h);var i=this.lookup("fast_answers_checkbox");i&&i.setChecked(c),this.center(),this.$("#@wizard_dialog .dialog_buttons").remove(),this.$("#@wizard_dialog").removeClass("hidden");var j=this.lookup("question");j.focus();if(a){this.lookup("question").setHtml(a);var k=this;$(document).ready(function(){setTimeout(function(){a&&k.questionTextDoneCallback()},0)})}this.serverCall("log_open_wizard_dialog").send()},center:function(){var a=420,b=100,c=this.$("#@wizard_dialog"),d=$(window).width(),e=$(window).scrollTop(),f=a,h=d-f,i=h/2;if(g.mobile)c.css("top",e).css("left","10px").css("right","10px").css("width","auto").appendTo($("div.mobile_page"));else{if(this.new_grid){var j=$(window).height()/2;j-=c.outerHeight(),c.css("top",j+"px"),c.css("left",i+"px"),c.css("width",a+"px"),c.appendTo($(document.body));var k=$(window).height()-j;c.find(".dialog_wrapper").css("max-height",k+"px").css("overflow","auto");return}var e=b;$(window).height()<1500&&(e+=$(window).scrollTop(),c.find(".dialog_wrapper").css("position","static")),c.find(".dialog_wrapper a.remove").css("top",15).css("right",-5),c.css("top",e+"px"),c.css("left",i-15+"px"),c.css("width",a+"px"),c.appendTo($(document.body))}},close:function(){this.add_button_disabled=!1,this.enableQuestionTextDoneButton(),this.skip_soft_rules=!1,this.$("#@wizard_dialog").addClass("hidden"),this.showQuestionSection(),this.lookup("question").clear(),this.$("#@fixit_title").html(""),this.$("#@fixit_text").html(""),this.$("#@fixit").hide()},showQuestionSection:function(){return this.toggleSection("#@question_row_inner"),this.toggleTitles("#@add_question_title",!1),this.$("#@question_text_preview").addClass("hidden").text(""),this.lookup("question").$("#@editor").removeClass("disabled_for_submit"),this._show_add_question(),this._hide_request_reviews(),!1},showDuplicatesSection:function(){var a=this.question_text_html.replace(/<(?:.|\n)*?>/gm,""),b="&nbsp;",c=new RegExp(b,"g");a=a.replace(c," ");var d=150;a.length>d&&(a=a.substring(0,d)+"..."),this.$("#@question_text_preview").html(a).removeClass("hidden");if(this.skipDuplicateCheckOnOrigQuestion&&this.question_text_html==this.origQuestionHtml)return this.duplicatesDoneCallback(),!1;this.serverCall("log_duplicate_step_started").send(),this.toggleSection("#@duplicate_row_inner"),this.toggleTitles("#@duplicates_title",!1),this.checkDuplicateResults();var e=this.lookup("wizard");return e.duplicate_no_results&&e.duplicatesDoneCallback(),!1},showTopicsSection:function(){function c(){a++;var d=b.lookup("add_topics_step",!0);d?d.onShownInWizard():a<=10&&setTimeout(c,200)}this.toggleSection("#@topics_row_inner"),this.toggleTitles("#@topics_title",!1);var a=0,b=this;return c(),!1},onEnterPressed:function(){this.enterPressedCallback&&this.enterPressedCallback()},onEditorInputChange:function(){this.enableQuestionTextDoneButton(),this.skip_soft_rules=!1},toggleSection:function(a){this.$("%@section_inner_content").hide(),this.$(a).show()},toggleTitles:function(a,b){b?this.$("%@title_tabs").removeClass("hidden").addClass("inactive"):this.$("%@title_tabs").addClass("hidden"),this.$(a).removeClass("inactive").removeClass("hidden")},showPoorQuestionFeedback:function(a){this.showQuestionSection(),this.$("#@fixit_title").html(a.title),this.$("#@fixit_text").html(a.note),this.$("#@fixit").slideDown(200),a.matched_phrase&&this.addQuestionFeedbackHighlight(a.matched_phrase),a.is_blocking?(this.disableQuestionTextDoneButton(),this.$("#@fixit_instruction").hide()):(this.$("#@fixit_instruction").show(),this.skip_soft_rules=!0)},hidePoorQuestionFeedback:function(){this.$("#@fixit").slideUp(200)},removeQuestionFeedbackHighlight:function(){this.lookup("question").$("#@editor .question_feedback_highlight").contents().unwrap()},addQuestionFeedbackHighlight:function(a){this.lookup("question").$("#@editor").html(function(b,c){var d=new RegExp("("+a+")","i");return c.replace(d,'<span class="question_feedback_highlight">$1</span>')})},enableQuestionTextDoneButton:function(){this.question_text_done_button_enabled=!0,this.$("#@question_text_done").removeClass("submit_button_disabled"),this.lookup("question").$("#@editor").removeClass("disabled_for_submit")},disableQuestionTextDoneButton:function(){this.$("#@question_text_done").addClass("submit_button_disabled"),this.question_text_done_button_enabled=!1},checkDuplicateResults:function(){var a=this.$(".duplicate_question_link_span");this.duplicate_no_results=a.length===0},questionTextDoneCallback:function(){if(!this.question_text_done_button_enabled)return;this.hidePoorQuestionFeedback(),this.lookup("question").$("#@editor").addClass("disabled_for_submit"),this.lookup("question").blur(),this.question_text_html=this.lookup("question").html(!1),this.$("#@duplicate_row_inner").empty().hide(),this.serverCall("get_duplicate_component").contentFor(this.$("#@duplicate_row_inner"),{parentCID:this.cid}).kwargs({query:this.lookup("question").serialize(),check_for_question_issues:!0,skip_soft_rules:this.skip_soft_rules}).except("poor_question",this.fnbind(function(a){this.showPoorQuestionFeedback(a)})).except("problematic_question",this.fnbind(function(a){this.showPoorQuestionFeedback(a)})).except("non_english_question",this.fnbind(function(a){this.showPoorQuestionFeedback(a)})).success(this.fnbind(function(a){this.loadTopics(),this.skipStep||(this.$("#@topics_row").hide(),this.$("#@duplicate_row").show(),this.showDuplicatesSection())})).send(),this.skipStep&&(this.$("#@topics_row").hide(),this.$("#@duplicate_row").show(),this.showDuplicatesSection())},loadTopics:function(){var a=this.lookup("question").html(!1);this.last_topic_lookup_question_text_html!=a&&(this.last_topic_lookup_question_text_html=a,this.serverCall("get_topic_component").contentFor(this.$("#@topics_row_inner"),{parentCID:this.cid}).kwargs({query:this.lookup("question").serialize()}).send())},duplicatesDoneCallback:function(){this.$("#@topics_row").show(),this.showTopicsSection()},getQuestionText:function(){return this.lookup("question").serialize()},topicsDoneCallback:function(){if(this.add_button_disabled)return;var a={question:this.getQuestionText(),is_private:this.lookup("add_topics_step").getIsPrivate(),topic_names:this.lookup("add_topics_step").getTopicNames(),unselected_topic_names:this.lookup("add_topics_step").getUnselectedTopicNames(),needs_fast_answers:this.lookup("fast_answers_checkbox")?this.lookup("fast_answers_checkbox").isChecked():!1,orig_query:this.origQuery};require("action_log").logSecondaryAction("QuestionAdd",null),this.add_button_disabled=!0,this.serverCall("add_question").kwargs(a).liveMutate().success(this.fnbind(function(a){var b=a[0];f.navigateTo(b)})).error(this.fnbind(function(){this.add_button_disabled=!1})).except(this.fnbind(function(){this.add_button_disabled=!1})).send()}}),a.AddQuestionWizardDuplicateStep=c.extend({onLoad:function(){this.parent().showCheckboxesOnDuplicateStep&&this.$("#@extra_checkboxes").show(),this.whenOnLoaded(this.fnbind(function(){var a=this.child("fast_answers_checkbox2");if(a){var b=this.parent().lookup("fast_answers_checkbox");if(b){var c=a.$("#@fast_answer_checkbox");c.change(function(){b.setChecked(a.isChecked())})}}var d=this.child("anon_checkbox2");if(d){var e=this.parent().lookup("anon_checkbox");if(e){var c=d.$("#@checkbox");c.change(function(){e.setValue(d.getValue())})}}})),this.$("#@duplicates_done").click(this.fnbind(function(a){return this.parent().duplicatesDoneCallback(),this.serverCall("log_step_complete").send(),!1})),this.$("#@duplicates_done").focus(),this.$("#@cancel").click(this.fnbind(function(){return this.parent().showQuestionSection(),this.$("#@extra_checkboxes").hide(),this.parent().showCheckboxesOnDuplicateStep=!1,!1}))}}),a.AddQuestionDuplicateQuestionLink=c.extend({onLoad:function(){this.$("#@link").find("a").click(this.fnbind(function(){return this.serverCall("log_question_click").send(),!0}))}}),a.AddQuestionWizardTopicStep=c.extend({onLoad:function(){this.$("#@topics_done").click(this.fnbind(function(a){return this.parent().topicsDoneCallback(),!1})),this.$("#@topics_done").focus(),this.$("#@cancel").click(this.fnbind(function(){var a=this.parent();return a.skipDuplicateCheckOnOrigQuestion&&a.question_text_html==a.origQuestionHtml?a.showQuestionSection():a.duplicate_no_results?a.showQuestionSection():a.showDuplicatesSection(),!1}))},onShownInWizard:function(){this.empty&&this.lookup("selector").focus(!0)},getIsPrivate:function(){return this.lookup("anon_checkbox").getValue()==0?1:0},getNeedsFastAnswers:function(){var a=this.lookup("fast_answers_checkbox",!0);return a?a.isChecked():!1},getTopicNames:function(){return this.lookup("topic_selection").getTopicNames()},getUnselectedTopicNames:function(){return this.lookup("topic_selection").getUnselectedTopicNames()}}),a.QuestionWizardTopicInline=c.extend({onLoad:function(){this.$("#@label_col").click(this.fnbind(function(){var a=this.$("#@checkbox");return a.prop("checked",!a.prop("checked")),this.serverCall("toggle_topic").send(),!1})),this.$("#@checkbox").mouseup(this.fnbind(function(){return this.serverCall("toggle_topic").send(),!1}))}}),a.AddQuestionTopicSelection=c.extend({onLoad:function(){this.setUpLabelClicks(),this.topic_added_index=0},setUpLabelClicks:function(){this.$("#@topic_list").find(".label_col").click(function(a){var b=$(this).siblings("input[type=checkbox]").eq(0);b.prop("checked",!b.prop("checked"))})},getTopicNames:function(){var a=[];return this.$("#@topic_list").find("input[type=checkbox]").each(function(b){$(this).is(":checked")&&a.push($(this).val())}),a},getUnselectedTopicNames:function(){var a=[];return this.$("#@topic_list").find("input[type=checkbox]").each(function(b){$(this).is(":checked")||a.push($(this).val())}),a},newTopicAdded:function(a){var b=a.value;this.serverCall("new_topic_added").kwargs({topic_name:b}).contentFor(this.$("#@topic_added_"+this.topic_added_index),{parentCID:this.cid}).success(this.fnbind(function(){this.$("#@topic_added_"+this.topic_added_index).show(),this.topic_added_index++})).send()}}),a.AddQuestionBelowPageSection=c.extend({onLoad:function(){this.determineProperPosition(),this.$(window).resize(this.fnbind(function(){this.determineProperPosition()})),this.$(".pager_next_link").click(this.fnbind(function(){this.determineProperPosition()})),this.$(".qtext_editor_content").keyup(this.fnbind(function(){this.determineProperPosition()}))},determineProperPosition:function(){var a=this.$(window).outerHeight(!0),b=this.$("#@section").outerHeight(!0),c=this.$(".main.wrapper:not(.hidden)").outerHeight(!0),d=this.$(".header").outerHeight(!0);c+b<a?this.$("#@section").addClass("fixed_to_bottom"):this.$("#@section").removeClass("fixed_to_bottom")}}),a.AddQuestionAnonymousCheckbox=c.extend({onLoad:function(){this.cb=this.$("#@checkbox");var a=this.lookup("publish_checkboxes",!0);a&&this.cb.change(this.fnbind(function(){this.cb.attr("checked")?a.hide():a.show()}))},getValue:function(){return this.cb.attr("checked")?this.anon_value:this.public_value},setValue:function(a){a==this.anon_value?this.cb.attr("checked","checked"):this.cb.removeAttr("checked")}})}),require.install("app/view/question/fast_answers",function(require,a,b){var c=require("w2.quora").Component;require("dialog"),a.EmptyAnswerFastAnswerSection=c.extend({onLoad:function(){this.$("#@get_fast_answers_button, #@cancel").click(this.fnbind(function(){return this.$("#@fast_answers_row, #@fast_answers_active_row").toggleClass("hidden"),!1})),this.$("#@show_a2a").click(this.fnbind(function(){return this.parent().$("#@empty_answer_suggestion_wrapper").toggle(),this.$("#@show_a2a").toggleClass("selected"),this.$("#@get_fast_answers_button, #@get_fast_answers_disabled_text").toggleClass("hidden"),!1}))}}),a.QuestionFollowerUrgentQuestionPrompt=c.extend({onLoad:function(){this.$("#@fast, #@cancel").click(this.fnbind(function(){return this.$("#@indicate_urgency_row, #@confirmation_row").toggleClass("hidden"),$(".fast_answers_requested_list, .fast_answers_needed_add_answer_box").toggle(),!1})),this.$("#@not_fast").click(this.fnbind(function(){return this.$("#@section").hide(),!1}))}}),a.UrgentQuestionFollower=c.extend({onLoad:function(){this.$("#@photo").tooltip({contents:this.tooltip_text})}})}),require.install("view/smart_scroll",function(require,a,b){(function(a){jQuery.fn.extend({smartScroll:function(b){var c=b;return this.each(function(){var b,d,e,f,g,h="<div></div>",i=30,j=25,k=c||{},l=k.width||"auto",m=k.height||"auto",n=k.size||"5px",o=k.color||"#000",p=k.position||"right",q=k.opacity||.4,r=k.alwaysVisible===!0,s=a(this),t=a(h).css({position:"relative",overflow:"hidden",width:l,height:m+2}).attr({"class":"smartScrollDiv"});s.css({overflow:"hidden",width:l,height:m});var u=a(h).css({width:"15px",height:"100%",position:"absolute",top:0}),v=a(h).attr({"class":"smartScrollBar ",style:"border-radius: "+n}).css({background:o,width:n,position:"absolute",top:0,opacity:q,display:r?"block":"none",BorderRadius:n,MozBorderRadius:n,WebkitBorderRadius:n,zIndex:10}),w=p=="right"?{right:"1px"}:{left:"1px"};u.css(w),v.css(w),s.wrap(t),s.parent().append(v),s.parent().append(u),require("jquery.ui-1.8.17"),v.draggable({axis:"y",containment:"parent",start:function(){e=!0},stop:function(){e=!1,C()},drag:function(b){y(0,a(this).position().top,!1)}}),u.hover(function(){B()},function(){C()}),v.hover(function(){d=!0},function(){d=!1}),s.hover(function(){b=!0,B(),C()},function(){b=!1,C()});var x=function(a){if(!b)return;a=a||window.event;var c=0;a.wheelDelta&&(c=-a.wheelDelta/120),a.detail&&(c=a.detail/3),y(0,c,!0),a.preventDefault&&a.preventDefault(),a.returnValue=!1},y=function(a,b,c){var d=b;if(c){d=v.position().top+b*j,d=Math.max(d,0);var e=s.outerHeight()-v.outerHeight();d=Math.min(d,e),v.css({top:d+"px"})}var f=parseInt(v.position().top,10)/(s.outerHeight()-v.outerHeight());d=f*(s[0].scrollHeight-s.outerHeight()),s.scrollTop(d),B()},z=function(){window.addEventListener?(this.addEventListener("DOMMouseScroll",x,!1),this.addEventListener("mousewheel",x,!1)):document.attachEvent("onmousewheel",x)};z();var A=function(){g=Math.max(s.outerHeight()/s[0].scrollHeight*s.outerHeight(),i),v.css({height:g+"px"})};A();var B=function(){A(),clearTimeout(f);if(g>=s.outerHeight())return;v.fadeIn(300)},C=function(){r||(f=setTimeout(function(){!d&&!e&&v.fadeOut(300)},500))}}),this}}),jQuery.fn.extend({smartScroll:jQuery.fn.smartScroll})})(jQuery)}),require.installLazy("app/view/home",'var Component=require("w2.quora").Component,fixable=require("view/fixable"),W2=require("webnode2"),toggle=require("view/toggle");exports.HomeMain=Component.extend({onLoad:function(){var a=this.$("#@left_col_inner"),b=this.$("#@left_col"),c=this.$(".header").outerHeight()+14,d=this.$("#@right_col_inner"),e=this.$("#@right_col");if(b.length>0&&a.length>0){var f={element:a,width_dep:!0,height_dep:!0,min_height:b.outerHeight()+b.offset().top};fixable.makeFixable(f)}if(this.should_be_fixed&&e.length>0&&d.length>0){var g={element:d,width_dep:!0,height_dep:!0,min_height:e.outerHeight()+e.offset().top};fixable.makeFixable(g)}}}),exports.ContentPageFeed=toggle.ToggledComponent.extend({onLoad:function(){this._super.apply(this,arguments),setTimeout(this.fnbind(this.recordImpression),0),this.$(".feed_item_wrapper").hide(),this.$(".feed_item_wrapper").fadeIn(500)},show:function(){this.$("#@wrapper").show()},recordImpression:function(){this.$("#@wrapper").is(":in-viewport")?this.serverCall("record_impression").send():setTimeout(this.fnbind(this.recordImpression),200)}}),exports.MobileAppPromo=Component.extend({onLoad:function(){this.recordStep("mobile_app_promo_impression"),this.$("#@ios_badge").click(this.fnbind(function(){this.recordStep("ios_badge_clicked")})),this.$("#@android_badge").click(this.fnbind(function(){this.recordStep("android_badge_clicked")}))},recordStep:function(a){this.serverCall("record_step").kwargs({step_name:a}).send()}}),exports.TopicSidebarLinkItemBase=Component.extend({onLoad:function(){this.is_network_admin&&this.$("#@remove_item").click(this.fnbind(function(){this.serverCall("remove_topic").kwargs({tid:this.tid}).liveMutate().send()}))}}),exports.TopicSidebarSelector=Component.extend({onLoad:function(){this.$("#@topic_selector_link").click(this.fnbind(function(){this.$("#@topic_selector_link").addClass("hidden"),this.$("#@topic_selector").removeClass("hidden").find(".question_box").focus()}))}}),exports.GlobalFeedLink=Component.extend({onLoad:function(){this.$("#@count").tooltip({contents:this.count+" Unorganized Question"+(this.count==1?"":"s")})}}),exports.NeedTopicsListItem=Component.extend({onLoad:function(){var a=this;this.$("#@item input.question_box").keydown(function(b){if(b.keyCode==9&&!b.shiftKey)for(var c=W2.getLiveDomId(a.cid),d=a.parent().orderedVisibleChildren(),e=0;e<d.length-1;++e)if(c==d[e])return $(this).blur(),$("#"+d[e+1]+" input.question_box").focus(),!1})},markHasEnoughTopics:function(){this.$("#@item").removeClass("item_selected")}}),exports.NeedTopicsQuestionInfo=Component.extend({onLoad:function(){this.has_enough_topics&&this.lookup("need_topics_list_item").markHasEnoughTopics()}}),exports.HomeLoggedOutInvite=Component.extend({onLoad:function(a){this.installMouseHandlers();var b=this.fnbind(function(){this.$("#@error_msg").empty()});this.$("#@email").keydown(this.fnbind(function(a){b();var c=a.keyCode?a.keyCode:a.which;c==13&&this.$("#@email_submit").click()})).blur(b)},clickHandlers:{invite_request_button:function(){this.$("#@invite_request_button").hide(),this.$("#@facepile").css("visibility","hidden"),this.$("#@mission").css("visibility","hidden"),this.$("#@invite_form").show(),this.$("#@email").focus(),this.serverCall("record_signup_step").kwargs({signup_action:"hp_invite_request_start"}).send()},email_submit:function(){this.serverCall("request_email").kwargs({email:this.$("#@email").val()}).success(this.fnbind(function(a){a&&(a.error_message?this.$("#@error_msg").text(a.error_message):(this.$("#@error_msg").hide(),this.$("#@invite_form_fields").hide(),this.$("#@success_msg").show()))})).send()}}}),exports.FindTopicsRow=Component.extend({onLoad:function(){var a=this;this.$("#@shuffle").click(this.fnbind(function(){var b=a.$(".find_topics_row:visible"),c=b.next(".find_topics_row");return b.hide(),a.$("#@more").children().remove(),c.length===0&&(c=this.$(".find_topics_row").first()),c.show(),!1}))},addRow:function(a){if(typeof this.clicked_tids!="undefined"&&this.clicked_tids.indexOf(a)!=-1)return;typeof this.clicked_tids!="undefined"&&this.clicked_tids.push(a),this.$("#@more").prepend(\'<div class="row new_row"></div>\');var b=this.$("#@more").children(".new_row").first();this.serverCall("load_row").kwargs({tid:a}).contentFor(b,{parentCID:this.cid}).send()}});'),function(){document.domain=document.domain,typeof google!="undefined"&&(google.load("search","1",{language:"en",style:google.loader.themes.V2_DEFAULT}),google.setOnLoadCallback(function(){var a={},b={};b.keys=[{label:"Relevance",key:""},{label:"Date",key:"date"}],a.enableOrderBy=!0,a.orderByOptions=b;var c=new google.search.CustomSearchControl("014053714977433807712:gtz1vfhsr8y",a);c.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);var d=new google.search.DrawOptions;d.setAutoComplete(!0),c.draw("mycse",d);var e=$("#mycse").attr("query");c.execute(e,1)},!0))}(),require.install("app/view/search/google_search_iframe",function(){}),require.installLazy("app/view/feed",'var W2=require("webnode2"),eventModule=require("event"),Component=require("w2.quora").Component,addEvent=eventModule.add,removeEvent=eventModule.remove,fixable=require("view/fixable"),windowManager=require("window_manager"),settings=require("settings"),toggle=require("view/toggle"),cookies=require("cookies");exports.UniversalPageFeed=require("view/paged_list").PagedList.extend({init:function(a){this._super.apply(this,arguments),this.hash_impressions={},this.hash_clicks={},this.last_check_time=0,this.needsRefresh=!1,this.offset=0,this.firstElement=0,this.numInitialQuestions=0,this.rate_limiter_ms=a.rate_limiter_ms,this.wait_until_log_impression_ms=a.wait_until_log_impression_ms,this.page_load_time=+(new Date),this.shouldLogImpressions=!0,this.impression_data=[],this.viewer_uid=a.uid,this.setDvar("feed_story_hash",null),this.setDvar("feed_story_position",null),this.setDvar("feed_story_initial",null),this.setDvar("feed_ty",a.feed_ty),this.setDvar("feed_page",a.feed_page),this.setDvar("page_data",a.page_data),this.setDvar("feed_location",a.feed_location),this.setDvar("focus_ty",a.focus_ty)},onLoad:function(a){this._super.apply(this,arguments);var b=this;this.recordImpressions(!0),setTimeout(function(){b.recordViews()},2e3);var c=this.fnbind(this.recordImpressions,!1);this._mousemove_handler=addEvent(document,"mousemove",c),this._keypress_handler=addEvent(document,"keypress",c),this._scroll_handler=addEvent(document,"scroll",c)},onUnload:function(){removeEvent(document,"mousemove",this._mousemove_handler),removeEvent(document,"keypress",this._keypress_handler),removeEvent(document,"scroll",this._scroll_handler)},recordViews:function(){if(this.debug)return;var a=3,b=this.children(),c=[],d={},e={},f=[];for(var g=0;g<b.length;g++){var h=b[g];if(!h.getHash||!h.getHash())continue;var i=W2._domids[h.cid];if(!i)continue;var j=document.getElementById(i);if(!j)continue;var k=$(j),l=k.children("div:first").is(":in-viewport");if(!l||!k.is(":visible"))continue;d[h.cid]=k.children("div:first").position().top,e[h.cid]=h,f.push(h.cid)}f.sort(function(a,b){return d[a]-d[b]});for(var g=0;g<Math.min(a,f.length);g++)c.push({hash:e[f[g]].getHash(),view_tracking_key:e[f[g]].view_tracking_key});this.viewer_uid&&this.serverCall("log_views").kwargs({data:c}).send()},recordImpressions:function(a){if(this.debug)return;if(!this.shouldLogImpressions)return;var b=+(new Date),c=a||this.needsRefresh;this.needsRefresh=!1;if(!c&&b<this.last_check_time+this.rate_limiter_ms)return;this.last_check_time=b;var d=this.children(),e=null,f;if(!a){var g=this.offset;for(f=0;f<d.length;f++){var h=d[f];if(!h.getDvar)continue;if(h.getDvar("feed_story_hash")==this.firstElement){var i=this.allOrderedChildren();for(var j=this.offset;j<i.length;j++)i[j]==W2.getLiveDomId(h.cid)&&(this.offset=j)}}this.offset!=g&&(c=!0)}for(f=0;f<d.length;f++){var h=d[f];if(!h.getHash)continue;var k=h.getHash();if(!k||this.hash_impressions[k])continue;var l=W2._domids[h.cid];if(!l)continue;var m=document.getElementById(l);if(!m)continue;var n=$(m),o=n.children("div:first").is(":in-viewport");if(!c&&!o)continue;if(!c&&!n.is(":visible"))continue;if(e===null){var p=this.orderedVisibleChildren();e={};for(var j=0;j<p.length;j++)e[p[j]]=j-this.offset;if(a)for(var j=0;j<d.length;j++)W2.getLiveDomId(d[j].cid)==p[0]&&(this.firstElement=d[j].getDvar("feed_story_hash"))}var q=e[l];c&&(h.setDvar("feed_story_position",q),h.setDvar("feed_story_initial",!0)),o&&n.is(":visible")&&(this.hash_impressions[k]=!0,this.impression_data.push({hash:k,initially_visible:a||q>=0&&q<this.numInitialQuestions,position:q}))}this.impression_data.length>0&&this.viewer_uid&&b-this.page_load_time>=this.wait_until_log_impression_ms&&(this.serverCall("log_impressions").kwargs({data:this.impression_data}).send(),this.impression_data=[])}}),exports.FeedMain=require("app/view/home").HomeMain.extend({onLoad:function(){this._super.apply(this,arguments);var a=this;this.installScrollHandlers(this.setPosition),$(window).resize(this.fnbind(this.setPosition)),this.floatingZone=200,this.topOffset=$(".header").outerHeight()+7,this.bottomOffset=55,this.offset=-1;var b=windowManager.getURL();if(b.indexOf("?qp_story=")!=-1||b.indexOf("?digest_story=")!=-1)windowManager.replaceURL("/"),this.lookup("home_feed").$("#@feed_visibility_wrapper").removeClass("invisible")},onUnload:function(){this.uninstallScrollHandlers(),$(window).off("resize")},setPosition:function(){var a=this,b=$(window).height(),c=$(window).scrollTop(),d=$(".header").css("position");cancelAnimationFrame(this.scrollID),this.scrollID=requestAnimationFrame(this.fnbind(function(){var b=$(window).width()-($(".feed_item").offset().left+$(".feed_item").outerWidth()),e=[];$(this.$("#@feed_main").find(".expanded_feed_content")).each(function(){var f=$(this).find(".rating_buttons_wrapper").eq(0),g=0,h=0,i="absolute";if(f.find(".rating_options").is(":visible")){var j=$(this).find(".feed_item_board_content").eq(0),k=j.height();j.length==0&&(j=$(this).find(".answer_content").eq(0),k=j.height()+2);var l=j.offset().top-a.topOffset+a.offset,m=l+k;d=="fixed"&&k>a.floatingZone&&c>l&&c<m&&(c<m-a.bottomOffset?(i="fixed",g=a.topOffset-a.offset,h=b):g=k-a.bottomOffset),e.push([f,i,g,h])}});for(var f=0;f<e.length;++f){var g=e[f],h=g[0];h.parent().css("position","relative"),h.css("position",g[1]),h.css("top",g[2]+"px"),h.css("right",g[3]+"px")}}))}}),exports.FeedMuteItem=Component.extend({onLoad:function(){var a=this;this.$("#@mute_item").tooltip({contents:"Remove From Feed"}).click(this.fnbind(function(){this.lookup("item").showMuteControls()}))}}),exports.FeedMuteItemOverlay=Component.extend({onLoad:function(){var a=this;this.feed_cards||(this.feed_mute_item=this.cQuery(":item.mute_item")),this.feed_item=this.cQuery(":item").$("#@feed_item"),this.cancel=this.$("#@cancel_mute_item_wrapper"),this.overlay=this.$("#@mute_item_overlay")},hide:function(){if(settings.new_grid){var a=this;a.overlay.removeClass("is_shown"),setTimeout(function(){a.overlay.hide()},333)}else this.overlay.addClass("hidden"),this.cancel.addClass("hidden")},show:function(){if(settings.new_grid){var a=this;a.overlay.css({width:a.feed_item.outerWidth(),height:a.feed_item.outerHeight()}),a.overlay.show(),setTimeout(function(){a.overlay.addClass("is_shown")},1)}else this.overlay.css({width:this.feed_item.outerWidth()+80,height:this.feed_item.outerHeight(),"margin-left":"-40px"}),this.overlay.removeClass("hidden"),this.cancel.removeClass("hidden")}}),exports.FeedMuteItemControls=Component.extend({onLoad:function(){var a=this;this.item=this.cQuery(":item").$("#@item"),this.controls=this.$("#@mute_item_controls"),this.shown=!1},hide:function(){if(settings.new_grid){var a=this;a.controls.removeClass("is_shown"),setTimeout(function(){a.controls.hide()},333)}else this.controls.addClass("hidden");this.shown=!1},show:function(){if(!settings.new_grid){var a=this.item.height()>300?100:(this.item.height()-this.controls.height())/2,b=(this.item.width()-this.controls.width())/2;this.controls.css({left:b+"px",top:a+"px"}),this.controls.removeClass("hidden")}else{var c=this;c.controls.show(),setTimeout(function(){c.controls.addClass("is_shown")},1)}this.shown=!0}}),exports.FeedMuteButton=Component.extend({onLoad:function(){var a=this.lookup("mute_item_controls").lookup("item");this.item=a.$("#@item"),this.feed_item=a.$("#@feed_item"),this.feed_cards||(this.mute_item_wrapper=a.lookup("mute_item").$("#@mute_item_wrapper")),this.mute_item_overlay=a.lookup("mute_item_overlay").$("#@mute_item_overlay"),this.mute_item_controls=a.lookup("mute_item_controls").$("#@mute_item_controls");var b={user:"UserMute",question:"QuestionMute",blog:"BoardMute",topic:"TopicMute"};this.$("#@mute_button").click(this.fnbind(function(){this.hideFeedItem();var a=b[this.type];a&&cookies.setQfeedLog(this,a),this.serverCall("mute").kwargs({oid:this.oid,qid:this.qid,bid:this.bid}).liveMutate().send()})),this.type=="user"&&this.$("#@mute_button").tooltip({contents:"Muting "+this.text+" will prevent their activity and content from appearing in your feed"}),this.type=="topic"&&this.$("#@mute_button").tooltip({contents:"Muting "+this.text+" will prevent any content in this topic from appearing in your feed"}),this.type=="question"&&this.$("#@mute_button").tooltip({contents:"Muting "+this.text+" will prevent it from appearing in your feed"}),this.type=="blog"&&this.$("#@mute_button").tooltip({contents:"Muting "+this.text+" will prevent any of its posts from appearing in your feed"})},hideFeedItem:function(){this.feed_cards||this.mute_item_wrapper.addClass("hidden"),this.mute_item_controls.hide(),this.mute_item_overlay.hide(),this.feed_item.parent(".feed_item").animate({opacity:0},this.fnbind(function(){this.feed_item.parent(".feed_item").slideUp(300)}))}}),exports.FeedUnfollowButton=Component.extend({onLoad:function(){var a=this.lookup("mute_item_controls").lookup("item");this.item=a.$("#@item"),this.feed_item=a.$("#@feed_item"),this.feed_cards||(this.mute_item_wrapper=a.lookup("mute_item").$("#@mute_item_wrapper")),this.mute_item_overlay=a.lookup("mute_item_overlay").$("#@mute_item_overlay"),this.mute_item_controls=this.lookup("mute_item_controls").$("#@mute_item_controls");var b={user:"UserUnfollow",question:"QuestionUnfollow",blog:"BoardUnfollow",topic:"TopicUnfollow"};this.$("#@unfollow_button").click(this.fnbind(function(){this.hideFeedItem(),this.serverCall("unfollow").kwargs({oid:this.oid,qid:this.qid,bid:this.bid}).liveMutate().send()}))},hideFeedItem:function(){this.feed_cards||this.mute_item_wrapper.addClass("hidden"),this.mute_item_controls.hide(),this.mute_item_overlay.hide(),this.feed_item.parent(".feed_item").animate({opacity:0},this.fnbind(function(){this.feed_item.parent(".feed_item").slideUp(300)}))}}),exports.EventDebugInfo=Component.extend({onLoad:function(){this.$("#@show").click(this.fnbind(function(){return this.$("#@debug_info").show(),this.$("#@show").hide(),!1})),this.$("#@hide").click(this.fnbind(function(){return this.$("#@debug_info").hide(),this.$("#@show").show(),!1}))}}),exports.ContentPageFeedStoryItemBase=Component.extend({onLoad:function(){var a="";this.$("#@item .truncated_q_text a.more_link").html(a).removeClass("more_link").removeAttr("id").addClass("read_more").attr("href",this.target_url),this.$("#@item a.lil_button.rate_up").removeAttr("id").attr("href",this.target_url),this.$("#@item .answer_content").css({cursor:"pointer"}),this.$("#@item_overlay").attr("target","_self"),this.$("#@item_overlay").mousedown(this.fnbind(function(){return this.serverCall("on_item_click").send(),!1}))}}),exports.FeedAnswerItem=toggle.ToggledComponent.extend({onLoad:function(a){this._super.apply(this,arguments),this.$("#@answer_rating").mouseover(this.fnbind(function(){this.truncated&&!this.mouseover_toggled&&(this.mouseover_toggled=!0,this.child("expandable_qtext").$("#@truncated").mouseover())})).click(this.fnbind(function(){return this.truncated&&this.toggleTextViews(),!1})),this.tt&&this.$("#@answer_rating").tooltip({contents:this.tt}),this.truncated&&this.child("expandable_qtext").setCallback(this.fnbind(function(){this.show()}))},getFacebookLikeHoverArea:function(){return this.$("#@answer")},toggleTextViews:function(){var a=this.child("expandable_qtext").$("#@truncated a.more_link");a.length?a.click():(this.child("expandable_qtext").switchIfReady(),this.show())},show:function(){!this.author&&this.allow_voting&&(this.$("#@answer_rating").addClass("hidden"),this.$("#@answer_voting").removeClass("hidden")),this.$("#@answer_voters").removeClass("hidden"),this.$("#@answer_actions").removeClass("hidden"),this.$("#@answer_user_sig .user_sig_source").show(),this.$("#@answer").addClass("expanded_feed_content")}}),exports.QuestionNumberAnswers=Component.extend({onLoad:function(a){this.$("#@link").mousedown(this.fnbind(function(){cookies.setQfeedLog(this,"QuestionAnswersClickthrough"),cookies.setQueryLog(this,"QuestionAnswersClickthrough")}))}}),exports.HomepageFeedStoryItem=Component.extend({init:function(){function b(){if(a.alreadySent)return;a.alreadySent=!0,cookies.setMessage("vtc",[a.hash,a.view_tracking_key]),a.allowServerCall&&a.serverCall("dummy_call_nonlivedepped").send()}this._super.apply(this,arguments),this.setDvar("feed_story_hash",this.hash);var a=this;a.allowServerCall=!0,a.alreadySent=!1,this.parent().needsRefresh=!0,this.$("#@item").mousedown(b),$("a",this.$("#@item")).mousedown(function(c){a.allowServerCall=c.target.pathname==window.location.pathname,b()})},onLoad:function(){var a=this;!settings.mobile&&this.show_mute_item&&(this.feed_item=this.$("#@feed_item"),this.controls=this.cQuery(":mute_item_controls"),this.overlay=this.cQuery(":mute_item_overlay"),this.close=this.cQuery(":mute_item_overlay").$("#@cancel_mute_item_wrapper"),this.close.click(function(){a.hideMuteControls()}),!settings.new_grid&&!this.feed_cards&&this.$("#@item").mouseleave(function(){a.hideMuteControls()}))},getHash:function(){return this.hash},retarget:function(){this.$(\'#@item a[href!="#"]\').attr("target","_blank")},showMuteControls:function(){if(this.controls.shown)return;settings.new_grid?this.feed_item.addClass("is_blurred"):this.feed_item.animate({opacity:"0.1"},300),this.overlay.show(),this.controls.show()},hideMuteControls:function(){if(!this.controls.shown)return;settings.new_grid?this.feed_item.removeClass("is_blurred"):this.feed_item.animate({opacity:"1"},800),this.overlay.hide(),this.controls.hide()}}),exports.QuestionTopics=Component.extend({onLoad:function(){this.$("#@view_all_link").tooltip({contents:"Click to view all topics"}),this.$("#@view_all_link").click(this.fnbind(function(){return this.$("#@view_all").addClass("hidden"),this.$("#@view_all_link").addClass("hidden"),this.$("#@all_topics").removeClass("hidden"),!1}))}}),exports.AnswerEventView=toggle.SwitchableComponentWithComments.extend({switchAction:function(){this.switchAndViewComments()},onLoad:function(){this._super.apply(this,arguments);if(this.scroll_to_top){var a=this.lookup("item").$("#@item");a&&(window.scroll(0,$(a).offset().top-windowManager.headerOffset),this.lookup("home_feed").$("#@feed_visibility_wrapper").removeClass("invisible"),$(a).effect("highlight",{},2e3))}}}),exports.EventView=toggle.SwitchableComponent.extend({onLoad:function(){this._super.apply(this,arguments);if(this.scroll_to_top){var a=this.lookup("item").$("#@item");a&&(window.scroll(0,$(a).offset().top-windowManager.headerOffset),this.lookup("home_feed").$("#@feed_visibility_wrapper").removeClass("invisible"),$(a).effect("highlight",{},2e3))}}}),exports.TopicOpenQuestionItem=Component.extend({onLoad:function(){this.$(\'#@item a[href!="#"]\').attr("target","_blank")}});'
),require.install("app/view/question",function(require,a,b){function o(a){var b=$(window).scrollTop(),c=$(".header").outerHeight();a=a.top-c,(a<b||b===0)&&$(window).scrollTop(a);return}var c=require("w2.quora").Component,d=require("webnode2"),e=require("view/inline_editor").InlineEditor,f=require("cookies"),g=require("view/toggle"),h=require("window_manager").isInHash,i=require("event").add,j=require("view/fixable"),k=require("view/floating_voting_buttons"),l=require("window_manager"),m=require("settings");require("dialog"),a.QuestionMain=c.extend({onLoad:function(a){a&&this.record_impression&&setTimeout(this.fnbind(function(){this.serverCall("record_impression").send()}),1e3)},onUnload:function(){this.uninstallScrollHandlers()},setAddQuestionSectionPosition:function(){var a=$(window).scrollTop(),b=this.$("#@fixed_add_q_outer").offset(),c=$(".header").height(),d=this.$("#@question_main_row").height()-this.fixedAddQHeight;d>b.top&&(a+c>=b.top&&a<d?(this.$("#@fixed_add_q_outer").next().css("margin-top",this.fixedAddQHeight).css("float","left"),this.$("#@fixed_add_q_inner").css("position","fixed"),this.$("#@fixed_add_q_inner").css("top",c-1+"px")):a+c>=d?(this.$("#@fixed_add_q_inner").css("position","absolute"),this.$("#@fixed_add_q_inner").css("top",d+"px")):(this.$("#@fixed_add_q_outer").next().css("margin-top","auto").css("float","auto"),this.$("#@fixed_add_q_inner").css("position","relative"),this.$("#@fixed_add_q_inner").css("top","0px")))}}),a.QuestionBestSourceIcon=c.extend({onLoad:function(a){this.comment?this.$("#@icon").tooltip({contents:"Best Source: "+this.comment}):this.$("#@icon").tooltip({contents:"Question marked as the best source for related information."})}}),a.QuestionLink=c.extend({onLoad:function(){this.$("#@link").mousedown(this.fnbind(function(){f.setQfeedLog(this,"QuestionClickthrough"),f.setQueryLog(this,"QuestionClickthrough")})),this.onKeyCombination(this.$("#@link"),"Shift-Enter",this.fnbind(function(){return l.navigateTo(this.$("#@link").attr("href")),!1}))}}),a.NewUserSendNotif=c.extend({init:function(){this._super.apply(this,arguments),this.seen=!1,this.notif_bottom=!1,this.idleTime=1,this.noActivity=!1;var a=$(document).find(".answer_wrapper").get();this.answersLocation=[];for(var b=0;b<a.length;b++){var c=$(a[b]);this.answersLocation.push(c.offset().top+c.height())}var d=this;$(document).bind("nux_dialog_close",function(){d.installScrollHandlers(d.fnbind(d.scrollHandler)),d.delay===!0&&(d.delay=!1,d.maybeSendNotif()),d.delay&&window.setTimeout(function(){d.maybeSendNotif()},d.delay*1e3),d.no_activity&&(window.setInterval(function(){d.idleTime=d.idleTime+1,d.idleTime>d.no_activity&&(d.noActivity=!0)},1e3),$(this).mousemove(function(a){d.onUserActivity()}),$(this).keypress(function(a){d.onUserActivity()}))})},onUserActivity:function(){this.noActivity&&(this.maybeSendNotif(),this.noActivity=!1),this.idleTime=0},maybeSendNotif:function(){this.seen||(this.seen=!0,this.serverCall("send_go_home_notif").kwargs({}).send())},maybeSendNotifBottom:function(){this.notif_bottom||(this.notif_bottom=!0,this.serverCall("send_go_home_notif_double").kwargs({}).send())},hitBottomHandler:function(){var a=$(window).scrollTop(),b=$(document).height(),c=$(window).height();a+c==b&&(this.double_notif?this.maybeSendNotifBottom():this.maybeSendNotif())},answerReadHandler:function(){var a=$(window).scrollTop(),b=0;for(var c=0;c<this.answersLocation.length;c++)a>this.answersLocation[c]&&(b+=1);b>=this.answer_read&&this.maybeSendNotif()},scrollHandler:function(){var a=$(window).scrollTop();(this.hit_bottom||this.double_notif)&&this.hitBottomHandler(),this.answer_read&&this.answerReadHandler(),this.on_scroll&&a>200&&this.maybeSendNotif()},onUnload:function(){this.uninstallScrollHandlers()}}),a.RelatedQuestionsList=c.extend({onLoad:function(){this.at_least_one_img&&this.recordStep("related_questions_impression")},recordStep:function(a){this.serverCall("record_step").kwargs({step_name:a}).send()}}),a.RelatedQuestionLink=require("action_log").ActionableComponent.extend({onLoad:function(){this._super.apply(this,arguments);var a=this;this.at_least_one_img&&a.$("#@actionable").mousedown(a.fnbind(function(){a.recordStep("related_questions_click")}))},recordStep:function(a){this.serverCall("record_step").kwargs({step_name:a}).send()}}),a.RelatedQuestionLinkTracked=c.extend({onLoad:function(){this.$("#@link").click(this.fnbind(function(){f.setMessage("rqc",[this.experiment_id,this.clicktrack_id,this.qid,this.rank])}))}}),a.QuestionSettingsLink=c.extend({onLoad:function(){this.$("#@question_settings_link").click(this.fnbind(function(a){return this.$("#@question_settings_menu").menu(this.$("#@question_settings_link")),!1}))}}),a.AddMonitorQuestionLink=c.extend({onLoad:function(){this.$("#@add_monitor").click(this.fnbind(function(a){return this.serverCall("add_monitor").liveMutate().send(),!1}))}}),a.RemoveMonitorQuestionLink=c.extend({onLoad:function(){this.$("#@remove_monitor").click(this.fnbind(function(a){return this.serverCall("remove_monitor").liveMutate().send(),!1}))}}),a.MuteQuestionLink=c.extend({onLoad:function(){this.$("#@mute_question").click(this.fnbind(function(a){return this.serverCall("mute").liveMutate().send(),!1}))}}),a.UnmuteQuestionLink=c.extend({onLoad:function(){this.$("#@unmute_question").click(this.fnbind(function(a){return this.serverCall("unmute").liveMutate().send(),!1}))}});var n=a.QuestionFollowing=c.extend({dialogActive:!1,onLoad:function(){var a=this.fnbind(function(a){f.setTlog({type:"QuestionFollow",qid:this.qid}),this.follow(),a.preventDefault()}),b=this.fnbind(function(a){this.unfollow(),a.preventDefault()});this.$("#@follow").click(a),this.$("#@unfollow").click(b),this.onKeyCombination(this.$("#@follow"),"f",a),this.onKeyCombination(this.$("#@unfollow"),"f",b),this.trigger_og_dialog_on_action&&this.$("#@follow").click(this.fnbind(function(a){a.preventDefault();if(window.opengraphDialogShown)return;if(this.dialogActive)return;this.dialogActive=!0,m.new_grid?this.dialog(!1).opt("width",510).opt("left","50%").opt("dialogClass","dialog_nux").load("get_step_dialog").close(this.fnbind(this.onDialogClose)):this.dialog(!1).opt("width",510).opt("left","50%").opt("dialogClass","modal_nux_dialog modal_new_nux_dialog").load("get_step_dialog").close(this.fnbind(this.onDialogClose))}))},follow:function(){this.serverCall("follow").kwargs({qid:this.qid}).liveMutate().sendOnlyOnce()},unfollow:function(){this.serverCall("unfollow").kwargs({qid:this.qid}).liveMutate().sendOnlyOnce()},onDialogClose:function(){this.dialogActive=!1,window.opengraphDialogShown=!0}});a.QuestionFollowingLink=n.extend({onLoad:function(a){var b=this.$("#@follow"),c=this.$("#@unfollow");b.mousedown(this.fnbind(function(){f.setQfeedLog(this,"QuestionFollow"),f.setQueryLog(this,"QuestionFollow")}));if(this.tooltip_text){var d=b.length?b:c;d.tooltip({contents:this.tooltip_text})}this._super.apply(this,arguments)}}),a.QuestionAnonLink=c.extend({onLoad:function(){this.$("#@set_anon").click(this.fnbind(function(){return this.setAnon(),!1})),this.$("#@set_public").click(this.fnbind(function(){return this.setPublic(),!1}))},setAnon:function(){this.serverCall("set_anon_question").kwargs({qid:this.qid}).liveMutate().send()},setPublic:function(){$(".content").dialog({title:"Remove Your Anonymity On This Question",contents:"Your name will be displayed with any action you take on this question (e.g. answers, votes, and comments).",mobile:this.mobile,buttons:{"Remove Anonymity":this.fnbind(function(){this.serverCall("set_public_question").kwargs({qid:this.qid}).liveMutate().send()}),Cancel:null}})}}),a.QuestionRedirectLink=c.extend({onLoad:function(){this.$("#@remove_redirect").click(this.fnbind(function(){return this.serverCall("remove_redirect_question").kwargs({qid:this.qid}).liveMutate().send(),!1}))}}),a.UnsubscribeQuestionEmailsLink=c.extend({onLoad:function(){this.$("#@unsubscribe").click(this.fnbind(function(){this.serverCall("unsubscribe").kwargs({qid:this.qid}).liveMutate().send()}))}}),a.QuestionArea=g.SwitchableComponentWithComments.extend({onLoad:function(){this._super.apply(this,arguments),this.a2a_loaded=!1,this.$("#@toggle_a2a").click(this.fnbind(function(){return this.toggle_a2a_section(),!1}))},toggle_a2a_section:function(){this.a2a_loaded||this.serverCall("load_a2a").contentFor(this.$("#@a2a_section"),{parentCID:this.cid}).success(this.fnbind(function(){this.a2a_loaded=!0})).send(),this.$("#@a2a_section").toggleClass("hidden")},switchAction:function(){this.switchAndViewComments()}}),a.QuestionDeleteLink=c.extend({onLoad:function(){var a=this;this.$("#@delete_question_link").click(function(){return $(".content").dialog({title:"Question Delete",contents:"Are you sure you wish to delete this question?",buttons:{Ok:function(){a._request("delete_question")},Cancel:null}}),!1}),this.$("#@undelete_question_link").click(function(){return $(".content").dialog({title:"Undelete Page",contents:"Are you sure you wish to restore this page?",buttons:{Ok:function(){a._request("undelete_question")},Cancel:null}}),!1})},_request:function(a){this.serverCall(a).kwargs({qid:this.qid}).liveMutate().send()}}),a.QuestionDeleteDialog=AddCommentDialog.extend({getPars:function(){return this.comment_required&&this.lookup("editor").isEmpty()?!1:{comment:this.lookup("editor").serialize(),review:this.review}}}),a.MobileQuestionTopics=c.extend({toggleTopicEditor:function(){this.$("#@view_topics_list").toggleClass("hidden"),this.$("#@edit_topics_list").toggleClass("hidden"),this.$("#@follow_button").toggleClass("hidden")}}),a.MobileEditTopicsLink=c.extend({onLoad:function(){this.$("#@link").click(this.fnbind(function(){return this.lookup("question_topics").toggleTopicEditor(),this.$("#@edit").toggleClass("hidden"),this.$("#@done").toggleClass("hidden"),!1}))}}),a.AnswerActions=g.SwitchableComponentWithComments.extend({init:function(a){this._super.apply(this,arguments),this.ajax_path="/question/ajax_edit_answer_POST"},getFacebookLikeHoverArea:function(){return this.$("#@answer")},onVisible:function(){if(!this.initState("first_call",!0)&&h("ans"+this.aid)){var a=this.lookup("collapsed_answers_div",!0);a&&a.$("#@expanded_content").has(this.$("#@answer")).size()&&a.expandAnswers(),this.$("#@answer").addClass("highlighter");var b=this.$("#@answer").offset();o(b),$(window).scroll(this.fnbind(function(){var a=$(window).scrollTop();a>b.top&&this.$("#@answer").removeClass("highlighter",400)}))}},onLoad:function(a){this.$("#@answer_versions_link").click(this.fnbind(function(a){return this.$("#@answer_versions").toggleClass("hidden"),!1})),this.$("#@answer_content_uncollapse_link").click(this.fnbind(function(a){return this.$("#@answer").toggleClass("hidden"),this.$("#@bad_answer").toggleClass("hidden"),!1})),this.$("#@show_actions").click(this.fnbind(function(){return this.$("#@show_actions").addClass("hidden"),this.$("#@show_actions").hide(),this.$("#@show_actions_bullet").addClass("hidden"),this.$("#@actions_list").removeClass("hidden"),!1})),this.$("#@answer_user").hover(this.fnbind(function(a){this.$("#@answer_user").addClass("hover")}),this.fnbind(function(a){this.$("#@answer_user").removeClass("hover")})),this.unseen.bound||(i(document,"scroll",this.fnbind(this.recordPrivateViews)),setTimeout(this.fnbind(this.recordPrivateViews),400),this.unseen.bound=!0),this.unseen.answers[this.cid]=this,this.setCallback(this.switchAndViewComments)},unseen:{bound:!1,answers:{},lastCheckTime:0,rateLimit:500},recordPrivateViews:function(){var a=+(new Date);if(a<this.unseen.lastCheckTime+this.unseen.rateLimit)return;this.unseen.lastCheckTime=a;var b=[],c=[];for(var d in this.unseen.answers){var e=this.unseen.answers[d];e.$("#@answer").is(":in-viewport")&&(b.push(e),c.push(e.aid),delete this.unseen.answers[d])}b.length>0&&b[0].serverCall("log_private_views").kwargs({aids:c}).send()},onUnload:function(){delete this.unseen.answers[this.cid]}}),a.AnswerDeleteLink=c.extend({onLoad:function(){this.$("#@answer_delete").click(this.fnbind(function(a){return this._dialog=this.dialog().title("Delete "+this.response_upper).cancel(null,"Cancel").ok(this.fnbind(function(){this.request("remove_answer")}),"Delete "+this.response_upper).close(this.fnbind(function(){this._dialog=null})).html("Are you sure you wish to delete this "+this.response_lower+"?"),!1})),this.$("#@answer_undelete").click(this.fnbind(function(a){return this._dialog=this.dialog().title("Restore "+this.response_upper).cancel(null,"Cancel").ok(this.fnbind(function(){this.request("unremove_answer")}),"Restore "+this.response_upper).close(this.fnbind(function(){this._dialog=null})).html("Are you sure you wish to restore this "+this.response_lower+"?"),!1}))},request:function(a){this.serverCall(a).kwargs({aid:this.aid}).liveMutate().send()}}),a.AnswerPermaLink=c.extend({onLoad:function(){this.$("#@link").mousedown(this.fnbind(function(){f.setQfeedLog(this,"AnswerClickthrough"),f.setQueryLog(this,"AnswerClickthrough")})),this.tooltip&&this.$("#@link").tooltip({contents:this.tooltip})}});var p=a.AnswerVotingButtons=c.extend({dialogActive:!1,upvote:function(a){f.setTlog({type:"AnswerVoteUp",aid:this.aid}),f.setQfeedLog(this,"AnswerUpvote"),f.setQueryLog(this,"AnswerUpvote"),this.serverCall("answer_vote_up").kwargs({aid:this.aid}).liveMutate().sendOnlyOnce(),a.preventDefault(),this.show_upvote_instruction&&this.lookup("upvote_instruction").nextStep()},cancelUpvote:function(){return this.serverCall("answer_vote_up_cancel").kwargs({aid:this.aid}).liveMutate().sendOnlyOnce(),!1},downvote:function(a){f.setQfeedLog(this,"AnswerDownvote"),f.setTlog({type:"AnswerVoteDown",aid:this.aid}),this.serverCall("answer_vote_down").kwargs({aid:this.aid}).liveMutate().sendOnlyOnce(),a.preventDefault()},cancelDownvote:function(){return this.serverCall("answer_vote_down_cancel").kwargs({aid:this.aid}).liveMutate().sendOnlyOnce(),!1},onDialogClose:function(){this.dialogActive=!1,window.opengraphDialogShown=!0},onLoad:function(a){this.$("#@answer_vote_up_link").click(this.fnbind(this.upvote)),this.$("#@answer_vote_up_cancel_link").click(this.fnbind(this.cancelUpvote)),this.$("#@answer_vote_down_link").click(this.fnbind(this.downvote)),this.$("#@answer_vote_down_cancel_link").click(this.fnbind(this.cancelDownvote)),this.onKeyCombination(this.$("#@answer_vote_up_cancel_link"),"u",this.fnbind(this.cancelUpvote)),this.onKeyCombination(this.$("#@answer_vote_up_link"),"u",this.fnbind(function(a){return this.upvote(a),!1})),this.onKeyCombination(this.$("#@answer_vote_down_cancel_link"),"d",this.fnbind(this.cancelDownvote)),this.onKeyCombination(this.$("#@answer_vote_down_link"),"d",this.fnbind(function(a){return this.downvote(a),!1})),this.trigger_og_dialog_on_action&&this.$("#@answer_vote_up_link").click(this.fnbind(function(a){a.preventDefault();if(window.opengraphDialogShown)return;if(this.dialogActive)return;this.dialogActive=!0,m.new_grid?this.dialog(!1).opt("width",510).opt("left","50%").opt("dialogClass","dialog_nux").load("get_step_dialog").close(this.fnbind(this.onDialogClose)):this.dialog(!1).opt("width",510).opt("left","50%").opt("dialogClass","modal_nux_dialog modal_new_nux_dialog").load("get_step_dialog").close(this.fnbind(this.onDialogClose))}))}});a.QuestionDownvoteButton=c.extend({onLoad:function(){this.$("#@question_vote_down_link").click(this.fnbind(this.downvote)),this.$("#@question_vote_down_cancel_link").click(this.fnbind(this.cancelDownvote)),this.onKeyCombination(this.$("#@question_vote_down_link"),"d",this.fnbind(this.downvote)),this.onKeyCombination(this.$("#@question_vote_down_cancel_link"),"d",this.fnbind(this.cancelDownvote))},downvote:function(){return f.setQfeedLog(this,"QuestionDownvote"),f.setTlog({type:"QuestionDownvote",qid:this.qid}),this.serverCall("question_vote_down").kwargs({qid:this.qid,context:this.context}).liveMutate().sendOnlyOnce(),!1},cancelDownvote:function(){return this.serverCall("question_vote_down_cancel").kwargs({qid:this.qid,context:this.context}).liveMutate().sendOnlyOnce(),!1}}),a.FeedAnswerVotingButtons=p.extend({}),a.AnswerAddInstructions=c.extend({onLoad:function(){this.$("#@view_deleted_answer").click(this.fnbind(function(){return this.$("#@deleted_answer").toggleClass("hidden"),!1}))}}),a.CreateAnswerWikiLink=c.extend({onLoad:function(){this.$("#@create_answer_wiki").click(this.fnbind(function(){return $("#answer_wiki").toggleClass("hidden"),!1}))}}),a.EmptyAnswerHeaderDialogContents=c.extend({onLoad:function(){this.allowInvites=!0,this.lookup("selector").focus()},setTo:function(a){d.Dialog.openerFor(this).email=a,d.Dialog.openerFor(this).msg=this.$("#@msg_contents").val()}}),a.AnswerHeader=c.extend({toggleA2ASection:function(){this.lookup("a2a_section").toggleSection()},loadA2ASection:function(){this.lookup("a2a_section").loadSection()}}),a.EmptyAnswerHeader=c.extend({onLoad:function(){this.$("#@invite_to_answer").click(this.fnbind(function(){return this.openDialog(),!1})),this.$("#@ask_to_answer").click(this.fnbind(function(){return this.$("#@empty_container, #@suggestions_container").toggleClass("hidden"),!1}))},setTo:function(a){this.email=a,this.openDialog()},openDialog:function(){this._dialog=this.dialog().title("Invite Someone Who Can Answer This Question").ok(this.fnbind(function(){var a=arguments[0].dialogComponent,b=a.lookup("selector").$("#@input").val(),c=a.$("#@msg_contents").val();b&&c&&this.serverCall("invite_users").kwargs({invite_email:b,msg:c}).liveMutate().success(this.fnbind(function(){this.allowInvites=!0})).send()}),"Send Invite").cancel(null,"Cancel").load("invite_to_answer_dialog_contents",{kwargs:{email:this.email}})}}),a.AnswerListDiv=c.extend({onLoad:function(){this.installScrollHandlers(this.setPosition),m.new_grid?(this.header_height=$(".SiteHeader").outerHeight(),this.offset=15):(this.header_height=$(".header").outerHeight(),this.offset=10),this.$("#@answers_anchor").css("top","-"+this.header_height+"px"),window.location.hash=="#answers"&&$(window).scrollTop(this.$("#@answers_anchor").offset().top)},onUnload:function(){this.uninstallScrollHandlers()},setPosition:function(){var a=this,b=this.$("#@answers").find(".answer_wrapper").get(),c,d,e,f,g,h,i,k,l=$(window).height();clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout(this.fnbind(function(){c=$(window).scrollTop(),f=null;for(d=0;d<b.length;d++){g=$(b[d]);if(g.offset().top>c+a.header_height){f=g.siblings(".rating_buttons_wrapper").eq(0);break}}f&&(h=g.offset().top+a.offset,i=g.offset().top+g.outerHeight()-f.height(),k=a.header_height+a.offset,j.makeFixable({element:f,width_dep:!0,height_dep:!0,scroll_dep:!0,min_scroll:h,max_scroll:i,fixed_offset:k}))}),0)},show:function(){this.$("#@collapsed").show()}}),a.QuestionAnswerMain=c.extend({onLoad:function(a){a&&setTimeout(this.fnbind(function(){this.serverCall("record_impression").send()}),1e3),this.recordStep("share_impression");if(!m.new_grid){var b=this.$("#@answer_page").find(".rating_buttons_wrapper").eq(0),c=this.$("#@answer_page").find(".answer_wrapper"),d=c.offset().top,e=d+c.outerHeight()-b.height(),f=$(".header").outerHeight()+10;j.makeFixable({element:b,width_dep:!0,height_dep:!0,scroll_dep:!0,min_scroll:d,max_scroll:e,fixed_offset:f})}},recordStep:function(a){this.serverCall("record_step").kwargs({step_name:a}).send()}});var q=a.NewAnswerEditor=e.extend({onLoad:function(){this._super.apply(this,arguments),this.disclaimer_update="",this.lookup("editor").setFocusCallback(this.fnbind(function(){this.focusEditor()})),this.lookup("editor").$("#@editor").attr("interactive")||this.focusEditor(),this.draft_space&&this.lookup("editor").$("#@answer_later_link").click(this.fnbind(function(a){return this.save_draft(!0),this.lookup("editor").hideFakeEditor(),!1}));var a=this.lookup("editor").child("review_rating");a&&this.lookup("editor").setBlurCallback(this.fnbind(function(){a.$(".star_rating_row").removeClass("focus")}));var b=this.lookup("editor"),c=b.$("#@fake_editor"),d=b.$("#@editor_outer");d.get(0)&&(this.onKeyCombination(d,"a",this.fnbind(function(){return l.scrollIntoView(d),c.get(0)?c.click().focus():b.$("#@editor").click().focus(),!1})),this.onKeyCombination(d,"Escape",this.fnbind(function(){document.activeElement.blur();var a=d;while(a.get(0)!==document.body&&!a.hasClass("kbfocusable"))a=a.parent();return a.click().focus(),!1}),null,!0),this.onKeyCombination(this.input_button_obj,"Cmd-Enter",this.fnbind(function(){return this.input_button_obj.click(),!1}),null,!0))},focusEditor:function(){this.$("#@later").addClass("hidden"),this.$("#@draft").removeClass("hidden"),this.$("#@inline_editor_buttons").removeClass("hidden"),this.$("#@editor_metadata_wrapper").removeClass("hidden"),this.lookup("editor").$("#@qtext_editor_buttons_wrapper").removeClass("hidden"),this.lookup("editor").$("#@editor").removeClass("hidden"),this.parent().parent().$("#@publish_checkboxes").removeClass("hidden"),this.parent().parent().showSigActions&&this.parent().parent().showSigActions(),this.focusEditorOptions()},focusEditorOptions:function(){this.$("#@editor_options_wrapper").removeClass("hidden"),this.lookup("editor_options").$("#@english_warning").removeClass("hidden"),this.$("#@inline_editor_form").removeClass("hide_share_checkboxes");var a=this.lookup("editor").child("review_rating");a&&a.$(".star_rating_row").addClass("focus")},showShareWarningDialog:function(){var a=this.lookup("editor_share"),b=a.getValues(),c;b.tw?(c="Twitter",b.fb&&(c+=" and Facebook")):b.fb&&(c="Facebook"),a.serverCall("warning_dialog_shown").send(),this.lookup("editor_share").dialog().title("Share Answer?").cancel(null,"Cancel").ok(this.fnbind(function(){this.shouldShowShareWarningDialog=!1,this.input_button_obj.click()}),"Add Answer and Share").html("You are about to share your answer to "+c+". If you don't want to share, deselect the checkboxes on the page before adding your answer. We will remember your settings in the future.")},submitHandler:function(){this.input_button_obj.click(this.fnbind(function(){if(this.getEditor()&&this.isEditorEmpty())return!1;var a={};this.lookup("editor_share",!0)&&(a=this.lookup("editor_share").getValues());var b=(a.tw||a.fb)&&this.shouldShowShareWarningDialog;if(b)return this.showShareWarningDialog(),!1;var c=this.lookup("editor").child("review_rating");if(c){var e=c.$("#@ratings").attr("class").slice(-1);e?d.InputValidator.validate(this,{valid:this.fnbind(this.trigger_request),invalid:function(){}}):c.$(".inline_label").addClass("error")}else d.InputValidator.validate(this,{valid:this.fnbind(this.trigger_request),invalid:function(){}});return!1}))},invokeEditServerCall:function(a){if(this.getFacebookCheckbox()&&!require("facebook").hasPermission("publish_actions")){var b=arguments,c=this._super;require("facebook").requestPermissions("publish_stream",this.fnbind(function(a){c.apply(this,b)}))}else this._super.apply(this,arguments)},ajax_callback:function(a){return a.share_data&&a.share_data.autoShowShareDialog&&require("app/view/share").showShareAction(a.share_data),l.sameDomainURL(a.url)&&l.navigateTo(a.url),this._super.apply(this,arguments)},tlog_data:function(){return{type:"AddAnswer"}},getLoggedAction:function(){return"AnswerAdd"},_get_kwargs:function(){var a={id:this.id,input:this.get_value(),disclaimer_update:this.disclaimer_update,tw_checked:this.getTwitterCheckbox(),fb_checked:this.getFacebookCheckbox(),fb_uid:require("facebook").getFbUid(),fb_access_token:require("facebook").getAccessToken(),fb_expires:require("facebook").getExpiresIn(),review_data:this.getReviewData()};return this.lookup("editor_share",!0)&&(a.share_values=this.lookup("editor_share").getValues()),a},getFacebookCheckbox:function(){return this.lookup("publish_checkboxes",!0)?this.lookup("publish_checkboxes").shouldPublishToFacebook():null},getTwitterCheckbox:function(){return this.lookup("publish_checkboxes",!0)?this.lookup("publish_checkboxes").shouldPublishToTwitter():null}});a.NewAnswerInFeedEditor=q.extend({onLoad:function(){this._super.apply(this,arguments)},submitHandler:function(){this.input_button_obj.click(this.fnbind(function(){return this.getEditor()&&this.isEditorEmpty()?!1:(d.InputValidator.validate(this,{valid:this.fnbind(function(){this.trigger_request(),f.setQfeedLog(this,"AddAnswer")}),invalid:function(){}}),!1)}))}}),a.NewAnswerEditorWithBoardSelector=q.extend({_get_kwargs:function(){var a=this._super.apply(this,arguments);try{var b=this.cQuery(":editor.selector");b&&(a.bid=b.getBid(),a.board_name=b.getText())}catch(c){delete a.bid,delete a.board_name}return a}}),a.TempReviewEditor=q.extend({onLoad:function(){this._super.apply(this,arguments);var a=this.lookup("section").lookup("selector");a?this.needs_topic=!0:this.needs_topic=!1},focusEditorOptions:function(){},_get_kwargs:function(){var a=this._super.apply(this,arguments);return this.needs_topic&&(a.topic_name=this.getTopicName(),a.redirect=!0),a},ajax_callback:function(a){return l.sameDomainURL(a.url)&&l.navigateTo(a.url),this._super.apply(this,arguments)},getTopicName:function(){var a=this.cQuery(":section.selector.topic_add").getTempTopicNamesAsArray();return a.length>0?a[0]:null}}),a.FlagHasEnoughTopicsLink=c.extend({onLoad:function(){this.$("#@has_enough_topics").click(this.fnbind(function(){return this.serverCall("has_enough_topics").liveMutate().send(),!1})),this.$("#@doesnot_have_enough_topics").click(this.fnbind(function(){return this.serverCall("doesnot_have_enough_topics").liveMutate().send(),!1}))}}),a.ReviewPageEditTopicLink=c.extend({onLoad:function(){this.$("#@edit_topic").click(this.fnbind(function(){return this.openDialog(),!1}))},openDialog:function(){this._dialog=this.dialog().title("Edit Review Topic").load("content")},closeDialog:function(){this._dialog.close_()}}),a.ReviewPageEditTopicDialog=c.extend({onLoad:function(){this.submitted=!1,this.$("#@cancel").click(this.fnbind(function(){return this.closeDialog(),!1})),this.$("#@edit").click(this.fnbind(function(){var a=this.getContextName();return a&&!this.submitted&&(this.submitted=!0,this.editTopic(a)),!1}))},editTopic:function(a){this.closeDialog(),this.serverCall("edit_topic").kwargs({topic_name:a}).liveMutate().send()},getContextName:function(){var a=this.cQuery(":context.topic_add").getTempTopicNamesAsArray();return a.length>0?a[0]:null},closeDialog:function(){d.Dialog.openerFor(this).closeDialog()}});var r=a.StarRatingButtons=c.extend({onLoad:function(){var a=this,b=this.$("#@ratings").attr("class");$.each(this.$("%@rating"),function(c,d){$(this).attr("title",""),$(this).hover(function(){b=a.$("#@ratings").attr("class"),a.$("#@ratings").removeClass();var c=$(this).attr("rating");a.$("#@ratings").addClass("current_rating_"+c)},function(){a.$("#@ratings").attr("class",b)}),$(this).click(function(){a.$("#@ratings").removeClass();var c=$(this).attr("rating");return a.$("#@ratings").addClass("current_rating_"+c),b="current_rating_"+c,!1})})}});a.ReviewQuestionTextMain=c.extend({onLoad:function(){var a=this;this.$("#@edit").click(this.fnbind(function(){a.$("#@name").hide(),a.$("#@selector").show()}))}}),a.TopicReviewRatingLabel=c.extend({onLoad:function(a){this.$("#@request").click(this.fnbind(function(){return this.requestReviews(),!1}))},requestReviews:function(){this.submitted||(this.submitted=!0,this.serverCall("request_reviews").success(this.fnbind(function(a){a[0]=="/"&&(document.location=a)})).liveMutate().send())}});var s=a.TabbedSteps=c.extend({onLoad:function(a){},nextStep:function(){this.setCurrentStep(this.current_step+1)},setCurrentStep:function(a){if(a>this.number_steps-1)this.doneCallback();else{var b=this.$("%@step");b.removeClass("current"),this.$(".tabbed_step_"+a).addClass("current"),this.current_step=a}},doneCallback:function(){}});a.NewQuestionPrompts=s.extend({doneCallback:function(){this.serverCall("dismiss").liveMutate().send()}}),a.TabbedStepButton=c.extend({onLoad:function(a){this.$("#@button").click(this.fnbind(function(){return this.lookup("tabbed_steps").nextStep(),!1}))}}),a.TabbedStepTitle=c.extend({onLoad:function(a){this.$("#@title").click(this.fnbind(function(){return this.lookup("tabbed_steps").setCurrentStep(this.step_index),!1}))}}),a.AnswerAdd=c.extend({showSigActions:function(){this.cQuery(":answer_user").$("#@sig_actions").removeClass("hidden")}}),a.AnswerPagingCompleteIndicator=c.extend({onLoad:function(){this.show_content_page_feed&&setTimeout(this.fnbind(this.showContentPageFeed),0)},showContentPageFeed:function(){var a=this.lookup("content_page_feed");a?a.show():setTimeout(this.fnbind(this.showContentPageFeed),250)}}),a.AnswerEditorMetadataItem=c.extend({onLoad:function(){var a=this.$("#@toggle");a.click(this.fnbind(function(){return this.$("#@item").toggleClass("ghosted"),a.text()=="Show"?(this.showItem(),a.text("Hide")):(this.hideItem(),a.text("Show")),!1}))},showItem:function(){return!1},hideItem:function(){return!1}}),a.AnswerEditorMetadataDisclaimerItem=a.AnswerEditorMetadataItem.extend({showItem:function(){return this.lookup("content_editor")&&(this.lookup("content_editor").disclaimer_update="attach"),!1},hideItem:function(){return this.lookup("content_editor")&&(this.lookup("content_editor").disclaimer_update="remove"),!1}}),a.AnswerEditorMetadataA2AItem=a.AnswerEditorMetadataItem.extend({showItem:function(){return this.lookup("content_editor")&&(this.lookup("content_editor").answer_attribution_update="attach"),this.aid||this.serverCall("show_answer_attribution").liveMutate().send(),!1},hideItem:function(){return this.lookup("content_editor")&&(this.lookup("content_editor").answer_attribution_update="remove"),this.aid||this.serverCall("hide_answer_attribution").liveMutate().send(),!1}}),a.AttachDisclaimerLink2=c.extend({onLoad:function(){this.$("#@add_disclaimer_link").click(this.fnbind(function(){return this._dialog=this.dialog().title("Create Your Disclaimer").load("set_disclaimer_dialog"),!1}))}}),a.LoggedOutAnswerAdd=c.extend({onLoad:function(){var a=this,b=this.$("#@logged_out_answer_add .qtext_editor_content");b.click(this.fnbind(function(){this.serverCall("simulate_server_call").send()}))}})}),require.installLazy("app/view/board/blog",'var Component=require("w2.quora").Component,W2=require("webnode2"),floatingVote=require("view/floating_voting_buttons"),settings=require("settings");exports.BlogMain=Component.extend({onLoad:function(){this.installScrollHandlers(this.setPosition)},onUnload:function(){this.uninstallScrollHandlers()},setPosition:function(){var a=this,b=$(window).height(),c=200;clearTimeout(this.scrollTimer);var d="blog_post";settings.new_grid&&(d="board_blog_item"),this.scrollTimer=setTimeout(this.fnbind(function(){var b=$(window).scrollTop();$(this.$("#@blog_main").find("."+d).get().reverse()).each(function(){var d=$(this).find(".rating_buttons_wrapper").eq(0);if(d.find(".rating_options").is(":visible")){var e=$(this).find(".board_item_content").find(".row").eq(0),f=e.height()+13;if(d.offset().top>b-c&&d.offset().top<b+c&&f>c){var g=10;a.design_polish&&(g=70);var h=68,i=1;floatingVote.enableFloatingVotingButtons(b,d,e.offset().top,f,g,h,i)}else b<d.offset().top&&(d.removeClass("voting_buttons_fixed"),d.removeClass("voting_buttons_absolute"),d.removeAttr("style"))}})}),0)}}),exports.BlogItemMain=Component.extend({onLoad:function(){this.installScrollHandlers(this.setPosition);if(!settings.new_grid&&!this.is_single_column_theme){this.recommendedItemsHeight=this.$("#@recommended_items_outer").height();var a=this.$("#@recommended_items_outer").width();this.$("#@recommended_items_inner").css("width",a+"px")}},onUnload:function(){this.uninstallScrollHandlers()},setPosition:function(){var a=$(window).scrollTop();if(!settings.new_grid&&!this.is_single_column_theme){var b=this.$("#@recommended_items_outer").offset(),c=this.$("#@item_outer").height()-this.recommendedItemsHeight;c>b.top&&(a>=b.top&&a<c?(this.$("#@recommended_items_inner").css("position","fixed"),this.$("#@recommended_items_inner").css("top","0px"),this.lookup("recd_items").$("#@recommended_title").fadeIn()):a>=c?(this.$("#@recommended_items_inner").css("position","absolute"),this.$("#@recommended_items_inner").css("top",c+"px")):(this.$("#@recommended_items_inner").css("position","relative"),this.$("#@recommended_items_inner").css("top","default"),this.lookup("recd_items").$("#@recommended_title").fadeOut()))}clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout(this.fnbind(function(){a=$(window).scrollTop();var b=this.$("#@item_outer").find(".rating_buttons_wrapper").eq(0);if(b.find(".rating_options").is(":visible")){var c=this.$("#@item_outer").find(".board_item_content").find(".row").eq(0),d=c.height()+15,e=10;settings.new_grid&&(e=70);var f=68,g=1;floatingVote.enableFloatingVotingButtons(a,b,c.offset().top,d,e,f,g)}}),0)}}),exports.BlogMuteLink=Component.extend({onLoad:function(){this.$("#@blog_mute_link").click(this.fnbind(function(){this.serverCall("mute").kwargs({bid:this.bid}).liveMutate().send()}))}}),exports.BlogUnmuteLink=Component.extend({onLoad:function(){this.$("#@blog_unmute_link").click(this.fnbind(function(){this.serverCall("unmute").kwargs({bid:this.bid}).liveMutate().send()}))}}),exports.PublishBlogButton=Component.extend({onLoad:function(){this.$("#@publish_blog").click(this.fnbind(function(){this.serverCall("publish").kwargs({bid:this.bid}).liveMutate().send()}))}}),exports.BlogImporter=Component.extend({onLoad:function(){this.blog=this.cQuery(":create_blog"),this.$("#@blog_importer").fadeIn("fast")}}),exports.BlogImportingOverlay=Component.extend({onLoad:function(){if(this.importing){var a=$(window).width(),b=$(window).height();this.$("#@overlay").css({width:a,height:b})}}}),exports.CreateBlog=Component.extend({onLoad:function(){this.submitted=!1,this.$("#@name").focus(),this.$("#@fake_editor").click(this.fnbind(function(){return this.$("#@fake_editor_row").hide(),this.$("#@editor_row").show(),this.lookup("editor").focus(),!1})),this.$("#@create").click(this.fnbind(function(){var a=this.$("#@name").val(),b=this.lookup("subdomain").getInput().val(),c=this.$("#@import_id").val();a?this.$("#@name").removeClass("input_validation_error"):(this.$("#@name").addClass("input_validation_error"),this.$("#@name").focus()),b?this.lookup("subdomain").getInput().removeClass("input_validation_error"):(this.lookup("subdomain").getInput().addClass("input_validation_error"),a&&this.lookup("subdomain").getInput().focus());if(b&&a&&this.lookup("subdomain").urlIsOK&&!this.submitted){this.$("#@create").addClass("submit_button_disabled"),this.submitted=!0;var d=this.lookup("privacy").getType(),e=this.lookup("editor").serialize();this.disable(),this.serverCall("create").kwargs({name:a,privacy:d,description:e,url:b,topics:"",import_id:c}).success(this.fnbind(function(a){a&&(document.location=a)})).liveMutate().send()}return!1}))},disable:function(){this.$("#@name").addClass("qtext_editor_content_disabled"),this.lookup("subdomain").getInput().addClass("qtext_editor_content_disabled"),this.lookup("editor").$("#@editor").addClass("qtext_editor_content_disabled")}});'
),require.install("jquery.mjs.nestedSortable",function(require,a,b){(function(a){a.widget("mjs.nestedSortable",a.extend({},a.ui.sortable.prototype,{options:{tabSize:20,disableNesting:"mjs-nestedSortable-no-nesting",errorClass:"mjs-nestedSortable-error",doNotClear:!1,listType:"ol",maxLevels:0,protectRoot:!1,rootID:null,rtl:!1,isAllowed:function(a,b){return!0}},_create:function(){this.element.data("sortable",this.element.data("nestedSortable"));if(!this.element.is(this.options.listType))throw new Error("nestedSortable: Please check the listType option is set to your actual list type");return a.ui.sortable.prototype._create.apply(this,arguments)},destroy:function(){return this.element.removeData("nestedSortable").unbind(".nestedSortable"),a.ui.sortable.prototype.destroy.apply(this,arguments)},_mouseDrag:function(b){this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);var c=this.options;if(this.options.scroll){var d=!1;this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<c.scrollSensitivity?this.scrollParent[0].scrollTop=d=this.scrollParent[0].scrollTop+c.scrollSpeed:b.pageY-this.overflowOffset.top<c.scrollSensitivity&&(this.scrollParent[0].scrollTop=d=this.scrollParent[0].scrollTop-c.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<c.scrollSensitivity?this.scrollParent[0].scrollLeft=d=this.scrollParent[0].scrollLeft+c.scrollSpeed:b.pageX-this.overflowOffset.left<c.scrollSensitivity&&(this.scrollParent[0].scrollLeft=d=this.scrollParent[0].scrollLeft-c.scrollSpeed)):(b.pageY-a(document).scrollTop()<c.scrollSensitivity?d=a(document).scrollTop(a(document).scrollTop()-c.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<c.scrollSensitivity&&(d=a(document).scrollTop(a(document).scrollTop()+c.scrollSpeed)),b.pageX-a(document).scrollLeft()<c.scrollSensitivity?d=a(document).scrollLeft(a(document).scrollLeft()-c.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<c.scrollSensitivity&&(d=a(document).scrollLeft(a(document).scrollLeft()+c.scrollSpeed))),d!==!1&&a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b)}this.positionAbs=this._convertPositionTo("absolute");var e=this.placeholder.offset().top;if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";for(var f=this.items.length-1;f>=0;f--){var g=this.items[f],h=g.item[0],i=this._intersectsWithPointer(g);if(!i)continue;if(h!=this.currentItem[0]&&this.placeholder[i==1?"next":"prev"]()[0]!=h&&!a.contains(this.placeholder[0],h)&&(this.options.type=="semi-dynamic"?!a.contains(this.element[0],h):!0)){a(h).mouseenter(),this.direction=i==1?"down":"up";if(this.options.tolerance!="pointer"&&!this._intersectsWithSides(g))break;a(h).mouseleave(),this._rearrange(b,g),this._clearEmpty(h),this._trigger("change",b,this._uiHash());break}}var j=this.placeholder[0].parentNode.parentNode&&a(this.placeholder[0].parentNode.parentNode).closest(".ui-sortable").length?a(this.placeholder[0].parentNode.parentNode):null,k=this._getLevel(this.placeholder),l=this._getChildLevels(this.helper),m=this.placeholder[0].previousSibling?a(this.placeholder[0].previousSibling):null;if(m!=null)while(m[0].nodeName.toLowerCase()!="li"||m[0]==this.currentItem[0]||m[0]==this.helper[0]){if(!m[0].previousSibling){m=null;break}m=a(m[0].previousSibling)}var n=this.placeholder[0].nextSibling?a(this.placeholder[0].nextSibling):null;if(n!=null)while(n[0].nodeName.toLowerCase()!="li"||n[0]==this.currentItem[0]||n[0]==this.helper[0]){if(!n[0].nextSibling){n=null;break}n=a(n[0].nextSibling)}var o=document.createElement(c.listType);return this.beyondMaxLevels=0,j!=null&&n==null&&(c.rtl&&this.positionAbs.left+this.helper.outerWidth()>j.offset().left+j.outerWidth()||!c.rtl&&this.positionAbs.left<j.offset().left)?(j.after(this.placeholder[0]),this._clearEmpty(j[0]),this._trigger("change",b,this._uiHash())):m!=null&&(c.rtl&&this.positionAbs.left+this.helper.outerWidth()<m.offset().left+m.outerWidth()-c.tabSize||!c.rtl&&this.positionAbs.left>m.offset().left+c.tabSize)?(this._isAllowed(m,k,k+l+1),m.children(c.listType).length||m[0].appendChild(o),e&&e<=m.offset().top?m.children(c.listType).prepend(this.placeholder):m.children(c.listType)[0].appendChild(this.placeholder[0]),this._trigger("change",b,this._uiHash())):this._isAllowed(j,k,k+l),this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(b,c){this.beyondMaxLevels&&(this.placeholder.removeClass(this.options.errorClass),this.domPosition.prev?a(this.domPosition.prev).after(this.placeholder):a(this.domPosition.parent).prepend(this.placeholder),this._trigger("revert",b,this._uiHash()));for(var d=this.items.length-1;d>=0;d--){var e=this.items[d].item[0];this._clearEmpty(e)}a.ui.sortable.prototype._mouseStop.apply(this,arguments)},serialize:function(b){var c=a.extend({},this.options,b),d=this._getItemsAsjQuery(c&&c.connected),e=[];return a(d).each(function(){var b=(a(c.item||this).attr(c.attribute||"id")||"").match(c.expression||/(.+)[-=_](.+)/),d=(a(c.item||this).parent(c.listType).parent(c.items).attr(c.attribute||"id")||"").match(c.expression||/(.+)[-=_](.+)/);b&&e.push((c.key||b[1])+"["+(c.key&&c.expression?b[1]:b[2])+"]"+"="+(d?c.key&&c.expression?d[1]:d[2]:c.rootID))}),!e.length&&c.key&&e.push(c.key+"="),e.join("&")},toHierarchy:function(b){function f(b){var d=(a(b).attr(c.attribute||"id")||"").match(c.expression||/(.+)[-=_](.+)/);if(d){var e={id:d[2]};return a(b).children(c.listType).children(c.items).length>0&&(e.children=[],a(b).children(c.listType).children(c.items).each(function(){var a=f(this);e.children.push(a)})),e}}var c=a.extend({},this.options,b),d=c.startDepthCount||0,e=[];return a(this.element).children(c.items).each(function(){var a=f(this);e.push(a)}),e},toArray:function(b){function g(b,f,h){var i=h+1,j,k;a(b).children(c.listType).children(c.items).length>0&&(f++,a(b).children(c.listType).children(c.items).each(function(){i=g(a(this),f,i)}),f--),j=a(b).attr(c.attribute||"id").match(c.expression||/(.+)[-=_](.+)/);if(f===d+1)k=c.rootID;else{var l=a(b).parent(c.listType).parent(c.items).attr(c.attribute||"id").match(c.expression||/(.+)[-=_](.+)/);k=l[2]}return j&&e.push({item_id:j[2],parent_id:k,depth:f,left:h,right:i}),h=i+1,h}var c=a.extend({},this.options,b),d=c.startDepthCount||0,e=[],f=2;return e.push({item_id:c.rootID,parent_id:"none",depth:d,left:"1",right:(a(c.items,this.element).length+1)*2}),a(this.element).children(c.items).each(function(){f=g(this,d+1,f)}),e=e.sort(function(a,b){return a.left-b.left}),e},_clearEmpty:function(b){var c=a(b).children(this.options.listType);c.length&&!c.children().length&&!this.options.doNotClear&&c.remove()},_getLevel:function(a){var b=1;if(this.options.listType){var c=a.closest(this.options.listType);while(c&&c.length>0&&!c.is(".ui-sortable"))b++,c=c.parent().closest(this.options.listType)}return b},_getChildLevels:function(b,c){var d=this,e=this.options,f=0;return c=c||0,a(b).children(e.listType).children(e.items).each(function(a,b){f=Math.max(d._getChildLevels(b,c+1),f)}),c?f+1:f},_isAllowed:function(b,c,d){var e=this.options,f=a(this.domPosition.parent).hasClass("ui-sortable")?!0:!1,g=this.placeholder.closest(".ui-sortable").nestedSortable("option","maxLevels");!e.isAllowed(this.currentItem,b)||b&&b.hasClass(e.disableNesting)||e.protectRoot&&(b==null&&!f||f&&c>1)?(this.placeholder.addClass(e.errorClass),g<d&&g!=0?this.beyondMaxLevels=d-g:this.beyondMaxLevels=1):g<d&&g!=0?(this.placeholder.addClass(e.errorClass),this.beyondMaxLevels=d-g):(this.placeholder.removeClass(e.errorClass),this.beyondMaxLevels=0)}})),a.mjs.nestedSortable.prototype.options=a.extend({},a.ui.sortable.prototype.options,a.mjs.nestedSortable.prototype.options)})(jQuery)}),require.install("jquery.tinysort",function(require,a,b){(function(a,undefined){function m(a){return a&&a.toLowerCase?a.toLowerCase():a}function n(a,c){for(var d=0,e=a.length;d<e;d++)if(a[d]==c)return!b;return b}"use strict";var b=!1,c=null,d=parseFloat,e=Math.min,f=/(-?\d+\.?\d*)$/g,g=/(\d+\.?\d*)$/g,h=[],i=[],j=function(a){return typeof a=="string"},k=function(a,b){var c=a.length,d=c,e;while(d--)e=c-d-1,b(a[e],e)},l=Array.prototype.indexOf||function(a){var b=this.length,c=Number(arguments[1])||0;c=c<0?Math.ceil(c):Math.floor(c),c<0&&(c+=b);for(;c<b;c++)if(c in this&&this[c]===a)return c;return-1};a.tinysort={id:"TinySort",version:"1.5.6",copyright:"Copyright (c) 2008-2013 Ron Valstar",uri:"http://tinysort.sjeiti.com/",licensed:{MIT:"http://www.opensource.org/licenses/mit-license.php",GPL:"http://www.gnu.org/licenses/gpl.html"},plugin:function(){var a=function(a,b){h.push(a),i.push(b)};return a.indexOf=l,a}(),defaults:{order:"asc",attr:c,data:c,useVal:b,place:"start",returns:b,cases:b,forceStrings:b,ignoreDashes:b,sortFunction:c}},a.fn.extend({tinysort:function(){var o,p,q,r=this,s=[],t=[],u=[],v=[],w=0,x,y=[],z=[],A=function(a){k(h,function(b){b.call(b,a)})},B=function(a,b){return typeof b=="string"&&(a.cases||(b=m(b)),b=b.replace(/^\s*(.*?)\s*$/i,"$1")),b},C=function(a,c){var e=0;w!==0&&(w=0);while(e===0&&w<x){var h=v[w],l=h.oSettings,m=l.ignoreDashes?g:f;A(l);if(l.sortFunction)e=l.sortFunction(a,c);else if(l.order=="rand")e=Math.random()<.5?1:-1;else{var n=b,o=B(l,a.s[w]),p=B(l,c.s[w]);if(!l.forceStrings){var q=j(o)?o&&o.match(m):b,r=j(p)?p&&p.match(m):b;if(q&&r){var s=o.substr(0,o.length-q[0].length),t=p.substr(0,p.length-r[0].length);s==t&&(n=!b,o=d(q[0]),p=d(r[0]))}}e=h.iAsc*(o<p?-1:o>p?1:0)}k(i,function(a){e=a.call(a,n,o,p,e)}),e===0&&w++}return e};for(o=0,q=arguments.length;o<q;o++){var D=arguments[o];j(D)?y.push(D)-1>z.length&&(z.length=y.length-1):z.push(D)>y.length&&(y.length=z.length)}y.length>z.length&&(z.length=y.length),x=y.length,x===0&&(x=y.length=1,z.push({}));for(o=0,q=x;o<q;o++){var E=y[o],F=a.extend({},a.tinysort.defaults,z[o]),G=!!E&&E!=="",H=G&&E[0]===":";v.push({sFind:E,oSettings:F,bFind:G,bAttr:F.attr!==c&&F.attr!=="",bData:F.data!==c,bFilter:H,$Filter:H?r.filter(E):r,fnSort:F.sortFunction,iAsc:F.order=="asc"?1:-1})}return r.each(function(b,c){var d=a(c),e=d.parent().get(0),f,g=[];for(p=0;p<x;p++){var h=v[p],i=h.bFind?h.bFilter?h.$Filter.filter(c):d.find(h.sFind):d;g.push(h.bData?i.data(h.oSettings.data):h.bAttr?i.attr(h.oSettings.attr):h.oSettings.useVal?i.val():i.text()),f===undefined&&(f=i)}var j=l.call(u,e);j<0&&(j=u.push(e)-1,t[j]={s:[],n:[]}),f.length>0?t[j].s.push({s:g,e:d,n:b}):t[j].n.push({e:d,n:b})}),k(t,function(a){a.s.sort(C)}),k(t,function(a){var c=a.s,d=a.n,f=c.length,g=d.length,h=f+g,i=[],j=h,l=[0,0];switch(F.place){case"first":k(c,function(a){j=e(j,a.n)});break;case"org":k(c,function(a){i.push(a.n)});break;case"end":j=g;break;default:j=0}for(o=0;o<h;o++){var m=n(i,o)?!b:o>=j&&o<j+f,p=m?0:1,q=(m?c:d)[l[p]].e;q.parent().append(q),(m||!F.returns)&&s.push(q.get(0)),l[p]++}}),r.length=0,Array.prototype.push.apply(r,s),r}}),a.fn.TinySort=a.fn.Tinysort=a.fn.tsort=a.fn.tinysort})(jQuery)}),require.installLazy("app/view/signup",'var W2=require("webnode2"),Component=require("w2.quora").Component,windowManager=require("window_manager"),LiveLoginDialog=require("login").LiveLoginDialog,facebook=require("facebook"),loginInProgress=!1;$(document).bind("w2rpcexception-signup_blocked.default",function(a,b){windowManager.navigateTo("/signup/blocked")}),exports.SignupFormFields=Component.extend({onLoad:function(){var a=this;this.__js_init.fb_signup_button_enabled_by_default||this.$("#@email, #@name, #@password").keyup(function(){a.$("#@name").val()&&a.$("#@email").val()&&a.$("#@password").val()?a.trigger("enable_submit"):a.trigger("disable_submit")})},validate:function(){if(!this.child("name_validator").isValid)if(!this.$("#@name")||this.child("name_validator")!==null)return!1;if(!this.child("email_validator").isValid)if(!this.$("#@email")||this.child("email_validator").isValid!==null)return this.$("#@email").removeAttr("readonly"),!1;if(this.$("#@password").val().length<this.minimum_password_length)return!1;if(!this.child("password_validator").isValid)if(!this.$("#@password")||this.child("password_validator").isValid!==null)return a1ert("Check the password that you\'re using before submitting."),!1;return!0}}),exports.ModalSignupDialog=Component.extend({onLoad:function(){var a=this;this.initFormFields(),a.$("#@modal_signup_wrapper").hasClass("hidden")&&setTimeout(function(){a.$("#@modal_signup_wrapper").removeClass("hidden"),a.centerComponent()},2e3),a.logged_in_modal_dialog&&this.serverCall("show_fb_modal").send(),a.log_times=[5,10,20,40],a.log_idx=0;var b=function(){a.recordStep("seconds_on_page_"+a.log_times[a.log_idx]),a.log_idx++};for(var c=0;c<a.log_times.length;c++)setTimeout(b,a.log_times[c]*1e3);a.updateCheckboxCookie(),a.recordStep("signup_dialog_begin"),a.fbConnected=!1,a.twConnected=!1,a.googConnected=!1,a.signupRpcPending=!1,a.fbProfileInfo={},a.fbInfo={},a.twInfo={},a.googInfo={},a.show_facebook_connect&&(a.logged_in_modal_dialog||facebook.onInit(function(){a.updateFbLoginStatus(!1)}),a.child("fb_connect").bind("fb_login",function(){a.updateFbLoginStatus(!0)}),a.child("fb_connect").bind("fb_login_failed",function(b){a.showAuthExplanation("facebook")})),a.show_twitter_connect&&(a.child("tw_connect").bind("tw_login",function(b,c,d){a.updateTwLoginStatus(c,d)}),a.child("tw_connect").bind("tw_login_failed",function(b){a.showAuthExplanation("twitter")})),a.show_google_connect&&(a.child("goog_connect").bind("goog_login",function(b,c,d){a.updateGoLoginStatus(c,d)}),a.child("goog_connect").bind("goog_login_failed",function(b){a.showAuthExplanation("google")})),a.registerSubmitButton(),a.registerLoginLink(),a.registerEmailSignupLink(),a.registerCancelLinks(),a.has_passwordless&&(a.recordStep("login_has_passwordless"),a.$("#@login").show(),a.$("#@create_account").hide()),$(window).resize(a.fnbind(function(b){a.centerComponent()}));var d=a.child("facepile");d&&d.bind("facepile_parsed",a.fnbind(function(b){a.centerComponent()})),a.centerComponent(),a.$("#@form").show(),a.$("%@create_account_footer_link").click(a.fnbind(function(){a.onClickCreateAccountLink()})),a.$("%@sign_in_footer_link").click(a.fnbind(function(){a.onClickSignInLink()})),a.$("%@remind_me_footer_link").click(a.fnbind(function(){a.onClickNotNowLink()})),a.$("#@checkbox_tos").click(a.fnbind(function(){a.clickCheckbox()})),a.$("#@checkbox_label").click(a.fnbind(function(){var b=a.$("#@checkbox_tos").is(":checked");a.$("#@checkbox_tos").attr("checked",!b),a.clickCheckbox()})),a.$("#@connect_button_overlay").click(a.fnbind(function(){a.$("#@connect_button_overlay").is(":visible")&&a.$("#@checkbox_error").removeClass("hidden")}))},initFormFields:function(){this.formFields=this.child("form_fields"),this.submit=this.$("#@submit"),this.spinner=this.$("#@spinner")},updateCheckboxCookie:function(){var a=this.$("#@checkbox_tos");a.hasClass("age_checkbox")&&require("cookies").cookie("age_gate_cb",a.is(":checked")?"checked":"unchecked")},clickCheckbox:function(){var a=this;a.$("#@checkbox_tos").is(":checked")?a.$("#@connect_button_overlay").addClass("hidden"):a.$("#@connect_button_overlay").removeClass("hidden"),a.updateCheckboxCookie()},registerEmailSignupLink:function(){var a=this;a.$("%@use_email_signup").click(function(){return a.show_facebook_connect&&FB.getLoginStatus(a.fnbind(function(b){a.toggleConnectButtonsAndForm(!0)})),a.hidePhotoSection(),a.toggleConnectButtonsAndForm(!0),!1})},hidePhotoSection:function(){this.$("#@contents").addClass("no_picture_form"),this.$("#@connected_photo_wrapper").hide()},registerCancelLinks:function(){var a=this;a.$("%@cancel_link").click(function(){return a.close(),!1}),a.logged_in_modal_bg_close&&a.$("#@background").click(function(){if(!a.logged_in_modal_bg_close)return!1;a.close(),a.serverCall("close_fb_modal_background").send()}),a.background_click_dismisses_dialog&&a.$("#@background").click(function(){if(!a.background_click_dismisses_dialog)return!1;if(a.signupRpcPending)return!1;a.close(),a.recordStep("signup_dialog_background_click_to_close")})},toggleCancelLinks:function(a){a?this.$("%@cancel_link").show():this.$("%@cancel_link").hide()},disableCancelBasedOnOptions:function(){this.disable_background_close_on_connect&&(this.background_click_dismisses_dialog=!1)},formTopCoord:function(){return Math.max(($(window).height()-this.$("#@form").outerHeight())/2-20,20)},centerComponent:function(){this.$("#@form .dialog_wrapper").css({position:"static"}),this.$("#@form").css({"margin-top":0,"margin-left":0});var a=Math.max(($(window).width()-this.$("#@form").outerWidth())/2,0),b=Math.max($(window).width()/2,0),c=this.formTopCoord();this.$("#@form").css({position:"fixed",left:a,top:c});var d=this.shouldShowFbFacepile();this.toggleFbFacepileDisplay(d),this.positionTopSection()},shouldShowTopSection:function(){return!0},shouldShowFbFacepile:function(){return!0},topSectionTopCoord:function(){var a=($(window).height()-this.$("#@form").outerHeight())/2;return a-this.$("#@top_section").outerHeight()-40},toggleFbFacepileDisplay:function(a){a?this.$("#@facepile_container").show():this.$("#@facepile_container").hide()},toggleTopSectionDisplay:function(a){a?this.$("#@top_section").show():this.$("#@top_section").hide()},positionTopSection:function(){if(this.$("#@top_section")){var a=this.topSectionTopCoord(),b=Math.max(($(window).width()-this.$("#@top_section").outerWidth())/2,0);this.$("#@top_section").css({position:"fixed",left:b,marginLeft:0,top:a});var c=this.shouldShowTopSection();this.toggleTopSectionDisplay(c)}},toggleConnectButtonsAndForm:function(a){this.showWaitingForLogin(!1),a?(this.$("#@connect").hide(),this.$("#@signup_form").show(),this.updateFormFieldFocus()):(this.$("#@connect").show(),this.$("#@signup_form").hide()),this.hideFooterLinks(),this.$("#@login").is(":visible")?this.$(".login_footer_links").show():this.$("#@signup_form").is(":visible")?this.$(".signup_footer_links").show():this.$("#@connect").is(":visible")&&this.$(".regular_login_links").show(),this.centerComponent()},showWaitingForLogin:function(a){a?(this.$("#@connect").hide(),this.$("#@signup_form").hide(),this.$("#@account_loading").show()):this.$("#@account_loading").hide(),this.centerComponent()},updateFbLoginStatus:function(a){var b=this;FB.getLoginStatus(function(c){c.status==="connected"&&b.showWaitingForLogin(!0),a||b.recordStep("signup_fb_initially_"+c.status);if(c.status==="connected"){var d=c.authResponse;b.fbInfo={uid:c.authResponse.userID,accessToken:c.authResponse.accessToken,expiresIn:c.authResponse.expiresIn},b.serverCall("save_fb_token").kwargs({fb_uid:b.fbInfo.uid,access_token:b.fbInfo.accessToken,expires_in:b.fbInfo.expiresIn}).send(),b.queryFacebookProfile(function(a){b.fbProfileInfo={name:a.name,email:a.email,photoUrl:a.picture},b.updateFormFields(b.fbProfileInfo)});var e=b.enable_passwordless_signup&&a;if(loginInProgress===!0)return;loginInProgress=!0,b.serverCall("try_login_facebook").kwargs({fb_access_token:b.fbInfo.accessToken,auto_signup:e,code:b.code,explicit:a}).success(function(c){c?b.completeLogin():b.enable_passwordless_signup?b.toggleConnectButtonsAndForm(a):b.toggleConnectButtonsAndForm(!0),loginInProgress=!1}).except("banned_user",function(){b.serverCall("login_user_is_banned").send(),loginInProgress=!1}).error(function(){loginInProgress=!1}).send(),b.updateLoginMessage(),facebook.updatePermissions(b.fnbind(b.updateLoginMessage)),a&&b.disableCancelBasedOnOptions()}}),b.centerComponent()},updateTwLoginStatus:function(a,b){var c=this;c.twConnected=!0,c.twInfo={uid:b.twitter_uid,accessToken:a.key},c.showWaitingForLogin(!0),c.updateFormFields({name:b.name,photoUrl:b.photo_url});if(loginInProgress===!0)return;loginInProgress=!0,c.serverCall("try_login_twitter").kwargs({tw_oauth_key:a.key}).success(function(a){a?c.completeLogin():c.toggleConnectButtonsAndForm(!0),loginInProgress=!1}).error(function(){loginInProgress=!1}).send(),c.disableCancelBasedOnOptions(),c.centerComponent()},updateGoLoginStatus:function(a,b){var c=this;c.googConnected=!0,c.googInfo={uid:b.email,accessToken:a},c.showWaitingForLogin(!0),c.updateFormFields({name:b.name,email:b.email,photoUrl:b.photo_url}),c.formFields.$("#@email").attr("readonly","readonly");if(loginInProgress===!0)return;loginInProgress=!0,c.serverCall("try_login_google").kwargs({goog_access_token:a,auto_signup:c.enable_passwordless_signup,code:c.code}).success(function(a){a?c.completeLogin():c.toggleConnectButtonsAndForm(!0),loginInProgress=!1}).error(function(){loginInProgress=!1}).send(),c.disableCancelBasedOnOptions(),c.centerComponent()},showAuthExplanation:function(a){var b=this;if(b.show_explanation){var c=2700;b.$("#@connect_main_title").text(b.auth_explanation_title),b.$("#@connect_subtitle").text(b.auth_explanation_subtitle),b.$("#@connect_row").effect("highlight",{},c),b.$("#@connect_subtitle").addClass("subtitle_centered");var d,e;a=="google"?(d=b.lookup("goog_connect").$("#@google_connect_button"),e=b.lookup("fb_connect").$("#@facebook_connect_button")):(d=b.lookup("fb_connect").$("#@facebook_connect_button"),e=b.lookup("goog_connect").$("#@google_connect_button")),d.effect("highlight",{color:"#87ceeb"},c);var f=b.$("#@arrow_pointing_down"),g=f.find("span.arrow_down");f.show();var h=a=="google";h===!0?(g.removeClass("arrow_right"),g.addClass("arrow_left")):(g.removeClass("arrow_left"),g.addClass("arrow_right")),b.$(".connect_buttons").css("padding-top","5px"),b.$("#@explanation_login_links").show(),b.$("#@explanation_login_links").effect("highlight",{},c)}},updateFormFields:function(a){var b=this.formFields;if(!b)return;var c=b.$("#@name");c.val(a.name),c.val()!==""&&c.addClass("disabled_text_field").click(function(){c.removeClass("disabled_text_field")}),b.child("name_validator").validate();if(a.email){var d=b.$("#@email");d.val(a.email).addClass("disabled_text_field").click(function(){d.attr("readonly")||d.removeClass("disabled_text_field")});var e={invalid:this.fnbind(function(a){this.formFields.$("#@email").removeAttr("readonly")})};b.child("email_validator").validate(e)}this.$("#@picture_spinner").hide(),a.photoUrl?this.$("#@connected_pic").attr("src",a.photoUrl).show():this.hidePhotoSection(),this.centerComponent()},updateFormFieldFocus:function(){var a=this.formFields;if(!a)return;a.$("#@name").val()?a.$("#@email").val()?a.$("#@password").focus():a.$("#@email").focus():a.$("#@name").focus()},registerLoginLink:function(){var a=this;this.$("%@login_link").click(function(){return a.onClickLoginLink(),!1})},updateLoginMessage:function(){facebook.getFbUid()?facebook.hasPermission("publish_actions")?(this.$("#@login_connect_and_timeline_msg").show(),this.$("#@login_connect_msg").hide()):(this.$("#@login_connect_and_timeline_msg").hide(),this.$("#@login_connect_msg").show()):(this.$("#@login_connect_and_timeline_msg").hide(),this.$("#@login_connect_msg").hide()),this.centerComponent()},registerSubmitButton:function(){this.formFields.bind("enable_submit",this.fnbind(function(){this.submit.removeAttr("disabled").removeClass("submit_button_disabled")})),this.formFields.bind("disable_submit",this.fnbind(function(){this.submit.attr("disabled","disabled").addClass("submit_button_disabled")}))},close:function(){return this.recordStep("signup_dialog_close"),this.$("#@background").hide(),this.$("#@form").hide(),this.$("#@top_section").remove(),!1},show:function(){this.$("#@background").show(),this.$("#@form").show(),this.$("#@top_section").show()},queryFacebookProfile:function(a){FB.api("/me?fields=id,name,email",this.fnbind(function(b){this.fbConnected=!0,this.recordStep("signup_facebook_api_succeeded"),a({email:b.email,name:b.name,fb_uid:b.id,picture:"https://graph.facebook.com/"+b.id+"/picture?type=normal"})}))},completeLogin:function(){require("settings").pageMode=="post_reload"&&$(document).trigger("quora_login")},recordStep:function(a){this.serverCall("record_step").kwargs({step_name:a}).send()},showFbModal:function(){this.serverCall("show_fb_modal").send()},getHashParams:function(){var a={},b=document.location.hash.substr(1).split("&");for(var c=0;c<b.length;++c)a[b[0]]=b[1];return a},objectToString:function(a,b){b=b||"";var c=[];for(var d in a)typeof a[d]=="object"?c.push(b+d+"=<br>"+this.objectToString(a[d],b+"&nbsp;&nbsp;")):c.push(b+d+"="+a[d]);return c.join(",<br>")},events:{"click #@create_account_link":"onClickCreateAccountLink","click #@submit":"onClickSubmit"},onClickLoginLink:function(){return this.hideDialogViews(),this.hideFooterLinks(),this.$("#@login").show(),this.$(".login_footer_links").show(),this.centerComponent(),this.toggleConnectButtonsAndForm(this.fbConnected||this.twConnected),!1},onClickCreateAccountLink:function(){return this.hideDialogViews(),this.hideFooterLinks(),this.$("#@create_account").show(),this.$("#@signup_form").show(),this.$(".signup_footer_links").show(),this.centerComponent(),!1},onClickSignInLink:function(){return this.hideDialogViews(),this.hideFooterLinks(),this.$("#@create_account").show(),this.$("#@connect").show(),this.$(".regular_login_links").show(),this.centerComponent(),!1},onClickNotNowLink:function(){this.close(),this.serverCall("close_fb_modal").send()},hideDialogViews:function(){this.$("#@create_account").hide(),this.$("#@connect").hide(),this.$("#@signup_form").hide(),this.$("#@login").hide()},hideFooterLinks:function(){this.$(".regular_login_links").hide(),this.$(".login_footer_links").hide(),this.$(".signup_footer_links").hide()},onClickSubmit:function(){var a=this;if(a.signupRpcPending)return!1;require("cookies").checkAgeGate();var b=a.formFields;if(b.validate()){a.signupRpcPending=!0,a.spinner.show(),a.submit.attr("disabled","disabled").addClass("submit_button_disabled");var c=b.$("#@followquora"),d=c.size()>0&&c.is(":checked");a.serverCall("signup").kwargs({name:b.$("#@name").val(),email:b.$("#@email").val(),password:b.$("#@password").val(),autofollow_quora_twitter:d,fb_access_token:a.fbInfo.accessToken,fb_expires:a.fbInfo.expiresIn,tw_oauth_key:a.twInfo.accessToken,goog_access_token:a.googInfo.accessToken,code:a.code}).success(function(b){a.spinner.hide(),b?a.completeLogin():a.submit.removeAttr("disabled").removeClass("submit_button_disabled"),a.signupRpcPending=!1}).error(function(){a.signupRpcPending=!1,a.spinner.hide(),a.submit.removeAttr("disabled").removeClass("submit_button_disabled")}).send()}return!1}});var SignupForm2=exports.SignupForm2=Component.extend({onLoad:function(){this.inline_login&&this.parent()&&this.parent()instanceof LiveLoginDialog&&this.serverCall("record_signup_step").kwargs({signup_action:"signup_dialog_begin"}).send(),this.signupRpcPending=!1,this.registerKeyupCallbacks(),this.useLoadingSpinnerForConnectedFriends=!1,this.child("twitter_connect_button")&&this.child("twitter_connect_button").bind("tw_login",this.fnbind(function(a,b,c){this.onTwitterOAuth(b.key,c)})),this.child("google_connect_button")&&(this.child("google_connect_button").bind("goog_login",this.fnbind(function(a,b,c){this.onGoogleOAuth(b,c)})),this.child("google_connect_button").bind("goog_login_failed",this.fnbind(function(){this.showAuthExplanation("google")}))),this.child("facebook_connect_button")&&(this.child("facebook_connect_button").bind("fb_login",this.fnbind(function(a,b){this.tryLoginFacebook(b.accessToken,!0),this.serverCall("show_connected_friends").kwargs({fb_uid:b.userID,fb_access_token:b.accessToken,fb_expires:b.expiresIn,tw_uid:this.$("#@tw_uid").val()}).contentFor(this.$("#@connected_friends_list"),{parentCID:this.cid,useLoadingSpinner:this.useLoadingSpinnerForConnectedFriends}).send(),this.useLoadingSpinnerForConnectedFriends=!1,this.$("#@fb_uid").val(b.userID),this.$("#@fb_access_token").val(b.accessToken),this.$("#@fb_expires").val(b.expiresIn)})),this.child("facebook_connect_button").bind("fb_login_failed",this.fnbind(function(){this.showAuthExplanation("facebook")})),this.child("facebook_connect_button").bind("fb_connected",this.fnbind(function(a,b,c){this.serverCall("record_signup_step").kwargs({signup_action:"signup_facebook_api_succeeded"}).send(),this.onFacebookAccountConnected(c)}))),this.$("#@form").submit(this.fnbind(function(a){if(this.signupRpcPending)return!1;if(!this.validateName())return!1;if(!this.validateEmail())return!1;if(!this.validatePassword())return!1;this.signupRpcPending=!0;if(this.inline_login||this.next_url){this.$("#@spinner").removeClass("hidden");var b={name:this.$("#@name").val(),email:this.$("#@email").val(),password:this.$("#@password").val()},c=this.getOptionalArgs();b.optional_args=c;var d=this.serverCall("signup_dont_redirect").kwargs(b).success(this.fnbind(function(a){this.$("#@spinner").addClass("hidden"),a?this.completeLogin():this.$("#@submit").removeAttr("disabled"),this.signupRpcPending=!1})).error(this.fnbind(function(){this.signupRpcPending=!1,this.$("#@spinner").hide(),this.$("#@submit").removeAttr("disabled")}));return this.disable_live_updates||d.liveMutate(),d.send(),this.$("#@submit").attr("disabled","disabled"),!1}return this.$("#@submit").attr("disabled","disabled"),this.onFormSubmission(),!0})),this.$("#@email").keyup(this.fnbind(function(){this.child("email_validator").hideAllErrors()})),this.$("#@name").keyup(this.fnbind(function(){this.child("name_validator").hideAllErrors()})),this.$("#@password").keyup(this.fnbind(function(){this.child("password_validator").hideAllErrors()}))},showAuthExplanation:function(a){var b=this;if(b.show_explanation){var c=2700;b.$("#@step_1_title").hide(),b.$("#@auth_explanation_container").show().effect("highlight",{},c);var d,e;a=="facebook"?(d=this.child("facebook_connect_button").$("#@facebook_connect_button"),e=this.child("google_connect_button").$("#@google_connect_button")):(d=this.child("google_connect_button").$("#@google_connect_button"),e=this.child("facebook_connect_button").$("#@facebook_connect_button")),d.effect("highlight",{color:"#87ceeb"},c);var f,g,h;b.show_explanation=="narrow"?(f=b.$("#@arrow_pointing_right"),g="area_top",h="area_bottom"):(f=b.$("#@arrow_pointing_down"),g="arrow_left",h="arrow_right"),a=="facebook"?(f.removeClass(h),f.addClass(g)):(f.removeClass(g),f.addClass(h)),b.$("#@bypass_connect_row").effect("highlight",{},c),b.$("#@login_link").css({"font-size":"1.3em","font-weight":"bold"}),b.$("#@bypass_connect_link").css({"font-size":"1.3em","font-weight":"bold"})}},onTwitterOAuth:function(a,b){this.serverCall("record_signup_step").kwargs({signup_action:"signup_twitter_connected"}).send();if(loginInProgress===!0)return;loginInProgress=!0,this.serverCall("try_login_twitter").kwargs({tw_oauth_key:a}).success(this.fnbind(function(c){c?(this.completeLogin(),loginInProgress=!1):(loginInProgress=!1,this.onTwitterAccountConnected(a,b))})).error(function(){loginInProgress=!1,this.onTwitterAccountConnected(a,b)}).send(),this.serverCall("show_connected_friends").kwargs({tw_uid:b.twitter_uid,fb_uid:this.$("#@fb_uid").val(),fb_access_token:this.$("#@fb_access_token").val(),fb_expires:this.$("#@fb_expires").val()}).contentFor(this.$("#@connected_friends_list"),{parentCID:this.cid,useLoadingSpinner:this.useLoadingSpinnerForConnectedFriends}).send(),this.useLoadingSpinnerForConnectedFriends=!1,this.$("#@connected_pic").hasClass("fb_photo")||(b.photo_url?this.$("#@connected_pic").attr("src",b.photo_url):this.$("#@connected_pic").hide())},onGoogleOAuth:function(a,b){this.serverCall("record_signup_step").kwargs({signup_action:"signup_google_connected"}).send(),this.tryLoginGoogle(a,this.onGoogleAccountConnected.bind(this,a,b)),this.$("#@connected_pic").hasClass("fb_photo")||(b.photo_url?this.$("#@connected_pic").attr("src",b.photo_url):this.$("#@connected_pic").hide())},tryLoginFacebook:function(a,b){var c=this;if(loginInProgress===!0)return;loginInProgress=!0,c.serverCall("try_login_facebook").kwargs({fb_access_token:a,code:c.code,explicit:b}).success(function(a){a&&c.completeLogin(),loginInProgress=!1}).except("banned_user",function(){c.serverCall("login_user_is_banned").send(),loginInProgress=!1}).error(function(){loginInProgress=!1}).send()},tryLoginGoogle:function(a,b){var c=this;if(loginInProgress===!0)return;loginInProgress=!0,c.serverCall("try_login_google").kwargs({goog_access_token:a,code:c.code}).success(function(a){a?(c.completeLogin(),loginInProgress=!1):(loginInProgress=!1,b())}).error(function(){loginInProgress=!1,b()}).send()},onFormSubmission:function(){},onTwitterAccountConnected:function(a,b){this.accountConnected(),this.$("#@twitter_signup_link").hide(),this.$("#@twitter_connected").show(),this.$("#@connect_option").hide(),this.$("#@connect_explanation").hide(),this.$("#@step_2").removeClass("hidden"),this.$("#@follow_quora_twitter").removeClass("hidden"),this.$("#@email").focus(),this.showConnectedFriends(),this.showTwitterConnectedInfo(b),this.$("#@tw_oauth_key").val(a),this.$("#@tw_uid").val(b.twitter_uid),this.$("#@tw_screen_name").val(b.twitter_screen_name),this.$("#@name").val(b.name),this.child("name_validator").validate(),this.onShowStepTwo()},onGoogleAccountConnected:function(a,b){this.accountConnected(),this.$("#@google_signup_link").hide(),this.$("#@google_connected").show(),this.$("#@connect_option").hide(),this.$("#@connect_explanation").hide(),this.$("#@step_2").removeClass("hidden"),this.$("#@password").focus(),this.showConnectedFriends(),this.showGoogleConnectedInfo(b),this.$("#@goog_access_token").val(a),this.$("#@goog_email").val(b.email),this.$("#@goog_name").val(b.name),this.$("#@name").val(b.name),this.$("#@email").val(b.email),this.child("name_validator").validate(),this.$("#@email").attr("readonly","readonly"),this.$("#@email").addClass("disabled_text_field");var c={invalid:this.fnbind(function(a){this.$("#@email").removeAttr("readonly"),this.$("#@email").removeClass("disabled_text_field")})};this.child("email_validator").validate(c),this.onShowStepTwo()},showConnectedFriends:function(){this.$("#@connected_friends_list").show()},onFacebookAccountConnected:function(a){this.accountConnected(),this.hide_welcome_on_connect&&this.$("#@signup_welcome").hide();if(a&&a[0])window.RESULTS=a,a[0].pic_big?(this.$("#@connected_pic").attr("src",a[0].pic_big),this.$("#@connected_pic").addClass("fb_photo")):this.$("#@connected_pic").hide(),a[0].contact_email&&this.$("#@email").val(a[0].contact_email),this.child("facebook_connect_button").$("#@facebook_connect_button").hide(),this.$("#@facebook_connected").show(),this.$("#@connect_option").hide(),this.$("#@connect_explanation").hide(),this.$("#@password").focus(),this.$("#@step_2").removeClass("hidden"),this.showConnectedFriends(),this.showFbConnectedInfo(a),this.$("#@name").val(a[0].name),this.child("name_validator").validate(),this.onShowStepTwo();else{var b=window.console;b&&b.error&&b.error("Error retrieving data from Facebook."),this.serverCall("record_signup_step").kwargs({signup_action:"signup_facebook_api_failed"}).send()}},validateName:function(){if(!this.child("name_validator").isValid)if(!this.$("#@name")||this.child("name_validator")!==null)return a1ert("Check the name that you entered before submitting."),!1;return!0},validateEmail:function(){if(!this.child("email_validator").isValid)if(!this.$("#@email")||this.child("email_validator").isValid!==null)return a1ert("Check the e-mail that you\'re using before submitting."),!1;return!0},validatePassword:function(){if(this.$("#@password").val().length<this.minimum_password_length)return!1;if(!this.child("password_validator").isValid){if(!this.$("#@password")||this.child("password_validator").isValid!==null)return a1ert("Check the password that you\'re using before submitting."),!1}else window.console.log("validator hasn\'t responded yet, allowing through");return!0},registerKeyupCallbacks:function(){this.$("#@email, #@name, #@password").keyup(this.fnbind(function(){this.$("#@name").val()&&this.$("#@email").val()&&this.$("#@password").val()?(this.$("#@submit").removeAttr("disabled"),this.$("#@submit").removeClass("submit_button_disabled")):(this.$("#@submit").attr("disabled","disabled"),this.$("#@submit").addClass("submit_button_disabled"))}))},showFbConnectedInfo:function(a){this.$("#@connected_info").show(),this.$("#@fb_name").text(a[0].name),this.$("#@fb_info").show()},showTwitterConnectedInfo:function(a){this.$("#@connected_info").show(),this.$("#@tw_name").text("@"+a.twitter_screen_name),this.$("#@twitter_info").show()},showGoogleConnectedInfo:function(a){this.$("#@connected_info").show(),this.$("#@goog_name").text(a.name),this.$("#@goog_email").text(a.email),this.$("#@goog_info").show()},getOptionalArgs:function(){var a=this.$("#@fb_access_token").val(),b=this.$("#@tw_oauth_key").val(),c=this.$("#@goog_access_token").val();return{code:this.$("#@code").val(),group:this.$("#@group").val(),source_user_name:this.$("#@source_user_name").val(),source_url:this.$("#@source_url").val(),tid:this.tid,fb_access_token:a,fb_expires:this.$("#@fb_expires").val(),tw_oauth_key:b,google_access_token:c}},completeLogin:function(){this.inline_login||windowManager.navigateTo(this.next_url||"/"),require("settings").pageMode=="post_reload"&&$(document).trigger("quora_login")},accountConnected:function(){},cancelClicked:function(){this.toggleStep1Header(!0),this.lookup("home_logged_out")&&(this.lookup("home_logged_out").$("#@contents").show(),this.lookup("home_logged_out").$("#@signup_form").hide())},onShowStepTwo:function(){this.toggleStep1Header(!1),this.serverCall("record_signup_step").kwargs({signup_action:"signup_show_step_two"}).send()},bypassConnectLink:function(){this.$("#@connect_option").hide(),this.$("#@connect_explanation").hide(),this.$("#@step_2").removeClass("hidden"),this.onShowStepTwo(),this.$("#@name").focus()},toggleStep1Header:function(a){this.hide_step1_header_on_step2&&(a?(this.$("#@step_1_title").show(),this.$("#@connect_buttons").show()):(this.$("#@step_1_title").hide(),this.$("#@connect_buttons").hide()))},events:{"click #@bypass_connect_link":"onClickBypassConnectLink","click #@twitter_signup_link":"onClickTwitterSignupLink","click #@google_signup_link":"onClickGoogleSignupLink","click #@login_link":"onClickLoginLink","click #@create_account_link":"onClickCreateAccountLink","click #@cancel":"onClickCancel"},onClickBypassConnectLink:function(a){return this.bypassConnectLink(),!1},onClickTwitterSignupLink:function(a){this.serverCall("record_signup_step").kwargs({signup_action:"signup_connect_to_twitter"}).send();var b=window.open("/twitter/oauth_window","_BLANK","height=400,width=800");return!1},onClickGoogleSignupLink:function(a){this.serverCall("record_signup_step").kwargs({signup_action:"signup_connect_to_google"}).send();var b=window.open("/google_/oauth_window","_BLANK","height=550,width=700");return!1},onClickLoginLink:function(a){this.$("#@step_1").addClass("hidden"),this.$("#@step_2").addClass("hidden"),this.$("#@login_form").removeClass("hidden")},onClickCreateAccountLink:function(a){this.$("#@step_1").removeClass("hidden"),this.$("#@login_form").addClass("hidden")},onClickCancel:function(a){return this.cancelClicked(),!1},onHomePageSignupFormLoad:function(){var a=windowManager.getPathName(),b={};if(a=="/"||a=="/signup")b={path:a};this.serverCall("record_signup_step").kwargs({signup_action:"signup_homepage_visit",funnel_args:b}).send(),this.no_associated_users&&this.serverCall("record_signup_step").kwargs({signup_action:"signup_homepage_visit_no_account",funnel_args:b}).send()}});exports.HomePageSignupForm=SignupForm2.extend({onLoad:function(){this._super.apply(this,arguments),this.onHomePageSignupFormLoad()}}),exports.MobileWebSignupForm=SignupForm2.extend({completeLogin:function(){$(document).trigger("mobile_web_signup_complete")}});var SignupFormExpanded=exports.SignupFormExpanded=SignupForm2.extend({accountConnected:function(){this.$("#@connected_photo_wrapper").show(),this.lookup("home_logged_out")&&(this.lookup("home_logged_out").$("#@contents").hide(),this.lookup("home_logged_out").$("#@signup_form").show(),this.lookup("home_logged_out").$("#@signup_form_expanded").removeClass("w3").addClass("row"))},cancelClicked:function(){this.toggleStep1Header(!0),this.lookup("home_logged_out")&&(this.lookup("home_logged_out").$("#@contents").show(),this.lookup("home_logged_out").$("#@signup_form_expanded").addClass("w3").removeClass("row")),this.child("facebook_connect_button").$("#@facebook_connect_button").show(),this.$("#@facebook_connected, #@google_connected, #@twitter_connected, #@connected_friends_list, #@connected_info, #@twitter_info, #@connected_photo_wrapper").hide(),this.$("#@step_2").addClass("hidden"),this.$("#@connect_option, #@connect_explanation, #@connect_option").show(),this.canSignupWithTwitter()&&this.$("#@twitter_signup_link").show()},canSignupWithTwitter:function(){return!0},bypassConnectLink:function(){this.serverCall("record_signup_step").kwargs({signup_action:"bypass_connect_link"}).send(),this.$("#@connect_option").hide(),this.$("#@connect_explanation").hide(),this.$("#@step_2").removeClass("hidden"),this.onShowStepTwo(),this.accountConnected(),this.$("#@name").focus()}});exports.NarrowSignupForm=SignupFormExpanded.extend({onLoad:function(){var a=this;a._super.apply(this,arguments),a.tryingFacebookLogin=!1,a.fbResults=null,a.tryingGoogleLogin=!1,a.googleResults=null},tryLoginFacebook:function(a,b){var c=this;c.$("#@account_loading").show(),c.$("#@connect_buttons").hide();if(loginInProgress===!0)return;loginInProgress=!0,c.serverCall("try_login_facebook").kwargs({fb_access_token:a,auto_signup:c.enable_passwordless_signup,code:c.code,explicit:b}).success(function(a){c.tryingFacebookLogin=!0,a?c.completeAutoLogin():c.fbResults&&c.onFacebookAccountConnected(c.fbResults),loginInProgress=!1}).except("banned_user",function(){c.$("#@account_loading").hide(),c.$("#@connect_buttons").show(),c.serverCall("login_user_is_banned").send(),loginInProgress=!1}).error(function(){loginInProgress=!1}).send()},tryLoginGoogle:function(a){var b=this;b.$("#@account_loading").show(),b.$("#@connect_buttons").hide();if(loginInProgress===!0)return;loginInProgress=!0,b.serverCall("try_login_google").kwargs({goog_access_token:a,auto_signup:b.enable_passwordless_signup,code:b.code}).success(function(c){b.tryingGoogleLogin=!0,c?b.completeAutoLogin():b.googleResults&&b.onGoogleAccountConnected(a,b.googleResults),loginInProgress=!1}).except("banned_user",function(){b.$("#@account_loading").hide(),b.$("#@connect_buttons").show(),b.serverCall("login_user_is_banned").send(),loginInProgress=!1}).error(function(){loginInProgress=!1}).send()},onFacebookAccountConnected:function(a){this.tryingFacebookLogin?(this._super.apply(this,arguments),this.tryingFacebookLogin=!1):this.fbResults=a},onGoogleAccountConnected:function(a,b){this.tryingGoogleLogin?(this._super.apply(this,arguments),this.tryingGoogleLogin=!1):this.googleResults=b},onShowStepTwo:function(){this.$("#@account_loading").hide(),this._super.apply(this,arguments)},completeAutoLogin:function(){this.enable_passwordless_signup&&require("settings").pageMode=="post_reload"?$(document).trigger("quora_login"):this.completeLogin()}});var HomePageSignupFormExpanded=exports.HomePageSignupFormExpanded=SignupFormExpanded.extend({onLoad:function(){this._super.apply(this,arguments),this.onHomePageSignupFormLoad(),this.initTryLoginFacebook()},initTryLoginFacebook:function(){var a=this;facebook.onInit(function(){FB.getLoginStatus(function(b){b.status==="connected"&&a.tryLoginFacebook(b.authResponse.accessToken,!1)})})}}),SignupFormBigButtons=exports.SignupFormBigButtons=HomePageSignupFormExpanded.extend({onLoad:function(){this._super.apply(this,arguments),this.doingPasswordlessSignup=!1},accountConnected:function(){this.lookup("home_logged_out")&&this.lookup("home_logged_out").$("#@quora_explanation").fadeTo(1,.15)},onShowStepTwo:function(){this._super.apply(this,arguments),this.$("#@step_1").hide(),this.setStepTwoTitle()},setStepTwoTitle:function(){var a=this.$("#@step_2_header_prefix").text(),b=this\n.$("#@name").val()==="",c=this.$("#@email").val()==="",d=this.$("#@password").val()==="";b||this.$("#@name").addClass("prefilled"),c||this.$("#@email").addClass("prefilled"),b&&c&&d||(c&&d?(a="Add Email and Password to ",this.$("#@email").focus()):d&&(a="Choose Password to ",this.$("#@password").focus())),this.$("#@step_2_header_prefix").text(a)},cancelClicked:function(){this._super.apply(this,arguments),this.$("#@step_1").show(),this.lookup("home_logged_out")&&this.lookup("home_logged_out").$("#@quora_explanation").fadeTo(1,1)},showFbConnectedInfo:function(a){this.$("#@connected_info").show()},showTwitterConnectedInfo:function(a){this.$("#@connected_info").show()},showGoogleConnectedInfo:function(a){this.$("#@connected_info").show()},registerKeyupCallbacks:function(){},showConnectedFriends:function(){},validateName:function(){return this.doingPasswordlessSignup?!0:this.$("#@name").val()===""?(this.child("name_validator").$("#@invalid_message").text("A full name is required."),this.child("name_validator").showErrorOnComponent("#@invalid_message"),!1):this._super.apply(this,arguments)},validateEmail:function(){return this.doingPasswordlessSignup?!0:this.$("#@email").val()===""?(this.child("email_validator").$("#@invalid_message").text("A valid email is required."),this.child("email_validator").showErrorOnComponent("#@invalid_message"),!1):this._super.apply(this,arguments)},validatePassword:function(){return this.doingPasswordlessSignup?!0:this.$("#@password").val()===""?(this.child("password_validator").$("#@invalid_message").text("A password is required."),this.child("password_validator").showErrorOnComponent("#@invalid_message"),!1):this._super.apply(this,arguments)},events:{"click #@bypass_connect_link":"onClickBypassConnectLink","click #@twitter_signup_link":"onClickTwitterSignupLink","click #@google_signup_link":"onClickGoogleSignupLink","click #@cancel":"onClickCancel","click #@name":"onClickName","click #@email":"onClickEmail"},onClickName:function(a){var b=this;b.$("#@name").removeClass("prefilled")},onClickEmail:function(a){var b=this;b.$("#@email").attr("readonly")||b.$("#@email").removeClass("prefilled")},onFacebookAccountConnected:function(a){this.doingPasswordlessSignup=!0;if(a&&a[0])window.RESULTS=a,a[0].pic_big?(this.$("#@connected_pic").attr("src",a[0].pic_big),this.$("#@connected_pic").addClass("fb_photo")):this.$("#@connected_pic").hide(),a[0].contact_email&&this.$("#@email").val()===""&&this.$("#@email").val(a[0].contact_email),this.$("#@name").val()===""&&this.$("#@name").val(a[0].name),this.doSignup();else{var b=window.console;b&&b.error&&b.error("Error retrieving data from Facebook."),this.serverCall("record_signup_step").kwargs({signup_action:"signup_facebook_api_failed"}).send()}},doSignup:function(){this.$("#@form").submit()}});exports.SignupFormInsideFBPageTimeline=SignupForm2.extend({completeLogin:function(){top.location="/"}}),exports.SignupAndAddAnswerForm=SignupForm2.extend({onLoad:function(){this._super.apply(this,arguments),this.lookup("editor").focus()},getOptionalArgs:function(){var a=this._super.apply(this,arguments);return a.answer_text=this.lookup("editor").serialize(),a.qid=this.qid,a.via=this.via,a.key=this.key,a.code=this.code,a}}),exports.SignupAndFollowBoardForm=SignupForm2.extend({onLoad:function(){this._super.apply(this,arguments)},getOptionalArgs:function(){var a=this._super.apply(this,arguments);return a.bid=this.bid,a.inviter_uid=this.inviter_uid,a.key=this.key,a.code=this.code,a}}),exports.SignupConnectedFriends=Component.extend({onLoad:function(){},events:{"click #@more_friends":"onClickMoreFriends"},onClickMoreFriends:function(a){return this.dialog().title("Connecting your Facebook or Twitter Account to Quora").cancel(null,"Close").html("To get you started, we\'ll have you follow all your Facebook or Twitter friends who are already on Quora when you sign up.<br /><br />We won\'t message your contacts who aren\'t on the site or post anything to your Facebook or Twitter unless you choose to.<br /><br />For Quora to become a great knowledge resource for everyone, it\'s important that users trust the site.  If Quora ever fails to meet your expectations of trust, please let us know by e-mailing <a href=\'mailto:feedback@quora.com\'>feedback@quora.com</a> and we\'ll try to do better."),!1}});var SignupWallExplanationOnAnswer=exports.SignupWallExplanationOnAnswer=Component.extend({onLoad:function(){var a=!1,b=this;$(window).scroll(function(){a=!0}),this.intervalId=setInterval(function(){a&&(a=!1,b.toggleFixed())},200),this.showingFixed=!1},toggleFixed:function(){var a=$(window).scrollTop(),b=this.$("#@signup_wall_explanation").offset().top,c=this.$("#@signup_wall_explanation").height(),d=30;this.showingFixed?b+c+d>=a&&(this.lookup("fixed").hide(),this.showingFixed=!1):b+c+d<a&&(this.lookup("fixed").show(),this.showingFixed=!0)},disableFixed:function(){this.lookup("fixed").hide(),this.showingFixed=!1,this.intervalId&&clearInterval(this.intervalId)},onUnload:function(){this.disableFixed(),clearInterval(this.facepileIntervalId)}});exports.SignupToGetNotifiedOfNewAnswers=Component.extend({defaultTextVisible:!0,onLoad:function(){var a=this;a.$("#@email").focus(function(){a.defaultTextVisible&&(a.defaultTextVisible=!1,a.$("#@email").val(""),a.$("#@email").removeClass("default_text"),a.serverCall("record_focus").kwargs({qid:a.qid}).send())}),a.$("#@form").submit(function(){return a.$("#@submit").attr("disabled","disabled"),a.child("email_validator").validate({valid:a.fnbind(a.onValid),invalid:a.fnbind(a.onInvalid)}),!1})},onInvalid:function(){this.$("#@submit").removeAttr("disabled")},onValid:function(){var a=this;a.serverCall("notify_email").kwargs({email:a.$("#@email").val(),qid:a.qid}).success(function(b){b&&a.$("#@wrapper").hide(),a.$("#@submit").removeAttr("disabled")}).send()}});'
),require.installLazy("app/view/signup/mobile_app",'var W2=require("webnode2"),Component=require("w2.quora").Component,cookies=require("cookies"),windowManager=require("window_manager"),BaseAppInstallComponent=Component.extend({timeoutInterval:1e3,pageIsProbablyVisible:function(){return document.webkitHidden!=undefined?!document.webkitHidden:document.hidden!=undefined?!document.hidden:!0},triggerRedirects:function(a,b){var c=this,d=+(new Date);c.redirectToAppURL(b),c.app_store_fallback&&setTimeout(function(){var b=+(new Date)-d>5*c.timeoutInterval;c.pageIsProbablyVisible()&&!b&&(window.location=a)},c.timeoutInterval)},redirectToAppURL:function(a){if(navigator.userAgent.match(/(iPad|iPhone|iPod)/g))window.location=a;else if(navigator.userAgent.match(/(Chrome\\/(19|\\d{3,}|[2-9]\\d))/g)){var b=a.replace("quora://","");window.location="intent://"+b+"/#Intent;package=com.quora.android;scheme=q;"+"action=android.intent.action.VIEW;category=android.intent.category.DEFAULT;end"}else $("body").append($(\'<div class="hidden"><iframe src="\'+a+\'"></iframe></div>\'))},recordStep:function(a,b){this.serverCall("record_step").kwargs({step_name:a}).success(function(){b&&b()}).send()}}),MobileAppInstallDialog=exports.MobileAppInstallDialog=BaseAppInstallComponent.extend({dialogType:"install_dialog",onLoad:function(){var a=this,b=a.fnbind(function(){a.recordStep(a.dialogType+"_view"),a._setupDialog()});a.redirect_to_store_on_load?a.redirectToStoreOnLoad(b):a.show_alert_on_load?a.showOnLoadInstallAlert(b):a.render_as_interstitial?(a.$("#@background").hide(),a.$(document).bind("mobile_web_signup_complete",function(){a.signup_complete=!0,a.$("#@background").show(),b()})):b()},_setupDialog:function(){this.$("#@dialog_contents").show(),this.$("#@bottom_section").show(),this.default_title=this.$("#@title").text(),this.default_subtitle=this.$("#@subtitle").text(),$(window).bind("orientationchange",this.fnbind(this.windowOrientationChange)),$(window).bind("resize",this.fnbind(this.windowOrientationChange)),this.windowOrientationChange()},bindRPCExceptionLoginRequired:function(){var a=this;if(!a.show_dialog_on_login_req)return;$(document).unbind("w2rpcexception-login_required.default"),$(document).bind("w2rpcexception-login_required.default",function(b,c){if(c.response){var d=a.getLoginRequiredActionType(c.response);a.updateDialogText(d)}a.showInstallLink(),a.show(),a.recordStep("login_required")})},showLoading:function(){this.$("#@app_banner").hide(),this.$("#@loading").show(),this.$("#@install_link").addClass("loading")},showInstallLink:function(){this.$("#@app_banner").show(),this.$("#@loading").hide(),this.$("#@install_link").removeClass("loading")},getLoginRequiredActionType:function(a){var b="default";if(!a)return b;if(!a.exception)return b;if(!a.exception.args)return b;var c=a.exception.args,d;for(var e in c){d=c[e];for(var f in this.title_on_actions)if(d.indexOf(f)!=-1)return f}return b},windowOrientationChange:function(){if(!this.$("#@background").is(":visible"))return;var a=$(window).height(),b=this.$("#@bottom_section");a<440&&(a=500),$("body").css({height:a,overflow:"hidden"}),a<220?this.$("#@dialog_contents").addClass("v_compact"):this.$("#@dialog_contents").removeClass("v_compact")},updateDialogText:function(a){var b=this.default_title,c=this.default_subtitle;this.title_on_actions[a]&&(b=this.title_on_actions[a],c=this.subtitle_on_action),this.$("#@title").text(b),this.$("#@subtitle").text(c)},events:{"click #@cancel_link":"onClose","click #@install_link":"onClickInstall","click #@appbanner_bg":"onClickInstall","click #@learn_more_link":"onClickInstall"},hide:function(){this.$("#@background").hide(),$("body").css({height:"",overflow:""}),this.render_as_interstitial&&this.signup_complete&&$(document).trigger("quora_login")},show:function(){this.$("#@background").show(),this.windowOrientationChange()},onClickInstall:function(){var a=this;return a.showLoading(),setTimeout(function(){a.hide()},5*a.timeoutInterval),a.bindRPCExceptionLoginRequired(),a.triggerRedirects(a.app_store_link,a.app_url),!1},showOnLoadInstallAlert:function(a){var b=this;b.recordStep("show_alert_on_load");var c=confirm("You need the Quora app to read all of the answers.");c==1?b.recordStep("show_alert_on_load_ok",function(){b.bindRPCExceptionLoginRequired(),b.triggerRedirects(b.app_store_link+"?no_install_link_clicked=1",b.app_url)}):b.recordStep("show_alert_on_load_close"),a&&setTimeout(a,1500)},redirectToStoreOnLoad:function(a){var b=this;b.recordStep("redirect_to_store_on_load",function(){b.triggerRedirects(b.app_store_link+"?no_install_link_clicked=1",b.app_url),a&&setTimeout(a,1500)})},onClose:function(){return this.bindRPCExceptionLoginRequired(),this.recordStep(this.dialogType+"_closed"),this.hide(),!1}});exports.MobileWebSignupDialog=MobileAppInstallDialog.extend({dialogType:"signup_dialog",onLoad:function(){var a=this;a.show_on_load?a._super.apply(this,arguments):(a._setupDialog(),a.bindRPCExceptionLoginRequired(),a.hide()),a.$(document).bind("mobile_web_signup_complete",function(b){a.hide(),a.will_show_interstitial||$(document).trigger("quora_login")})}}),exports.TruncatedAnswerRequireAppInstall=BaseAppInstallComponent.extend({onLoad:function(){var a=this;a.$("#@more_require_app_install").click(a.fnbind(function(){a.triggerRedirects(a.app_store_link,a.app_url)})),a.$("#@more_require_login").click(a.fnbind(function(){a.serverCall("show_more").send()}))}}),exports.MobileAppLink=BaseAppInstallComponent.extend({onLoad:function(){var a=this;a.$("#@download_button").click(function(){a.triggerRedirects(a.app_store_link,a.app_url)})}});var MobileAppInstallHP=BaseAppInstallComponent.extend({onLoad:function(){var a=this.onLoadStepsToBeRecorded();this.recordSteps(a)},onLoadStepsToBeRecorded:function(){var a=["signup_homepage_visit"];return this.no_associated_users&&a.push("signup_homepage_visit_no_account"),a},events:{"click #@mobile_site":"switchMobileSite","click #@install_link":"onClickInstall","click #@arrow":"onClickInstall","click #@call_to_action":"onClickInstall","click #@appbanner_bg":"onClickInstall"},onClickInstall:function(){this.triggerRedirects(this.app_store_link,this.app_url)},switchMobileSite:function(){var a=this;a.recordStep("switch_classic_hp",function(){windowManager.navigateTo(a.classic_hp_url)})},recordSteps:function(a,b){this.serverCall("record_steps").kwargs({steps:a}).success(function(){b&&b()}).send()}});exports.MobileAppInstallHPIPhone=MobileAppInstallHP.extend({android:!1}),exports.MobileAppInstallHPAndroid=MobileAppInstallHP.extend({android:!0}),exports.SignupWallViewInAppButton=BaseAppInstallComponent.extend({events:{"click #@app_button":"onClickInstall"},onClickInstall:function(){this.recordStep("install_link_clicked"),this.triggerRedirects(this.app_store_link,this.app_url)}});'),require.installLazy("app/view/contact_importer",'function isEmailInDomains(a,b){var c=!1;return $.each(b,function(b,d){if(d.test(a)){c=!0;return}}),c}var Component=require("w2.quora").Component,PagedList=require("view/paged_list").PagedList,YahooDomains=[/@yahoo\\.(ca|cn|co\\.id|co\\.in|co\\.jp|co\\.kr|co\\.nz|co\\.uk|com|com\\.ar|com\\.au|com\\.br|com\\.cn|com\\.hk|com\\.mx|com\\.my|com\\.ph|com\\.sg|com\\.tr|com\\.tw|com\\.vn|de|dk|es|fr|gr|ie|it|no|pl|se)$/,/@ymail\\.com$/,/@rocketmail\\.com$/],GmailDomains=[/@gmail\\.com$/,/@googlemail\\.com$/],HotmailDomains=[/@.*(hotmail|live|msn)\\..+$/],ImportContactsForm=exports.ImportContactsForm=Component.extend({prevEmail:null,isGoogleAppsEmail:!1,shouldLogImpression:!0,onLoad:function(){var a=this;this.isGoogleAppsEmail=this.is_google_apps_email,this.prevEmail=this.getEmail(),this.$("input[type=submit]").focus(),this.$("#@email").keyup(function(){a.prevEmail!=a.getEmail()&&(a.prevEmail=a.getEmail(),a.validateEmail())}),this.$("input[type=submit]").click(function(){return a.onSubmit()}),this.shouldLogImpression&&this.serverCall("log_impression").kwargs({email:this.getEmail()}).send()},submitForm:function(){this.$("#@contact_importer_form").submit()},updateAndSubmitForm:function(a,b){this.$("#@service").val(a),this.$("#@access_token").val(b),this.$("#@spinner").show(),this.submitForm()},onOAuthRejected:function(a){},onSubmit:function(){return this.openOAuthDialog(this.getEmail())?!1:!0},getEmail:function(){return $.trim(this.$("#@email").val())},lastTimeoutId:null,validateEmail:function(){var a=this.getEmail();if(!a)return this.onOAuthEmailEntered("empty"),!1;this.lastTimeoutId&&(clearTimeout(this.lastTimeoutId),this.lastTimeoutId=null);var b=isEmailInDomains(a,YahooDomains),c=isEmailInDomains(a,GmailDomains),d=isEmailInDomains(a,HotmailDomains);this.isGoogleAppsEmail=!1,this.isGoogleAppsDomainCheckQueued=!1,b?this.onOAuthEmailEntered("yahoo"):c?this.onOAuthEmailEntered("gmail"):d?this.onOAuthEmailEntered("hotmail"):(this.onUnknownDomainEntered(),this.lastTimeoutId=setTimeout(this.fnbind(function(){this.checkGoogleAppsDomain()}),500))},onOAuthEmailEntered:function(a){},onUnknownEmailDomainEntered:function(){},isCheckingGoogleAppsDomain:!1,isGoogleAppsDomainCheckQueued:!1,checkGoogleAppsDomain:function(){if(this.isCheckingGoogleAppsDomain){this.isGoogleAppsDomainCheckQueued=!0;return}this.isCheckingGoogleAppsDomain=!0;var a=this.getEmail(),b=this;this.serverCall("is_google_apps_domain").kwargs({email:a}).success(function(c){c&&(b.isGoogleAppsEmail=!0),b.onCheckGoogleAppsDomainResponse(a,c),b.isCheckingGoogleAppsDomain=!1,b.isGoogleAppsDomainCheckQueued&&(b.isGoogleAppsDomainCheckQueued=!1,b.checkGoogleAppsDomain())}).send()},onCheckGoogleAppsDomainResponse:function(a,b){},logOAuthAttempt:function(a){this.serverCall("log_contact_importer_oauth_attempt").kwargs({email:a}).send()},openOAuthDialog:function(a){if(isEmailInDomains(a,YahooDomains))return this.logOAuthAttempt(a),window.open("/oauth/yahoo","_BLANK","height=400,width=800"),!0;if(isEmailInDomains(a,GmailDomains)||this.isGoogleAppsEmail){this.logOAuthAttempt(a);var b,c;this.perms=="email_and_contacts"?(b=550,c=700):(b=450,c=700);var d=(screen.width-c)/2,e=(screen.height-b)/2,f="width="+c+", height="+b+"location=no, toolbar=no, status=no, top="+e+", left="+d,g="/oauth/google_oauth2?email="+encodeURIComponent(a);return this.perms!==null&&(g=g+"&perms="+this.perms),window.open(g,"_BLANK",f),!0}return isEmailInDomains(a,HotmailDomains)?(this.logOAuthAttempt(a),window.open("/oauth/hotmail","_BLANK","height=600,width=1000"),!0):!1},getEmailDomain:function(a){return isEmailInDomains(a,YahooDomains)?"yahoo":isEmailInDomains(a,GmailDomains)||this.isGoogleAppsEmail?"google":isEmailInDomains(a,HotmailDomains)?"hotmail":"other"}});exports.OAuthFormSubmissionListener=Component.extend({onLoad:function(){var a=this;$(document).bind("oauth_approved",function(b,c){var d=c.service,e=c.accessToken;a.lookup("contact_importer").updateAndSubmitForm(d,e)}),$(document).bind("oauth_rejected",function(b,c){var d=c.service;a.lookup("contact_importer").onOAuthRejected()})}}),exports.SimpleImportContactsForm=ImportContactsForm.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@contact_importer_form").submit(this.fnbind(this.onFormSubmit))},onFormSubmit:function(){return!this.child("submit").$("#@import_contacts").is(":disabled")},unsupportedMessageTimeoutId:null,clearUnsupportedMessageTimeout:function(){this.unsupportedMessageTimeoutId&&(clearTimeout(this.unsupportedMessageTimeoutId),this.unsupportedMessageTimeoutId=null)},onOAuthEmailEntered:function(a){this.$("#@spinner").hide(),this.$("#@email_import_error").hide(),this.$("#@unsupported_domain").hide(),this.$("#@form_error").hide(),this.enableSubmitButton(!0),this.clearUnsupportedMessageTimeout()},onUnknownDomainEntered:function(){this.$("#@spinner").show(),this.$("#@email_import_error").hide(),this.$("#@form_error").hide(),this.enableSubmitButton(!1),this.clearUnsupportedMessageTimeout()},onUnsupportedDomainEntered:function(){this.$("#@spinner").hide(),this.$("#@unsupported_domain").show(),this.$("#@email_import_error").show(),this.enableSubmitButton(!1)},onCheckGoogleAppsDomainResponse:function(a,b){if(this.getEmail()==a)if(!b){var c=this;this.unsupportedMessageTimeoutId=setTimeout(function(){c.onUnsupportedDomainEntered()},500)}else this.$("#@spinner").hide(),this.$("#@unsupported_domain").hide(),this.enableSubmitButton(!0)},enableSubmitButton:function(a){a?this.child("submit").$("#@import_contacts").attr("disabled",!1).removeClass("submit_button_disabled").addClass("follow_button"):this.child("submit").$("#@import_contacts").attr("disabled",!0).addClass("submit_button_disabled").removeClass("follow_button")}}),exports.NuxImportContactsForm=exports.SimpleImportContactsForm.extend({shouldLogImpression:!1,onLoad:function(){var a=this;this._super.apply(this,arguments),this.$("#@change_email_link").click(function(){return a.$("#@default_email_container").hide(),a.$("#@change_email_container").show(),!1})}}),exports.NuxDialogImportContactsForm=exports.NuxImportContactsForm.extend({onLoad:function(){var a=this;a._super.apply(a,arguments),a.getEmailDomain(a.getEmail())=="other"&&a.onUnsupportedDomainEntered(),a.$("#@skip").click(function(){a.serverCall("record_step").kwargs({step_name:"skip_oauth_dialog"}).success(function(){a.lookup("dialog_step").skipNextStep()}).send()})},onOAuthRejected:function(a){this.serverCall("record_step").kwargs({step_name:"reject_oauth"}).send()},onSubmit:function(){var a=this._super.apply(this,arguments),b=!a;return b?this.serverCall("record_step").kwargs({step_name:"open_oauth",props:{domain:this.getEmailDomain(this.getEmail())}}).send():this.serverCall("record_step").kwargs({step_name:"invalid_import_domain"}).send(),a},submitForm:function(){var a=this.$("#@service").val(),b=this.$("#@access_token").val();return this.importContacts(this.getEmail(),a,b),!1},importContacts:function(a,b,c){var d=this;d.$("#@alt_spinner").show(),d.serverCall("import_contacts").kwargs({email:a,service:b,access_token:c}).liveMutate().success(function(){d.lookup("dialog_step").gotoNextStep()}).send()}}),exports.CompactImportContactsForm=exports.SimpleImportContactsForm.extend({onLoad:function(){var a=this;this._super.apply(this,arguments),this.$("#@change_email_link").click(function(){return a.$("#@default_email_container").hide(),a.$("#@change_email_container").show(),a.$("#@find_contacts_button").css({"float":"right"}),!1})}}),exports.ImportContactsFormHarness=ImportContactsForm.extend({onOAuthEmailEntered:function(a){console.log("onOAuthEmailEntered",a)},onUnknownDomainEntered:function(){console.log("onUnknownDomainEntered")},onCheckGoogleAppsDomainResponse:function(a,b){console.log("onCheckGoogleAppsDomainResponse",a,b)}});var common=require("app/view/common"),ToFollowList=common.ToFollowList,ToFollowListItem=common.ToFollowListItem;exports.PersonalMessage=ToFollowList.extend({onLoad:function(){this.$("#@view_personal_message").click(this.fnbind(function(){return this.$("#@view_personal_message").addClass("hidden"),this.$("#@personal_message").removeClass("hidden"),!1}))},getVal:function(){return this.$("#@msg").val()}}),exports.InviteByEmailAddress=Component.extend({onLoad:function(){this.$("#@more").click(this.fnbind(function(){return this.$("#@more").addClass("hidden"),this.$("#@email_addresses .hidden_fields").removeClass("hidden"),!1}))}}),exports.InviteByEmailAddressItem=Component.extend({onLoad:function(a){this.$("#@email").bind("blur",this.fnbind(function(a){if(this.$("#@email").val())return this.showTopicSuggestionsAndNextEmail(),!1}))},showTopicSuggestionsAndNextEmail:function(){this.lookup("suggestions").show(),this.cQuery(":suggestions.topic.topic_add").setoid(this.$("#@email").val()),this.cQuery(":suggestions.topic").setTarget(this.$("#@email").val());var a=parseInt(this.$("#@email").attr("index"),10)+1;this.lookup("address_item_"+a.toString()).show()},show:function(){this.$("#@address_item_wrapper").show()},setTo:function(a){a&&(this.$("#@email").val(a),this.showTopicSuggestionsAndNextEmail())}}),exports.SendSuggestions=Component.extend({toggle:function(){this.$("#@suggestions").toggleClass("hidden")},show:function(){this.$("#@suggestions").removeClass("hidden")},hide:function(){this.$("#@suggestions").addClass("hidden")}}),exports.ContactImporterStepBase=Component.extend({onLoad:function(){var a=this;a.maybeLogImpression(),a.totalCount=a.$(".suggestions_table input[type=checkbox]").length,a.$("#@toggle_all").click(function(){a.$("#@toggle_all").is(":checked")?a.selectAll():a.clearAll(),a.serverCall("log_step").kwargs({step:"toggle_all"}).send()}),a.registerActionButtonClickCallback("action_button"),a.registerActionButtonClickCallback("top_action_button"),a.numContacts=parseInt(a.$("#@select_count").text(),10),a.numSelected=a.numContacts},registerActionButtonClickCallback:function(a){var b=this,c=b.child(a);c&&c.$("#@submit").click(function(){return b.submitForm(),!1})},selectAll:function(){this.$(".suggestions_table input[type=checkbox]").attr("checked",!0);var a=this.$(this.itemSelector());a.addClass("selected").removeClass("unmodified"),this.updateSelectCount({selectAll:!0})},clearAll:function(){this.$(".suggestions_table input[type=checkbox]").attr("checked",!1),this.$(this.itemSelector()).removeClass("selected unmodified"),this.updateSelectCount({clearAll:!0})},maybeLogImpression:function(){},submitForm:function(){},updateSelectCount:function(a){assert(a.select||a.clear||a.selectAll||a.clearAll),a.select?this.numSelected++:a.clear?this.numSelected--:a.selectAll?this.numSelected=this.numContacts:a.clearAll&&(this.numSelected=0),this.$("#@select_count").html(this.numSelected)},itemSelector:function(){return""}}),exports.ContactImporterStep=exports.ContactImporterStepBase.extend({maybeLogImpression:function(){this.serverCall("log_impression").send()},submitForm:function(){this.$("#@form").submit()}}),exports.SuggestionCard=Component.extend({onLoad:function(){var a=this;this.$("#@checkbox").click(this.fnbind(this.handleClick)),this.$("#@suggestion").click(function(b){b.target!=a.$("#@checkbox")[0]&&(a.$("#@checkbox").attr("checked",!a.$("#@checkbox").is(":checked")),a.handleClick())})},handleClick:function(){var a=this.lookup("contact_importer_step");this.$("#@checkbox").is(":checked")?(this.$("#@suggestion").addClass("selected"),a.updateSelectCount({select:!0})):(this.$("#@suggestion").removeClass("selected"),a.updateSelectCount({clear:!0}))}}),exports.InviteSuggestionTable=PagedList.extend({onUpdate:function(a){this._super.apply(this,arguments);var b=this.lookup("contact_importer_step");b.$("#@toggle_all").attr("checked")||b.updateInviteList()}}),exports.UsersToFollowFromContacts=exports.ContactImporterStep.extend({itemSelector:function(){return".usercard"}}),exports.UsersToInviteFromContacts=exports.ContactImporterStep.extend({itemSelector:function(){return".invite_row"}});'),require.installLazy("app/view/notifications",'var Component=require("w2.quora").Component,fixable=require("view/fixable"),settings=require("settings"),W2=require("webnode2"),Home=require("app/view/home"),windowManager=require("window_manager"),toggle=require("view/toggle");exports.NewNotificationsTab=Home.HomeMain.extend({onLoad:function(){this._super.apply(this,arguments),fixable.makeFixable({element:this.$("#@notifications_heading"),width_dep:!0,height_dep:!0})}}),exports.NewNotification=Component.extend({onLoad:function(){this.actionBar&&(this.$("#@notification_action_bar a").click(this.fnbind(function(){this.$("#@notification_item_wrapper").hasClass("unseen")&&this.markAsSeen()})),this.$("#@content_toggle").click(this.fnbind(function(a){a.preventDefault(),this.$("#@notification_content").removeClass("hidden"),this.$("#@content_toggle").addClass("hidden")})))},markAsSeen:function(a){this.serverCall("mark_as_seen").liveMutate().send()}}),exports.AggregatedNotificationSectionCount=Component.extend({onLoad:function(){this.initState("expanded",!1),this.$("#@expand").click(this.fnbind(function(){return this.state("expanded",!this.state("expanded")),!1}))},stateHandlers:{expanded:function(a){var b=this.lookup("notif").lookup("list").$("#@notifs"),c=!b.hasClass("hidden");if(arguments.length<1)return c;b.toggleClass("hidden",!a)}}}),exports.NotificationsClearButton=Component.extend({onLoad:function(){this.$("#@clear").click(this.fnbind(function(){return this.serverCall("mark_as_seen").liveMutate().success(this.fnbind(function(a){a||this.clearNotifsNoDataCallback()})).send(),!1}))},clearNotifsNoDataCallback:function(){return}}),exports.NotificationsClearLink=exports.NotificationsClearButton.extend({onLoad:function(){this._super.apply(this,arguments),settings.new_grid||(this.homeNav=this.lookup("notif_menu").lookup("home_nav"))},clearNotifsNoDataCallback:function(){settings.new_grid||this.homeNav.doHide()}}),exports.NotificationPreview=Component.extend({onLoad:function(){this.$("#@details").click(this.fnbind(function(){return this.$("#@notification_details").toggleClass("hidden"),!1})),this.$("#@notification").click(this.fnbind(function(){return this.$("#@notification_diff").toggleClass("hidden"),this.$("#@notification, #@bullet").hide(),!1}))}}),exports.NotifHeaderBarButtons=toggle.ToggledComponent.extend({onLoad:function(){this._super.apply(this,arguments),this.locked=!1,$(document).keydown(this.fnbind(function(a){return this.docKeydown(a)}))},gotoNext:function(){this.next_url&&windowManager.navigateTo(this.next_url)},isLocked:function(){var a=!1;return $("input, textarea, .qtext_editor_content").each(function(){var b=$(this);if(b.attr("focused")=="true"||b.is(":focus"))return a=!0,!1}),this.locked||a},docKeydown:function(a){var b=a||window.event;if(this.isLocked())return!0;if(b.keyCode==39)return this.gotoNext(),!1}}),exports.NotifHeaderBarNextButton=Component.extend({onLoad:function(){$(document).keydown(this.fnbind(function(a){return this.docKeydown(a)}))},gotoNext:function(){var a=this.$("#@next_button .action_button").attr("href");windowManager.navigateTo(a)},isLocked:function(){var a=!1;return $("input, textarea, .qtext_editor_content").each(function(){var b=$(this);if(b.attr("focused")=="true"||b.is(":focus"))return a=!0,!1}),this.locked||a},docKeydown:function(a){var b=a||window.event;if(this.isLocked())return!0;if(b.keyCode==39)return this.gotoNext(),!1}}),exports.GrowlNotification=Component.extend({onUnload:function(){this.uninstallScrollHandlers()},onLoad:function(a){this.leftPositionSet=!1;var b=this.fnbind(function(){this.setPosition()});this.installScrollHandlers(this.setPosition),setTimeout(b,1);var c=this.age_us/1e3/1e3;if(!a){var d=this.extend_visibility?60:15;c<d&&this.show()}else{var e=this.extend_visibility?60:1.5;c<e&&this.showNow()}this.extend_visibility?this.startFade(6e4):(this.$("#@notif").mouseover(this.fnbind(function(a){clearTimeout(this._timeout);var b=this.$("#@notif");b.is(":animated")&&(b.stop(),b.css("opacity",100)),this.marked_as_read_sent||(W2.rpc("/notifications/mark_as_read_POST").kwargs({snid:this.snid}).send(),this.marked_as_read_sent=!0)})),this.$("#@notif").mouseout(this.fnbind(function(a){this.startFade(1e3)})),this.startFade(4e3))},setPosition:function(){var a=$(window).scrollTop(),b=$("#layout_header").outerHeight(),c=$(window).width(),d=this.$("#@notif").outerWidth(),e=this.$("#@notif").offset(),f=d+e.left;if(c<f){var g=f-c,h=e.left-(g+10);this.$("#@notif").css("left",h+"px"),this.$("#@notif .hover_menu_nub").css("backgroundPosition",g+20+"px top"),this.leftPositionSet=!0}else this.leftPositionSet||this.$("#@notif .hover_menu_nub").css("backgroundPosition","10px top")},show:function(){this.$("#@notif").fadeIn(1e3)},showNow:function(){this.$("#@notif").show()},startFade:function(a){clearTimeout(this._timeout),this._timeout=setTimeout(this.fnbind(function(){require("visibility").isVisible()?this.$("#@notif").fadeOut(1250):this.$("#@notif").hide()}),a)}});var growlIsVisible=!1;exports.GrowlNotificationNew=Component.extend({onLoad:function(a){this.notif=this.$("#@notif");var b=this.age_us/1e3/1e3;b<(this.extend_visibility?60:a?1.5:15)&&this.show(!a),this.extend_visibility?this.hideAfter(6e4):(this.notif.mouseover(this.fnbind(function(a){clearTimeout(this.hideTimer),this.notif.removeClass("fade_out"),this.marked_as_read_sent||(W2.rpc("/notifications/mark_as_read_POST").kwargs({snid:this.snid}).send(),this.marked_as_read_sent=!0)})),this.notif.mouseout(this.fnbind(function(a){this.hideAfter(1e3)})),this.hideAfter(4e3))},show:function(a){growlIsVisible&&(a=!1),growlIsVisible=!0,a&&this.notif.addClass("animate_in"),this.notif.removeClass("fade_out").removeClass("hidden"),a&&setTimeout(this.fnbind(function(){this.notif.removeClass("animate_in")}),200)},hideAfter:function(a){this.hideTimer=setTimeout(this.fnbind(function(){this.hide()}),a)},hide:function(){this.notif.addClass("fade_out"),setTimeout(this.fnbind(function(){this.notif.hasClass("fade_out")&&(this.notif.addClass("hidden").removeClass("fade_out"),growlIsVisible=!1)}),1250)}}),exports.TitleNotificationsCount=Component.extend({onLoad:function(a){a||this.setTitle()},setTitle:function(){var a=windowManager.getTitle(),b=a,c,d="",e;if(this.notif_count||this.inbox_count){d+="(";if(this.new_notifs){var f=this.notif_count+this.inbox_count;d+=f}else this.notif_count&&(d+=this.notif_count),this.inbox_count&&(d+="/"+this.inbox_count);d+=") "}b=a.replace(/^\\(((\\d+)?\\/)?\\d+\\) |/,d),a!=b&&windowManager.setTitle(b)}}),exports.NotificationsNav=Component.extend({onLoad:function(){fixable.makeFixable({element:this.$("#@notifications_nav .SimpleTabs"),width_dep:!0,height_dep:!0})}});'),require.installLazy("app/view/user",'var Component=require("w2.quora").Component,W2=require("webnode2"),InlineEditor=require("view/inline_editor").InlineEditor,windowManager=require("window_manager"),cookies=require("cookies"),fixable=require("view/fixable"),floatingVote=require("view/floating_voting_buttons");require("dialog"),exports.UserPage=Component.extend({onLoad:function(){this.installScrollHandlers(this.setPosition)},onUnload:function(){this.uninstallScrollHandlers()},setPosition:function(){var a=this,b=$(window).height(),c=200,d=$(".header").outerHeight()+7,e=39;clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout(this.fnbind(function(){var a=$(window).scrollTop();$(this.$("#@user_page").find(".profile_feed_item").get().reverse()).each(function(){var b=$(this).find(".rating_buttons_wrapper").eq(0);if(b.find(".rating_options").is(":visible")){var f=$(this).find(".profile_feed_item_content").eq(0).parent(),g=f.height();if(b.offset().top>a-c&&b.offset().top<a+c&&g>c){e=55;var h=-1;floatingVote.enableFloatingVotingButtons(a,b,f.offset().top,g,d,e,h)}else a<b.offset().top&&(b.removeClass("voting_buttons_fixed"),b.removeClass("voting_buttons_absolute"),b.removeAttr("style"))}})}),0)}}),exports.UserTopicSig=Component.extend({onLoad:function(){this.$("#@view").click(this.fnbind(function(){return this.toggleSuggestion(),!1}))},toggleSuggestion:function(){this.$("#@pending").toggle(),this.$("#@view").toggle()}}),exports.TopicSigEditor=Component.extend({onLoad:function(){var a=this.$("#@input"),b=a.val();a.focus(),a.val(""),a.val(b),this.$("#@submit").click(this.fnbind(function(){return this.clickSubmit(a),!1})),this.$("#@cancel").click(this.fnbind(function(){return this.clickCancel(),!1}))},clickSubmit:function(a){var b=this.$("#@checkbox").is(":checked");return this.serverCall("update_sig").kwargs({viewer:this.viewer,uid:this.uid,tid:this.tid,sig:a.val(),experienced:b}).liveMutate().send(),this.clickCancel(),!1},clickCancel:function(){return W2.Dialog.dialogFor(this).close_(),!1}}),exports.MultiTopicSigEditor=exports.TopicSigEditor.extend({clickCancel:function(){return this.parent().$("#@sig_editor_section").hide(),this.parent().$("#@sig_list_section").show(),!1}}),exports.SuggestedTopicSigEditor=Component.extend({onLoad:function(){var a=this.$("#@input"),b=a.val();a.focus(),a.val(""),a.val(b),this.$("#@submit").click(this.fnbind(function(){return this.clickSubmit(a),!1})),this.$("#@accept").click(this.fnbind(function(){return a.val()==b?this.clickAccept():this.clickSubmit(a),!1})),this.$("#@discard").click(this.fnbind(function(){return this.clickDiscard(),!1})),this.$("#@close").click(this.fnbind(function(){return this.clickClose(),!1}))},clickSubmit:function(a){var b=this.$("#@checkbox").is(":checked");return this.serverCall("update_sig").kwargs({viewer:this.viewer,uid:this.uid,tid:this.tid,sig:a.val(),experienced:b}).liveMutate().send(),this.clickClose(),!1},clickAccept:function(){var a=this.$("#@checkbox").is(":checked");return this.serverCall("accept").kwargs({uid:this.uid,to_uid:this.to_uid,tid:this.tid,experienced:a}).liveMutate().send(),this.clickClose(),!1},clickDiscard:function(){return this.serverCall("discard").kwargs({uid:this.uid,to_uid:this.to_uid,tid:this.tid}).liveMutate().send(),this.clickClose(),!1},clickClose:function(){return W2.Dialog._dialogCounter>0&&W2.Dialog.dialogFor(this).close_(),!1}}),exports.TopicSigEditLinkDialog=Component.extend({onLoad:function(){this.tooltip&&this.$("#@link").tooltip({contents:this.tooltip}),this.$("#@link").click(this.fnbind(function(){return this.showDialog(),!1}))},showDialog:function(){return this.dialog().opt("closeOnClickOut",!0).title(this.title).load("get_editor"),!1}}),exports.MultiTopicSigEditLink=Component.extend({onLoad:function(){var a=this.lookup("list");this.$("#@link").click(this.fnbind(function(){return this.serverCall("get_editor").contentFor(a.$("#@sig_editor_section"),{parentCID:a.cid}).success(this.fnbind(function(b){a.$("#@sig_editor_section").show()})).send(),a.$("#@sig_list_section").hide(),!1}))}}),exports.MultiTopicSigList=Component.extend({onLoad:function(){this.$("#@cancel").click(this.fnbind(function(){return W2.Dialog.dialogFor(this).close_(),!1}))}}),exports.ProfilePhoto=Component.extend({toggleSuggestion:function(){this.$("#@view_pending").toggle(),this.$("#@pending").toggle();var a=this.parent().$("#@user_action_link");$(this.$("#@pending")).is(":visible")?a.addClass("w1").removeClass("w1_5"):a.removeClass("w1").addClass("w1_5")}}),exports.ReportUser=Component.extend({onLoad:function(){this.$("#@report").click(this.fnbind(function(){return this.serverCall("report").send(),!1}))}}),exports.MuteUser=Component.extend({onLoad:function(){this.$("#@mute_user").click(this.fnbind(function(){return this.serverCall("mute").kwargs({object_id:this.object_id}).liveMutate().send(),!1}))}}),exports.UnmuteUser=Component.extend({onLoad:function(){this.$("#@unmute_user").click(this.fnbind(function(){return this.serverCall("unmute").kwargs({object_id:this.object_id}).liveMutate().send(),!1}))}}),exports.WantedAnswerDialog=Dialog.extend({onLoad:function(a){this._super.apply(this,arguments),this.child("question_selector").focus(),this.setSuccessCallback(this.fnbind(function(a){a&&windowManager.navigateTo(a)}))},getPars:function(){var a=this.child("question_selector").getQid(),b=this.child("question_selector").qValue;return{qid:a,text:b}}}),exports.UserFollowLink=Component.extend({onLoad:function(){this.$("#@follow_user").click(this.fnbind(function(a){this.follow(),a.preventDefault()})),this.$("#@unfollow_user").click(this.fnbind(function(a){this.unfollow(),a.preventDefault()}))},keyEvents:function(a){switch(a){case 70:return this.follow(),!1;case 78:return this.unfollow(),!1}},follow:function(){cookies.setQfeedLog(this,"UserFollow"),cookies.setQueryLog(this,"UserFollow"),cookies.setTlog({type:"UserFollow",uid:this.uid}),this.serverCall("follow_user").liveMutate().send()},unfollow:function(){this.serverCall("unfollow_user").liveMutate().send()}}),exports.EndorseUserLink=Component.extend({onLoad:function(a){this.show_tooltip&&this.$("#@endorse").tooltip({contents:"Endorse "+this.name+" on "+this.topic_name}),this.$("#@endorse").click(this.fnbind(function(){return this._request(),!1}))},_request:function(){this.serverCall("endorse_user").kwargs({to_uid:this.uid,tid:this.tid}).liveMutate().send()}}),exports.UnendorseUserLink=Component.extend({onLoad:function(){this.$("#@remove_endorse").click(this.fnbind(function(){return this.serverCall("remove_endorse_user").kwargs({enid:this.enid}).liveMutate().send(),!1}))}}),exports.UserTopicFinder=Component.extend({onLoad:function(a){this.$("#@link").click(this.fnbind(function(){return this.$("#@link").addClass("hidden"),this.$("#@topic_selector").removeClass("hidden"),this.lookup("selector").focus(),!1}))}}),exports.UserTopicStatsRow=Component.extend({onLoad:function(){this.$(".@view_more").click(this.fnbind(function(){return this.$("#@more").toggleClass("hidden"),!1}))}}),exports.UserTopicPromote=Component.extend({onLoad:function(a){this.$("#@add_featured_topic").tooltip({contents:"Move to Top"}),this.$("#@add_featured_topic").click(this.fnbind(function(){return this.serverCall("add_featured_topic").liveMutate().send(),!1})),this.$("#@remove_featured_topic").tooltip({contents:"Remove from Top"}),this.$("#@remove_featured_topic").click(this.fnbind(function(){return this.serverCall("remove_featured_topic").liveMutate().send(),!1}))}}),exports.NameInlineEditor=InlineEditor.extend({onLoad:function(){this._super.apply(this,arguments),windowManager.getHash().substr(0,9)=="#editname"&&this.toggle_editor()},_get_kwargs:function(){return{uid:this.id,input:this.get_value()}}}),exports.UserSig=Component.extend({onLoad:function(){this.$("#@view").click(this.fnbind(function(){return this.toggleSuggestion(),!1}))},toggleSuggestion:function(){this.$("#@pending").toggle(),this.$("#@view").toggle()}}),exports.BatchRevertControls=Component.extend({onLoad:function(){this.$("#@select_all_check").change(this.fnbind(function(a){return this.toggleCheckboxes(),!1})),this.$("#@select_all_word").click(this.fnbind(function(a){return this.toggleCheckboxes(),!1})),this.$("#@revert").click(this.fnbind(function(){return this.batchRevert(),!1}))},batchRevert:function(){var a=[];return this.$(".user_log_operations_to_revert input:checked").each(function(b){a.push($(this).attr("name"))}),a.length===0?!1:(this._dialog=this.dialog().title("Batch Revert Edits").cancel(null,"Cancel").ok(this.fnbind(function(b){var c=b.dialogComponent,d=c.lookup("editor");if(d.isEmpty())return;var e=d.serialize();this.serverCall("batch_revert").kwargs({revert_strings:a,comment:e}).liveMutate().send()})).load("batch_revert_dialog"),!1)},toggleCheckboxes:function(){var a=this.$(".user_log_operations_to_revert .pagedlist_hidden input:not(:disabled)").length,b=this.$(".user_log_operations_to_revert input:not(:disabled)").length-a,c=this.$(".user_log_operations_to_revert input:checked").length;b!=c?(this.$("#@select_all_check").attr("checked",!0),this.$("input:not(:disabled)").attr("checked",!0),this.$(".user_log_operations_to_revert .pagedlist_hidden input").each(function(a){$(this).attr("checked",!1)})):(this.$("#@select_all_check").attr("checked",!1),this.$("input:not(:disabled)").attr("checked",!1))},getKwargs:function(a,b){return{revert_strings:a,comment:b.serialize()}}}),exports.UserSigInlineEditor=InlineEditor.extend({onLoad:function(){this._super.apply(this,arguments);var a=this.fnbind(function(){var a=this.parent();return a&&a.toggleButtons&&a.toggleButtons(),!1});this.$("#@inline_editor_cancel").click(a),this.$("#@inline_editor_link").click(a)},submitHandler:function(){if(!this.shouldShowConfirmDialog)return this._super.apply(this,arguments);this.input_button_obj.click(this.fnbind(function(){return this.getEditor()&&this.isEditorEmpty()?!1:(this.showConfirmDialog(),!1)}))},showConfirmDialog:function(){var a="Your existing recognized topic biography will be temporarily removed while we review your updated biography.";this.dialog().title("Confirm New Biography Submission").cancel(null,"Cancel").ok(this.fnbind(function(){this.trigger_request()}),"Submit").html(a)}}),exports.NameConfirmationBanner=Component.extend({onLoad:function(){this.$("#@readonly").click(this.fnbind(function(){return this.serverCall("set_read_only").liveMutate().send(),!1}))}}),exports.UnconfirmedEmailBlockedEditor=Component.extend({onLoad:function(){this.$("#@resend").click(this.fnbind(function(){return this.serverCall("resend_email_confirmation").send(),!1}))}}),exports.ProfileStructuredTopicsSidebarWizard=Component.extend({onLoad:function(){var a=this;this.currStepIndex=0},clickNext:function(){this.currStepIndex==this.steps.length-1?this.completeWizard():(this.hideCurrStep(),this.showNextStep())},hideCurrStep:function(){var a=this.steps[this.currStepIndex];this.$("#"+a+"_topics").hide(),this.serverCall("mark_step_complete").kwargs({step:this.steps[this.currStepIndex]}).send()},showNextStep:function(){this.currStepIndex+=1;var a=this.steps[this.currStepIndex];this.$("#"+a+"_topics").fadeIn()},completeWizard:function(){this.$("#@profile_topic").hide(),this.$("#@subtitle").hide(),this.$("#@check").fadeIn(),this.$("#@completion_msg").fadeIn(),this.$("#@title").html("Profile Topics Added"),this.serverCall("mark_wizard_complete").send()}}),exports.ProfileStructuredTopicSidebarNextButton=Component.extend({onLoad:function(){var a=this;this.$("#@next").click(function(b){b.preventDefault(),a.lookup("topic_sidebar").lookup("wizard").clickNext()})}}),exports.EndorsementsSidebarWizard=Component.extend({onLoad:function(){var a=this;this.currTopicIndex=0,fixable.makeFixable({element:this.$("#@endorsements"),width_dep:!0,height_dep:!0,min_height:500})},clickNext:function(){this.currTopicIndex==this.typeTopicTuples.length-1?this.completeWizard():(this.hideCurrStep(),this.showNextStep())},hideCurrStep:function(){var a=this.currTopicIndex+1;this.$("#@endorsement_topics .endorsement_topic_sidebar_wrapper:nth-child("+a+")").hide(),this.serverCall("mark_topic_type_complete").kwargs({type:this.typeTopicTuples[this.currTopicIndex][0],tid:this.typeTopicTuples[this.currTopicIndex][1]}).send()},showNextStep:function(){this.currTopicIndex+=1;var a=this.currTopicIndex+1;this.$("#@endorsement_topics .endorsement_topic_sidebar_wrapper:nth-child("+a+")").fadeIn()},completeWizard:function(){this.$("#@endorsement_topics").hide(),this.$("#@completion_msg").fadeIn()}}),exports.EndorsementTopicSidebar=Component.extend({onLoad:function(){this.button=this.child("next_button").$("#@next"),this.selectAll=this.$("#@select_all"),this.selectAllText=this.$("#@select_all_text"),this.maxUids=this.suggestedUids.length,this.toUids=[],this.insertedUids=[];var a=this.$("#@users_list"),b=this.$("#@title");a.scroll(function(){a.scrollTop()>0?b.hasClass("has_shadow")||b.addClass("has_shadow"):b.hasClass("has_shadow")&&b.removeClass("has_shadow")}),this.$("#@select_all").click(this.fnbind(function(){this.$("#@select_all").hasClass("unchecked")?(a.find(".check_wrapper").removeClass("unchecked"),this.checkSelectAll(),this.promptNextButton(),this.toUids=this.suggestedUids.concat(this.insertedUids)):(a.find(".check_wrapper").addClass("unchecked"),this.uncheckSelectAll(),this.unpromptNextButton(),this.toUids=[])}));return},toggleUid:function(a){var b=!1,c=0;for(var d=0;d<this.toUids.length;d++)a==this.toUids[d]&&(b=!0,c=d);b?this.removeUid(c):this.addUid(a),this.checkButtonAndSelectAll()},addUid:function(a){this.toUids.push(a)},removeUid:function(a){this.toUids.splice(a,1)},addMultiEndorsements:function(){this.toUids.length>0&&this.serverCall("add_multi_endorsements").liveMutate().kwargs({to_uids:this.toUids}).success(this.fnbind(function(){return})).send()},setTo:function(a){var b=!1;for(var c=0;c<this.toUids.length;c++)a==this.toUids[c]&&(b=!0);b||this.addUserSuggestion(a)},addUserSuggestion:function(a){var b=this.checkUidList(a,this.insertedUids,"selection_wrapper",1),c=this.checkUidList(a,this.suggestedUids,"suggestion_wrapper",0);this.serverCall("add_user_suggestion").kwargs({uid:a,tid:this.tid,type:this.endorsement_type}).contentFor(this.$("#@selector_list").find(".selection_wrapper").eq(0),{parentCID:this.cid}).success(this.fnbind(function(){var d=$("<div/>").addClass("selection_wrapper");this.$("#@selector_list").prepend(d),b&&b.remove(),c&&c.remove(),this.addUid(a),this.insertedUids.unshift(a),this.maxUids=this.insertedUids.length+this.suggestedUids.length,this.checkButtonAndSelectAll()})).send()},checkButtonAndSelectAll:function(){this.toUids.length===0?(this.unpromptNextButton(),this.uncheckSelectAll()):(this.promptNextButton(),this.toUids.length==this.maxUids?this.checkSelectAll():this.uncheckSelectAll())},checkUidList:function(a,b,c,d){var e=!1,f=0;for(var g=0;g<b.length;g++)if(a==b[g]){e=!0,f=g;break}if(e){b.splice(f,1);var h=f+2;return this.$("#@users_list ."+c+":nth-child("+h+")")}return null},checkSelectAll:function(){this.selectAllText.html(this.maxUids+" People Selected"),this.selectAll.hasClass("unchecked")&&this.selectAll.removeClass("unchecked")},uncheckSelectAll:function(){this.selectAllText.html("Select Everyone"),this.selectAll.hasClass("unchecked")||this.selectAll.addClass("unchecked")},promptNextButton:function(){this.button.hasClass("submit_button")||this.button.addClass("submit_button")},unpromptNextButton:function(){this.button.hasClass("submit_button")&&this.button.removeClass("submit_button")}}),exports.EndorsementTopicSidebarNextButton=Component.extend({onLoad:function(){var a=this;this.$("#@next").click(function(b){b.preventDefault(),a.lookup("topic_sidebar").addMultiEndorsements(),a.lookup("topic_sidebar").lookup("wizard").clickNext()})}}),exports.EndorsementUserSuggestion=Component.extend({onLoad:function(){this.topicSidebar=this.lookup("topic_sidebar"),this.$("#@link").click(this.fnbind(function(a){this.onClick(),a.preventDefault()}))},onClick:function(){this.topicSidebar.toggleUid(this.toUid),this.$("#@link").toggleClass("unchecked")}});'
),require.installLazy("app/view/query",'var Component=require("w2.quora").Component,W2=require("webnode2"),toggle=require("view/toggle"),fixable=require("view/fixable"),alog=require("action_log"),settings=require("settings"),QueryResult=exports.QueryResult=alog.ActionableComponent.extend({onLoad:function(){this._super.apply(this,arguments),this.setDvar("query_id",this.query_id),this.setDvar("index",this.index);var a="_blank";this.compact&&(a="_parent"),this.$(\'#@title a[href!="#"], #@content a[href!="#"]\').attr("target",a),this.reportTidsToParent(),this.checkHighlight()},reportTidsToParent:function(){},navigateToObject:function(){var a=this.$("#@title a").attr("href");window.open(a,"_parent")},checkHighlight:function(){var a=this.$("#@title")[0],b=this.$("#@content")[0],c=a.innerHTML+b.innerHTML;c.indexOf("matched_term")<0&&this.serverCall("log_highlight_error").send()}});exports.QuestionQueryResult=QueryResult.extend({reportTidsToParent:function(){this.lookup("query_results").storeQuestionTids(this.tids)}}),exports.TopicQueryResult=QueryResult.extend({reportTidsToParent:function(){this.index==0&&this.lookup("query_results").storeHighlightedTid(this.object_id)}}),exports.QueryResultRankingMetadata=Component.extend({onLoad:function(){this.$("#@metadata").click(this.fnbind(function(){var a=this.$("#@metadata").parent().hasClass("expanded");this.$(".metadata").parent().removeClass("expanded"),a||this.$("#@metadata").parent().addClass("expanded")}))}}),exports.QueryResults=Component.extend({onLoad:function(a){this.storedResultTids=[],this.highlightedTid=null,this.haveUpdatedAddQuestionInSidebar=!1,this.$("#@request_reviews_link").click(this.fnbind(function(){return this.showDialog("request_reviews_dialog"),!1})),this.$("#@create_topic_link").click(this.fnbind(function(){return this.showDialog("create_topic_dialog"),!1}));var b=this.$("#@sidebar"),c={element:this.$("#@sidebar_add_question"),width_dep:!0,height_dep:!0,min_height:700};fixable.makeFixable(c)},showDialog:function(a,b){this._dialog=this.dialog().load(a,{kwargs:{tid:this.getPrimaryTid()}})},storeQuestionTids:function(a){this.storedResultTids=this.storedResultTids.concat(a),this.updateAddQuestionInSidebar()},storeHighlightedTid:function(a){this.highlightedTid||(this.highlightedTid=a),this.updateAddQuestionInSidebar()},updateAddQuestionInSidebar:function(){if(this.showing_add_question_in_sidebar&&!this.haveUpdatedAddQuestionInSidebar){var a=this.getPrimaryTid();this.lookup("add_question_simple").replaceContextEditor(a),this.haveUpdatedAddQuestionInSidebar=!0}},getPrimaryTid:function(){if(this.highlightedTid)return this.highlightedTid;var a=this.storedResultTids,b={};for(var c=0;c<a.length;c++){var d=a[c];b[d]?b[d]=b[d]+1:b[d]=1}var e=-1,f=-1;for(var g=0;g<a.length;g++){var d=a[g],h=b[d];h>f&&(e=d,f=h)}return f>=this.tid_prepopulate_threshold?e:null}}),exports.QueryResultContents=toggle.SwitchableComponent.extend({onLoad:function(){this.contentExpanded=!1,settings.new_grid?this.qtext=this.$("#@truncated .truncated_q_text"):this.qtext=this.$("#@truncated .expandable_qtext"),this.qtext.click(this.fnbind(function(a){var b=this.child("snippet").child("click_switch").$("#@switch_link");this.contentExpanded||(this.contentExpanded=!0,b.click()),a.preventDefault()})),this.compact&&this.child("click_switch").$("#@switch_link").click(this.fnbind(function(){return this.parent().navigateToObject(),e.preventDefault(),!1}))},switchAction:function(){this.$("#@truncated").addClass("hidden"),this.$("#@expanded").removeClass("hidden")}});'),require.installLazy("app/view/suggestions",'var Component=require("w2.quora").Component,alog=require("action_log");exports.SuggestionsSidebarRefreshButton=Component.extend({onLoad:function(){var a=this;a.$(".SuggestionsSidebarRefreshButton").click(a.fnbind(function(){$(".FollowSuggestionCard").fadeOut(),a.serverCall("refresh_suggestions").liveMutate().send()}))}}),exports.FollowSuggestionCard=alog.ActionableComponent.extend({onLoad:function(){this._super.apply(this,arguments);var a=this,b=!1,c=a.$("#@actionable").parent();c.mouseleave(a.fnbind(function(){b==1&&(c.fadeOut(),a.serverCall("follow").liveMutate().send())})),a.$("#@follow").click(a.fnbind(function(){a.$("#@follow, #@unfollow").toggle(),b=!0})),a.$("#@unfollow").click(a.fnbind(function(){a.$("#@follow, #@unfollow").toggle(),b=!1})),a.$("#@reject").click(a.fnbind(function(){return c.fadeOut(),a.serverCall("reject_suggestion").liveMutate().send(),!1}))}});'),require.installLazy("pinterest",'function onInit(a){initialized?a():asyncInit(a)}var W2=require("webnode2"),Component=require("w2.quora").Component,windowManager=require("window_manager"),initialized=!1,initEventHost={},asyncInit=exports.asyncInit=function(a){require("win.load").add(function(){(function(b){var c=b.getElementsByTagName("SCRIPT")[0],d=b.createElement("SCRIPT");d.type="text/javascript",d.async=!0,d.src="//assets.pinterest.com/js/pinit.js",c.parentNode.insertBefore(d,c),initialized=!0,a&&a()})(document)})};exports.ShareSectionPinterestPinButton=Component.extend({onLoad:function(){var a=this;onInit(function(){a.$("#@pinterest_pin").click(function(){a.serverCall("record_pin").kwargs({url:window.location.href}).send()})})}});'),require.install("app/view/user_stats",function(require,a,b){var c=require("webnode2"),d=require("event"),e=d.add,f=d.remove,g=require("w2.quora").Component,h=require("window_manager");a.RSGraph=g.extend({onLoad:function(){var a=new Rickshaw.Color.Palette({scheme:this.colors});for(var b in this.data_json)this.data_json[b].color=a.color();var c=new Rickshaw.Graph({element:this.$("#@rsgraph").get(0),series:this.data_json,width:this.width,height:this.height,renderer:"bar",stroke:!0,min:this.min,max:this.max,xmin:this.xmin,xmax:this.xmax,interpolation:"step-after"});c.render();var d=new Rickshaw.Graph.Axis.Y({graph:c,tickFormat:this.ypercent?function(a){return(a*100).toFixed(1)+"%"}:null});d.render();var e=new Rickshaw.Graph.Axis.Time({graph:c});e.render();var f=new Rickshaw.Graph.HoverDetail({graph:c})}}),a.StatsMain=g.extend({updateChildren:function(){this.child("graphs_section").updateGraphs(this.content_type,this.interval_type,this.oid)},updateAttributes:function(a){var b=!1;if("interval_type"in a&&this.interval_type!=a.interval_type){this.interval_type=a.interval_type,b=!0;var c=null;this.child("content_list").updateTopContentList(c,this.interval_type);var d=this.$(".content_item"),e=this.$(".content_item")[0];$(e).hasClass("active")||(d.removeClass("active"),$(e).addClass("active"));var f=this.$(".heads_up_item:first-child");f.hasClass("active")||(this.$(".heads_up_item.active").removeClass("active"),f.addClass("active"),this.lookup("graphs_section").active_metric=2)}"content_type"in a&&this.content_type!=a.content_type&&(this.content_type=a.content_type,b=!0),"oid"in a&&this.oid!=a.oid&&(this.oid=a.oid,b=!0),b&&this.updateChildren()}}),a.ContentList=g.extend({updateTopContentList:function(a,b){this.serverCall("render_new_top_content_list").args(a,b).contentFor(this.$("#@top_content_list"),{parentCID:this.cid}).send()}}),a.ContentListItem=g.extend({onLoad:function(){this.$("#@link").click(this.fnbind(function(a){this.lookup("stats_main").updateAttributes({content_type:this.content_type,oid:this.oid})})),this.registerClickHandler()},registerClickHandler:function(){var a=this,b=this.parent().$(".heads_up_item:first-child");this.$("#@link").click(function(c){var d=$(this);d.hasClass("active")||(a.$(".active").removeClass("active"),d.addClass("active")),b.addClass("active"),a.lookup("graphs_section").active_metric=2})}}),a.StatsHeader=g.extend({onLoad:function(){this.intervals.forEach(this.fnbind(function(a){var b="#@"+a;this.child("interval_tabs").$(b).click(this.fnbind(function(b){this.lookup("stats_main").updateAttributes({interval_type:a,content_type:null,oid:null});var c=$(b.target).parent(".tab");c.hasClass("first")||(c.siblings(".first").removeClass("first"),c.addClass("first"))}))}))}}),a.Graphs=g.extend({onLoad:function(){this.metrics.forEach(this.fnbind(function(a){this.child("headsup_section").$("#@"+a).click(this.fnbind(function(b){var c=$(b.target);return c.hasClass("heads_up_item")||(c=c.parents(".heads_up_item")),c.hasClass("active")||(c.siblings(".active").removeClass("active"),c.addClass("active")),this.active_metric!=a&&(this.$(".stats_graph").hide(),this.child("stats_graphs").$("#@graph_"+a).fadeIn(500),this.active_metric=a),b.preventDefault(),!1}))}))},updateGraphs:function(a,b,c){this.serverCall("render_new_graphs").args(a,b,c).contentFor(this.$("#@graphs"),{parentCID:this.cid}).send(),this.serverCall("get_new_counts").args(a,b,c).success(this.fnbind(function(a){a.forEach(this.fnbind(function(a){a[1]===null?this.child("headsup_section").$("#@"+a[0]).hide():(this.child("headsup_section").$("#@"+a[0]).show(),this.child("headsup_section").$("#@"+a[0]+">.big_num").text(a[1]))}))})).send()}})}),require.install("app/view/user_content",function(require,a,b){var c=require("webnode2"),d=require("event"),e=d.add,f=d.remove,g=require("w2.quora").Component,h=require("window_manager");a.UserContentMain=g.extend({onLoad:function(){this.$("#@toggle_filters").click(this.fnbind(function(){return this.$("#@filters").toggle(),!1}))},getUrlVars:function(){var a={},b=window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(b,c,d){a[c]=d});return a},updateDataAndReloadList:function(a,b){var c=this.getUrlVars();c[a]=b;for(var d in c)c[d]===null&&delete c[d];var e=$.param(c);window.location=window.location.pathname+"?"+e}}),a.UserContentFilter=g.extend({onLoad:function(){this.configureLinks()},configureLinks:function(){var a=this,b=this.$("#@filter_links a");this.$("#@filter_links a").click(function(){var b=$(this);if(b.hasClass("selected"))return!1;var c=b.attr("value");return a.lookup("user_content_main").updateDataAndReloadList(a.data_key,c),!1})}}),a.UserContentFilterTopics=a.UserContentFilter.extend({configureLinks:function(){this.$("#@all_topics").click(this.fnbind(function(){return this.$("#@all_topics").hasClass("selected")||this.clearChosenTopic(),!1})),this.$("#@remove_chosen_topic").click(this.fnbind(function(){return this.clearChosenTopic(),!1}))},clearChosenTopic:function(){this.lookup("user_content_main").updateDataAndReloadList(this.data_key,null)},tempTopicChosen:function(a,b){this.$("#@chosen_topic").text(b),this.$("#@chosen_topic_link_row").show(),this.$("#@topic_selector_row").hide(),this.$("#@all_topics").removeClass("selected"),this.lookup("user_content_main").updateDataAndReloadList(this.data_key,a)}})}),require.installLazy("app/view/livenode_log",'var Component=require("w2.quora").Component,inspector=require("w2.inspector"),w2=require("webnode2"),liveNodeRideAlong;require("keystrokes").on([76,48,76,48],function(){liveNodeRideAlong&&liveNodeRideAlong.toggle()}),exports.LiveNodeLog=Component.extend({onLoad:function(){var a=this;liveNodeRideAlong=a,$(document).bind("livenode_op_start",this.fnbind(function(a,b){this.handleLivenodeOpStart(a,b)})),$(document).bind("rpc_content_for_done",this.fnbind(function(a,b){this.handleRpcContentForDone(a,b)}))},addErrorsToLog:function(a){console.log("ERROR: ",a)},addToLog:function(a,b,c,d,e){var f=$("<div></div>").addClass("livenode_log_item");f.append("<span style=\'width:100px; display:inline-block;\'>"+a+"</span>");var g="<span style=\'width:600px; display:inline-block;\'>";for(var h=0;h<b.dirtied_depkeys.length;h++){var i=b.dirtied_depkeys[h],j=w2._debugInfo[b.cid].live_id,k=document.location.href+"?__break_depkey_token="+w2._depKeysBreakpointTokens[j+":"+i];g+="<a href=\'"+k+"\' target=\'_blank\'> "+i+" </a>"}g+="</span>",f.append(g),f.append("<span style=\'width:200px; display:inline-block;\'>"+b.cid+"</span>"),(c.oldHTML||c.newHTML)&&f.append("<div></div>"),c.oldHTML&&f.append("<span class=\'inner\' style=\'display:inline\'>&ominus;</span><div class=\'inner\'>&ominus; Old content:</div><div class=\'inner livenode_inner_html\'>"+c.oldHTML+"</div>"),c.newHTML&&f.append("<span class=\'inner\' style=\'display:inline\'>&oplus;</span><div class=\'inner hidden\'>&oplus; New content:</div><div class=\'inner livenode_inner_html\'>"+c.newHTML+"</div>"),f.click(function(a){f.children(".inner").toggle()}),this.$("#@tablearea").prepend(f),f.effect("highlight",{},2e3)},handleRpcContentForDone:function(a,b){var c=b.opts,d=b.value,b={};b.cid=c.parentCID,b.dirtied_depkeys=[],this.addToLog("contentFor",b,{newHTML:d.html})},handleLivenodeOpStart:function(a,b){var c;if(b.type=="set_node"){var d=$("#"+b.domid);if(!d.length){c={type:"set_node_el_domid_missing",domid:b.domid,cid:b.cid},addErrorsToLog([c]);return}var e={};e.domid=b.domid,e.liveid=b.liveid,e.dirtied_depkeys=b.dirtied_depkeys,e.cid=b.cid;var f=d.html(),g=b.content.html;this.addToLog("set",e,{oldHTML:f,newHTML:g})}else if(b.type=="insert_node"){var e={};e.domid=b.domid,e.cid=$(document.getElementById(b.domid)).attr(inspector.getAnnotationAttr()),e.liveid=b.liveid,e.position=b.position,e.dirtied_depkeys=b.dirtied_depkeys;var g=b.content.html;this.addToLog("insert",e,{newHTML:g})}else if(b.type=="delete_node"){var e={};e.domid=b.domid,e.child_domid=b.child_domid,e.child_cid=b.child_cid,e.position=b.position,e.liveid=b.liveid,e.dirtied_depkeys=b.dirtied_depkeys;var h=document.getElementById(b.domid);if(!h){c={type:"delete_node_parent_el_domid_missing",op_domid:b.domid,op_child_domid:b.child_domid,op_child_cid:b.child_cid},this.addErrorsToLog([c]);return}var i=h.childNodes[b.position];if(i.id!=b.child_domid){c={type:"delete_node_child_domid_mismatch",op_child_domid:b.child_domid,node_domid:i.id,op_child_cid:b.child_cid},this.addErrorsToLog([c]);return}var d=$("#"+b.child_domid);if(!d.length){c={type:"delete_node_child_el_domid_missing",op_child_domid:b.child_domid,op_child_cid:b.child_cid},this.addErrorsToLog([c]);return}var f=d.html();this.addToLog("delete",e,{oldHTML:f})}},toggle:function(){this.$("#@wrapper").hasClass("hidden")?this.turnOn():this.turnOff()},turnOn:function(){this.$("#@wrapper").removeClass("hidden")},turnOff:function(){this.$("#@wrapper").addClass("hidden")},slideOut:function(){if(!this.hovering){var a=this.$("#@wrapper"),b=parseInt(a.css("padding"));a.animate({right:b-a.width()+50+"px"})}},slideIn:function(){this.$("#@wrapper").animate({right:"0px"})}});'),require.install("app/view/layout/site_header",function(require,a,b){var c=require("w2.quora").Component,d=require("webnode2"),e=require("window_manager"),f=require("view/hover_menu"),g=require("cookies");a.SiteHeader=c.extend({shortcuts:{"g h":"/","g m":"/messages","g n":"/notifications","g q":"/questions","g o":"/open_questions","g p":"/posts"},onLoad:function(){for(var a in this.shortcuts)this.onKeyCombination(document.body,a,e.navigateTo.bind(e,this.shortcuts[a]))}}),a.NotifsNavItemBase=f.HoverMenu.extend({isInvalidCloseTarget:function(a){var b=this.$("#@link"),c=this.$(".SiteHeaderHoverMenuContents");return a.is(b)||a.parents(b).is(b)||a.is(c)||a.parents(c).is(c)?!0:!1},doShow:function(){this._super.apply(this,arguments);var a=this;if(this.newNotifs){var b=this.cQuery(":notifs_hover_menu_contents"),c=b.cQuery(":notifications_dropdown").$("#@dropdown"),d=b.$("#@hover_menu_header_link");this.serverCall("clear_new").send(),c.scroll(function(){c.scrollTop()>0?d.addClass("has_shadow"):d.removeClass("has_shadow")})}}}),a.MobileSiteLink=c.extend({onLoad:function(){this.$("#@mobile_link").click(this.fnbind(function(a){return g.cookie("m","1"),location.reload(!0),!1}))}}),a.NewGridWhiteHeaderSwitcher=c.extend({onLoad:function(){var a=this.$(".NewGridWhiteHeaderSwitcher input");this.$(".NewGridWhiteHeaderSwitcher").click(function(){$(".SiteHeader").toggleClass("white"),a.prop("checked",!a.prop("checked"))})}})}),require.installLazy("app/view/intro_to_quora",'var W2=require("webnode2"),Component=require("w2.quora").Component,throttleInstructionsRate=3,UpvoteInstruction=exports.UpvoteInstruction=Component.extend({onLoad:function(){var a=this;a.upvoteInstruction=a.$("#@upvote_instruction"),a.truncatedText=a.lookup("item").$("#@item").find(".truncated_q_text"),a.expanded=!1,a.rateLimitMs=500,a.scrollOffset=100,a.$("#@close").click(function(b){a.$("#@upvote_instruction").hide(),b.preventDefault()}),a.lookup("item").$("#@item").find(".more_link").length&&a.truncatedText.one("click",a.fnbind(a.onExpanded))},onExpanded:function(){var a=this;if(UpvoteInstruction.upvoted||a.expanded||!a.throttleInstructions())return;a.expanded=!0,a.currentPosition=$(window).scrollTop(),a.lastCheckTime=0,a.installScrollHandlers(a.scrollHandler)},throttleInstructions:function(){var a=this;typeof UpvoteInstruction.numExpanded=="undefined"&&(UpvoteInstruction.numExpanded=0),a.truncatedText.unbind("click",a.onExpanded);var b=UpvoteInstruction.numExpanded%throttleInstructionsRate===0;return UpvoteInstruction.numExpanded+=1,b},scrollHandler:function(){var a=this,b=+(new Date);if(b<a.lastCheckTime+a.rateLimitMs)return;a.lastCheckTime=b,typeof a.expandedText=="undefined"&&(a.expandedText=a.lookup("item").$("#@item").find(".expanded_q_text")),a.scrollLength=a.expandedText.height()-a.scrollOffset,a.currentPosition+a.scrollLength<$(window).scrollTop()&&(a.upvoteInstruction.fadeIn(100),a.recordSteps(["upvote_step_impr","upvote_step_impr_repeated"]),this.uninstallScrollHandlers())},recordSteps:function(a){this.serverCall("record_step").kwargs({uid:this.uid,steps:a}).send()},onUnload:function(){this.uninstallScrollHandlers(),this.$("#@close").unbind("click")},nextStep:function(){var a=this;this.$("#@instructional_text_part_1").hide(),this.$("#@instructional_text_part_2").show(),this.$("#@instructional_text_header_part_1").hide(),this.$("#@instructional_text_header_part_2").show(),a.serverCall("upvoted").kwargs({uid:a.uid}).success(function(){UpvoteInstruction.upvoted=!0}).send(),window.setTimeout(function(){a.upvoteInstruction.fadeOut(400)},8e3)}});'),require.enqueue(function(require){require("json2"),require("assert"),require("jquery"),require("jquery.securepost"),require("jquery.cookie"),require("jquery.dialog"),require("jquery.tooltip"),require("jquery.menu"),require("jquery.topic"),require("jquery.viewport"),require("spin"),require("jquery.whenIdle"),require("Class"),require("jquery.ajax"),require("effects.core"),require("effects.shake"),require("effects.highlight"),require("jquery.webnode2"),require("jquery.quora"),require("polyfills/requestAnimationFrame"),require("w2.errors"),require("w2.dialog"),require("w2.inputvalidate"),require("w2.rpc"),require("w2.interaction"),require("w2.quora"),require("tchannel_up"),require("app/view/board/settings"),require("app/view/question/question_alias"),require("app/view/report"),require("app/view/user/profile"),require("app/view/question/not_helpful"),require("view/filterable_list"),require("view/upload"),require("app/view/board/submission"),require("app/view/contact_browser"),require("view/announcement"),require("app/view/login"),require("app/view/question/suggested_answer"),require("app/view/photo"),require("app/view/beta"),require("app/view/board/dialog"),require("app/view/thanks"),require("app/view/tumblr"),require("app/view/question/talk_page"),require("app/view/related"),require("app/view/topic/top_answerers"),require("app/view/comment"),require("app/view/instructions_wiki"),require("view/datetime_"),require("app/view/suggested_questions"),require("app/view/topic/topic_editor"),require("app/view/oauth"),require("app/view/linkedin_"),require("view/swf"),require("view/invisibleinfo"),require("app/view/topic_tagger"),require("app/view/announcement"),require("app/view/board/view_tracker"),require("view/board_selector"),require("view/user"),require("app/view/review_topics"),require("view/object_browser"),require("view/hover_menu"),require("app/view/layout"),require("app/view/social"),require("app/view/read_later"),require("app/view/syndicate"),require("app/view/review"),require("view/qtext_editor"),require("app/view/static"),require("app/view/answer_wiki"),require("view/suggested_edits"),require("app/view/question/move_answer"),require("app/view/shuffle"),require("app/view/topic/topic_create"),require("app/view/question/reviews"),require("app/view/suggested_sig"),require("view/photo"),require("app/view/question/add_answer"),require("app/view/review_answers"),require("app/view/post/post_distribution"),require("app/view/question/disclaimer"),require("app/view/question/question_redirect"),require("app/view/context"),require("app/view/components"),require("app/view/link"),require("app/view/home/home_invite"),require("app/view/board/item"),require("view/topic_selector"),require("app/view/pmsg/pmsg"),require("app/view/mobile_debug"),require("app/view/admin"),require("app/view/suggested_photo"),require("app/view/vc"),require("app/view/widgets"),require("app/view/question/answer_tag"),require("app/view/promote"),require("app/view/thread"),require("app/view/review_names"),require("app/view/topic/topic_ontology"),require("app/view/draft"),require("app/view/board/follow"),require("app/view/question/answer_flag"),require("view/mobile"),require("ytplayer"),require("view/notif"),require("init"),require("facebook"),require("twitter"),require("google_"),require("login"),require("window_manager"),require("dialog"),require("qtext"),require("qtexteditor"),require("typeahead"),require("mobile"),require("flash"),require("presence"),require("query_eval"),require("viz"),require("e2e"),require("view/voter_list"),require("keystrokes"),require("siteuri"),require("mobile_ride_along"),require("view/paged_list"),require("view/floating_voting_buttons"),require("app/view/share"),require("app/view/question/question_add"),require("app/view/question/fast_answers"),require("app/view/threaded_comments"),!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,window.log&&window.log.enabled&&window.log("main","main is loaded."),require("w2.timing").logTime("mainScriptEnd")});rec('package', 'Finish', 'main.js');