if(!window.PT){PT={}}PT.version=2;PT.define=function(e,g){var d,c,b,h=e.split("."),a=h.length,f=window.PT;for(d=0;d<a;d+=1){c=h[d];b=f[c];if(!b){b=((d+1)===a)?g:{};f[c]=b}f=b}};PT.define("extend",function(c,a){var b;for(b in a){c[b]=a[b]}return c});PT.define("defineWidget",function(b,a,c){c.__hasRun=false;c.__name=b;c.__classname="pt-"+b.replace(/[A-Z]/g,function(d){return"-"+d.toLowerCase()});c.__attributes=a;if(!c.init){c.init=function(h,j){var f,d,g=this,e=0;if(this.__hasRun&&!j){return}this.__hasRun=true;PT.event.bind("dom.ready",function(){d=PT.dom.getElementsByClassName(g.__classname,h);if(g.__beforeInit&&d.length){g.__beforeInit()}PT.util.each(d,function(){var k=this,i={};PT.util.each(a,function(){i[this]=k.getAttribute("data-"+this)});g.__render&&g.__render(this,i,e);e+=1});if(g.__afterInit&&d.length){g.__afterInit()}})}}PT.define("widget."+b,c)});PT.define("animate",{css:function(i,j,g,a){var l,c,h,f,d,m,e,k={},b={};for(l in j){k=parseInt(i.style[l],10);h=parseInt(j[l],10);f=h-k;d=f/g;b[l]={origin:k,end:h,difference:f,current:k,step:d}}m=function(){var n;for(n in b){b[n].current+=b[n].step;i.style[n]=Math.ceil(b[n].current)+"px";if(b[n].difference<0){e=b[n].current<b[n].end}else{e=b[n].current>b[n].end}if(e){clearInterval(c);a&&a()}}};c=window.setInterval(m,1)},transition:function(d,c,g,a,f){var b,e=[];f=f||"";if(typeof c==="object"){for(b in c){e.push(b)}}if(typeof c==="string"){e=[c]}this.cssTransition(d,e.join(", ")+" "+g+"ms "+f);if(typeof c==="object"){PT.dom.css(d,c)}if(a){window.setTimeout(function(){a()},g)}},cssTransition:function(a,b){a.style.webkitTransition=b;a.style.MozTransition=b;a.style.oTransition=b;a.style.msTransition=b;a.style.transition=b;return a}});PT.define("api",{propagate:{},_propagate_cookies:["__ptut"],_callbacks:{},cache:{},triggered:{},jsonp:function(f,j,a,e,i,g){var h=document.createElement("script"),b="s"+parseInt(Math.random()*40000000,10),c,d;d=f.search("punchtab.com")>=0||f.search("127.0.0.1")>=0;e.method=a;e.callback="PT.api._callbacks."+b;c=f+j+"?"+PT.serializer.qsEncode(e);PT.api._callbacks[b]=function(k){if(d){if(!k.status){g&&g(k.data)}else{i&&i(k.data)}}else{i&&i(k)}delete PT.api._callbacks[b];h.parentNode.removeChild(h)};h.src=c;document.getElementsByTagName("head")[0].appendChild(h)},call:function(e,d){var b,a,c;b={data:d.data||{},method:d.method||"get",success:d.success,error:d.error,domain:d.domain||PT.domain.api,ajax:d.ajax||false,dataType:d.dataType};b.method=b.method.toLowerCase();c=document.referrer;a="";if(PT.option.internal){b.ajax=true;if(PT.option.internal.referrer!==false){c=document.location.protocol+"//"+PT.option.domain}b.domain=d.domain||PT.domain.legacy_api}if(b.data.installation===undefined&&PT.option.installation){b.data.installation=PT.option.installation}if("post"==b.method){if(-1==e.search(/method=post/i)){if(-1==e.indexOf("?")){a="?"}else{a="&"}a+="method=post"}}if(PT.option&&PT.option.key&&!b.data.key){b.data.key=PT.option.key}if(PT.user&&PT.user.accessToken&&!b.data.accessToken){b.data.token=PT.user.accessToken}if(PT.option&&PT.option.language&&!b.data.language){b.data.language=PT.option.language}PT.util.each(this._propagate_cookies,function(){if(PT.cookie.get(this)){b.data[this]=PT.cookie.get(this)}});for(key in this.propagate){b.data[key]=this.propagate[key]}if(b.ajax&&$&&$.ajax){$.ajax({url:b.domain+e+a,data:b.data,type:b.method,dataType:b.dataType,cache:false,beforeSend:function(f){f.setRequestHeader("X-Alt-Referer",c)},success:function(f){b.success&&b.success(f)},error:function(f){b.error&&b.error(f)}})}else{PT.api.jsonp(b.domain,e,b.method,b.data,b.success,b.error)}}});PT.define("auth",(function(k,l,f){var h={status:"disconnected"};function g(o){PT.connect.bind();o=o||{};for(var p in o){this[p]=o[p]}}g.prototype.authenticate=function(){throw new PT.error.NotImplementedError(this,"authenticate")};g.prototype.getLoginStatus=function(o){throw new PT.error.NotImplementedError(this,"getLoginStatus")};g.prototype.processResponse=function(o){PT.connect.triggerConnectState(PT.option.key,o)};g.prototype.logout=function(){var o=this;PT.sso.logout(function(p){o.processResponse(p)})};g.prototype.canAutoConnect=function(){return false};g.prototype.callbackOrProcess=function(p,o){if(p){p(o)}else{this.processResponse(o)}};function j(){g.apply(this,arguments)}j.prototype=Object.create(g.prototype);j.constructor=j;j.prototype.getLoginStatus=function(p){var o=this;PT.sso.getLoginStatus(function(q){if(q.authResponse){o.processResponse(q)}else{o.callbackOrProcess(p,q)}},{key:PT.option.key})};j.prototype.canAutoConnect=function(){return true};function i(){g.apply(this,arguments)}i.prototype=Object.create(g.prototype);i.constructor=j;i.prototype.processResponse=function(o){if(o.authResponse){o.authResponse.limited=true}var p=PT.cookie.get("pt_referrer_"+PT.option.key);PT.extend(o,{referrer:p});if(o.authResponse){PT.event.persistent("connect.connected",o,false,true)}else{PT.event.persistent("connect.disconnected",{referrer:p},false)}};function m(){g.apply(this,arguments);this.cookieName="pt_"+this.widgetName+this.widgetId;this.cookieExpiration=60}m.prototype=Object.create(g.prototype);m.prototype.constructor=m;m.prototype.getLoginStatus=function(q){var o=PT.cookie.get(this.cookieName),p=this;this.deleteCookie();if(o){this.processResponse({accessToken:o})}else{this.callbackOrProcess(q,h)}};m.prototype.createCookie=function(){PT.cookie.set(this.cookieName,PT.user.token,{expires:this.cookieExpiration})};m.prototype.deleteCookie=function(){PT.cookie.expire(this.cookieName)};function n(){j.apply(this,arguments)}n.prototype=Object.create(j.prototype);n.constructor=n;n.prototype.getLoginStatus=function(p){var o=this;j.prototype.getLoginStatus.call(this,function(){PT.event.bind("facebook.ready",function(){PT.sso.auto_login(function(q){if(q.authResponse){PT.sso.getLoginStatus(function(r){o.processResponse(r)},{key:PT.option.key})}else{o.callbackOrProcess(p,q)}},false)})})};n.prototype.getProvider=function(){return"facebook"};n.prototype.attachConnect=function(o,p){PT.platform.facebook.attachConnect(PT.dom.$(p||"pt-facebook-connect",o),{provider:this.getProvider(),scope:this.scope})};function a(){if(arguments.length===0||!arguments[0]||!arguments[0].facebookAppName){throw PT.error.MissingParameterError(this,"facebookAppName")}n.apply(this,arguments)}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;a.prototype.getProvider=function(){return"sso_facebook_"+this.facebookAppName};function e(){i.apply(this,arguments);this.lock=false}e.prototype=Object.create(i.prototype);e.prototype.constructor=e;e.prototype.allowProfile=function(){return false};e.prototype.getLoginStatus=function(o){this.callbackOrProcess(o,h)};e.prototype.attachConnect=function(o,s){var r=this,q=PT.dom.$(s||"pt-email-only",o),p=false;PT.dom.onsubmit(q,function(x){if(!p){var w,u,v=l.getElementsByTagName("input",q),t=l.getElementsByClassName("error",q);p=true;for(w=0,u=v.length;w<u;w+=1){PT.dom.removeClass(v[w],"required")}for(w=0,u=t.length;w<u;w+=1){t[w].style.display="none"}PT.api.call(q.getAttribute("action"),{method:"POST",data:x,success:function(y){var z,A,B,C;if(y.status){z=l.querySelector("input[name=email]",q).value;PT.sso.login("email_only",function(D){if(D.authResponse){PT.event.trigger("connect.sendToken",D.authResponse,false,false);r.processResponse(D);PT.user.name=PT.user.first_name=q.first_name?q.first_name.value:"";PT.user.last_name=q.last_name?q.last_name.value:"";PT.user.name=PT.user.first_name+" "+PT.user.last_name;PT.user.name=PT.user.name.replace(" ","")?PT.user.name:""}else{p=false;k.alert(PT.i18n.gettext("Oops something went wrong...If the problem persists, please contact support@punchtab.com"))}},{email:z,key:PT.option.key,domain:PT.option.domain})}else{p=false;for(B in y.error.fields){C=y.error.fields[B];PT.dom.addClass(l.querySelector("input[name="+B+"]",q),"required");l.querySelector("img[name="+B+"]",q).style.display="block"}}},error:function(y){if(y.status===403){var z=JSON.parse(y.responseText);k.alert(z.error);p=false}}})}})};function d(){g.apply(this,arguments);this.facebookAuth=new n(this.options);this.emailOnlyAuth=new e(this.options)}d.prototype=Object.create(g.prototype);d.prototype.constructor=d;d.prototype.canAutoConnect=function(){return this.facebookAuth.canAutoConnect()||this.emailOnlyAuth.canAutoConnect()};d.prototype.getLoginStatus=function(p){var o=this;this.facebookAuth.getLoginStatus(function(){o.emailOnlyAuth.getLoginStatus()})};d.prototype.attachConnect=function(o,p,q){this.facebookAuth.attachConnect(o,p);this.emailOnlyAuth.attachConnect(o,q)};function c(){i.apply(this,arguments)}c.prototype=Object.create(i.prototype);c.prototype.construtor=c;c.prototype.getLoginStatus=function(){this.processResponse({status:"connected",authResponse:{}});PT.user.first_name="Le";PT.user.last_name="Wolf";PT.user.name="Le Wolf"};var b={create:function(r,q){r=r.split("_");for(var p=0,o=r.length;p<o;p++){r[p]=r[p][0].toUpperCase()+r[p].slice(1,r[p].length)}return new PT.auth[r.join("")+"Auth"](q)}};return{FacebookAuth:n,FacebookSsoAuth:a,EmailOnlyAuth:e,FacebookEmailOnlyMixinAuth:d,CookieAuth:m,DummyAuth:c,Factory:b}})(window,document));PT.define("connect",{hasRun:false,isConnected:false,init:function(){if(this.hasRun){return}this.hasRun=true;var a,b=this,c={key:PT.option.key,version:1,language:PT.option.language};a=document.location.protocol+PT.domain.web+"/mast/connect2?"+PT.serializer.qsEncode(c);this.bind();PT.event.bind("connect.ready",function(h){var i,g,f,e,d;if(typeof _pt_pre_config!=="undefined"&&!PT.util.isEmpty(_pt_pre_config.auth_request)&&!PT.util.isEmpty(_pt_pre_config.signature)&&!PT.util.isEmpty(_pt_pre_config.timestamp)&&!PT.util.isEmpty(_pt_pre_config.client_id)){PT.event.trigger("connect.sso_params",_pt_pre_config)}b._triggerCheckLoginStatus();f=PT.cookie.get("pt_token_value");if(f!==undefined){e=PT.cookie.get("pt_token_expiry");if(e===undefined){e=14}PT.event.trigger("connect.sendToken",{token:f,expiry:e})}});PT.xdm.socket("connect",{remote:a,onReady:function(){PT.event.persistent("connect.ready")}})},_triggerCheckLoginStatus:function(a){if(PT.option.internal&&a){this.triggerConnectState(PT.option.key,a)}else{PT.event.trigger("connect.checkLoginStatus",a)}},triggerConnectState:function(c,a){var b;b=PT.cookie.get("pt_referrer_"+c);PT.extend(a,{referrer:b});if(a.authResponse){PT.event.persistent("connect.connected",a)}else{PT.event.persistent("connect.disconnected",{referrer:b})}},userConnected:function(a){PT.user.connect(a.authResponse.accessToken,a.authResponse.uid,a.authResponse.userID,a.authResponse.userID,a.referrer,a.authResponse.newUser||false,a.authResponse.forcePasswordChange)},userDisconnected:function(b){var a;if(b&&b.referrer){a=b.referrer}PT.user.disconnect(a)},bind:function(){PT.event.bind("connect.connected",this.userConnected);PT.event.bind("connect.disconnected",this.userDisconnected);PT.event.invalidate("connect.disconnected","connect.connected");PT.event.invalidate("connect.connected","connect.disconnected");PT.event.invalidate("user.disconnected","user.connected");PT.event.invalidate("user.connected","user.disconnected")},unbind:function(){PT.event.unbind("connect.connected",this.userConnected);PT.event.unbind("connect.disconnected",this.userDisconnected)}});PT.define("console",{log:function(){if(window.console&&window.console.log){var a=Array.prototype.slice.call(arguments);if(window.console.log.apply){window.console.log.apply(window.console,a)}else{window.console.log(a)}}},debug:function(){if(PT.option.debug){PT.console.log.apply(PT.console.log,Array.prototype.slice.call(arguments))}},debugBar:function(){if(!PT.option.debug){return}PT.event.bind("dom.ready",function(){var a=PT.dom.createElement("div",{position:"fixed",top:"10px",right:"10px",padding:"10px",borderRadius:"5px",boxShadow:"0 0 3px #CCC",width:"250px",backgroundColor:"#fff",fontFamily:"monospace"},"pt-debug-bar"),b=[PT.action];PT.util.each(b,function(){if(this._debug){var c=PT.dom.createElement("div");a.appendChild(this._debug(c))}});document.body.appendChild(a)})}});PT.define("cookie",{get:function(a){if(document.cookie!==this._cacheString){this._populateCache()}return this._cache[a]},defaults:{path:"/"},set:function(b,d,a){a={path:a&&a.path||this.defaults.path,domain:a&&a.domain||this.defaults.domain,expires:a&&a.expires||this.defaults.expires,secure:a&&a.secure!==undefined?a.secure:this.defaults.secure};if(d===undefined){a.expires=-1;d=""}switch(typeof a.expires){case"number":a.expires=new Date(new Date().getTime()+a.expires*1000);break;case"string":a.expires=new Date(a.expires);break}var c=encodeURIComponent(b)+"="+(d+"").replace(/[^!#-+\--:<-[\]-~]/g,encodeURIComponent);c+=a.path?";path="+a.path:"";c+=a.domain?";domain="+a.domain:"";c+=a.expires?";expires="+a.expires.toUTCString():"";c+=a.secure?";secure":"";document.cookie=c;return this},expire:function(b,a){return this.set(b,undefined,a)},_populateCache:function(){this._cache={};this._cacheString=document.cookie;var b,e,a,c,d=this._cacheString.split("; ");for(b=0;b<d.length;b+=1){e=d[b].indexOf("=");a=decodeURIComponent(d[b].substr(0,e));c=decodeURIComponent(d[b].substr(e+1));if(this._cache[a]===undefined){this._cache[a]=c}}}});PT.define("domain",{api:"//api.punchtab.com/api/v1",legacy_api:"//www.punchtab.com/api/v1",s_api:"//s.punchtab.com/api/v1",web:"//www.punchtab.com",css:"//s3.amazonaws.com/punchtab-static/",static_host:"//s3.amazonaws.com/punchtab-static/",cdn:"//d3brdqgnb3d1f5.cloudfront.net/",cookie:"."+("www.punchtab.com".split(":")[0]).split(".").slice(-2).join(".")});PT.define("dom",{hasRun:false,isReady:false,init:function(){var c,g,d=this,b;if(this.hasRun){return}this.hasRun=true;c=function(){d.isReady=true;PT.event.persistent("dom.ready",{},false)};b=function(){if(document.addEventListener){document.removeEventListener("DOMContentLoaded",b,false);c()}else{if(document.readyState==="complete"){document.detachEvent("onreadystatechange",b);c()}}};if(document.readyState==="complete"){window.setTimeout(c,1)}else{if(document.addEventListener){document.addEventListener("DOMContentLoaded",b,false);window.addEventListener("load",c,false)}else{document.attachEvent("onreadystatechange",b);window.attachEvent("onload",c);g=false;try{g=window.frameElement==null&&document.documentElement}catch(f){}if(g&&g.doScroll){(function a(){if(!d.isReady){try{g.doScroll("left")}catch(h){return setTimeout(a,50)}c()}})()}}}this._oldReady()},_oldReady:function(){var a=function(){PT.event.persistent("dom.ready",{},false)};if(document.readyState==="complete"||document.readyState=="loaded"||document.readyState=="interactive"){setTimeout(a,1)}else{if(document.addEventListener){document.addEventListener("DOMContentLoaded",a,false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",a)}}}},$:function(a){return document.getElementById(a)},getElementsByClassName:function(a,b){if(!b){b=document.body}if(b.getElementsByClassName){return b.getElementsByClassName(a)}else{return(function c(m,k){var h=[],g=k.getElementsByTagName("*"),d=g.length,l=new RegExp("(^|\\s)"+m+"(\\s|$)"),f,e;for(f=0,e=0;f<d;f+=1){if(l.test(g[f].className)){h[e]=g[f];e+=1}}return h}(a,b))}},getFirstElementByClassName:function(a,b){var c=this.getElementsByClassName(a,b);if(c.length){return c[0]}return null},eachElements:function(b,a,c){PT.util.each(this.getElementsByClassName(b,c),a)},createElement:function(a,e,c,b){e=e||{};var d=document.createElement(a);PT.dom.css(d,e);if(typeof c!=="undefined"){d.className=c}if(typeof b!=="undefined"){b.appendChild(d)}return d},removeChildren:function(a){while(a.firstChild){a.removeChild(a.firstChild)}},appendChildren:function(b,c){for(var a=0;a<c.length;a++){b.appendChild(c[a])}},css:function(c,b){var a;for(a in b){c.style[a]=b[a]}return c},cssTransform:function(a,b){a.style.webkitTransform=b;a.style.MozTransform=b;a.style.oTransform=b;a.style.msTransform=b;a.style.transform=b;return a},hasClass:function(b,a){var c=" "+a+" ";if((" "+b.className+" ").replace(/[\n\t\r]/g," ").indexOf(c)>-1){return true}return false},removeClass:function(a,b){if(this.hasClass(a,b)){a.className=a.className.replace(" "+b,"").replace(b,"")}},addClass:function(a,b){if(!this.hasClass(a,b)){a.className+=a.className===""?"":" ";a.className+=b}},insertCss:function(b){var c=document.getElementsByTagName("script")[0],a=document.createElement("style");a.type="text/css";if(a.styleSheet){a.styleSheet.cssText=b}else{a.appendChild(document.createTextNode(b))}c.parentNode.insertBefore(a,c);return c},getComputedStyle:function(c,b){var a;if(typeof(c.currentStyle)!="undefined"){a=c.currentStyle}else{a=document.defaultView.getComputedStyle(c,null)}return a[b]},defer:function(){var b=Array.prototype.slice.call(arguments),e=b.shift(),d,f,c,a;while(e){d=typeof e;if(d==="function"){f=e}else{if(d==="string"){a=e}}e=b.shift()}if(a){c=this.$(a)}else{c=document.body}if(c){f()}else{PT.event.bind("dom.ready",f)}},position:function(c){var b=0,a=0;while(c&&!isNaN(c.offsetLeft)&&!isNaN(c.offsetTop)){b+=c.offsetLeft-c.scrollLeft;a+=c.offsetTop-c.scrollTop;c=c.offsetParent}return{top:a,left:b}},serializeForm:function(a){var f,g,j,c,b={},d=a.getElementsByTagName("input"),h=a.getElementsByTagName("textarea"),e=a.getElementsByTagName("select");for(c=0;c<d.length;c+=1){f=d[c];if(f.type!=="submit"&&!f.disabled){if(f.type==="checkbox"){if(f.value&&f.value!=="on"){if(f.name in b){b[f.name]=[b[f.name]];if(f.checked){b[f.name].push(f.value)}}else{b[f.name]=f.value}}else{b[f.name]=f.checked}}else{if(f.type==="radio"){f.checked&&(b[f.name]=f.value)}else{if(!f.hasAttribute("placeholder")||f.getAttribute("placeholder")!==f.value){b[f.name]=f.value}}}}}for(c=0;c<h.length;c+=1){j=h[c];b[j.name]=j.innerHTML}for(c=0;c<e.length;c+=1){g=e[c];if(g.selectedIndex===-1){b[g.name]=g.value||""}else{b[g.name]=g.options[g.selectedIndex].value}}return b},onsubmit:function(b,c){var a=(typeof b==="string")?document.forms[b]:b;if(!a){return}a.onsubmit=function(){var d=PT.dom.serializeForm(a,c);try{c&&c.call(this,d)}catch(f){PT.console.log(f)}return false}},dataset:function(b){var a=/^data\-(.+)$/,c={};PT.util.each(b.attributes,function(){if(a.test(this.nodeName)){c[this.nodeName.match(a)[1]]=this.nodeValue}});return c},viewport:function(){var a,b=document.getElementsByTagName("meta");for(a=0;a<b.length;a+=1){if(b[a].getAttribute("name")==="viewport"){return b[a].getAttribute("content")}}return""},findParentByTag:function(b,a){while(b){if(b.tagName==a){return b}b=b.parentNode}return null}});PT.define("env",{init:function(a,b){this.name=a;this.type=b;var c=/xdm_e=/.test(document.location.search)?document.location.search:document.location.hash;if(self==window.top||!/xdm_p/.test(c)){this.type="parent"}this._common();if(this.type==="parent"){this._parent()}else{this._child()}PT.main.processAsyncQueue();return this},widgets:function(b){var a;PT.event.bind("env.ready",function(){var c;for(c=0;c<b.length;c+=1){a=b[c];if(PT.widget[a]){PT.widget[a].init()}}});return this},waitForWidgets:function(b,d){var c={};for(var a=0;a<b.length;++a){c[b[a]]=false}PT.event.bind("widget.initialized",function(f){var e=function(g){return g};if(c.hasOwnProperty(f)){c[f]=true;if(PT.util.every(c,e)){if(d){d()}PT.event.trigger("campaign.rendered")}}})},_triggerEnvReady:function(){PT.event.persistent("env.ready",{},false)},_parent:function(){PT.event.persistent("option.updated",PT.option);if(PT.option.hasBadge&&!PT.option.badge.disable){PT.badge.init()}this._triggerEnvReady();if(PT.source){PT.source.init()}PT.connect.init();if(PT.trigger){PT.trigger.init()}PT.referral.parentInit()},_child:function(){var a=this;PT.event.bind("option.updated",function(b){PT.option=PT.util.deepMerge(b,PT.option);a._triggerEnvReady()});PT.xdm.socket(this.name)},_common:function(){var a=this;PT.option.init();PT.dom.init();PT.event.bind("env.ready",function(){if(PT.option.hasLoyalty&&!PT.option.loyalty.disable){PT.loyalty.init(a.type)}});PT.user.bind();PT.connect.bind()}});PT.define("error",(function(d,a,e){function b(f,g){PT.console.log("["+this.name+"]",f,g,"NOT IMPLEMENTED")}b.prototype=Object.create(Error.prototype);b.constructor=b;b.prototype.name="NotImplementedError";function c(g,f){PT.console.log("["+this.name+"]",g,f,"IS REQUIRED")}c.prototype=Object.create(Error.prototype);c.constructor=c;c.prototype.name="MissingParameterError";return{NotImplementedError:b,MissingParameterError:c}})(window,document));PT.define("event",{bind:function(a,b){this._persistent=this._persistent||{};this._listeners=this._listeners||{};this._listeners[a]=this._listeners[a]||[];this._listeners[a].push(b);if(this._persistent[a]){b(this._persistent[a].response)}},unbind:function(b,e){var a,c;a=this._listeners[b];if(a){if(e){do{c=PT.util.indexOf(a,e);if(c>=0){this._listeners[b].splice(c,1)}}while(c>=0)}else{this._listeners[b]=[]}}},persistent:function(c,a,b,d){b=(b!==false);this.trigger(c,a,true,b,null,d)},invalidate:function(b,a){PT.event.bind(b,function(){PT.event._persistent[a]=false})},trigger:function(g,c,a,f,b,h){var e,d;if(typeof c==="undefined"){c={}}this._persistent=this._persistent||{};if(this._persistent[g]&&!h){return}if(g!=="all"){PT.console.debug("event: "+g,c,"\t("+(PT.env.name||document.location.pathname)+")")}this._listeners=this._listeners||{};e=this._listeners[g]||[];this._persistent[g]=(a!==undefined&&a!==false);if(this._persistent[g]){this._persistent[g]={response:c,persistent:a,propagation:f}}PT.util.each(e,function(){var i=this;setTimeout(function(){i(c)},1)});if(f!==false){this.trigger("all",{type:g,response:c,persistent:a,origin:b},false,false)}},forward:function(d,a,c){var b=this;this.bind(d,function(e){if(typeof c!=="undefined"){b.trigger(a,c)}else{b.trigger(a,e)}})},getHistory:function(){var c,a;c={};for(a in this._persistent){var b=this._persistent[a];if(b.propagation!==false){c[a]=b}}return c}});PT.define("i18n",{_init:false,language:{facebook:"en_US",locale:"en",language:"en"},activities:{},formats:{DATETIME_FORMAT:"N j, Y, P",DATE_FORMAT:"N j, Y",DECIMAL_SEPARATOR:".",MONTH_DAY_FORMAT:"F j",NUMBER_GROUPING:"3",TIME_FORMAT:"P",FIRST_DAY_OF_WEEK:"0",TIME_INPUT_FORMATS:["%H:%M:%S","%H:%M"],THOUSAND_SEPARATOR:",",DATE_INPUT_FORMATS:["%Y-%m-%d","%m/%d/%Y","%m/%d/%y"],YEAR_MONTH_FORMAT:"F Y",SHORT_DATE_FORMAT:"m/d/Y",SHORT_DATETIME_FORMAT:"m/d/Y P",DATETIME_INPUT_FORMATS:["%Y-%m-%d %H:%M:%S","%Y-%m-%d %H:%M","%Y-%m-%d","%m/%d/%Y %H:%M:%S","%m/%d/%Y %H:%M","%m/%d/%Y","%m/%d/%y %H:%M:%S","%m/%d/%y %H:%M","%m/%d/%y"]},initActivities:function(){if(this._init){return}this.activities.visit={name:this.gettext("visit"),reason:this.gettext("for visiting"),past:this.gettext("visited")};this.activities.comment={name:this.gettext("comment"),reason:this.gettext("for commenting"),past:this.gettext("commented")};this.activities.like={name:this.gettext("like"),reason:this.gettext("for liking"),past:this.gettext("liked")};this.activities.tweet={name:this.gettext("tweet"),reason:this.gettext("for tweeting"),past:this.gettext("tweeted")};this.activities.plusone={name:this.gettext("+1"),reason:this.gettext("for +1ing"),past:this.gettext("+1ed")};this.activities.apply={name:this.gettext("application"),reason:this.gettext("for applying"),past:this.gettext("applied")};this.activities.submit={name:this.gettext("submission"),reason:this.gettext("for submitting"),past:this.gettext("submitted")};this.activities.beingreferred={name:this.gettext("interest"),reason:this.gettext("for being referred"),past:this.gettext("was referred")};this.activities.donate={name:this.gettext("donation"),reason:this.gettext("for donating"),past:this.gettext("donated")};this.activities.checkin={name:this.gettext("checkin"),reason:this.gettext("for checking-in"),past:this.gettext("checked in")};this.activities.addtotimeline={name:this.gettext("add to timeline"),reason:this.gettext("for adding to timeline"),past:this.gettext("added to timeline")};this.activities.refer={name:this.gettext("refer"),reason:this.gettext("for referring"),past:this.gettext("referred")};this.activities.discover={name:this.gettext("discover"),reason:this.gettext("for discovering"),past:this.gettext("discovered")};this.activities.redeem={name:this.gettext("redeem"),reason:this.gettext("for redeeming"),past:this.gettext("redeemed")};this.activities.invite={name:this.gettext("invitation"),reason:this.gettext("for inviting"),past:this.gettext("invited")};this.activities.watch={name:this.gettext("watch"),reason:this.gettext("for watching"),past:this.gettext("watched")};this.activities.reply={name:this.gettext("reply"),reason:this.gettext("for replying"),past:this.gettext("replied")};this.activities.answer={name:this.gettext("answer"),reason:this.gettext("for answering"),past:this.gettext("answered")};this.activities.share={name:this.gettext("share"),reason:this.gettext("for sharing"),past:this.gettext("shared")};this.activities.purchase={name:this.gettext("purchase"),reason:this.gettext("for purchasing"),past:this.gettext("purchased")};this.activities.pin={name:this.gettext("pin"),reason:this.gettext("for pinning it"),past:this.gettext("pinned")};this.activities.search={name:this.gettext("search"),reason:this.gettext("for searching"),past:this.gettext("searched")};this.activities.download={name:this.gettext("download"),reason:this.gettext("for downloading"),past:this.gettext("downloaded")};this.activities.view={name:this.gettext("view"),reason:this.gettext("for viewing"),past:this.gettext("viewed")};this.activities.vote={name:this.gettext("vote"),reason:this.gettext("for voting"),past:this.gettext("voted")};this.activities.subscribe={name:this.gettext("subscription"),reason:this.gettext("for subscribing"),past:this.gettext("subscribed")};this.activities.follow={name:this.gettext("follow"),reason:this.gettext("for following"),past:this.gettext("followed")};this.activities.post={name:this.gettext("post"),reason:this.gettext("for posting"),past:this.gettext("posted")};this.activities.review={name:this.gettext("review"),reason:this.gettext("for reviewing"),past:this.gettext("reviewed")};this.activities.play={name:this.gettext("play"),reason:this.gettext("for playing"),past:this.gettext("played")};this.activities.ask={name:this.gettext("question"),reason:this.gettext("for asking"),past:this.gettext("asked")};this.activities.smile={name:this.gettext("smile"),reason:this.gettext("for smiling"),past:this.gettext("smiled")};this.activities.paint={name:this.gettext("paint"),reason:this.gettext("for painting"),past:this.gettext("painted")};this.activities.register={name:this.gettext("registration"),reason:this.gettext("for registering"),past:this.gettext("registered")};this.activities.login={name:this.gettext("login"),reason:this.gettext("for logging in"),past:this.gettext("logged in")};this.activities.birthday={name:this.gettext("info"),reason:this.gettext("for adding your birthday"),past:this.gettext("added your birthday")};this.activities.phone={name:this.gettext("digits"),reason:this.gettext("for adding your phone"),past:this.gettext("added your phone")};this.activities.gender={name:this.gettext("info"),reason:this.gettext("for adding your gender"),past:this.gettext("added your gender")};this.activities.email={name:this.gettext("email"),reason:this.gettext("for adding your email"),past:this.gettext("added your email")};this.activities.welcome={name:this.gettext("welcome"),reason:this.gettext("for joining"),past:this.gettext("joined")};this.activities.connect={name:this.gettext("connect"),reason:this.gettext("for connecting"),past:this.gettext("connected")};this.activities.redirect={name:this.gettext("redirect"),reason:this.gettext("for visiting"),past:this.gettext("visited")};this.activities.google_follow={name:this.gettext("google_follow"),reason:this.gettext("for following g+"),past:this.gettext("followed g+")};this.activities.poll={name:this.gettext("poll"),reason:this.gettext("for answering the poll"),past:this.gettext("submitted the poll")};this.activities.linkedin_follow={name:this.gettext("linkedin_follow"),reason:this.gettext("for following on Linkedin"),past:this.gettext("followed Linkedin")};this.activities.upload={name:this.gettext("upload"),reason:this.gettext("for uploading"),past:this.gettext("uploaded")};this.activities.earn={name:this.gettext("earn"),reason:this.gettext("for earning"),past:this.gettext("earned")};this.activities.quiz={name:this.gettext("quiz"),reason:this.gettext("for quiz"),past:this.gettext("took")};this.activities.submit_profile={name:this.gettext("submit profile"),reason:this.gettext("for submitting your profile"),past:this.gettext("submitted your profile")};this.activities.celebrate={name:this.gettext("celebrate"),reason:this.gettext("for celebrating"),past:this.gettext("submitted your profile")};this.activities.promote={name:this.gettext("promote"),reason:this.gettext("for promotions"),past:this.gettext("promoted")};this._init=true},getActivityName:function(a){this.initActivities();if(this.activities[a]){return this.activities[a].name}return a},getActivityReason:function(a){this.initActivities();if(this.activities[a]){return this.activities[a].reason}return a},getActivityPastTense:function(a){this.initActivities();if(this.activities[a]){return this.activities[a].past}return a},gettext:function(a){return a},ngettext:function(b,a,c){return(c==1)?b:a},gettext_noop:function(a){return a},pgettext:function(a,b){return b},npgettext:function(b,c,a,d){return(d==1)?c:a},pluralidx:function(a){return(a==1)?0:1},interpolate:function(b,c,a){if(a){return b.replace(/%\(\w+\)s/g,function(d){return String(c[d.slice(2,-2)])})}else{return b.replace(/%s/g,function(d){return String(c.shift())})}},get_format:function(a){var b=PT.i18n.formats[a];if(typeof(b)=="undefined"){return msgid}else{return b}}});PT.define("load",{stylesheet:function(a,d){var b=document.getElementsByTagName("head")[0],c=document.createElement("link");c.rel="stylesheet";c.type="text/css";c.href=a;if(d){if(typeof d==="string"){c.onload=function(){PT.event.persistent(d)}}else{c.onload=d}}b.parentNode.appendChild(c)},script:function(e,d){var c,f,b,a=new this.loader();for(c=0;c<e.length;c+=1){a.registerScript(e[c])}if(d){for(c=0;c<d.length;c+=1){f=d[c];b=f;if(typeof f==="string"){b=function(){PT.event.persistent(f)}}a.registerCallback(b)}}a.go()},loader:function(){this.counter=0;this.urls=[];this.callbacks=[];this.registerScript=function(a){this.counter+=1;this.urls.push(a)};this.registerCallback=function(a){this.callbacks.push(a)};this._scriptLoaded=function(){var a;this.counter-=1;if(this.counter===0&&this.callbacks.length){for(a=0;a<this.callbacks.length;a+=1){this.callbacks[a].call()}}};this._loadScript=function(b){var c,a,d;d=this;c=document.getElementsByTagName("head")[0];a=document.createElement("script");a.type="text/javascript";a.src=b;if(a.addEventListener){a.addEventListener("load",function(){d._scriptLoaded.apply(d)},false)}else{if(a.readyState){a.onreadystatechange=function(){if(this.readyState=="loaded"||this.readyState=="complete"){d._scriptLoaded.apply(d)}}}}c.appendChild(a)};this.go=function(){var a;for(a=0;a<this.urls.length;a+=1){this._loadScript(this.urls[a])}}}});PT.define("main",{processAsyncQueueHasRun:false,_trackHasRun:false,init:function(){var a;PT.reward_widget=function(b){PT.main.init()};a=PT.serializer.qsDecode(document.location.search);if(!this._trackHasRun&&!a.pt_disable){this._trackHasRun=true;PT.perf.track("pub",10,["dom.ready","user.connected","user.disconnected","loyalty.ready","badge.ready","activitystream.ready","mast.open","badge.open"])}PT.env.init("parent","parent")},processAsyncQueue:function(){var b,a;if(this.processAsyncQueueHasRun){return}this.processAsyncQueueHasRun=true;window.ptReady=window.ptReady||[];if(window.ptAsyncInit){window.ptReady.push(window.ptAsyncInit)}if(window.pbAsyncInit){window.ptReady.push(window.pbAsyncInit)}while(window.ptReady.length){a=window.ptReady.shift();a()}window.ptReady.push=function(c){c()}},triggerComment:function(a){PT.event.trigger("main.comment",a,false,false)}});PT.define("option",{hasLoyalty:false,hasBadge:false,key:undefined,language:"",domain:window.location.hostname,name:window.location.hostname,unbrand:undefined,triggers:false,challenges:false,whitelabel:undefined,internal:false,config:undefined,hasConfig:false,init:function(){var a,b;if(typeof _pt_config!=="undefined"){this.config=_pt_config;this.hasConfig=true;if(typeof this.config.global!=="undefined"){this.config.hasGlobal=true}if(typeof this.config.loyalty!=="undefined"){this.config.hasLoyalty=true}if(typeof this.config.achievement!=="undefined"){this.config.hasAchievement=true}}if(typeof _punchtab_settings!=="undefined"&&_punchtab_settings.key){this.hasLoyalty=true;this._copyGlobalOptions(_punchtab_settings);if(_punchtab_settings.bar||(this.hasConfig&&this.config.hasLoyalty&&this.config.loyalty.bar)){_punchtab_settings.bar=PT.util.merge(this.defaultBar,_punchtab_settings.bar);_punchtab_settings.notification=_punchtab_settings.notification||false;_punchtab_settings.earningmap=_punchtab_settings.earningmap||false}PT.option.loyalty=PT.util.merge(PT.option.loyalty,_punchtab_settings)}if(typeof reward_widget_options!=="undefined"&&reward_widget_options.key){this.hasLoyalty=true;this._copyGlobalOptions(reward_widget_options);PT.option.loyalty=PT.util.merge(PT.option.loyalty,reward_widget_options)}if(this.hasConfig&&this.config.hasGlobal){PT.option.product=this.config.product;this._copyGlobalOptions(this.config.global)}if(this.hasConfig&&this.config.hasLoyalty){this._overrideGlobalFromServer(this.config.loyalty);PT.option.loyalty=PT.util.merge(PT.option.loyalty,this.config.loyalty);if(typeof _punchtab_settings!=="undefined"){if(_punchtab_settings.bar||(this.hasConfig&&this.config.hasLoyalty&&this.config.loyalty.bar)){PT.option.loyalty.notification=false;PT.option.loyalty.earningmap=false}}}if(typeof _punchtab_settings_badges!=="undefined"&&_punchtab_settings_badges.key){this.hasBadge=true;this._copyGlobalOptions(_punchtab_settings_badges);PT.option.badge=PT.util.merge(PT.option.badge,_punchtab_settings_badges)}if(this.hasConfig&&this.config.hasAchievement){this._overrideGlobalFromServer(this.config.loyalty);PT.option.badge=PT.util.merge(PT.option.badge,this.config.achievement)}a=PT.serializer.qsDecode(document.location.search);if(a.pt_debug){PT.option.debug=true}if(a.pt_disable){PT.option.loyalty.disable=true;PT.option.badge.disable=true}if(a.pt_mastodon){PT.option.loyalty.mastodon=true}if(a.pt_open){PT.event.bind("loyalty.ready",function(){PT.event.trigger("mast.open",{panel:a.pt_open})})}if(PT.option.key!=="a348c2c4119e9a8bb92aea7d33e181c8"){PT.option.loyalty.mastodon=true}if(PT.option.key=="5af2bbff24b8d0aeed31322e9148c39c"||PT.option.key=="949af2876a115c469fdabcb8f5758f12"){PT.option.badge.disable=false}b=(/iphone|ipod|android|blackberry|mini|windows\sce|palm/i.test(navigator.userAgent.toLowerCase()));if(b){if(PT.option.hasLoyalty){if((PT.option.loyalty.display!=="inline"&&PT.option.loyalty.display!=="invisible")||PT.option.loyalty.mobile){if((PT.dom.viewport().indexOf("initial-scale=1")!==-1&&!PT.option.unbrand)||PT.option.loyalty.mobile){PT.option.loyalty.display="sidebar";PT.option.installation="mobile"}else{PT.option.loyalty.display="invisible"}}PT.option.loyalty.bar=false}if(PT.option.hasBadge){PT.option.badge.display="invisible"}}if(a.pt_sidebar){PT.option.loyalty.display="sidebar";PT.option.installation="mobile";PT.option.loyalty.bar=false}if(PT.option.hasLoyalty){if(PT.option.product==="other"){PT.option.loyalty.mast={overview:false,earning:false,leaderboard:false,catalog:true,};PT.option.loyalty.defaultearning=false}}},loyalty:{display:undefined,position:{x:"left",y:"bottom"},notification:true,activity:undefined,defaultearning:undefined,earningmap:true,bar:undefined,disable:undefined,learnMore:undefined},defaultBar:{width:undefined,align:undefined,notification:true,backgroundColor:"#434343",navBackgroundColor:"#2B2B2B",tweet:{text:document.title},url:document.location.href,pinterest:undefined,linkedin:undefined,media:undefined},badge:{display:undefined,position:{x:"left",y:"bottom"},notification:true,locked_image:PT.domain.cdn+"nd/images/badges/default/locked.png",disable:true,learnMore:undefined},_copyGlobalOptions:function(b){var c=this,a=["key","debug","language","domain","name","unbrand","internal","whitelabel","installation","triggers","widgets","challenges","product"];PT.util.each(a,function(){if(b[this]){c[this]=b[this]}});delete b.key;b.debug&&delete b.debug;if(b.domain){this.name=this.domain}},_overrideGlobalFromServer:function(a){if(a){if(a.displayName){this.name=a.displayName}}},bind:function(){var a=this;PT.event.bind("option.updated",function(b){PT.option=PT.util.merge(a,b)})}});PT.define("perf",{_events:[],_id:String(Math.random()).replace(".",""),_sendEnabled:undefined,_start:new Date().getTime(),_sentIdx:0,track:function(d,a,c){var b,f,e=this;PT.util.each(c,function(){e._bind(d,this.toString())});this._process(a)},_bind:function(b,a){var c=this;PT.event.bind(a,function(d){c._tick(b,a)})},_tick:function(b,d,f){var c,a,e=0;a=f||new Date().getTime();if(window.performance&&window.performance.timing&&window.performance.timing.navigationStart){e=a-window.performance.timing.navigationStart}c={name:d,time:a-this._start,global_time:e,ns:b};this._events.push(c)},_process:function(b){var a=this;b=b||10;window.setTimeout(function(){a._send();a._process(b)},b*1000)},_send:function(){var b,a;if(this._sendEnabled===undefined){this._sendEnabled=PT.option.debug||!(Math.floor(Math.random()*2000))}a=this._events.length;b=this._events.slice(this._sentIdx,a);this._sentIdx=a;if(b.length){PT.console.debug("tk: ",b);if(this._sendEnabled){PT.api.call("/perf/",{method:"post",data:{events:PT.serializer.jsonEncode(b),id:this._id,ua:navigator.userAgent}})}}}});PT.define("platform.facebook",{hasRun:false,capturing:false,appId:undefined,init:function(){var c=this;if(this.hasRun){return}this.hasRun=true;PT.event.bind("facebook.appid",function(d){c.appId=d});var b=window.fbAsyncInit;function a(){PT.event.persistent("facebook.ready",{},false)}if((window.fbAsyncInit&&window.fbAsyncInit.hasRun)||(window.FB!==undefined&&FB.Event!==undefined)){a()}else{window.fbAsyncInit=function(){if(b){b()}a()}}},_triggerLike:function(a,b){PT.event.trigger("facebook.like",{url:a,auto:b||false},false,b||false)},captureLike:function(){var a=this;FB.Event.subscribe("edge.create",function(b){a._triggerLike(b)})},captureComment:function(){FB.Event.subscribe("comment.create",function(a){PT.main.triggerComment(a)})},capture:function(){var a=this;if(this.capturing){return}this.capturing=true;PT.event.bind("facebook.ready",function(){a.captureLike();a.captureComment();a.checkPreviousLike()})},load:function(c,e){var b,a=PT.i18n.language.facebook||"en_US",f="//connect.facebook.net/"+a+"/all.js#xfbml=1",d=this;if(c){f+="&appId="+c}if(!window.FB){(function(j,g,k){var i,h=j.getElementsByTagName(g)[0];if(j.getElementById(k)){PT.event.bind("facebook.ready",function(){d.render(e)});return}i=j.createElement(g);i.id=k;i.src=f;h.parentNode.insertBefore(i,h)}(document,"script","facebook-jssdk"))}else{PT.event.bind("facebook.ready",function(){d.render(e)})}},render:function(a){a=a||undefined;FB.XFBML.parse(a)},createLikeButton:function(a){a=a||{};var b=document.createElement("div");b.className="fb-like";a.href&&b.setAttribute("data-href",a.href);b.setAttribute("data-send",a.send||false);b.setAttribute("data-layout",a.layout||"standard");a.width&&b.setAttribute("data-width",a.width);b.setAttribute("data-show-faces",a.face||false);b.setAttribute("data-colorscheme",a.colorscheme||"light");a.ref&&b.setAttribute("data-ref",a.ref);return b},createLikeBox:function(a){a=a||{};var b=document.createElement("div");b.className="fb-like-box";a.href&&b.setAttribute("data-href",a.href);b.setAttribute("data-send",a.send||false);b.setAttribute("data-layout",a.layout||"standard");a.width&&b.setAttribute("data-width",a.width);b.setAttribute("data-show-faces",a.face||false);b.setAttribute("data-stream",a.stream||false);b.setAttribute("data-header",a.header||false);b.setAttribute("data-colorscheme",a.colorscheme||"light");a.ref&&b.setAttribute("data-ref",a.ref);return b},createCommentBox:function(b){b=b||{};var a=PT.dom.createElement("div",{},"fb-comments");b.href&&a.setAttribute("data-href",b.href);a.setAttribute("data-num-posts",b.numPosts||2);a.setAttribute("data-width",b.width||450);return a},attachEarningMap:function(){var a,c,b,d;a=document.body;if(PT.option.loyalty.earningmap===undefined||PT.option.loyalty.earningmap!==false){if(PT.util.isEnabled(PT.option.loyalty.earningmap.like)){c=a.getElementsByTagName("fb:like");PT.util.each(c,function(){this.innerHTML=this.innerHTML+"<div class='ribbon_earning_map' style='position:absolute;left:-15px;' title='"+PT.i18n.gettext("Earn loyalty points by liking this")+"'></div>"});b=PT.dom.getElementsByClassName("fb-like");PT.util.each(b,function(){PT.widget.earningMap.wrap(this,PT.i18n.gettext("Earn loyalty points by liking this"))})}if(PT.util.isEnabled(PT.option.loyalty.earningmap.comment)){d=a.getElementsByTagName("fb:comments");PT.util.each(d,function(){this.innerHTML=this.innerHTML+"<div class='ribbon_earning_map'  style='position:absolute;left:-18px;' title=\""+PT.i18n.gettext("Earn loyalty points by commenting")+'"></div>'});d=PT.dom.getElementsByClassName("fb-comments");PT.util.each(d,function(){PT.widget.earningMap.insert(this,PT.i18n.gettext("Earn loyalty points by commenting"))})}}},checkPreviousLike:function(){function a(b){if(b){PT.event.trigger("facebook.checkLikes",b)}}PT.event.bind("dom.ready",function(b){PT.util.each(document.body.getElementsByTagName("fb:like"),function(){a(this.getAttribute("href"))});PT.util.each(PT.dom.getElementsByClassName("fb-like"),function(){a(this.getAttribute("data-href"))})})},checkLikes:function(b,a){var c=this;if(a){PT.event.bind("user.connected",function(d){PT.event.bind("facebook.ready",function(e){PT.sso.getLoginStatus(function(f){if(f&&f.authResponse){var h=a.indexOf("facebook")>0,j,i=a,g=f.authResponse.accessToken;if(!h&&isNaN(parseInt(i,10))){j=FB.Data.query('select url from url_like where user_id=me() and url="'+i+'"');j.wait(function(k){if(k.length&&k[0].url){c._triggerLike(k[0].url,true)}})}else{if(h){i=c.extractFBPageId(i,10)}FB.api("/"+i,function(k){var l=k.link;FB.api("/me/likes/"+k.id,{access_token:g},function(m){if(m&&!m.error&&m.data.length>0){c._triggerLike(l,true)}})})}}},{key:b},true,{scope:"user_likes"})})})}},extractFBPageId:function(a){var b=a.indexOf("pages");if(b>0){return a.substring(b).split("/")[2]}else{return a.substring(a.indexOf("com")).split("/")[1]}},attachShare:function(a,c){var b=this;c=c||{};c.display=c.display||"popup";if(a.getAttribute("data-popup")=="true"){a.onclick=function(){var f=c.link||a.getAttribute("data-link");var e="https://www.facebook.com/dialog/feed?app_id="+b.appId+"&display=popup&link="+f+"&redirect_uri=http:"+PT.domain.web+"/close";var d={};if(a.getAttribute("data-width")){d.width=a.getAttribute("data-width")}if(a.getAttribute("data-height")){d.height=a.getAttribute("data-height")}PT.util.popup(e,function(){PT.event.trigger("facebook.share",{ref_id:a.getAttribute("data-ref-id"),share_id:a.getAttribute("data-share-id")})},d);return false}}else{a.onclick=function(){FB.ui({method:"feed",name:c.name||a.getAttribute("data-name"),link:c.link||a.getAttribute("data-link"),caption:c.caption||a.getAttribute("data-caption"),description:c.description||a.getAttribute("data-description"),picture:c.picture||a.getAttribute("data-picture"),display:c.display||a.getAttribute("data-display")},function(d){if(d){PT.event.trigger("facebook.share",{response:d,ref_id:a.getAttribute("data-ref-id"),share_id:a.getAttribute("data-share-id")})}else{PT.event.trigger("facebook.share.cancel")}});return false}}},attachConnect:function(b,a){a=a||{};a.scope=a.scope||["email","user_likes"];a.provider=a.provider||"facebook";if(PT.option.loyalty.authentication){a.provider=PT.option.loyalty.authentication.provider||a.provider;a.scope=PT.option.loyalty.authentication.scope}a.scope=a.scope.join(",");b.onclick=function(c){PT.widget.connect._triggerClick();PT.sso.login(a.provider,function(e){var d=PT.util.clone(e)||{};d.source=b.getAttribute("data-src")||undefined;PT.connect._triggerCheckLoginStatus(d)},a);return false}}});PT.define("platform.google",{hasRun:false,buttons:[],init:function(){var a;if(this.hasRun){return}this.hasRun=true;a=this;window._ptPlusoneCallback=this.plusoneCallback;PT.event.bind("dom.ready",function(b){PT.event.bind("google.ready",function(c){a.renderAll()})});if(typeof gapi!="undefined"&&typeof gapi.plusone!="undefined"&&typeof gapi.plusone.go=="function"){PT.event.persistent("google.ready",{})}else{window.gapi_onload=function(){PT.event.persistent("google.ready",{})}}},load:function(){PT.load.script(["https://apis.google.com/js/plusone.js"],["google.ready"])},createPlusOneButton:function(a){a=a||{};var b=document.createElement("div");b.className=a.className||"g-plusone";b.setAttribute("data-size",a.size||"medium");a.annotation&&b.setAttribute("data-annotation",a.annotation);a.callback&&b.setAttribute("data-callback",a.callback);a.href&&b.setAttribute("data-href",a.href);a.width&&b.setAttribute("data-width",a.width);return b},plusoneCallback:function(a){if(a.state&&a.state==="on"){PT.event.trigger("google.plusone",a,false,false)}},render:function(d){var f,c,b,a,e;d=d||document;f=PT.dom.getElementsByClassName("punchtab-plusone",d);for(c=0;c<f.length;c+=1){a=f[c].attributes;e={callback:"_ptPlusoneCallback"};for(b=0;b<a.length;b+=1){if(a[b].name.substr(0,5)=="data-"){e[a[b].name.substr(5)]=a[b].value}}gapi.plusone.render(f[c],e)}},renderAll:function(){var b,c,a;if(this.buttons.length==0){this.parseElements()}PT.util.each(this.buttons,function(){a=this.attributes;c={callback:"_ptPlusoneCallback"};b=this;PT.util.each(a,function(){if(this.name.substr(0,5)=="data-"){c[this.name.substr(5)]=this.value}});gapi.plusone.render(this,c)})},parseElements:function(){var a,b;b=this;a=document.getElementsByTagName("g:plusone");PT.util.each(a,function(){b.buttons.push(this)});a=PT.dom.getElementsByClassName("g-plusone");PT.util.each(a,function(){b.buttons.push(this)});a=PT.dom.getElementsByClassName("punchtab-plusone");PT.util.each(a,function(){b.buttons.push(this)})},attachEarningMap:function(){if(PT.option.loyalty.earningmap!==false&&PT.util.isEnabled(PT.option.loyalty.earningmap.plusone)){if(this.buttons.length==0){this.parseElements()}PT.util.each(this.buttons,function(){if(this.className.search(/punchtab_no_earningmap(\s|$)/)===-1){PT.widget.earningMap.attach(this,PT.i18n.gettext("Earn loyalty points by clicking on this +1 button"))}})}},attachPlusonePopup:function(c,b){b=b||{};b.url=b.url||document.location.href;var a="https://plus.google.com/share?url="+b.url;c.onclick=function(){window.open(a,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600");return false}}});PT.define("platform.twitter",{hasRun:false,init:function(){if(this.hasRun){return}this.hasRun=true;var a=this;PT.event.bind("twitter.ready",function(){a.capture()});if(window.twttr&&window.twttr.events){PT.event.trigger("twitter.ready",{},true,false)}else{if(window.twttr){window.twttr._e=[];window.twttr.ready=function(b){window.twttr._e.push(b)}}else{window.twttr=(function(){var b;return window.twttr||(b={_e:[],ready:function(c){b._e.push(c)}})}())}if(window.twttr.ready){window.twttr.ready(function(b){PT.event.trigger("twitter.ready",{},true,false)})}}},captureTweet:function(){window.twttr.events.bind("tweet",function(a){PT.event.trigger("twitter.tweet",a,false,false)})},captureRetweet:function(){window.twttr.events.bind("retweet",function(a){PT.event.trigger("twitter.retweet",a,false,false)})},captureFollow:function(){window.twttr.events.bind("follow",function(a){PT.event.trigger("twitter.follow",a.data,false,false)})},captureFavorite:function(){window.twttr.events.bind("favorite",function(a){PT.event.trigger("twitter.favorite",a.data,false,false)})},capture:function(){this.captureTweet();this.captureRetweet();this.captureFollow();this.captureFavorite()},renderButtons:function(a){if(window.twttr&&window.twttr.widgets&&window.twttr.widgets.loaded){window.twttr.widgets.load(a)}},load:function(a){var b=this,c="//platform.twitter.com/widgets.js";if(a===false){c+="?_="+new Date().getTime()}if(!window.twttr||window.twttr.init===undefined){window.twttr=(function(i,f,j){var e,h,g=i.getElementsByTagName(f)[0];if(i.getElementById(j)){b.renderButtons();return window.twttr}h=i.createElement(f);h.id=j;h.src=c;g.parentNode.insertBefore(h,g);return window.twttr||(e={_e:[],ready:function(d){e._e.push(d)}})}(document,"script","twitter-wjs"))}else{b.renderButtons()}},createTweetButton:function(a){var b=document.createElement("a");b.href="https://twitter.com/share";b.className="twitter-share-button";if(a.url&&a.text&&a.text.indexOf("%(url)s")!==-1){a.text=PT.i18n.interpolate(a.text,{url:a.url},true);a.url=" "}a.url&&b.setAttribute("data-url",a.url);a.counturl&&b.setAttribute("data-counturl",a.counturl);a.via&&b.setAttribute("data-via",a.via);a.text&&b.setAttribute("data-text",a.text);a.size&&b.setAttribute("data-size",a.size);a.count&&b.setAttribute("data-count",a.count);a.lang=a.lang||PT.i18n.language.language;b.setAttribute("data-lang",a.lang);a.hashtags&&b.setAttribute("data-hashtags",a.hashtags);b.innerHTML="Tweet";return b},createIntentButton:function(c){var e={tweet_id:c.tweet_id},d=c.type;if(c.type==="reply"){d="tweet";e={in_reply_to:c.tweet_id}}var b=document.createElement("a");b.href="https://twitter.com/intent/"+d+"?"+PT.serializer.qsEncode(e);b.innerHTML='<div class="icon '+c.type+'"></div>';if(PT.util.isIEBrowser()){b.onclick=function(){PT.event.trigger("twitter."+d,{tweet_id:c.tweet_id,ref_id:c.ref_id})}}return b},attachTweet:function(b,c){c=c||{};var a={url:c.url||b.getAttribute("data-url"),via:c.via||b.getAttribute("data-via"),text:c.text||b.getAttribute("data-text"),size:c.size||b.getAttribute("data-size"),count:c.count||b.getAttribute("data-count"),hashtags:c.hashtags||b.getAttribute("data-hashtags"),share_id:c.share_id||b.getAttribute("data-share-id")};if(a.url&&a.text&&a.text.indexOf("%(url)s")!==-1){a.text=PT.i18n.interpolate(a.text,{url:a.url},true);a.url=""}PT.util.each(a,function(d){if(this===window){delete a[d]}});b.href="https://twitter.com/intent/tweet?"+PT.serializer.qsEncode(a);if(PT.util.isIEBrowser()){b.onclick=function(){PT.event.trigger("twitter.tweet",{target:{dataset:{refId:b.getAttribute("data-ref-id")}}})}}},attachRetweet:function(b,a){b.href="https://twitter.com/intent/retweet?tweet_id="+a;if(PT.util.isIEBrowser()){b.onclick=function(){PT.event.trigger("twitter.retweet",{target:{dataset:{refId:b.getAttribute("data-ref-id")}}})}}},createSimpleFollowButton:function(b){var a=document.createElement("a");a.href="https://twitter.com/"+b.screenName;a.className="twitter-follow-button";b.size&&a.setAttribute("data-size",b.size);a.setAttribute("data-show-count",false);b.lang=b.lang||PT.i18n.language.language;a.setAttribute("data-lang",b.lang);a.innerHTML="Follow @"+b.screenName;return a},attachEarningMap:function(){var a;if(PT.option.loyalty.earningmap===undefined||PT.option.loyalty.earningmap!==false){if(PT.util.isEnabled(PT.option.loyalty.earningmap.tweet)){a=PT.dom.getElementsByClassName("twitter-share-button");PT.util.each(a,function(){PT.widget.earningMap.wrap(this,PT.i18n.gettext("Earn loyalty points by tweeting this"))})}}}});PT.define("platform.kissmetrics",{hasRun:false,init:function(){if(this.hasRun){return}this.hasRun=true;window._kmq=window._kmq||[];window._kmk=window._kmk||"bc3528bcb0149b1fe9d2ed46cb72c9b8dd71782b";PT.event.bind("user.connected",function(a){window._kmq.push(["identify",a.uid])});PT.load.script(["//i.kissmetrics.com/i.js","//doug1izaerwt3.cloudfront.net/"+window._kmk+".1.js"]);PT.event.persistent("kissmetrics.ready",{},false)}});PT.define("serializer",{qsEncode:function(b,d){var c,a="",e="";d=d||encodeURIComponent;for(c in b){if(b[c]!==undefined){e+=a+c+"="+d(b[c])}a="&"}return e},qsDecode:function(e,f){var a={},c,d,b;f=f||decodeURIComponent;a={};c=e.slice(e.indexOf("?")+1).split("&");for(b=0;b<c.length;b+=1){d=c[b].split("=");a[d[0]]=f(d[1])}return a},jsonEncode:function(a){return JSON.stringify(a)},jsonDecode:function(a){return JSON.parse(a)},_b64Str:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",base64Encode:function(c){var a,k,h,f,j,g,e,d,b;c=escape(c);a="";b=0;do{k=c.charCodeAt(b++);h=c.charCodeAt(b++);f=c.charCodeAt(b++);j=k>>2;g=((k&3)<<4)|(h>>4);e=((h&15)<<2)|(f>>6);d=f&63;if(isNaN(h)){e=d=64}else{if(isNaN(f)){d=64}}a=a+this._b64Str.charAt(j)+this._b64Str.charAt(g)+this._b64Str.charAt(e)+this._b64Str.charAt(d);k=h=f="";j=g=e=d=""}while(b<c.length);return a},sha1Hash:function(h){var n=[1518500249,1859775393,2400959708,3395469782];h+=String.fromCharCode(128);var x=Math.ceil(h.length/4)+2;var k=Math.ceil(x/16);var m=new Array(k);for(var z=0;z<k;z++){m[z]=new Array(16);for(var y=0;y<16;y++){m[z][y]=(h.charCodeAt(z*64+y*4)<<24)|(h.charCodeAt(z*64+y*4+1)<<16)|(h.charCodeAt(z*64+y*4+2)<<8)|(h.charCodeAt(z*64+y*4+3))}}m[k-1][14]=((h.length-1)*8)/Math.pow(2,32);m[k-1][14]=Math.floor(m[k-1][14]);m[k-1][15]=((h.length-1)*8)&4294967295;var u=1732584193;var r=4023233417;var q=2562383102;var p=271733878;var o=3285377520;var f=new Array(80);var E,D,C,B,A;for(var z=0;z<k;z++){for(var v=0;v<16;v++){f[v]=m[z][v]}for(var v=16;v<80;v++){f[v]=this._rotl(f[v-3]^f[v-8]^f[v-14]^f[v-16],1)}E=u;D=r;C=q;B=p;A=o;for(var v=0;v<80;v++){var w=Math.floor(v/20);var g=(this._rotl(E,5)+this._fSha1(w,D,C,B)+A+n[w]+f[v])&4294967295;A=B;B=C;C=this._rotl(D,30);D=E;E=g}u=(u+E)&4294967295;r=(r+D)&4294967295;q=(q+C)&4294967295;p=(p+B)&4294967295;o=(o+A)&4294967295}return this.toHexStr(u)+this.toHexStr(r)+this.toHexStr(q)+this.toHexStr(p)+this.toHexStr(o)},_fSha1:function(b,a,d,c){switch(b){case 0:return(a&d)^(~a&c);case 1:return a^d^c;case 2:return(a&d)^(a&c)^(d&c);case 3:return a^d^c}},_rotl:function(a,b){return(a<<b)|(a>>>(32-b))},toHexStr:function(d){var c="",a;for(var b=7;b>=0;b--){a=(d>>>(b*4))&15;c+=a.toString(16)}return c},utf8Encode:function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a},utf8Decode:function(a){var b="";var d=0;var e=c1=c2=0;while(d<a.length){e=a.charCodeAt(d);if(e<128){b+=String.fromCharCode(e);d++}else{if((e>191)&&(e<224)){c2=a.charCodeAt(d+1);b+=String.fromCharCode(((e&31)<<6)|(c2&63));d+=2}else{c2=a.charCodeAt(d+1);c3=a.charCodeAt(d+2);b+=String.fromCharCode(((e&15)<<12)|((c2&63)<<6)|(c3&63));d+=3}}}return b}});PT.define("sso",{loginCallback:undefined,loginStatusCallback:undefined,Sso:function(b,a){if(PT.util.isEmpty(a)){this.request=b}else{this.request=this.toObject(b)}},popup:function(b,c,a){this.loginCallback=function(d){if(c.hasRun){return}c.hasRun=true;c&&c(d)};PT.util.popup(b,this.loginCallback,a)},iframeLogin:function(b,d,a){var c=document.createElement("iframe");c.setAttribute("id","auto_login_iframe");document.body.appendChild(c);c.setAttribute("src",b)},login:function(g,h,a,d,e){var b,c,i=window.location.protocol,f=this;if(g==="foursquare"){this.loginCallback=function(j){PT.platform.foursquare.save(j,h)}}else{this.loginCallback=h}switch(g){case"email_only":PT.api.call("/auth/login",{method:"post",data:{email:a.email,key:a.key},success:function(j){f.loginCallback(j)},error:function(j){f.loginCallback(j)},ajax:true,domain:PT.domain.legacy_api});break;case"email_pass":PT.api.call("/auth/login",{method:"post",data:{email:a.email,password:a.password,key:a.key,type:"user"},success:function(j){f.loginCallback(j)},error:function(j){f.loginCallback(j)},ajax:true,domain:PT.domain.legacy_api});break;case"email_full":PT.api.call("/auth/login",{method:"post",data:{first_name:a.first_name,last_name:a.last_name,email:a.email,password:a.password,key:a.key,type:"user"},success:function(j){f.loginCallback(j)},error:function(j){f.loginCallback(j)},ajax:true,domain:PT.domain.legacy_api});break;case"sso":PT.api.call("/auth/sso",{method:"post",data:{auth_request:a.auth_request,signature:a.signature,timestamp:a.timestamp,client_id:a.client_id,key:a.key,type:"user"},success:function(j){if(j.authResponse){PT.cookie.set("sessionid",j.authResponse.accessToken,{expires:j.authResponse.expiresIn})}f.loginCallback(j)},error:function(j){f.loginCallback(j)},ajax:true,domain:PT.domain.legacy_api});break;default:if(PT.util.isEmpty(d)){d="popup"}if(e){return(FB.login(h,a))}a=a||{};if(PT.option.key){a.key=PT.option.key}a.auth="no";a.provider=g;if(g==="foursquare"){b=i+PT.domain.web+"/mast/connect/foursquare"}else{if(g==="instagram"){i="https:";delete a.key}b=i+PT.domain.web+"/sso?"+PT.serializer.qsEncode(a)}if("popup"==d){c=500;if(g==="instagram"){c=1000}this.popup(b,f.loginCallback,{width:c,height:500})}else{if("iframe"==d){this.iframeLogin(b)}}break}},getLoginStatus:function(h,g,f,a){var c,d,b,e=this;if(f){return(FB.getLoginStatus(h,a))}if(!PT.util.isEmpty(g)){if(!PT.util.isEmpty(g.key)){d=g.key}if(!PT.util.isEmpty(g.accessToken)){c=g.accessToken}}this.loginStatusCallback=h;b={};if(PT.util.isEmpty(c)){c=PT.cookie.get("sessionid")}if(!PT.util.isEmpty(c)){PT.api.call("/auth/status",{data:{key:d,token:c},success:function(i){e.loginStatusCallback(i)},error:function(i){e.loginStatusCallback(i)},ajax:true,domain:PT.domain.legacy_api})}else{this.loginStatusCallback(b)}},logout:function(e,d){var c=this,a,b;if(d){return(FB.logout(e))}this.logoutCallback=e;a={};b=PT.cookie.get("sessionid");if(!PT.util.isEmpty(b)){PT.api.call("/auth/logout",{success:function(f){c.logoutCallback(f)},error:function(f){c.logoutCallback(f)},ajax:true,domain:PT.domain.legacy_api})}else{this.logoutCallback(a)}},auto_login:function(d,c){var a,b;b=this;a=PT.cookie.get("sessionid");if(PT.util.isEmpty(a)||c){FB.getLoginStatus(function(e){if("connected"==e.status){b.login("facebook",function(f){d(f)},{},"iframe")}else{d(e)}})}else{d({})}},email:{bind:function(){var a=this;PT.event.bind("sso.email.register",function(d){var c={description:undefined,fields:{}},b=false;if(!PT.util.validateEmail(d.email)){c.description="Invalid email address";c.fields.email="Invalid email address";b=true}if(d.password!==d.confirm_password){c.description=c.description||"Password doesn't match the confirmation";c.fields.password="Password doesn't match the confirmation";b=true}if(!b){a.register({data:d,callback:function(e){PT.event.trigger("sso.email.register.success",d,false,true)},error:function(e){PT.event.trigger("sso.email.register.error",e,false,true)}})}else{PT.event.trigger("sso.email.register.error",{status:false,error:c},false,false)}});PT.event.bind("sso.email.password.forgot",function(b){a.forgotPassword({data:b,callback:function(c){PT.event.trigger("sso.email.password.forgot.success",c,false,false)},error:function(c){PT.event.trigger("sso.email.password.forgot.error",c,false,false)}})});PT.event.bind("sso.email.password.change",function(b){if(b.new_password!==b.confirm_password){PT.event.trigger("sso.email.password.change.error",b,false,false)}else{a.changePassword({data:b,callback:function(c){PT.event.trigger("sso.email.password.change.success",c,false,true)},error:function(c){PT.event.trigger("sso.email.password.change.error",c,false,true)}})}});PT.event.bind("sso.email.update",function(d){var c={description:undefined,fields:{}},b=false;if(!PT.util.validateEmail(d.email)){c.description="Invalid email address";c.fields.email="Invalid email address";b=true}if(d.password!==d.confirm_password){c.description=c.description||"Password doesn't match the confirmation";c.fields.password="Password doesn't match the confirmation";b=true}if(!b){a.update({data:d,callback:function(e){PT.event.trigger("sso.email.update.success",e,false,true)},error:function(e){PT.event.trigger("sso.email.update.error",e,false,true)}})}else{PT.event.trigger("sso.email.update.error",{status:false,error:c},false,true)}})},register:function(a){this._api("register",a)},forgotPassword:function(a){this._api("reset_password",a)},changePassword:function(a){this._api("change_password",a,"post")},update:function(a){this._api("profile",a,"post")},_api:function(b,a,c){PT.api.call("/account/"+b,{data:a.data,method:c||"post",ajax:true,domain:PT.domain.legacy_api,success:function(d){if(d.status&&d.status===true){a.callback&&a.callback(d)}else{a.error&&a.error(d)}},error:function(d){a.error&&a.error(d)}})},loginCallback:function(b){var a=PT.util.clone(b);PT.connect._triggerCheckLoginStatus(a)}}});PT.extend(PT.sso.Sso.prototype,{toObject:function(b){var a={auth_request:b.auth_request.replace(/\*/g,"="),timestamp:b.timestamp,signature:b.signature,client_id:b.client_id};return a},validate:function(){if(!PT.util.isEmpty(this.request)&&!PT.util.isEmpty(this.request.auth_request)&&!PT.util.isEmpty(this.request.signature)&&!PT.util.isEmpty(this.request.timestamp)&&!PT.util.isEmpty(this.request.client_id)){return true}else{return false}},isValid:function(){return this.validate()},toURLParams:function(){return"auth_request="+this.request.auth_request+"&timestamp="+this.request.timestamp+"&signature="+this.request.signature+"&client_id="+this.request.client_id}});PT.define("util",{isEmpty:function(a){if(typeof a=="undefined"||a===null||a===""){return true}if(typeof a=="number"&&isNaN(a)){return true}if(a instanceof Array&&a.length<1){return true}if(a instanceof Date&&isNaN(Number(a))){return true}return false},isEnabled:function(a){return(a!=false&&a!="no")},isDisabled:function(b,a){if(this.isEmpty(b)||this.isEmpty(b[a])){return false}if("no"==b[a]||false==b[a]){return true}return false},isArray:function(b){return Object.prototype.toString.apply(b)==="[object Array]"},isString:function(a){return typeof a==="string"},isObject:function(a){return a!=null&&typeof a==="object"},isUndefined:function(a){return typeof a==="undefined"},each:function(c,b){var a;if(this.isArray(c)||(c!==undefined&&c.length!==undefined)){for(a=0;a<c.length;a+=1){b.apply(c[a],[a])}}else{for(a in c){b.apply(c[a],[a])}}},every:function(c,b){if(this.isArray(c)||this.isString(c)){for(var a=0;a<c.length;++a){if(!b.apply(c,[c[a]])){return false}}return true}else{if(this.isObject(c)){for(var d in c){if(c.hasOwnProperty(d)&&!b.apply(c,[c[d]])){return false}}return true}}return false},intcomma:function(g){var a,e,b,d,c,f;c=PT.i18n.formats.DECIMAL_SEPARATOR;f=PT.i18n.formats.THOUSAND_SEPARATOR;g+="";a=g.split(".");e=a[0];b=a.length>1?"."+a[1]:"";d=/(\d+)(\d{3})/;while(d.test(e)){e=e.replace(d,"$1"+f+"$2")}return e+b},getUTCTime:function(){var a,b;a=new Date();b=a.getTime();return(b)/1000},daydiff:function(c,a){var b=parseInt((a.getTime()-c.getTime())/(1000*60*60*24),10);b=b===0?1:b;return b},timeago:function(i){var h;if(typeof i==="string"){var g=i.split(" ");var c=g[0];var b=g[1];var k=c.split("-");var a=b.split(":");h=Date.UTC(k[0],k[1]-1,k[2],a[0],a[1],a[2],0)}else{if(typeof i==="object"){h=i}else{h=i}}var j=new Date();var f=(j.getTime()-h)/1000;var e;if(f<5){return" "+PT.i18n.gettext("just now")}else{if(f<60){e=Math.floor(f);return PT.i18n.interpolate(PT.i18n.ngettext("%(number)s second ago","%(number)s seconds ago",e),{number:e},true)}else{if(f/60<60){e=Math.floor(f/60);return PT.i18n.interpolate(PT.i18n.ngettext("%(number)s minute ago","%(number)s minutes ago",e),{number:e},true)}else{if(f/60/60<24){e=Math.floor(f/60/60);return PT.i18n.interpolate(PT.i18n.ngettext("%(number)s hour ago","%(number)s hours ago",e),{number:e},true)}else{e=Math.floor(f/60/60/24);return PT.i18n.interpolate(PT.i18n.ngettext("%(number)s day ago","%(number)s days ago",e),{number:e},true)}}}}},customTimeStamp:function(k){var i;if(typeof k==="string"){var h=k.split(" ");var c=h[0];var b=h[1];var l=c.split("-");var a=b.split(":");i=new Date(l[0],l[1]-1,l[2],a[0],a[1],a[2],0)}else{if(typeof k==="object"){i=k}else{i=k}}var g=i.getMonth()+1;if(g<10){g="0"+g}var j=i.getDate();if(j<10){j="0"+j}var f=(i.getHours())%24;if(f<10){f="0"+f}var e=i.getMinutes();if(e<10){e="0"+e}return(g+"/"+j+"/"+i.getFullYear()+" "+f+":"+e)},getTheBeginingOfNextDay:function(){var b=new Date();var a=new Date(b.getTime()+24*60*60*1000);a.setHours(0);a.setMinutes(0);return a},isBrowserSafari:function(){var a=navigator.userAgent.toLowerCase();if((a.indexOf("safari")>=0)&&(-1==a.indexOf("chrome"))){return true}else{return false}},fixSafariIframeCookie:function(d){var a,e,b,c;if(this.isBrowserSafari()&&this.isEmpty(document.cookie)){document.write("<div id='safari_div'> </div>");a="safari_div";e=document.getElementById(a);b=document.createElement("iframe");c=document.createElement("form");b.name=a;b.style.display="none";b.src="javascript:false";e.appendChild(b);c.action="/safari_blank_fix";c.method="GET";c.target=a;e.appendChild(c);c.submit();PT.event.persistent("safari.fix")}},merge:function(d,c){var b,a={};for(b in d){a[b]=d[b]}for(b in c){a[b]=c[b]}return a},popup:function(a,i,j){j=j||{};j.width=j.width||500;j.height=j.height||500;var b,g,e=this,h=j.title,d=(screen.width/2)-(j.width/2),f=(screen.height/2)-(j.height/2),c="width="+j.width+", height="+j.height+", top="+f+", left="+d;b=window.open(a,h,c);g=window.setInterval(function(){if(b.closed){window.clearInterval(g);i&&i()}},500)},indexOf:function(f,c){if(Array.prototype.indexOf){return f.indexOf(c)}else{if(f==null){throw new TypeError()}var d=Object(f);var a=d.length>>>0;if(a===0){return -1}var e=0;if(arguments.length>1){e=Number(arguments[1]);if(e!=e){e=0}else{if(e!=0&&e!=Infinity&&e!=-Infinity){e=(e>0||-1)*Math.floor(Math.abs(e))}}}if(e>=a){return -1}var b=e>=0?e:Math.max(a-Math.abs(e),0);for(;b<a;b++){if(b in d&&d[b]===c){return b}}return -1}},clone:function(c){if(c===undefined){return}var b={};for(var a in c){if(c.hasOwnProperty(a)){if(typeof c[a]!=="object"){b[a]=c[a]}else{b[a]=this.clone(c[a])}}}return b},validateEmail:function(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)},isInt:function(a){var b=parseInt(a);if(isNaN(b)){return false}return a==b&&a.toString()==b.toString()},deepMerge:function(d,f){var b,c,a=0,h=PT.util.isArray(f),g=h&&[]||{};if(h){d=d||[];g=g.concat(d);for(c in f){if(f.hasOwnProperty(c)){if(typeof c==="object"){g[a]=this.deepMerge(d[a],c)}else{if(d.indexOf(c)===-1){g.push(c)}}a+=1}}}else{if(d&&typeof d==="object"){for(b in d){if(d.hasOwnProperty(b)){g[b]=d[b]}}}for(b in f){if(f.hasOwnProperty(b)&&f[b]!==undefined){if(typeof f[b]!=="object"||!f[b]){g[b]=f[b]}else{if(!d[b]){g[b]=f[b]}else{g[b]=PT.util.deepMerge(d[b],f[b])}}}}}return g},hashCode:function(c){var b=0;if(c.length==0){return b}for(var a=0;a<c.length;a++){character=c.charCodeAt(a);b=((b<<5)-b)+character;b=b&b}return b.toString()},trim:function(a){return a.replace(/^\s+|\s+$/g,"")},applyNameFormat:function(a){nameArray=a.split(" ");if(nameArray.length>1){return nameArray[0]+" "+nameArray[1][0]+"."}else{return a}},isMobileBrowser:function(){return navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)},isIEBrowser:function(){return((/MSIE (\d+\.\d+);/).test(navigator.userAgent)||(!!navigator.userAgent.match(/Trident\/7\./)))},isIE8:function(){return(navigator.userAgent.toLowerCase().indexOf("msie")!==-1&&(navigator.userAgent.toLowerCase().split("msie")[1]===8))},addLeadingZeros:function(d,a){var b="",c;a=a===undefined?2:a;if(d.toString().length<a){for(c=0;c<a-d.toString().length;c+=1){b+="0"}return b+d.toString()}else{return d.toString()}},capitalize:function(a){if(!a){return a}return a.charAt(0).toUpperCase()+a.slice(1)},map:function(g,f){if(Array.prototype.map){return Array.prototype.map.call(g,f)}else{"use strict";if(g===void 0||g===null){throw new TypeError()}var e=Object(g);var a=e.length>>>0;if(typeof f!=="function"){throw new TypeError()}var d=new Array(a);var b=arguments.length>=2?arguments[1]:void 0;for(var c=0;c<a;c++){if(c in e){d[c]=f.call(b,e[c],c,e)}}return d}}});PT.define("user",{haveBeenBind:false,accessToken:undefined,uid:undefined,userID:undefined,username:undefined,referrerId:undefined,newUser:undefined,isConnected:false,redeemable_points:undefined,connect:function(c,d,b,g,f,a,e){this.accessToken=c;this.uid=d;this.userID=b;this.username=g;this.referrerId=f;this.newUser=a;this.forcePasswordChange=e;this.isConnected=true;PT.event.persistent("user.connected",this,false);PT.event.persistent("user.ready",this,false)},disconnect:function(a){this.accessToken=undefined;this.uid=undefined;this.userID=undefined;this.username=undefined;this.referrerId=a;this.newUser=undefined;this.optins=undefined;this.first_name=undefined;this.last_name=undefined;this.avatar=undefined;this.profile=undefined;this.user_id=undefined;this.isConnected=false;PT.event.persistent("user.disconnected",{},false);PT.event.persistent("user.ready",{},false)},_triggerUserUpdated:function(a){a=a||this;PT.event.persistent("user.updated",a,false,true)},bind:function(){if(this.haveBeenBind){return}this.haveBeenBind=true;PT.event.bind("user.updated",function(a){PT.user=PT.util.merge(PT.user,a)})},update:function(a){var b,c;for(b in a){c=a[b];this[b]=c}this._triggerUserUpdated()},get:function(a,c){var b=this;if(PT.user[a]===undefined||c===true){PT.api.call("/user",{success:function(d){b._triggerUserUpdated(d)}})}else{b._triggerUserUpdated(PT.user)}},getActivities:function(a){PT.api.call("/activity",{data:{limit:a||-1},success:function(b){PT.event.trigger("user.activity",b)}})},getRedemptions:function(){PT.api.call("/activity/redeem",{success:function(a){PT.event.trigger("user.redemption",a)}})},getProfile:function(){PT.api.call("/account/profile",{success:function(a){PT.event.trigger("user.profile",a)}})},updateProfile:function(a,b){PT.api.call("/account/profile",{method:b||"post",data:a,success:function(c){PT.event.trigger("user.profile.updated",c)},error:function(c){PT.event.trigger("user.profile.error",c)}})},getOptins:function(){var a=this;PT.api.call("/user/optin",{success:function(b){a.processOptinResponse(b)}})},addOptins:function(b){var e=this;var c=["shared_email","terms_and_conditions","shared_content","sweeps_rules"];var a={};for(var d=0;d<b.length;d++){if(PT.util.indexOf(c,b[d])==-1){alert("wrong optin attrs")}else{a[b[d]]=true}}PT.api.call("/user/optin",{method:"post",data:a,success:function(f){e.processOptinResponse(f);PT.event.trigger("user.optin.success",a)},error:function(f){PT.event.trigger("user.optin.error")}})},processOptinResponse:function(a){var c={};for(var b in a){c[b]=a[b]}PT.user.optins=PT.user.optins||{};PT.user.optins=PT.util.merge(PT.user.optins,c);PT.event.trigger("user.optin.updated")},addParams:function(b){var a=this;PT.api.call("/user/param/value",{method:"post",data:{fields:JSON.stringify(b)},success:function(c){a.getParams();PT.event.trigger("user.params.insert.success")},error:function(c){PT.event.trigger("user.params.insert.error")}})},getParams:function(){var a=this;PT.api.call("/user/param/value",{success:function(b){a.processUserParamsResponse(b)}})},processUserParamsResponse:function(a){var c={};for(var b in a){c[b]=a[b]}PT.user.params=PT.user.params||{};PT.user.params=PT.util.merge(PT.user.params,c);PT.event.trigger("user.params.updated")},});PT.defineWidget("connect",["platform","scope"],{__render:function(b,a){a=a||{};if(a.scope){a.scope=a.scope.split(",")}this.attachPlatformConnect(b,a.platform,a.scope)},cssInserted:false,create:function(){var a;this.insertCss();a=document.createElement("button");a.name="connect";a.className="fb-btn";a.innerHTML=PT.i18n.gettext("Login");this.attachConnect(a);return a},attachConnect:function(b,a){a=a||{};if(PT.option.key){a.key=PT.option.key}PT.platform.facebook.attachConnect(b,a)},_triggerClick:function(){PT.event.trigger("connect.click")},attachPlatformConnect:function(e,a,c){var d=this,b;if(c){b={scope:c}}e.onclick=function(){d._triggerClick();PT.sso.login(a,function(f){PT.action.connection.get(function(g){if(a in g){PT.event.trigger("user."+a+".connected")}})},b);return false}},insertCss:function(){if(this.cssInserted){return}this.cssInserted=true;PT.dom.insertCss(this.css)},css:"button.fb-btn {font-size: 100%;vertical-align:baseline;*vertical-align: middle;margin: auto;padding: 5px 15px;text-shadow: 1px 0px 0 rgba(0,0,0,.4);border-radius: 5px;border: none;font-family: cabin,sans-serif;font-weight: bold;display: block;color: #fff;background: #28577A;background: -moz-linear-gradient(top,  #28577A 0%, #28577A 50%, #254E6E 51%, #254E6E 100%);background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#28577A), color-stop(50%,#28577A), color-stop(51%,#254E6E), color-stop(100%,#254E6E));background: -webkit-linear-gradient(top,  #28577A 0%,#28577A 50%,#254E6E 51%,#254E6E 100%);background: linear-gradient(top,  #28577A 0%,#28577A 50%,#254E6E 51%,#254E6E 100%);}"});PT.defineWidget("giveaway",["uuid","language","width","fbid"],{giveawayList:[],Giveaway:function(e,d,c){var f=d.uuid||e.id,b=PT.i18n.gettext("The uuid of the giveaway must be provided"),a;if(f===null||f===undefined){throw b}this.index=c;this.holder=e;this.container=e.parentNode;this.uuid=f;a={language:d.language||this.options.language,width:d.width||this.options.width,facebookPageId:d.fbid||this.options.facebookPageId};this.options=a;this.socketName="giveaway_"+f+"_"+c;PT.platform.google.load()},__beforeInit:function(){PT.option.init();PT.dom.init()},__render:function(d,b,a){try{var e=new this.Giveaway(d,b,a);this.giveawayList.push(e);e.load()}catch(c){PT.console.debug("new giveaway:",c)}}});PT.extend(PT.widget.giveaway.Giveaway.prototype,{container:undefined,holder:undefined,wrapper:undefined,uuid:undefined,index:0,reloaded:false,youtubeLoaded:false,loadingTimeout:undefined,socketName:undefined,overlay:undefined,options:{width:"400",language:"en",facebookPageId:undefined},iframeStyle:{width:"400px",visibility:"hidden"},constants:{baseUrl:document.location.protocol+PT.domain.web+"/giveaway/widget",loaderImgPath:"nd/images/ajax-loader.gif",closeBtnPath:"giveaway/images/close.png",overlayId:"pt-giveaway-overlay"},load:function(){var a=this;if(!this.wrapper){this._buildWrapper()}this.wrapper.appendChild(this._createLoader());PT.console.debug("new giveaway:","["+new Date()+"]","loader displayed");this.createSocket();a._loadIframe()},_loadIframe:function(){var b,a,d=this;function c(){var g=d.wrapper.firstChild,e=document.createElement("button"),f=document.createElement("p");f.innerHTML=PT.i18n.gettext("Looks like we are having problems loading the giveaway. Please reload the widget.");e.innerHTML="Reload";g.appendChild(f);g.appendChild(e);e.onclick=function(){var h=d.wrapper;d.reloaded=true;while(h.hasChildNodes()){h.removeChild(h.firstChild)}PT.xdm.destroy(d.socketName);d.load();return false}}this.loadingTimeout=window.setTimeout(c,7000)},_createLoader:function(){var c=document.createElement("div"),b=document.createElement("h1"),a=document.createElement("img");a.src=PT.domain.cdn+this.constants.loaderImgPath;a.setAttribute("class","loading");a.style.padding="5px";a.style.background="#fff";a.style.borderRadius="5px";c.setAttribute("class","giveaway_loading");c.style.padding="10px";c.style.textAlign="center";c.style.margin="auto";c.style.fontFamily="'Cabin', sans-serif";b.style.fontSize="24px";b.style.fontWeight="bold";b.style.color="#434343";b.innerHTML=PT.i18n.gettext("Loading the giveaway...");c.appendChild(b);c.appendChild(a);return c},_buildWrapper:function(){var a;this.wrapper=document.createElement("div");this.wrapper.className=this.holder.className;this.container.replaceChild(this.wrapper,this.holder);this.wrapper.style.position="relative";if(this.options.width==="auto"){a=this.container.offsetWidth+"px";this.wrapper.style.width=a;this.iframeStyle.width=a}else{a=this.options.width+"px";this.wrapper.style.width=a;this.iframeStyle.width=a}},showIframe:function(){PT.console.debug("new giveaway:","["+new Date()+"]","ready");var b=this.wrapper.firstChild,a=this.wrapper.getElementsByTagName("iframe")[0];window.clearTimeout(this.loadingTimeout);b.parentNode.removeChild(b);a.style.visibility="visible"},show:function(){this.wrapper.style.display="block"},hide:function(){this.wrapper.style.display="none"},resize:function(a){var b=this.wrapper.getElementsByTagName("iframe")[0];b.style.height=a+"px"},getId:function(a){return"_"+this.index+"_"+a},showPlusoneBtn:function(a,g,d,e){var f=document.getElementById("plusone-wrapper"+this.getId(g)),c=document.createElement("div");if(f!==null){f.style.display="block";return}else{f=document.createElement("div")}f.id="plusone-wrapper"+this.getId(g);f.style.position="absolute";f.style.left=d/2+"px";f.style.top=e+"px";c.id="plusone-div"+this.getId(g);f.appendChild(c);this.wrapper.appendChild(f);function b(h){if(h&&h.state==="on"){PT.event.trigger("giveaway.plusone.done",{url:a})}}if(gapi!==undefined){gapi.plusone.render("plusone-div"+this.getId(g),{size:"standard",callback:b,href:a})}},hidePlusoneBtn:function(b){var a=document.getElementById("plusone-wrapper"+this.getId(b));if(a!==null){a.style.display="none"}},showYoutubeModal:function(h,g,e,f){var a="youtube"+this.getId(g),c,b,d=this;if(!this.youtubeLoaded){this.overlay=this.overlay||document.getElementById("pt-giveaway-overlay")||undefined;if(!this.overlay){this.overlay=this._createOverlay();document.body.appendChild(this.overlay)}this.youtubeLoaded=true;PT.load.script(["https://www.youtube.com/player_api"],["youtube.api.ready"])}PT.event.bind("youtube.api.ready",function(){var i;d._buildYoutubeIframe(h,a);YT.ready(function(){i=new YT.Player(a,{events:{onStateChange:function(j){if(j.data===0){PT.event.trigger("giveaway.youtube.done",{id:h})}}}})});d.overlay.style.display="block"})},hideYoutubeModal:function(a){if(this.youtubeLoaded){this.overlay.style.display="none";this.overlay.innerHTML=""}},_buildYoutubeIframe:function(g,d){var c,b,f={height:360,width:640},a={width:45,height:45},e=this;c=document.createElement("div");c.onclick=function(h){e.hideYoutubeModal();h.stopPropagation();return false};c.style.top="50%";c.style.left="50%";c.style.marginLeft=(f.width/2-(a.width/2))+"px";c.style.marginTop=-(f.height/2+(a.height/2))+"px";c.style.height=a.height+"px";c.style.width=a.width+"px";c.style.position="absolute";c.style.cursor="pointer";c.style.backgroundImage="url("+PT.domain.cdn+this.constants.closeBtnPath+")";c.style.backgroundRepeat="no-repeat";c.style.zIndex="1";this.overlay.appendChild(c);b=document.createElement("iframe");b.src="https://www.youtube.com/embed/"+g+"?enablejsapi=1&playerapiid="+d+"&version=3&wmode=opaque&autoplay=1";b.id=d;b.style.position="absolute";b.style.top="50%";b.style.left="50%";b.style.width="640px";b.style.height="360px";b.style.marginLeft="-320px";b.style.marginTop="-180px";b.style.border="none";this.overlay.appendChild(b)},_createOverlay:function(){opacity_overlay=document.createElement("div");opacity_overlay.style.display="none";opacity_overlay.style.position="fixed";opacity_overlay.style.left="0px";opacity_overlay.style.right="0px";opacity_overlay.style.bottom="0px";opacity_overlay.style.top="0px";opacity_overlay.style.zIndex="2147483601";opacity_overlay.id=this.constants.overlayId;opacity_overlay.style.display="block";if(navigator.userAgent.indexOf("MSIE")!==-1){opacity_overlay.style.background="url("+PT.domain.cdn+"img/ie-overlay.png) repeat"}else{opacity_overlay.style.background="rgba(0, 0, 0, 0.7)"}return opacity_overlay},registerRpc:function(){var b,a;for(b=0,a=arguments.length;b<a;b+=1){PT.xdm.rpcRegister(this.socketName,arguments[b],this)}},createSocket:function(){var d,b,a,c;b=this.constants.baseUrl+"?uuid="+this.uuid+"&width="+this.options.width+"&language="+this.options.language;if(this.options.facebookPageId){b+="&facebook_page_id="+(this.options.facebookPageId||"")}PT.xdm.socket(this.socketName,{remote:b,container:this.wrapper,props:{style:{width:this.iframeStyle.width,visibility:this.iframeStyle.visibility,"-webkit-transition":"height 0.5s ease","-moz-transition":"height 0.5s ease",transition:"height 0.5s ease"},scrolling:"no",frameborder:"0",allowTransparency:"true"}});this.registerRpc("showIframe","resize","showPlusoneBtn","hidePlusoneBtn","showYoutubeModal","hideYoutubeModal")}});(function(d,a,f){var b={getComputedStyle:function(h,g){return PT.dom.getComputedStyle(h,g)},getElementsByClassName:function(g,h){return PT.dom.getElementsByClassName(g,h)},indexOf:function(h,g){return PT.util.indexOf(h,g)}},e={width:{style:"marginLeft",key:{previous:[37],next:[39]}},height:{style:"marginTop",key:{previous:[38],next:[40]}}};function c(h,g){h=(typeof h==="string")?a.getElementById(h):h;g=g||{};this.index=g.index||0;this.current=f;this.length=0;this.loop=g.loop||false;this.hide=(g.hide===false)?false:true;this.property=(g.property==="height")?"height":"width";this.animation=(g.animation===false||!$)?false:true;this.gestureEnabled=(g.gestureEnabled===false||!$||!$.fn.swipe)?false:true;g.duration=g.duration||{};this.duration={timeout:f,animation:g.duration.effect||450,pause:g.duration.pause||1000};g.node=g.node||{};g.node.wrapper=h;this.node={wrapper:g.node.wrapper,slides:f,slide:f,pagination:g.node.pagination,page:f,next:g.node.next,previous:g.node.previous};this.findNodes();this.positions=[];g.key=g.key||{};this.key={enable:(g.key.enable===false)?false:true,previous:g.key.previous||e[this.property].key.previous,next:g.key.next||e[this.property].key.next};this.canMove=function(i){return true};this.run()}c.prototype.run=function(){this.css();this.bind();this.parse();this.move(0);return this};c.prototype.findNodes=function(){this.node.slides=this.node.slides||b.getElementsByClassName("slides",this.node.wrapper)[0];this.node.slide=this.node.slides.childNodes;this.node.pagination=this.node.pagination||b.getElementsByClassName("pagination",this.node.wrapper)[0];if(this.node.pagination){this.node.page=b.getElementsByClassName("page",this.node.pagination)}else{this.node.page=[]}this.node.next=this.node.next||b.getElementsByClassName("next",this.node.wrapper)[0]||{};this.node.previous=this.node.previous||b.getElementsByClassName("previous",this.node.wrapper)[0]||{}};c.prototype.css=function(){this.node.wrapper.style.overflow="hidden";this.node.slides.style.overflow="hidden"};c.prototype.parse=function(){var g,k,h,j=0;this.positions=[];this.length=this.node.slide.length;for(h=0;h<this.length;h+=1){g=this.node.slide[h];if(this.property==="width"){g.style.cssFloat="left";g.style.styleFloat="left"}k=parseInt(b.getComputedStyle(g,this.property),10);this.positions.push(j);j+=k}this[this.property]=j;this.node.slides.style[this.property]=j+"px"};c.prototype.pagination=function(){var g,k,l,j,h=this;if(this.hide!==false){if(this.node.previous.style){if(this.first){this.node.previous.style.display="none"}else{this.node.previous.style.display="block"}}if(this.node.next.style){if(this.last){this.node.next.style.display="none"}else{this.node.next.style.display="block"}}}j=this.node.page.length;if(j>0){for(g=0;g<j;g+=1){l=this.node.page[g].className;this.node.page[g].className=l.replace(" current","")}this.node.page[this.index].className+=" current"}};c.prototype.bind=function(){var h,m,l=this,o=true,k=a.onkeydown,g=a.onkeyup;this.node.next.onclick=function(){l.next()};this.node.previous.onclick=function(){l.previous()};function n(p){if(o){o=false;var i=p.keyCode||p.which;k&&k(p);if(l.key.enable){if(l.key.next&&(b.indexOf(l.key.next,i)!==-1)){l.next()}if(l.key.previous&&(b.indexOf(l.key.previous,i)!==-1)){l.previous()}}}}function j(i){g&&g(i);if(l.key.enable){o=true}}if(a.addEventListener){a.addEventListener("keydown",n);a.addEventListener("keyup",j)}else{a.attachEvent("onkeydown",n);a.attachEvent("onkeyup",j)}for(h=0;h<this.node.page.length;h+=1){m=this.node.page[h];m.onclick=function(p){return function(i){l.move(p);return false}}(h)}if(this.gestureEnabled&&$&&$.fn.swipe){$(this.node.slides).swipe({swipeLeft:function(p,r,s,q,i){l.next()},swipeRight:function(p,r,s,q,i){l.previous()}})}};c.prototype.resume=function(){var g=this;if(this.loop){this.duration.timeout=d.setTimeout(function(){g.index=(g.index===g.length-1)?-1:g.index;g.next(false);g.resume()},this.duration.pause)}};c.prototype.pause=function(){d.clearInterval(this.duration.timeout)};c.prototype.next=function(h){var g;this.events.trigger("next.before",this);g=(this.index>=(this.length-1))?this.index:this.index+1;this.events.trigger("next",this);this.move(g,h)};c.prototype.previous=function(h){var g;this.events.trigger("previous.before",this);g=(this.index<=0)?this.index:this.index-1;this.events.trigger("previous",this);this.move(g,h)};c.prototype.move=function(h,k){if(!this.canMove(h)){return}var g,j=this,i=e[this.property].style,l;this.events.trigger("move.before",this);this.index=h;if(k!==false){this.pause();this.resume()}this.current=this.node.slide[this.index];this.first=(this.index===0);this.last=(this.index===this.length-1);l=-this.positions[this.index];this.pagination();this.events.trigger("move",this);if(this.animation&&$){g={};g[i]=l;$(this.node.slides).stop().animate(g,{duration:this.duration.animation,complete:function(){j.events.trigger("animate.after",j)}})}else{this.node.slides.style[i]=l+"px";this.events.trigger("animate.after",j)}this.events.trigger("animate",this)};c.prototype.events={_listeners:{},bind:function(g,h){this._listeners[g]=this._listeners[g]||[];this._listeners[g].push(h)},unbind:function(g){this._listeners[g]=[]},trigger:function(g,j){this._listeners[g]=this._listeners[g]||[];for(var h=0;h<this._listeners[g].length;h+=1){this._listeners[g][h].call(j,g)}}};c.prototype.remove=function(g){var h=(g===f||g<0||g>this.length)?this.current:this.node.slide[g];this.node.slides.removeChild(h);this.parse();return h};c.prototype.insert=function(j,h){var g=(h===f||h<0||h>this.length)?this.current:this.node.slide[h];this.node.slides.insertBefore(j,g);this.parse()};PT.widget.Slider=c})(window,document);PT.define("widget.toggle",{hasRun:false,init:function(){if(this.hasRun){return}this.hasRun=true},_countParents:function(a){var b=0;while(a!==null){a=a.parentElement;b+=1}return b},_firstLevelElement:function(f,e){var b,h=0,d,a,c=0,g=PT.dom.getElementsByClassName(f,e);if(g.length===1){return g[0]}for(d=0,a=g.length;d<a;d+=1){c=this._countParents(g[d]);if(b===undefined||h>c){h=c;b=g[d]}}return b},_updateElements:function(b,k,h,f,e){var a,d,j,g,c,i=this;f=f||"none";e=e||"none";if(typeof b=="string"){a=PT.dom.getElementsByClassName(b)}else{a=[b]}PT.util.each(a,function(){this.className=this.className.replace(" pt-toggle-state-on","").replace(" pt-toggle-state-off","").replace(" pt-toggle-state-wait","").replace(" pt-toggle-state-error","");if(f==="block"){this.className+=" pt-toggle-state-wait"}else{if(h==="block"){this.className+=" pt-toggle-state-off"}else{if(k==="block"){this.className+=" pt-toggle-state-on"}else{if(k==="error"){this.className+=" pt-toggle-state-error"}}}}d=i._firstLevelElement("pt-toggle-on",this);if(d){PT.dom.css(d,{display:k})}j=i._firstLevelElement("pt-toggle-off",this);if(j){PT.dom.css(j,{display:h})}g=i._firstLevelElement("pt-toggle-wait",this);if(g){PT.dom.css(g,{display:f})}c=i._firstLevelElement("pt-toggle-error",this);if(c){PT.dom.css(c,{display:e})}})},on:function(a){this._updateElements(a,"block","none")},off:function(a){this._updateElements(a,"none","block");if(typeof a=="string"){PT.event.trigger("toggle.off",a)}else{PT.event.trigger("toggle.off")}},wait:function(a){this._updateElements(a,"none","none","block")},error:function(a){this._updateElements(a,"none","none","none","block")}});if(document.domain.search("punchtab.com")!=-1){document.domain="punchtab.com"}PT.define("xdm",{_sockets:{},socket:function(c,b){this._sockets[c]=this._sockets[c]||{};this._sockets[c].onReady=this._sockets[c].onReady||[];this._sockets[c].onMessage=this._sockets[c].onMessage||[];var d,f=this,a=this._sockets[c].socket;b=b||{};b.onReady&&this._sockets[c].onReady.push(b.onReady);b.onMessage&&this._sockets[c].onMessage.push(b.onMessage);if(!a){b.onReady=function(){PT.xdm.postMessage(c,{type:"event_history",data:PT.event.getHistory()},PT.serializer.jsonEncode);for(d=0;d<f._sockets[c].onReady.length;d+=1){f._sockets[c].onReady[d].call(this)}};b.onMessage=function(i,e){try{i=PT.serializer.jsonDecode(i)}catch(h){i=PT.serializer.qsDecode(i)}for(d=0;d<f._sockets[c].onMessage.length;d+=1){f._sockets[c].onMessage[d].call(this,i,e)}};this._sockets[c].propagate=function(e){if(e.origin!=c){PT.xdm.postMessage(c,{type:"event",data:e},PT.serializer.jsonEncode)}};PT.event.bind("all",this._sockets[c].propagate);this._sockets[c].onMessage.push(function(h){var e,i;if(h.type==="event"){PT.event.trigger(h.data.type,h.data.response,h.data.persistent,h.data.propagation,c)}else{if(h.type==="event_history"){for(i in h.data){if(h.data[i]!==false){PT.event.trigger(i,h.data[i].response,h.data[i].persistent,h.data[i].propagation,c)}}}else{if(h.type==="ping"){PT.xdm.postMessage(c,{type:"pong"},PT.serializer.jsonEncode)}else{if(h.type==="pong"){PT.event.trigger("xdm.pong",null,false,false)}}}}});this._sockets[c].onMessage.push(function(e){if(e.type==="rpc"){PT.xdm._rpcExecute(c,e.fnName,e.args)}});try{a=new easyXDM.Socket(b);this._sockets[c].socket=a}catch(g){PT.console.log("xdm: create socket",g)}}},postMessage:function(a,c,b){if(this._sockets[a]&&this._sockets[a].socket){b=b||PT.serializer.qsEncode;if(typeof c==="object"){c=b(c)}this._sockets[a].socket.postMessage(c)}},destroy:function(a){try{PT.event.unbind("all",this._sockets[a].propagate);this._sockets[a].socket.destroy()}catch(b){PT.console.log("xdm: destroy socket",b)}finally{delete this._sockets[a]}},ping:function(a){this.postMessage(a,{type:"ping"},PT.serializer.jsonEncode)},rpcRegister:function(a,c,b){PT.xdm._sockets[a].rpcMethods=PT.xdm._sockets[a].rpcMethods||{};PT.xdm._sockets[a].rpcMethods[c]=b},_rpcExecute:function(c,d,b){var a=PT.xdm._sockets[c].rpcMethods;b=b||[];if(typeof a[d]==="function"){a[d](b)}else{a[d][d].apply(a[d],b)}},rpcCall:function(b,c,a){PT.xdm.postMessage(b,{type:"rpc",fnName:c,args:a},PT.serializer.jsonEncode)}});(function(N,d,p,K,k,H){if(N.easyXDM){return}var b=this;var n=Math.floor(Math.random()*10000);var q=Function.prototype;var Q=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/;var R=/[\-\w]+\/\.\.\//;var F=/([^:])\/\//g;var I="";var o={};var M=N.easyXDM;var U="easyXDM_";var E;var y=false;var i;var h;function C(X,Z){var Y=typeof X[Z];return Y=="function"||(!!(Y=="object"&&X[Z]))||Y=="unknown"}function u(X,Y){return !!(typeof(X[Y])=="object"&&X[Y])}function r(X){return Object.prototype.toString.call(X)==="[object Array]"}function c(){var Z="Shockwave Flash",ad="application/x-shockwave-flash";if(!t(navigator.plugins)&&typeof navigator.plugins[Z]=="object"){var ab=navigator.plugins[Z].description;if(ab&&!t(navigator.mimeTypes)&&navigator.mimeTypes[ad]&&navigator.mimeTypes[ad].enabledPlugin){i=ab.match(/\d+/g)}}if(!i){var Y;try{Y=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");i=Array.prototype.slice.call(Y.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1);Y=null}catch(ac){}}if(!i){return false}var X=parseInt(i[0],10),aa=parseInt(i[1],10);h=X>9&&aa>0;return true}var v,x;if(C(N,"addEventListener")){v=function(Z,X,Y){Z.addEventListener(X,Y,false)};x=function(Z,X,Y){Z.removeEventListener(X,Y,false)}}else{if(C(N,"attachEvent")){v=function(X,Z,Y){X.attachEvent("on"+Z,Y)};x=function(X,Z,Y){X.detachEvent("on"+Z,Y)}}else{throw new Error("Browser not supported")}}var W=false,J=[],L;if("readyState" in d){L=d.readyState;W=L=="complete"||(~navigator.userAgent.indexOf("AppleWebKit/")&&(L=="loaded"||L=="interactive"))}else{W=!!d.body}function s(){if(W){return}W=true;for(var X=0;X<J.length;X++){J[X]()}J.length=0}if(!W){if(C(N,"addEventListener")){v(d,"DOMContentLoaded",s)}else{v(d,"readystatechange",function(){if(d.readyState=="complete"){s()}});if(d.documentElement.doScroll&&N===top){var g=function(){if(W){return}try{d.documentElement.doScroll("left")}catch(X){K(g,1);return}s()};g()}}v(N,"load",s)}function G(Y,X){if(W){Y.call(X);return}J.push(function(){Y.call(X)})}function m(){var Z=parent;if(I!==""){for(var X=0,Y=I.split(".");X<Y.length;X++){Z=Z[Y[X]]}}return Z.easyXDM}function e(X){N.easyXDM=M;I=X;if(I){U="easyXDM_"+I.replace(".","_")+"_"}return o}function z(X){return X.match(Q)[3]}function f(X){return X.match(Q)[4]||""}function j(Z){var X=Z.toLowerCase().match(Q);var aa=X[2],ab=X[3],Y=X[4]||"";if((aa=="http:"&&Y==":80")||(aa=="https:"&&Y==":443")){Y=""}return aa+"//"+ab+Y}function B(X){X=X.replace(F,"$1/");if(!X.match(/^(http||https):\/\//)){var Y=(X.substring(0,1)==="/")?"":p.pathname;if(Y.substring(Y.length-1)!=="/"){Y=Y.substring(0,Y.lastIndexOf("/")+1)}X=p.protocol+"//"+p.host+Y+X}while(R.test(X)){X=X.replace(R,"")}return X}function P(X,aa){var ac="",Z=X.indexOf("#");if(Z!==-1){ac=X.substring(Z);X=X.substring(0,Z)}var ab=[];for(var Y in aa){if(aa.hasOwnProperty(Y)){ab.push(Y+"="+H(aa[Y]))}}return X+(y?"#":(X.indexOf("?")==-1?"?":"&"))+ab.join("&")+ac}var S=(function(X){X=X.substring(1).split("&");var Z={},aa,Y=X.length;while(Y--){aa=X[Y].split("=");Z[aa[0]]=k(aa[1])}return Z}(/xdm_e=/.test(p.search)?p.search:p.hash));function t(X){return typeof X==="undefined"}var O=function(){var Y={};var Z={a:[1,2,3]},X='{"a":[1,2,3]}';if(typeof JSON!="undefined"&&typeof JSON.stringify==="function"&&JSON.stringify(Z).replace((/\s/g),"")===X){return JSON}if(Object.toJSON){if(Object.toJSON(Z).replace((/\s/g),"")===X){Y.stringify=Object.toJSON}}if(typeof String.prototype.evalJSON==="function"){Z=X.evalJSON();if(Z.a&&Z.a.length===3&&Z.a[2]===3){Y.parse=function(aa){return aa.evalJSON()}}}if(Y.stringify&&Y.parse){O=function(){return Y};return Y}return null};function T(X,Y,Z){var ab;for(var aa in Y){if(Y.hasOwnProperty(aa)){if(aa in X){ab=Y[aa];if(typeof ab==="object"){T(X[aa],ab,Z)}else{if(!Z){X[aa]=Y[aa]}}}else{X[aa]=Y[aa]}}}return X}function a(){var Y=d.body.appendChild(d.createElement("form")),X=Y.appendChild(d.createElement("input"));X.name=U+"TEST"+n;E=X!==Y.elements[X.name];d.body.removeChild(Y)}function A(Y){if(t(E)){a()}var ac;if(E){ac=d.createElement('<iframe name="'+Y.props.name+'"/>')}else{ac=d.createElement("IFRAME");ac.name=Y.props.name}ac.id=ac.name=Y.props.name;delete Y.props.name;if(typeof Y.container=="string"){Y.container=d.getElementById(Y.container)}if(!Y.container){T(ac.style,{position:"absolute",top:"-2000px",left:"0px"});Y.container=d.body}var ab=Y.props.src;Y.props.src="javascript:false";T(ac,Y.props);ac.border=ac.frameBorder=0;ac.allowTransparency=true;Y.container.appendChild(ac);if(Y.onLoad){v(ac,"load",Y.onLoad)}if(Y.usePost){var aa=Y.container.appendChild(d.createElement("form")),X;aa.target=ac.name;aa.action=ab;aa.method="POST";if(typeof(Y.usePost)==="object"){for(var Z in Y.usePost){if(Y.usePost.hasOwnProperty(Z)){if(E){X=d.createElement('<input name="'+Z+'"/>')}else{X=d.createElement("INPUT");X.name=Z}X.value=Y.usePost[Z];aa.appendChild(X)}}}aa.submit();aa.parentNode.removeChild(aa)}else{ac.src=ab}Y.props.src=ab;return ac}function V(aa,Z){if(typeof aa=="string"){aa=[aa]}var Y,X=aa.length;while(X--){Y=aa[X];Y=new RegExp(Y.substr(0,1)=="^"?Y:("^"+Y.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"));if(Y.test(Z)){return true}}return false}function l(Z){var ae=Z.protocol,Y;Z.isHost=Z.isHost||t(S.xdm_p);y=Z.hash||false;if(!Z.props){Z.props={}}if(!Z.isHost){Z.channel=S.xdm_c.replace(/["'<>\\]/g,"");Z.secret=S.xdm_s;Z.remote=S.xdm_e.replace(/["'<>\\]/g,"");ae=S.xdm_p;if(Z.acl&&!V(Z.acl,Z.remote)){throw new Error("Access denied for "+Z.remote)}}else{Z.remote=B(Z.remote);Z.channel=Z.channel||"default"+n++;Z.secret=Math.random().toString(16).substring(2);if(t(ae)){if(j(p.href)==j(Z.remote)){ae="4"}else{if(C(N,"postMessage")||C(d,"postMessage")){ae="1"}else{if(Z.swf&&C(N,"ActiveXObject")&&c()){ae="6"}else{if(navigator.product==="Gecko"&&"frameElement" in N&&navigator.userAgent.indexOf("WebKit")==-1){ae="5"}else{if(Z.remoteHelper){ae="2"}else{ae="0"}}}}}}}Z.protocol=ae;switch(ae){case"0":T(Z,{interval:100,delay:2000,useResize:true,useParent:false,usePolling:false},true);if(Z.isHost){if(!Z.local){var ac=p.protocol+"//"+p.host,X=d.body.getElementsByTagName("img"),ad;var aa=X.length;while(aa--){ad=X[aa];if(ad.src.substring(0,ac.length)===ac){Z.local=ad.src;break}}if(!Z.local){Z.local=N}}var ab={xdm_c:Z.channel,xdm_p:0};if(Z.local===N){Z.usePolling=true;Z.useParent=true;Z.local=p.protocol+"//"+p.host+p.pathname+p.search;ab.xdm_e=Z.local;ab.xdm_pa=1}else{ab.xdm_e=B(Z.local)}if(Z.container){Z.useResize=false;ab.xdm_po=1}Z.remote=P(Z.remote,ab)}else{T(Z,{channel:S.xdm_c,remote:S.xdm_e,useParent:!t(S.xdm_pa),usePolling:!t(S.xdm_po),useResize:Z.useParent?false:Z.useResize})}Y=[new o.stack.HashTransport(Z),new o.stack.ReliableBehavior({}),new o.stack.QueueBehavior({encode:true,maxLength:4000-Z.remote.length}),new o.stack.VerifyBehavior({initiate:Z.isHost})];break;case"1":Y=[new o.stack.PostMessageTransport(Z)];break;case"2":Z.remoteHelper=B(Z.remoteHelper);Y=[new o.stack.NameTransport(Z),new o.stack.QueueBehavior(),new o.stack.VerifyBehavior({initiate:Z.isHost})];break;case"3":Y=[new o.stack.NixTransport(Z)];break;case"4":Y=[new o.stack.SameOriginTransport(Z)];break;case"5":Y=[new o.stack.FrameElementTransport(Z)];break;case"6":if(!i){c()}Y=[new o.stack.FlashTransport(Z)];break}Y.push(new o.stack.QueueBehavior({lazy:Z.lazy,remove:true}));return Y}function D(aa){var ab,Z={incoming:function(ad,ac){this.up.incoming(ad,ac)},outgoing:function(ac,ad){this.down.outgoing(ac,ad)},callback:function(ac){this.up.callback(ac)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}};for(var Y=0,X=aa.length;Y<X;Y++){ab=aa[Y];T(ab,Z,true);if(Y!==0){ab.down=aa[Y-1]}if(Y!==X-1){ab.up=aa[Y+1]}}return ab}function w(X){X.up.down=X.down;X.down.up=X.up;X.up=X.down=null}T(o,{version:"2.4.16.3",query:S,stack:{},apply:T,getJSONObject:O,whenReady:G,noConflict:e});o.DomHelper={on:v,un:x,requiresJSON:function(X){if(!u(N,"JSON")){d.write('<script type="text/javascript" src="'+X+'"><\/script>')}}};(function(){var X={};o.Fn={set:function(Y,Z){X[Y]=Z},get:function(Z,Y){var aa=X[Z];if(Y){delete X[Z]}return aa}}}());o.Socket=function(Y){var X=D(l(Y).concat([{incoming:function(ab,aa){Y.onMessage(ab,aa)},callback:function(aa){if(Y.onReady){Y.onReady(aa)}}}])),Z=j(Y.remote);this.origin=j(Y.remote);this.destroy=function(){X.destroy()};this.postMessage=function(aa){X.outgoing(aa,Z)};X.init()};o.Rpc=function(Z,Y){if(Y.local){for(var ab in Y.local){if(Y.local.hasOwnProperty(ab)){var aa=Y.local[ab];if(typeof aa==="function"){Y.local[ab]={method:aa}}}}}var X=D(l(Z).concat([new o.stack.RpcBehavior(this,Y),{callback:function(ac){if(Z.onReady){Z.onReady(ac)}}}]));this.origin=j(Z.remote);this.destroy=function(){X.destroy()};X.init()};o.stack.SameOriginTransport=function(Y){var Z,ab,aa,X;return(Z={outgoing:function(ad,ae,ac){aa(ad);if(ac){ac()}},destroy:function(){if(ab){ab.parentNode.removeChild(ab);ab=null}},onDOMReady:function(){X=j(Y.remote);if(Y.isHost){T(Y.props,{src:P(Y.remote,{xdm_e:p.protocol+"//"+p.host+p.pathname,xdm_c:Y.channel,xdm_p:4}),name:U+Y.channel+"_provider"});ab=A(Y);o.Fn.set(Y.channel,function(ac){aa=ac;K(function(){Z.up.callback(true)},0);return function(ad){Z.up.incoming(ad,X)}})}else{aa=m().Fn.get(Y.channel,true)(function(ac){Z.up.incoming(ac,X)});K(function(){Z.up.callback(true)},0)}},init:function(){G(Z.onDOMReady,Z)}})};o.stack.FlashTransport=function(aa){var ac,X,ab,ad,Y,ae;function af(ah,ag){K(function(){ac.up.incoming(ah,ad)},0)}function Z(ah){var ag=aa.swf+"?host="+aa.isHost;var aj="easyXDM_swf_"+Math.floor(Math.random()*10000);o.Fn.set("flash_loaded"+ah.replace(/[\-.]/g,"_"),function(){o.stack.FlashTransport[ah].swf=Y=ae.firstChild;var ak=o.stack.FlashTransport[ah].queue;for(var al=0;al<ak.length;al++){ak[al]()}ak.length=0});if(aa.swfContainer){ae=(typeof aa.swfContainer=="string")?d.getElementById(aa.swfContainer):aa.swfContainer}else{ae=d.createElement("div");T(ae.style,h&&aa.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0});d.body.appendChild(ae)}var ai="callback=flash_loaded"+ah.replace(/[\-.]/g,"_")+"&proto="+b.location.protocol+"&domain="+z(b.location.href)+"&port="+f(b.location.href)+"&ns="+I;ae.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+aj+"' data='"+ag+"'><param name='allowScriptAccess' value='always'></param><param name='wmode' value='transparent'><param name='movie' value='"+ag+"'></param><param name='flashvars' value='"+ai+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+ai+"' allowScriptAccess='always' wmode='transparent' src='"+ag+"' height='1' width='1'></embed></object>"}return(ac={outgoing:function(ah,ai,ag){Y.postMessage(aa.channel,ah.toString());if(ag){ag()}},destroy:function(){try{Y.destroyChannel(aa.channel)}catch(ag){}Y=null;if(X){X.parentNode.removeChild(X);X=null}},onDOMReady:function(){ad=aa.remote;o.Fn.set("flash_"+aa.channel+"_init",function(){K(function(){ac.up.callback(true)})});o.Fn.set("flash_"+aa.channel+"_onMessage",af);aa.swf=B(aa.swf);var ah=z(aa.swf);var ag=function(){o.stack.FlashTransport[ah].init=true;Y=o.stack.FlashTransport[ah].swf;Y.createChannel(aa.channel,aa.secret,j(aa.remote),aa.isHost);if(aa.isHost){if(h&&aa.swfNoThrottle){T(aa.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"})}T(aa.props,{src:P(aa.remote,{xdm_e:j(p.href),xdm_c:aa.channel,xdm_p:6,xdm_s:aa.secret}),name:U+aa.channel+"_provider"});X=A(aa)}};if(o.stack.FlashTransport[ah]&&o.stack.FlashTransport[ah].init){ag()}else{if(!o.stack.FlashTransport[ah]){o.stack.FlashTransport[ah]={queue:[ag]};Z(ah)}else{o.stack.FlashTransport[ah].queue.push(ag)}}},init:function(){G(ac.onDOMReady,ac)}})};o.stack.PostMessageTransport=function(aa){var ac,ad,Y,Z;function X(ae){if(ae.origin){return j(ae.origin)}if(ae.uri){return j(ae.uri)}if(ae.domain){return p.protocol+"//"+ae.domain}throw"Unable to retrieve the origin of the event"}function ab(af){var ae=X(af);if(ae==Z&&af.data.substring(0,aa.channel.length+1)==aa.channel+" "){ac.up.incoming(af.data.substring(aa.channel.length+1),ae)}}return(ac={outgoing:function(af,ag,ae){Y.postMessage(aa.channel+" "+af,ag||Z);if(ae){ae()}},destroy:function(){x(N,"message",ab);if(ad){Y=null;ad.parentNode.removeChild(ad);ad=null}},onDOMReady:function(){Z=j(aa.remote);if(aa.isHost){var ae=function(af){if(af.data==aa.channel+"-ready"){Y=("postMessage" in ad.contentWindow)?ad.contentWindow:ad.contentWindow.document;x(N,"message",ae);v(N,"message",ab);K(function(){ac.up.callback(true)},0)}};v(N,"message",ae);T(aa.props,{src:P(aa.remote,{xdm_e:j(p.href),xdm_c:aa.channel,xdm_p:1}),name:U+aa.channel+"_provider"});ad=A(aa)}else{v(N,"message",ab);Y=("postMessage" in N.parent)?N.parent:N.parent.document;Y.postMessage(aa.channel+"-ready",Z);K(function(){ac.up.callback(true)},0)}},init:function(){G(ac.onDOMReady,ac)}})};o.stack.FrameElementTransport=function(Y){var Z,ab,aa,X;return(Z={outgoing:function(ad,ae,ac){aa.call(this,ad);if(ac){ac()}},destroy:function(){if(ab){ab.parentNode.removeChild(ab);ab=null}},onDOMReady:function(){X=j(Y.remote);if(Y.isHost){T(Y.props,{src:P(Y.remote,{xdm_e:j(p.href),xdm_c:Y.channel,xdm_p:5}),name:U+Y.channel+"_provider"});ab=A(Y);ab.fn=function(ac){delete ab.fn;aa=ac;K(function(){Z.up.callback(true)},0);return function(ad){Z.up.incoming(ad,X)}}}else{if(d.referrer&&j(d.referrer)!=S.xdm_e){N.top.location=S.xdm_e}aa=N.frameElement.fn(function(ac){Z.up.incoming(ac,X)});Z.up.callback(true)}},init:function(){G(Z.onDOMReady,Z)}})};o.stack.NameTransport=function(ab){var ac;var ae,ai,aa,ag,ah,Y,X;function af(al){var ak=ab.remoteHelper+(ae?"#_3":"#_2")+ab.channel;ai.contentWindow.sendMessage(al,ak)}function ad(){if(ae){if(++ag===2||!ae){ac.up.callback(true)}}else{af("ready");ac.up.callback(true)}}function aj(ak){ac.up.incoming(ak,Y)}function Z(){if(ah){K(function(){ah(true)},0)}}return(ac={outgoing:function(al,am,ak){ah=ak;af(al)},destroy:function(){ai.parentNode.removeChild(ai);ai=null;if(ae){aa.parentNode.removeChild(aa);aa=null}},onDOMReady:function(){ae=ab.isHost;ag=0;Y=j(ab.remote);ab.local=B(ab.local);if(ae){o.Fn.set(ab.channel,function(al){if(ae&&al==="ready"){o.Fn.set(ab.channel,aj);ad()}});X=P(ab.remote,{xdm_e:ab.local,xdm_c:ab.channel,xdm_p:2});T(ab.props,{src:X+"#"+ab.channel,name:U+ab.channel+"_provider"});aa=A(ab)}else{ab.remoteHelper=ab.remote;o.Fn.set(ab.channel,aj)}var ak=function(){var al=ai||this;x(al,"load",ak);o.Fn.set(ab.channel+"_load",Z);(function am(){if(typeof al.contentWindow.sendMessage=="function"){ad()}else{K(am,50)}}())};ai=A({props:{src:ab.local+"#_4"+ab.channel},onLoad:ak})},init:function(){G(ac.onDOMReady,ac)}})};o.stack.HashTransport=function(Z){var ac;var ah=this,af,aa,X,ad,am,ab,al;var ag,Y;function ak(ao){if(!al){return}var an=Z.remote+"#"+(am++)+"_"+ao;((af||!ag)?al.contentWindow:al).location=an}function ae(an){ad=an;ac.up.incoming(ad.substring(ad.indexOf("_")+1),Y)}function aj(){if(!ab){return}var an=ab.location.href,ap="",ao=an.indexOf("#");if(ao!=-1){ap=an.substring(ao)}if(ap&&ap!=ad){ae(ap)}}function ai(){aa=setInterval(aj,X)}return(ac={outgoing:function(an,ao){ak(an)},destroy:function(){N.clearInterval(aa);if(af||!ag){al.parentNode.removeChild(al)}al=null},onDOMReady:function(){af=Z.isHost;X=Z.interval;ad="#"+Z.channel;am=0;ag=Z.useParent;Y=j(Z.remote);if(af){T(Z.props,{src:Z.remote,name:U+Z.channel+"_provider"});if(ag){Z.onLoad=function(){ab=N;ai();ac.up.callback(true)}}else{var ap=0,an=Z.delay/50;(function ao(){if(++ap>an){throw new Error("Unable to reference listenerwindow")}try{ab=al.contentWindow.frames[U+Z.channel+"_consumer"]}catch(aq){}if(ab){ai();ac.up.callback(true)}else{K(ao,50)}}())}al=A(Z)}else{ab=N;ai();if(ag){al=parent;ac.up.callback(true)}else{T(Z,{props:{src:Z.remote+"#"+Z.channel+new Date(),name:U+Z.channel+"_consumer"},onLoad:function(){ac.up.callback(true)}});al=A(Z)}}},init:function(){G(ac.onDOMReady,ac)}})};o.stack.ReliableBehavior=function(Y){var aa,ac;var ab=0,X=0,Z="";return(aa={incoming:function(af,ad){var ae=af.indexOf("_"),ag=af.substring(0,ae).split(",");af=af.substring(ae+1);if(ag[0]==ab){Z="";if(ac){ac(true);ac=null}}if(af.length>0){aa.down.outgoing(ag[1]+","+ab+"_"+Z,ad);if(X!=ag[1]){X=ag[1];aa.up.incoming(af,ad)}}},outgoing:function(af,ad,ae){Z=af;ac=ae;aa.down.outgoing(X+","+(++ab)+"_"+af,ad)}})};o.stack.QueueBehavior=function(Z){var ac,ad=[],ag=true,aa="",af,X=0,Y=false,ab=false;function ae(){if(Z.remove&&ad.length===0){w(ac);return}if(ag||ad.length===0||af){return}ag=true;var ah=ad.shift();ac.down.outgoing(ah.data,ah.origin,function(ai){ag=false;if(ah.callback){K(function(){ah.callback(ai)},0)}ae()})}return(ac={init:function(){if(t(Z)){Z={}}if(Z.maxLength){X=Z.maxLength;ab=true}if(Z.lazy){Y=true}else{ac.down.init()}},callback:function(ai){ag=false;var ah=ac.up;ae();ah.callback(ai)},incoming:function(ak,ai){if(ab){var aj=ak.indexOf("_"),ah=parseInt(ak.substring(0,aj),10);aa+=ak.substring(aj+1);if(ah===0){if(Z.encode){aa=k(aa)}ac.up.incoming(aa,ai);aa=""}}else{ac.up.incoming(ak,ai)}},outgoing:function(al,ai,ak){if(Z.encode){al=H(al)}var ah=[],aj;if(ab){while(al.length!==0){aj=al.substring(0,X);al=al.substring(aj.length);ah.push(aj)}while((aj=ah.shift())){ad.push({data:ah.length+"_"+aj,origin:ai,callback:ah.length===0?ak:null})}}else{ad.push({data:al,origin:ai,callback:ak})}if(Y){ac.down.init()}else{ae()}},destroy:function(){af=true;ac.down.destroy()}})};o.stack.VerifyBehavior=function(ab){var ac,aa,Y,Z=false;function X(){aa=Math.random().toString(16).substring(2);ac.down.outgoing(aa)}return(ac={incoming:function(af,ad){var ae=af.indexOf("_");if(ae===-1){if(af===aa){ac.up.callback(true)}else{if(!Y){Y=af;if(!ab.initiate){X()}ac.down.outgoing(af)}}}else{if(af.substring(0,ae)===Y){ac.up.incoming(af.substring(ae+1),ad)}}},outgoing:function(af,ad,ae){ac.down.outgoing(aa+"_"+af,ad,ae)},callback:function(ad){if(ab.initiate){X()}}})};o.stack.RpcBehavior=function(ad,Y){var aa,af=Y.serializer||O();var ae=0,ac={};function X(ag){ag.jsonrpc="2.0";aa.down.outgoing(af.stringify(ag))}function ab(ag,ai){var ah=Array.prototype.slice;return function(){var aj=arguments.length,al,ak={method:ai};if(aj>0&&typeof arguments[aj-1]==="function"){if(aj>1&&typeof arguments[aj-2]==="function"){al={success:arguments[aj-2],error:arguments[aj-1]};ak.params=ah.call(arguments,0,aj-2)}else{al={success:arguments[aj-1]};ak.params=ah.call(arguments,0,aj-1)}ac[""+(++ae)]=al;ak.id=ae}else{ak.params=ah.call(arguments,0)}if(ag.namedParams&&ak.params.length===1){ak.params=ak.params[0]}X(ak)}}function Z(an,am,ai,al){if(!ai){if(am){X({id:am,error:{code:-32601,message:"Procedure not found."}})}return}var ak,ah;if(am){ak=function(ao){ak=q;X({id:am,result:ao})};ah=function(ao,ap){ah=q;var aq={id:am,error:{code:-32099,message:ao}};if(ap){aq.error.data=ap}X(aq)}}else{ak=ah=q}if(!r(al)){al=[al]}try{var ag=ai.method.apply(ai.scope,al.concat([ak,ah]));if(!t(ag)){ak(ag)}}catch(aj){ah(aj.message)}}return(aa={incoming:function(ah,ag){var ai=af.parse(ah);if(ai.method){if(Y.handle){Y.handle(ai,X)}else{Z(ai.method,ai.id,Y.local[ai.method],ai.params)}}else{var aj=ac[ai.id];if(ai.error){if(aj.error){aj.error(ai.error)}}else{if(aj.success){aj.success(ai.result)}}delete ac[ai.id]}},init:function(){if(Y.remote){for(var ag in Y.remote){if(Y.remote.hasOwnProperty(ag)){ad[ag]=ab(Y.remote[ag],ag)}}}aa.down.init()},destroy:function(){for(var ag in Y.remote){if(Y.remote.hasOwnProperty(ag)&&ad.hasOwnProperty(ag)){delete ad[ag]}}aa.down.destroy()}})};b.easyXDM=o})(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent);